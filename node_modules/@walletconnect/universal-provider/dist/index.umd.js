(function(Jr,et){typeof exports=="object"&&typeof module<"u"?et(exports):typeof define=="function"&&define.amd?define(["exports"],et):(Jr=typeof globalThis<"u"?globalThis:Jr||self,et(Jr["@walletconnect/universal-provider"]={}))})(this,function(Jr){"use strict";var et=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function my(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Xu(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var je={exports:{}},Ai=typeof Reflect=="object"?Reflect:null,Qu=Ai&&typeof Ai.apply=="function"?Ai.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},bs;Ai&&typeof Ai.ownKeys=="function"?bs=Ai.ownKeys:Object.getOwnPropertySymbols?bs=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:bs=function(e){return Object.getOwnPropertyNames(e)};function by(t){console&&console.warn&&console.warn(t)}var eh=Number.isNaN||function(e){return e!==e};function se(){se.init.call(this)}je.exports=se,je.exports.once=_y,se.EventEmitter=se,se.prototype._events=void 0,se.prototype._eventsCount=0,se.prototype._maxListeners=void 0;var th=10;function vs(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(se,"defaultMaxListeners",{enumerable:!0,get:function(){return th},set:function(t){if(typeof t!="number"||t<0||eh(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");th=t}}),se.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},se.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||eh(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function rh(t){return t._maxListeners===void 0?se.defaultMaxListeners:t._maxListeners}se.prototype.getMaxListeners=function(){return rh(this)},se.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Qu(c,this,r);else for(var u=c.length,h=ah(c,u),i=0;i<u;++i)Qu(h[i],this,r);return!0};function ih(t,e,r,i){var n,s,o;if(vs(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),n=rh(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,by(a)}return t}se.prototype.addListener=function(e,r){return ih(this,e,r,!1)},se.prototype.on=se.prototype.addListener,se.prototype.prependListener=function(e,r){return ih(this,e,r,!0)};function vy(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function nh(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=vy.bind(i);return n.listener=r,i.wrapFn=n,n}se.prototype.once=function(e,r){return vs(r),this.on(e,nh(this,e,r)),this},se.prototype.prependOnceListener=function(e,r){return vs(r),this.prependListener(e,nh(this,e,r)),this},se.prototype.removeListener=function(e,r){var i,n,s,o,a;if(vs(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Ey(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},se.prototype.off=se.prototype.removeListener,se.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function sh(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?xy(n):ah(n,n.length)}se.prototype.listeners=function(e){return sh(this,e,!0)},se.prototype.rawListeners=function(e){return sh(this,e,!1)},se.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):oh.call(t,e)},se.prototype.listenerCount=oh;function oh(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}se.prototype.eventNames=function(){return this._eventsCount>0?bs(this._events):[]};function ah(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Ey(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function xy(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function _y(t,e){return new Promise(function(r,i){function n(o){t.removeListener(e,s),i(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}ch(t,e,s,{once:!0}),e!=="error"&&Iy(t,n,{once:!0})})}function Iy(t,e,r){typeof t.on=="function"&&ch(t,"error",e,r)}function ch(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var L={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ko=function(t,e){return Ko=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ko(t,e)};function Sy(t,e){Ko(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Wo=function(){return Wo=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Wo.apply(this,arguments)};function Ay(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Dy(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function $y(t,e){return function(r,i){e(r,i,t)}}function Oy(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Py(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(h){try{u(i.next(h))}catch(l){o(l)}}function c(h){try{u(i.throw(h))}catch(l){o(l)}}function u(h){h.done?s(h.value):n(h.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function By(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return c([u,h])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(h){u=[6,h],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Cy(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Ty(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Go(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function uh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function Ry(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(uh(arguments[e]));return t}function Ny(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function un(t){return this instanceof un?(this.v=t,this):new un(t)}function Uy(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){l(s[0][3],d)}}function c(f){f.value instanceof un?Promise.resolve(f.value.v).then(u,h):l(s[0][2],f)}function u(f){a("next",f)}function h(f){a("throw",f)}function l(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Fy(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:un(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Ly(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Go=="function"?Go(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function ky(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function My(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function jy(t){return t&&t.__esModule?t:{default:t}}function qy(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function zy(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Hy=Object.freeze({__proto__:null,__extends:Sy,get __assign(){return Wo},__rest:Ay,__decorate:Dy,__param:$y,__metadata:Oy,__awaiter:Py,__generator:By,__createBinding:Cy,__exportStar:Ty,__values:Go,__read:uh,__spread:Ry,__spreadArrays:Ny,__await:un,__asyncGenerator:Uy,__asyncDelegator:Fy,__asyncValues:Ly,__makeTemplateObject:ky,__importStar:My,__importDefault:jy,__classPrivateFieldGet:qy,__classPrivateFieldSet:zy}),Es=Xu(Hy),Yo={},hn={},hh;function Vy(){if(hh)return hn;hh=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return hn.delay=t,hn}var Xr={},Zo={},Qr={},lh;function Ky(){return lh||(lh=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.ONE_THOUSAND=Qr.ONE_HUNDRED=void 0,Qr.ONE_HUNDRED=100,Qr.ONE_THOUSAND=1e3),Qr}var Jo={},fh;function Wy(){return fh||(fh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Jo)),Jo}var dh;function ph(){return dh||(dh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Es;e.__exportStar(Ky(),t),e.__exportStar(Wy(),t)}(Zo)),Zo}var gh;function Gy(){if(gh)return Xr;gh=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.fromMiliseconds=Xr.toMiliseconds=void 0;const t=ph();function e(i){return i*t.ONE_THOUSAND}Xr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Xr.fromMiliseconds=r,Xr}var yh;function Yy(){return yh||(yh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Es;e.__exportStar(Vy(),t),e.__exportStar(Gy(),t)}(Yo)),Yo}var Di={},wh;function Zy(){if(wh)return Di;wh=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Di.Watch=t,Di.default=t,Di}var Xo={},ln={},mh;function Jy(){if(mh)return ln;mh=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.IWatch=void 0;class t{}return ln.IWatch=t,ln}var bh;function Xy(){return bh||(bh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Es.__exportStar(Jy(),t)}(Xo)),Xo}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Es;e.__exportStar(Yy(),t),e.__exportStar(Zy(),t),e.__exportStar(Xy(),t),e.__exportStar(ph(),t)})(L);class ei{}class Qy extends ei{constructor(e){super()}}const vh=L.FIVE_SECONDS,ti={pulse:"heartbeat_pulse"};class Qo extends Qy{constructor(e){super(e),this.events=new je.exports.EventEmitter,this.interval=vh,this.interval=e?.interval||vh}static async init(e){const r=new Qo(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),L.toMiliseconds(this.interval))}pulse(){this.events.emit(ti.pulse)}}const ew=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,tw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,rw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function iw(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){nw(t);return}return e}function nw(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function xs(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!rw.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(ew.test(t)||tw.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,iw)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function sw(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ie(t,...e){try{return sw(t(...e))}catch(r){return Promise.reject(r)}}function ow(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function aw(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function _s(t){if(ow(t))return String(t);if(aw(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return _s(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ea="base64:";function cw(t){return typeof t=="string"?t:ea+lw(t)}function uw(t){return typeof t!="string"||!t.startsWith(ea)?t:hw(t.slice(ea.length))}function hw(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function lw(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function tt(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function fw(...t){return tt(t.join(":"))}function Is(t){return t=tt(t),t?t+":":""}function dw(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function pw(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function d5(t){return t}const gw="memory",yw=()=>{const t=new Map;return{name:gw,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function ww(t={}){const e={mounts:{"":t.driver||yw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const h of e.mountpoints)if(u.startsWith(h))return{base:h,relativeKey:u.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,h)=>e.mountpoints.filter(l=>l.startsWith(u)||h&&u.startsWith(l)).map(l=>({relativeBase:u.length>l.length?u.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),n=(u,h)=>{if(e.watching){h=tt(h);for(const l of e.watchListeners)l(u,h)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Eh(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,h,l)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of u){const g=typeof d=="string",v=tt(g?d:d.key),I=g?void 0:d.value,A=g||!d.options?h:{...h,...d.options},b=r(v);p(b).items.push({key:v,value:I,relativeKey:b.relativeKey,options:A})}return Promise.all([...f.values()].map(d=>l(d))).then(d=>d.flat())},c={hasItem(u,h={}){u=tt(u);const{relativeKey:l,driver:f}=r(u);return Ie(f.hasItem,l,h)},getItem(u,h={}){u=tt(u);const{relativeKey:l,driver:f}=r(u);return Ie(f.getItem,l,h).then(p=>xs(p))},getItems(u,h={}){return a(u,h,l=>l.driver.getItems?Ie(l.driver.getItems,l.items.map(f=>({key:f.relativeKey,options:f.options})),h).then(f=>f.map(p=>({key:fw(l.base,p.key),value:xs(p.value)}))):Promise.all(l.items.map(f=>Ie(l.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:xs(p)})))))},getItemRaw(u,h={}){u=tt(u);const{relativeKey:l,driver:f}=r(u);return f.getItemRaw?Ie(f.getItemRaw,l,h):Ie(f.getItem,l,h).then(p=>uw(p))},async setItem(u,h,l={}){if(h===void 0)return c.removeItem(u);u=tt(u);const{relativeKey:f,driver:p}=r(u);p.setItem&&(await Ie(p.setItem,f,_s(h),l),p.watch||n("update",u))},async setItems(u,h){await a(u,h,async l=>{if(l.driver.setItems)return Ie(l.driver.setItems,l.items.map(f=>({key:f.relativeKey,value:_s(f.value),options:f.options})),h);l.driver.setItem&&await Promise.all(l.items.map(f=>Ie(l.driver.setItem,f.relativeKey,_s(f.value),f.options)))})},async setItemRaw(u,h,l={}){if(h===void 0)return c.removeItem(u,l);u=tt(u);const{relativeKey:f,driver:p}=r(u);if(p.setItemRaw)await Ie(p.setItemRaw,f,h,l);else if(p.setItem)await Ie(p.setItem,f,cw(h),l);else return;p.watch||n("update",u)},async removeItem(u,h={}){typeof h=="boolean"&&(h={removeMeta:h}),u=tt(u);const{relativeKey:l,driver:f}=r(u);f.removeItem&&(await Ie(f.removeItem,l,h),(h.removeMeta||h.removeMata)&&await Ie(f.removeItem,l+"$",h),f.watch||n("remove",u))},async getMeta(u,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),u=tt(u);const{relativeKey:l,driver:f}=r(u),p=Object.create(null);if(f.getMeta&&Object.assign(p,await Ie(f.getMeta,l,h)),!h.nativeOnly){const d=await Ie(f.getItem,l+"$",h).then(g=>xs(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(u,h,l={}){return this.setItem(u+"$",h,l)},removeMeta(u,h={}){return this.removeItem(u+"$",h)},async getKeys(u,h={}){u=Is(u);const l=i(u,!0);let f=[];const p=[];let d=!0;for(const v of l){v.driver.flags?.maxDepth||(d=!1);const I=await Ie(v.driver.getKeys,v.relativeBase,h);for(const A of I){const b=v.mountpoint+tt(A);f.some(m=>b.startsWith(m))||p.push(b)}f=[v.mountpoint,...f.filter(A=>!A.startsWith(v.mountpoint))]}const g=h.maxDepth!==void 0&&!d;return p.filter(v=>(!g||dw(v,h.maxDepth))&&pw(v,u))},async clear(u,h={}){u=Is(u),await Promise.all(i(u,!1).map(async l=>{if(l.driver.clear)return Ie(l.driver.clear,l.relativeBase,h);if(l.driver.removeItem){const f=await l.driver.getKeys(l.relativeBase||"",h);return Promise.all(f.map(p=>l.driver.removeItem(p,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>xh(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,h){if(u=Is(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((l,f)=>f.length-l.length)),e.mounts[u]=h,e.watching&&Promise.resolve(Eh(h,n,u)).then(l=>{e.unwatch[u]=l}).catch(console.error),c},async unmount(u,h=!0){u=Is(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),h&&await xh(e.mounts[u]),e.mountpoints=e.mountpoints.filter(l=>l!==u),delete e.mounts[u])},getMount(u=""){u=tt(u)+":";const h=r(u);return{driver:h.driver,base:h.base}},getMounts(u="",h={}){return u=tt(u),i(u,h.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,h={})=>c.getKeys(u,h),get:(u,h={})=>c.getItem(u,h),set:(u,h,l={})=>c.setItem(u,h,l),has:(u,h={})=>c.hasItem(u,h),del:(u,h={})=>c.removeItem(u,h),remove:(u,h={})=>c.removeItem(u,h)};return c}function Eh(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function xh(t){typeof t.dispose=="function"&&await Ie(t.dispose)}function ri(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function _h(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=ri(r);return(n,s)=>i.then(o=>s(o.transaction(e,n).objectStore(e)))}let ta;function fn(){return ta||(ta=_h("keyval-store","keyval")),ta}function Ih(t,e=fn()){return e("readonly",r=>ri(r.get(t)))}function mw(t,e,r=fn()){return r("readwrite",i=>(i.put(e,t),ri(i.transaction)))}function bw(t,e=fn()){return e("readwrite",r=>(r.delete(t),ri(r.transaction)))}function vw(t=fn()){return t("readwrite",e=>(e.clear(),ri(e.transaction)))}function Ew(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ri(t.transaction)}function xw(t=fn()){return t("readonly",e=>{if(e.getAllKeys)return ri(e.getAllKeys());const r=[];return Ew(e,i=>r.push(i.key)).then(()=>r)})}const _w=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Iw=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function ii(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Iw(t)}catch{return t}}function rr(t){return typeof t=="string"?t:_w(t)||""}const Sw="idb-keyval";var Aw=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=_h(t.dbName,t.storeName)),{name:Sw,options:t,async hasItem(n){return!(typeof await Ih(r(n),i)>"u")},async getItem(n){return await Ih(r(n),i)??null},setItem(n,s){return mw(r(n),s,i)},removeItem(n){return bw(r(n),i)},getKeys(){return xw(i)},clear(){return vw(i)}}};const Dw="WALLET_CONNECT_V2_INDEXED_DB",$w="keyvaluestorage";class Ow{constructor(){this.indexedDb=ww({driver:Aw({dbName:Dw,storeName:$w})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,rr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var ra=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ss={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ra<"u"&&ra.localStorage?Ss.exports=ra.localStorage:typeof window<"u"&&window.localStorage?Ss.exports=window.localStorage:Ss.exports=new e})();function Pw(t){var e;return[t[0],ii((e=t[1])!=null?e:"")]}class Bw{constructor(){this.localStorage=Ss.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Pw)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return ii(r)}async setItem(e,r){this.localStorage.setItem(e,rr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Cw="wc_storage_version",Sh=1,Tw=async(t,e,r)=>{const i=Cw,n=await e.getItem(i);if(n&&n>=Sh){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,Sh),r(e),Rw(t,o)},Rw=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class Nw{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Bw;this.storage=e;try{const r=new Ow;Tw(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function Uw(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Fw=Lw;function Lw(t,e,r){var i=r&&r.stringify||Uw,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",h=1-n,l=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(l=l>-1?l:0,t.charCodeAt(p+1)){case 100:case 102:if(h>=c||e[h]==null)break;l<p&&(u+=t.slice(l,p)),u+=Number(e[h]),l=p+2,p++;break;case 105:if(h>=c||e[h]==null)break;l<p&&(u+=t.slice(l,p)),u+=Math.floor(Number(e[h])),l=p+2,p++;break;case 79:case 111:case 106:if(h>=c||e[h]===void 0)break;l<p&&(u+=t.slice(l,p));var d=typeof e[h];if(d==="string"){u+="'"+e[h]+"'",l=p+2,p++;break}if(d==="function"){u+=e[h].name||"<anonymous>",l=p+2,p++;break}u+=i(e[h]),l=p+2,p++;break;case 115:if(h>=c)break;l<p&&(u+=t.slice(l,p)),u+=String(e[h]),l=p+2,p++;break;case 37:l<p&&(u+=t.slice(l,p)),u+="%",l=p+2,p++,h--;break}++h}++p}return l===-1?t:(l<f&&(u+=t.slice(l)),u)}const Ah=Fw;var qt=zt;const dn=Gw().console||{},kw={mapHttpRequest:Ds,mapHttpResponse:Ds,wrapRequestSerializer:na,wrapResponseSerializer:na,wrapErrorSerializer:na,req:Ds,res:Ds,err:Hw};function Mw(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function zt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||dn;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Mw(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=pn),Object.defineProperty(c,"levelVal",{get:h}),Object.defineProperty(c,"level",{get:l,set:f});const u={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:Vw(t)};c.levels=zt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=pn,c.serializers=i,c._serialize=n,c._stdErrSerialize=s,c.child=p,e&&(c._logEvent=ia());function h(){return this.level==="silent"?1/0:this.levels.values[this.level]}function l(){return this._level}function f(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,$i(u,c,"error","log"),$i(u,c,"fatal","error"),$i(u,c,"warn","error"),$i(u,c,"info","log"),$i(u,c,"debug","log"),$i(u,c,"trace","log")}function p(d,g){if(!d)throw new Error("missing bindings for child Pino");g=g||{},n&&d.serializers&&(g.serializers=d.serializers);const v=g.serializers;if(n&&v){var I=Object.assign({},i,v),A=t.browser.serialize===!0?Object.keys(I):n;delete d.serializers,As([d],A,I,this._stdErrSerialize)}function b(m){this._childLevel=(m._childLevel|0)+1,this.error=Oi(m,d,"error"),this.fatal=Oi(m,d,"fatal"),this.warn=Oi(m,d,"warn"),this.info=Oi(m,d,"info"),this.debug=Oi(m,d,"debug"),this.trace=Oi(m,d,"trace"),I&&(this.serializers=I,this._serialize=A),e&&(this._logEvent=ia([].concat(m._logEvent.bindings,d)))}return b.prototype=this,new b(this)}return c}zt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},zt.stdSerializers=kw,zt.stdTimeFunctions=Object.assign({},{nullTime:Dh,epochTime:$h,unixTime:Kw,isoTime:Ww});function $i(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?pn:n[r]?n[r]:dn[r]||dn[i]||pn,jw(t,e,r)}function jw(t,e,r){!t.transmit&&e[r]===pn||(e[r]=function(i){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===dn?dn:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&As(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(a,qw(this,r,o,s)):i.apply(a,o),t.transmit){const u=t.transmit.level||e.level,h=zt.levels.values[u],l=zt.levels.values[r];if(l<h)return;zw(this,{ts:s,methodLevel:r,methodValue:l,transmitLevel:u,transmitValue:zt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function qw(t,e,r,i){t._serialize&&As(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let s=n[0];const o={};i&&(o.time=i),o.level=zt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?Ah(n.shift(),n):void 0}else typeof s=="string"&&(s=Ah(n.shift(),n));return s!==void 0&&(o.msg=s),o}function As(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=zt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const s in t[n])e&&e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function Oi(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function zw(t,e,r){const i=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;As(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,i(s,t._logEvent,a),t._logEvent=ia(c)}function ia(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Hw(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Vw(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Dh:$h}function Ds(){return{}}function na(t){return t}function pn(){}function Dh(){return!1}function $h(){return Date.now()}function Kw(){return Math.round(Date.now()/1e3)}function Ww(){return new Date(Date.now()).toISOString()}function Gw(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const Yw={level:"info"},gn="custom_context",sa=1e3*1024;class Zw{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class Oh{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Zw(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Ph{constructor(e,r=sa){this.level=e??"error",this.levelValue=qt.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Oh(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===qt.levels.values.error?console.error(e):r===qt.levels.values.warn?console.warn(e):r===qt.levels.values.debug?console.debug(e):r===qt.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(rr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Oh(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(rr({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class Jw{constructor(e,r=sa){this.baseChunkLogger=new Ph(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}class Xw{constructor(e,r=sa){this.baseChunkLogger=new Ph(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var Qw=Object.defineProperty,em=Object.defineProperties,tm=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,rm=Object.prototype.hasOwnProperty,im=Object.prototype.propertyIsEnumerable,Ch=(t,e,r)=>e in t?Qw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$s=(t,e)=>{for(var r in e||(e={}))rm.call(e,r)&&Ch(t,r,e[r]);if(Bh)for(var r of Bh(e))im.call(e,r)&&Ch(t,r,e[r]);return t},Os=(t,e)=>em(t,tm(e));function Ps(t){return Os($s({},t),{level:t?.level||Yw.level})}function nm(t,e=gn){return t[e]||""}function sm(t,e,r=gn){return t[r]=e,t}function rt(t,e=gn){let r="";return typeof t.bindings>"u"?r=nm(t,e):r=t.bindings().context||"",r}function om(t,e,r=gn){const i=rt(t,r);return i.trim()?`${i}/${e}`:e}function Ge(t,e,r=gn){const i=om(t,e,r),n=t.child({context:i});return sm(n,i,r)}function am(t){var e,r;const i=new Jw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:qt(Os($s({},t.opts),{level:"trace",browser:Os($s({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function cm(t){var e;const r=new Xw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:qt(Os($s({},t.opts),{level:"trace"})),chunkLoggerController:r}}function um(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?am(t):cm(t)}var hm=Object.defineProperty,lm=(t,e,r)=>e in t?hm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Th=(t,e,r)=>lm(t,typeof e!="symbol"?e+"":e,r);class fm extends ei{constructor(e){super(),this.opts=e,Th(this,"protocol","wc"),Th(this,"version",2)}}var dm=Object.defineProperty,pm=(t,e,r)=>e in t?dm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gm=(t,e,r)=>pm(t,typeof e!="symbol"?e+"":e,r);class ym extends ei{constructor(e,r){super(),this.core=e,this.logger=r,gm(this,"records",new Map)}}class wm{constructor(e,r){this.logger=e,this.core=r}}class mm extends ei{constructor(e,r){super(),this.relayer=e,this.logger=r}}class bm extends ei{constructor(e){super()}}class vm{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class Em extends ei{constructor(e,r){super(),this.relayer=e,this.logger=r}}class xm extends ei{constructor(e,r){super(),this.core=e,this.logger=r}}class _m{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}}class Im{constructor(e,r){this.projectId=e,this.logger=r}}class Sm{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}}var Am=Object.defineProperty,Dm=(t,e,r)=>e in t?Am(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rh=(t,e,r)=>Dm(t,typeof e!="symbol"?e+"":e,r);class $m{constructor(e){this.opts=e,Rh(this,"protocol","wc"),Rh(this,"version",2)}}class Om{constructor(e){this.client=e}}function Pm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Nh(t,...e){if(!Pm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Uh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Bm(t,e){Nh(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Pi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const oa=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Cm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Fh(t){return typeof t=="string"&&(t=Cm(t)),Nh(t),t}class Tm{clone(){return this._cloneInto()}}function Rm(t){const e=i=>t().update(Fh(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Lh(t=32){if(Pi&&typeof Pi.getRandomValues=="function")return Pi.getRandomValues(new Uint8Array(t));if(Pi&&typeof Pi.randomBytes=="function")return Pi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Nm(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}class Um extends Tm{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=oa(this.buffer)}update(e){Uh(this);const{view:r,buffer:i,blockLen:n}=this;e=Fh(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=oa(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Uh(this),Bm(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let l=o;l<n;l++)r[l]=0;Nm(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=oa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}}const Bs=BigInt(2**32-1),aa=BigInt(32);function kh(t,e=!1){return e?{h:Number(t&Bs),l:Number(t>>aa&Bs)}:{h:Number(t>>aa&Bs)|0,l:Number(t&Bs)|0}}function Fm(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=kh(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const Lm=(t,e)=>BigInt(t>>>0)<<aa|BigInt(e>>>0),km=(t,e,r)=>t>>>r,Mm=(t,e,r)=>t<<32-r|e>>>r,jm=(t,e,r)=>t>>>r|e<<32-r,qm=(t,e,r)=>t<<32-r|e>>>r,zm=(t,e,r)=>t<<64-r|e>>>r-32,Hm=(t,e,r)=>t>>>r-32|e<<64-r,Vm=(t,e)=>e,Km=(t,e)=>t,Wm=(t,e,r)=>t<<r|e>>>32-r,Gm=(t,e,r)=>e<<r|t>>>32-r,Ym=(t,e,r)=>e<<r-32|t>>>64-r,Zm=(t,e,r)=>t<<r-32|e>>>64-r;function Jm(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Xm=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Qm=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,e1=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),t1=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,r1=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),i1=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Z={fromBig:kh,split:Fm,toBig:Lm,shrSH:km,shrSL:Mm,rotrSH:jm,rotrSL:qm,rotrBH:zm,rotrBL:Hm,rotr32H:Vm,rotr32L:Km,rotlSH:Wm,rotlSL:Gm,rotlBH:Ym,rotlBL:Zm,add:Jm,add3L:Xm,add3H:Qm,add4L:e1,add4H:t1,add5H:i1,add5L:r1},[n1,s1]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),vr=new Uint32Array(80),Er=new Uint32Array(80);class o1 extends Um{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:h,Fh:l,Fl:f,Gh:p,Gl:d,Hh:g,Hl:v}=this;return[e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v]}set(e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=v|0}process(e,r){for(let b=0;b<16;b++,r+=4)vr[b]=e.getUint32(r),Er[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const m=vr[b-15]|0,x=Er[b-15]|0,$=Z.rotrSH(m,x,1)^Z.rotrSH(m,x,8)^Z.shrSH(m,x,7),D=Z.rotrSL(m,x,1)^Z.rotrSL(m,x,8)^Z.shrSL(m,x,7),B=vr[b-2]|0,P=Er[b-2]|0,U=Z.rotrSH(B,P,19)^Z.rotrBH(B,P,61)^Z.shrSH(B,P,6),C=Z.rotrSL(B,P,19)^Z.rotrBL(B,P,61)^Z.shrSL(B,P,6),R=Z.add4L(D,C,Er[b-7],Er[b-16]),T=Z.add4H(R,$,U,vr[b-7],vr[b-16]);vr[b]=T|0,Er[b]=R|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:h,Eh:l,El:f,Fh:p,Fl:d,Gh:g,Gl:v,Hh:I,Hl:A}=this;for(let b=0;b<80;b++){const m=Z.rotrSH(l,f,14)^Z.rotrSH(l,f,18)^Z.rotrBH(l,f,41),x=Z.rotrSL(l,f,14)^Z.rotrSL(l,f,18)^Z.rotrBL(l,f,41),$=l&p^~l&g,D=f&d^~f&v,B=Z.add5L(A,x,D,s1[b],Er[b]),P=Z.add5H(B,I,m,$,n1[b],vr[b]),U=B|0,C=Z.rotrSH(i,n,28)^Z.rotrBH(i,n,34)^Z.rotrBH(i,n,39),R=Z.rotrSL(i,n,28)^Z.rotrBL(i,n,34)^Z.rotrBL(i,n,39),T=i&s^i&a^s&a,j=n&o^n&c^o&c;I=g|0,A=v|0,g=p|0,v=d|0,p=l|0,d=f|0,{h:l,l:f}=Z.add(u|0,h|0,P|0,U|0),u=a|0,h=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const y=Z.add3L(U,R,j);i=Z.add3H(y,P,C,T),n=y|0}({h:i,l:n}=Z.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Z.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Z.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:h}=Z.add(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:f}=Z.add(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:d}=Z.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:v}=Z.add(this.Gh|0,this.Gl|0,g|0,v|0),{h:I,l:A}=Z.add(this.Hh|0,this.Hl|0,I|0,A|0),this.set(i,n,s,o,a,c,u,h,l,f,p,d,g,v,I,A)}roundClean(){vr.fill(0),Er.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const a1=Rm(()=>new o1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ca=BigInt(0),Mh=BigInt(1),c1=BigInt(2);function ua(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ha(t){if(!ua(t))throw new Error("Uint8Array expected")}function la(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const u1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function fa(t){ha(t);let e="";for(let r=0;r<t.length;r++)e+=u1[t[r]];return e}function jh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ca:BigInt("0x"+t)}const ir={_0:48,_9:57,A:65,F:70,a:97,f:102};function qh(t){if(t>=ir._0&&t<=ir._9)return t-ir._0;if(t>=ir.A&&t<=ir.F)return t-(ir.A-10);if(t>=ir.a&&t<=ir.f)return t-(ir.a-10)}function zh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=qh(t.charCodeAt(s)),a=qh(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function h1(t){return jh(fa(t))}function Cs(t){return ha(t),jh(fa(Uint8Array.from(t).reverse()))}function Hh(t,e){return zh(t.toString(16).padStart(e*2,"0"))}function da(t,e){return Hh(t,e).reverse()}function nr(t,e,r){let i;if(typeof e=="string")try{i=zh(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ua(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Vh(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];ha(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const pa=t=>typeof t=="bigint"&&ca<=t;function l1(t,e,r){return pa(t)&&pa(e)&&pa(r)&&e<=t&&t<r}function yn(t,e,r,i){if(!l1(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function f1(t){let e;for(e=0;t>ca;t>>=Mh,e+=1);return e}const d1=t=>(c1<<BigInt(t-1))-Mh,p1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ua(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ga(t,e,r={}){const i=(n,s,o)=>{const a=p1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function Kh(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Se=BigInt(0),pe=BigInt(1),ni=BigInt(2),g1=BigInt(3),ya=BigInt(4),Wh=BigInt(5),Gh=BigInt(8);function be(t,e){const r=t%e;return r>=Se?r:e+r}function y1(t,e,r){if(e<Se)throw new Error("invalid exponent, negatives unsupported");if(r<=Se)throw new Error("invalid modulus");if(r===pe)return Se;let i=pe;for(;e>Se;)e&pe&&(i=i*t%r),t=t*t%r,e>>=pe;return i}function Ht(t,e,r){let i=t;for(;e-- >Se;)i*=i,i%=r;return i}function Yh(t,e){if(t===Se)throw new Error("invert: expected non-zero number");if(e<=Se)throw new Error("invert: expected positive modulus, got "+e);let r=be(t,e),i=e,n=Se,s=pe;for(;r!==Se;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==pe)throw new Error("invert: does not exist");return be(n,e)}function w1(t){const e=(t-pe)/ni;let r,i,n;for(r=t-pe,i=0;r%ni===Se;r/=ni,i++);for(n=ni;n<t&&y1(n,e,t)!==t-pe;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+pe)/ya;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+pe)/ni;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,n),r),h=o.pow(a,s),l=o.pow(a,r);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(l);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(u,pe<<BigInt(c-f-1));u=o.sqr(p),h=o.mul(h,p),l=o.mul(l,u),c=f}return h}}function m1(t){if(t%ya===g1){const e=(t+pe)/ya;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%Gh===Wh){const e=(t-Wh)/Gh;return function(r,i){const n=r.mul(i,ni),s=r.pow(n,e),o=r.mul(i,s),a=r.mul(r.mul(o,ni),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return w1(t)}const b1=(t,e)=>(be(t,e)&pe)===pe,v1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function E1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=v1.reduce((i,n)=>(i[n]="function",i),e);return ga(t,r)}function x1(t,e,r){if(r<Se)throw new Error("invalid exponent, negatives unsupported");if(r===Se)return t.ONE;if(r===pe)return e;let i=t.ONE,n=e;for(;r>Se;)r&pe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=pe;return i}function _1(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function Zh(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Jh(t,e,r=!1,i={}){if(t<=Se)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Zh(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:d1(n),ZERO:Se,ONE:pe,create:c=>be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Se<=c&&c<t},is0:c=>c===Se,isOdd:c=>(c&pe)===pe,neg:c=>be(-c,t),eql:(c,u)=>c===u,sqr:c=>be(c*c,t),add:(c,u)=>be(c+u,t),sub:(c,u)=>be(c-u,t),mul:(c,u)=>be(c*u,t),pow:(c,u)=>x1(a,c,u),div:(c,u)=>be(c*Yh(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Yh(c,t),sqrt:i.sqrt||(c=>(o||(o=m1(t)),o(a,c))),invertBatch:c=>_1(a,c),cmov:(c,u,h)=>h?u:c,toBytes:c=>r?da(c,s):Hh(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Cs(c):h1(c)}});return Object.freeze(a)}const Xh=BigInt(0),Ts=BigInt(1);function wa(t,e){const r=e.negate();return t?r:e}function Qh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ma(t,e){Qh(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function I1(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function S1(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const ba=new WeakMap,el=new WeakMap;function va(t){return el.get(t)||1}function A1(t,e){return{constTimeNegate:wa,hasPrecomputes(r){return va(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Xh;)i&Ts&&(n=n.add(s)),s=s.double(),i>>=Ts;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=ma(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let h=1;h<s;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=ma(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),h=2**r,l=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(n&u);n>>=l,d>o&&(d-=h,n+=Ts);const g=p,v=p+Math.abs(d)-1,I=f%2!==0,A=d<0;d===0?c=c.add(wa(I,i[g])):a=a.add(wa(A,i[v]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=ma(r,e),c=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let l=0;l<o;l++){const f=l*a;if(n===Xh)break;let p=Number(n&c);if(n>>=h,p>a&&(p-=u,n+=Ts),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,i,n){let s=ba.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&ba.set(i,n(s))),s},wNAFCached(r,i,n){const s=va(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=va(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Qh(i,e),el.set(r,i),ba.delete(r)}}}function D1(t,e,r,i){if(I1(r,t),S1(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=f1(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let h=n;for(let l=u;l>=0;l-=o){c.fill(n);for(let p=0;p<i.length;p++){const d=i[p],g=Number(d>>BigInt(l)&BigInt(a));c[g]=c[g].add(r[p])}let f=n;for(let p=c.length-1,d=n;p>0;p--)d=d.add(c[p]),f=f.add(d);if(h=h.add(f),l!==0)for(let p=0;p<o;p++)h=h.double()}return h}function $1(t){return E1(t.Fp),ga(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Zh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Ct=BigInt(0),it=BigInt(1),Rs=BigInt(2),O1=BigInt(8),P1={zip215:!0};function B1(t){const e=$1(t);return ga(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function C1(t){const e=B1(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Rs<<BigInt(a*8)-it,h=r.create,l=Jh(e.n,e.nBitLength),f=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(w))}}catch{return{isValid:!1,value:Ct}}}),p=e.adjustScalarBytes||(y=>y),d=e.domain||((y,w,E)=>{if(la("phflag",E),w.length||E)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,w){yn("coordinate "+y,w,Ct,u)}function v(y){if(!(y instanceof b))throw new Error("ExtendedPoint expected")}const I=Kh((y,w)=>{const{ex:E,ey:O,ez:_}=y,S=y.is0();w==null&&(w=S?O1:r.inv(_));const N=h(E*w),k=h(O*w),H=h(_*w);if(S)return{x:Ct,y:it};if(H!==it)throw new Error("invZ was invalid");return{x:N,y:k}}),A=Kh(y=>{const{a:w,d:E}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:O,ey:_,ez:S,et:N}=y,k=h(O*O),H=h(_*_),q=h(S*S),V=h(q*q),K=h(k*w),G=h(q*h(K+H)),Q=h(V+h(E*h(k*H)));if(G!==Q)throw new Error("bad point: equation left != right (1)");const W=h(O*_),de=h(S*N);if(W!==de)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(w,E,O,_){this.ex=w,this.ey=E,this.ez=O,this.et=_,g("x",w),g("y",E),g("z",O),g("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof b)throw new Error("extended point not allowed");const{x:E,y:O}=w||{};return g("x",E),g("y",O),new b(E,O,it,h(E*O))}static normalizeZ(w){const E=r.invertBatch(w.map(O=>O.ez));return w.map((O,_)=>O.toAffine(E[_])).map(b.fromAffine)}static msm(w,E){return D1(b,l,w,E)}_setWindowSize(w){$.setWindowSize(this,w)}assertValidity(){A(this)}equals(w){v(w);const{ex:E,ey:O,ez:_}=this,{ex:S,ey:N,ez:k}=w,H=h(E*k),q=h(S*_),V=h(O*k),K=h(N*_);return H===q&&V===K}is0(){return this.equals(b.ZERO)}negate(){return new b(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:w}=e,{ex:E,ey:O,ez:_}=this,S=h(E*E),N=h(O*O),k=h(Rs*h(_*_)),H=h(w*S),q=E+O,V=h(h(q*q)-S-N),K=H+N,G=K-k,Q=H-N,W=h(V*G),de=h(K*Q),we=h(V*Q),xe=h(G*K);return new b(W,de,xe,we)}add(w){v(w);const{a:E,d:O}=e,{ex:_,ey:S,ez:N,et:k}=this,{ex:H,ey:q,ez:V,et:K}=w;if(E===BigInt(-1)){const ly=h((S-_)*(q+H)),fy=h((S+_)*(q-H)),Ju=h(fy-ly);if(Ju===Ct)return this.double();const dy=h(N*Rs*K),py=h(k*Rs*V),gy=py+dy,yy=fy+ly,wy=py-dy,u5=h(gy*Ju),h5=h(yy*wy),l5=h(gy*wy),f5=h(Ju*yy);return new b(u5,h5,f5,l5)}const G=h(_*H),Q=h(S*q),W=h(k*O*K),de=h(N*V),we=h((_+S)*(H+q)-G-Q),xe=de-W,_e=de+W,me=h(Q-E*G),Me=h(we*xe),Si=h(_e*me),a5=h(we*me),c5=h(xe*_e);return new b(Me,Si,c5,a5)}subtract(w){return this.add(w.negate())}wNAF(w){return $.wNAFCached(this,w,b.normalizeZ)}multiply(w){const E=w;yn("scalar",E,it,i);const{p:O,f:_}=this.wNAF(E);return b.normalizeZ([O,_])[0]}multiplyUnsafe(w,E=b.ZERO){const O=w;return yn("scalar",O,Ct,i),O===Ct?x:this.is0()||O===it?this:$.wNAFCachedUnsafe(this,O,b.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return $.unsafeLadder(this,i).is0()}toAffine(w){return I(this,w)}clearCofactor(){const{h:w}=e;return w===it?this:this.multiplyUnsafe(w)}static fromHex(w,E=!1){const{d:O,a:_}=e,S=r.BYTES;w=nr("pointHex",w,S),la("zip215",E);const N=w.slice(),k=w[S-1];N[S-1]=k&-129;const H=Cs(N),q=E?u:r.ORDER;yn("pointHex.y",H,Ct,q);const V=h(H*H),K=h(V-it),G=h(O*V-_);let{isValid:Q,value:W}=f(K,G);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const de=(W&it)===it,we=(k&128)!==0;if(!E&&W===Ct&&we)throw new Error("Point.fromHex: x=0 and x_0=1");return we!==de&&(W=h(-W)),b.fromAffine({x:W,y:H})}static fromPrivateKey(w){return P(w).point}toRawBytes(){const{x:w,y:E}=this.toAffine(),O=da(E,r.BYTES);return O[O.length-1]|=w&it?128:0,O}toHex(){return fa(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,it,h(e.Gx*e.Gy)),b.ZERO=new b(Ct,it,it,Ct);const{BASE:m,ZERO:x}=b,$=A1(b,a*8);function D(y){return be(y,i)}function B(y){return D(Cs(y))}function P(y){const w=r.BYTES;y=nr("private key",y,w);const E=nr("hashed private key",s(y),2*w),O=p(E.slice(0,w)),_=E.slice(w,2*w),S=B(O),N=m.multiply(S),k=N.toRawBytes();return{head:O,prefix:_,scalar:S,point:N,pointBytes:k}}function U(y){return P(y).pointBytes}function C(y=new Uint8Array,...w){const E=Vh(...w);return B(s(d(E,nr("context",y),!!n)))}function R(y,w,E={}){y=nr("message",y),n&&(y=n(y));const{prefix:O,scalar:_,pointBytes:S}=P(w),N=C(E.context,O,y),k=m.multiply(N).toRawBytes(),H=C(E.context,k,S,y),q=D(N+H*_);yn("signature.s",q,Ct,i);const V=Vh(k,da(q,r.BYTES));return nr("result",V,r.BYTES*2)}const T=P1;function j(y,w,E,O=T){const{context:_,zip215:S}=O,N=r.BYTES;y=nr("signature",y,2*N),w=nr("message",w),E=nr("publicKey",E,N),S!==void 0&&la("zip215",S),n&&(w=n(w));const k=Cs(y.slice(N,2*N));let H,q,V;try{H=b.fromHex(E,S),q=b.fromHex(y.slice(0,N),S),V=m.multiplyUnsafe(k)}catch{return!1}if(!S&&H.isSmallOrder())return!1;const K=C(_,q.toRawBytes(),H.toRawBytes(),w);return q.add(H.multiplyUnsafe(K)).subtract(V).clearCofactor().equals(b.ZERO)}return m._setWindowSize(8),{CURVE:e,getPublicKey:U,sign:R,verify:j,ExtendedPoint:b,utils:{getExtendedPublicKey:P,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,w=b.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const Ea=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const T1=BigInt(1),rl=BigInt(2);BigInt(3);const R1=BigInt(5),N1=BigInt(8);function U1(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=Ea,o=t*t%s*t%s,a=Ht(o,rl,s)*o%s,c=Ht(a,T1,s)*t%s,u=Ht(c,R1,s)*c%s,h=Ht(u,e,s)*u%s,l=Ht(h,r,s)*h%s,f=Ht(l,i,s)*l%s,p=Ht(f,n,s)*f%s,d=Ht(p,n,s)*f%s,g=Ht(d,e,s)*u%s;return{pow_p_5_8:Ht(g,rl,s)*t%s,b2:o}}function F1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function L1(t,e){const r=Ea,i=be(e*e*e,r),n=be(i*i*e,r),s=U1(t*n).pow_p_5_8;let o=be(t*i*s,r);const a=be(e*o*o,r),c=o,u=be(o*tl,r),h=a===t,l=a===be(-t,r),f=a===be(-t*tl,r);return h&&(o=c),(l||f)&&(o=u),b1(o,r)&&(o=be(-o,r)),{isValid:h||l,value:o}}const k1=Jh(Ea,void 0,!0),M1={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:k1,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:N1,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:a1,randomBytes:Lh,adjustScalarBytes:F1,uvRatio:L1},il=C1(M1),j1="EdDSA",q1="JWT",Ns=".",Us="base64url",nl="utf8",sl="utf8",z1=":",H1="did",V1="key",ol="base58btc",K1="z",W1="K36",G1=32;function xa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function al(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?xa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function cl(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=al(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return xa(r)}function Y1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,v=0,I=0,A=d.length;I!==A&&d[I]===0;)I++,g++;for(var b=(A-I)*h+1>>>0,m=new Uint8Array(b);I!==A;){for(var x=d[I],$=0,D=b-1;(x!==0||$<v)&&D!==-1;D--,$++)x+=256*m[D]>>>0,m[D]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");v=$,I++}for(var B=b-v;B!==b&&m[B]===0;)B++;for(var P=c.repeat(g);B<b;++B)P+=t.charAt(m[B]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var v=0,I=0;d[g]===c;)v++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var m=r[d.charCodeAt(g)];if(m===255)return;for(var x=0,$=A-1;(m!==0||x<I)&&$!==-1;$--,x++)m+=a*b[$]>>>0,b[$]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");I=x,g++}if(d[g]!==" "){for(var D=A-I;D!==A&&b[D]===0;)D++;for(var B=new Uint8Array(v+(A-D)),P=v;D!==A;)B[P++]=b[D++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var Z1=Y1,J1=Z1;const ul=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},X1=t=>new TextEncoder().encode(t),Q1=t=>new TextDecoder().decode(t);class eb{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class tb{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hl(this,e)}}class rb{constructor(e){this.decoders=e}or(e){return hl(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hl=(t,e)=>new rb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class ib{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new eb(e,r,i),this.decoder=new tb(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Fs=({name:t,prefix:e,encode:r,decode:i})=>new ib(t,e,r,i),wn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=J1(r,e);return Fs({prefix:t,name:e,encode:i,decode:s=>ul(n(s))})},nb=(t,e,r,i)=>{const n={};for(let h=0;h<e.length;++h)n[e[h]]=h;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let h=0;h<s;++h){const l=n[t[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},sb=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Fs({prefix:e,name:t,encode(n){return sb(n,i,r)},decode(n){return nb(n,i,r,t)}}),ob=Fs({prefix:"\0",name:"identity",encode:t=>Q1(t),decode:t=>X1(t)});var ab=Object.freeze({__proto__:null,identity:ob});const cb=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ub=Object.freeze({__proto__:null,base2:cb});const hb=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lb=Object.freeze({__proto__:null,base8:hb});const fb=wn({prefix:"9",name:"base10",alphabet:"0123456789"});var db=Object.freeze({__proto__:null,base10:fb});const pb=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gb=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var yb=Object.freeze({__proto__:null,base16:pb,base16upper:gb});const wb=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mb=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bb=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vb=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Eb=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xb=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_b=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ib=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sb=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ab=Object.freeze({__proto__:null,base32:wb,base32upper:mb,base32pad:bb,base32padupper:vb,base32hex:Eb,base32hexupper:xb,base32hexpad:_b,base32hexpadupper:Ib,base32z:Sb});const Db=wn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),$b=wn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ob=Object.freeze({__proto__:null,base36:Db,base36upper:$b});const Pb=wn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Bb=wn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Cb=Object.freeze({__proto__:null,base58btc:Pb,base58flickr:Bb});const Tb=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Rb=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Nb=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ub=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Fb=Object.freeze({__proto__:null,base64:Tb,base64pad:Rb,base64url:Nb,base64urlpad:Ub});const ll=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Lb=ll.reduce((t,e,r)=>(t[r]=e,t),[]),kb=ll.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Mb(t){return t.reduce((e,r)=>(e+=Lb[r],e),"")}function jb(t){const e=[];for(const r of t){const i=kb[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const qb=Fs({prefix:"\u{1F680}",name:"base256emoji",encode:Mb,decode:jb});var zb=Object.freeze({__proto__:null,base256emoji:qb}),Hb=dl,fl=128,Vb=127,Kb=~Vb,Wb=Math.pow(2,31);function dl(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Wb;)e[r++]=t&255|fl,t/=128;for(;t&Kb;)e[r++]=t&255|fl,t>>>=7;return e[r]=t|0,dl.bytes=r-i+1,e}var Gb=_a,Yb=128,pl=127;function _a(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw _a.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&pl)<<n:(o&pl)*Math.pow(2,n),n+=7}while(o>=Yb);return _a.bytes=s-i,r}var Zb=Math.pow(2,7),Jb=Math.pow(2,14),Xb=Math.pow(2,21),Qb=Math.pow(2,28),ev=Math.pow(2,35),tv=Math.pow(2,42),rv=Math.pow(2,49),iv=Math.pow(2,56),nv=Math.pow(2,63),sv=function(t){return t<Zb?1:t<Jb?2:t<Xb?3:t<Qb?4:t<ev?5:t<tv?6:t<rv?7:t<iv?8:t<nv?9:10},ov={encode:Hb,decode:Gb,encodingLength:sv},gl=ov;const yl=(t,e,r=0)=>(gl.encode(t,e,r),e),wl=t=>gl.encodingLength(t),Ia=(t,e)=>{const r=e.byteLength,i=wl(t),n=i+wl(r),s=new Uint8Array(n+r);return yl(t,s,0),yl(r,s,i),s.set(e,n),new av(t,r,e,s)};class av{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ml=({name:t,code:e,encode:r})=>new cv(t,e,r);class cv{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ia(this.code,r):r.then(i=>Ia(this.code,i))}else throw Error("Unknown type, must be binary type")}}const bl=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),uv=ml({name:"sha2-256",code:18,encode:bl("SHA-256")}),hv=ml({name:"sha2-512",code:19,encode:bl("SHA-512")});var lv=Object.freeze({__proto__:null,sha256:uv,sha512:hv});const vl=0,fv="identity",El=ul;var dv=Object.freeze({__proto__:null,identity:{code:vl,name:fv,encode:El,digest:t=>Ia(vl,El(t))}});new TextEncoder,new TextDecoder;const xl={...ab,...ub,...lb,...db,...yb,...Ab,...Ob,...Cb,...Fb,...zb};({...lv,...dv});function _l(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Il=_l("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Sa=_l("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=al(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Sl={utf8:Il,"utf-8":Il,hex:xl.base16,latin1:Sa,ascii:Sa,binary:Sa,...xl};function Ls(t,e="utf8"){const r=Sl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Bi(t,e="utf8"){const r=Sl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?xa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Al(t){return ii(Ls(Bi(t,Us),nl))}function ks(t){return Ls(Bi(rr(t),nl),Us)}function Dl(t){const e=Bi(W1,ol),r=K1+Ls(cl([e,t]),ol);return[H1,V1,r].join(z1)}function pv(t){return Ls(t,Us)}function gv(t){return Bi(t,Us)}function yv(t){return Bi([ks(t.header),ks(t.payload)].join(Ns),sl)}function wv(t){return[ks(t.header),ks(t.payload),pv(t.signature)].join(Ns)}function Aa(t){const e=t.split(Ns),r=Al(e[0]),i=Al(e[1]),n=gv(e[2]),s=Bi(e.slice(0,2).join(Ns),sl);return{header:r,payload:i,signature:n,data:s}}function $l(t=Lh(G1)){const e=il.getPublicKey(t);return{secretKey:cl([t,e]),publicKey:e}}async function mv(t,e,r,i,n=L.fromMiliseconds(Date.now())){const s={alg:j1,typ:q1},o=Dl(i.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},u=yv({header:s,payload:c}),h=il.sign(u,i.secretKey.slice(0,32));return wv({header:s,payload:c,signature:h})}var Ol=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},bv=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),vv=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Ev=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),xv=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),_v=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Iv=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Sv=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Pl=3,Av=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Iv]],Bl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Dv(t){return t?Cl(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new _v:typeof navigator<"u"?Cl(navigator.userAgent):Pv()}function $v(t){return t!==""&&Av.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Cl(t){var e=$v(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new xv;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Pl&&(n=Ol(Ol([],n,!0),Bv(Pl-n.length),!0)):n=[];var s=n.join("."),o=Ov(t),a=Sv.exec(t);return a&&a[1]?new Ev(r,s,o,a[1]):new bv(r,s,o)}function Ov(t){for(var e=0,r=Bl.length;e<r;e++){var i=Bl[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function Pv(){var t=typeof process<"u"&&process.version;return t?new vv(process.version.slice(1)):null}function Bv(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ue={};Object.defineProperty(ue,"__esModule",{value:!0}),ue.getLocalStorage=ue.getLocalStorageOrThrow=ue.getCrypto=ue.getCryptoOrThrow=Tl=ue.getLocation=ue.getLocationOrThrow=Da=ue.getNavigator=ue.getNavigatorOrThrow=oi=ue.getDocument=ue.getDocumentOrThrow=ue.getFromWindowOrThrow=ue.getFromWindow=void 0;function si(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ue.getFromWindow=si;function Ci(t){const e=si(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ue.getFromWindowOrThrow=Ci;function Cv(){return Ci("document")}ue.getDocumentOrThrow=Cv;function Tv(){return si("document")}var oi=ue.getDocument=Tv;function Rv(){return Ci("navigator")}ue.getNavigatorOrThrow=Rv;function Nv(){return si("navigator")}var Da=ue.getNavigator=Nv;function Uv(){return Ci("location")}ue.getLocationOrThrow=Uv;function Fv(){return si("location")}var Tl=ue.getLocation=Fv;function Lv(){return Ci("crypto")}ue.getCryptoOrThrow=Lv;function kv(){return si("crypto")}ue.getCrypto=kv;function Mv(){return Ci("localStorage")}ue.getLocalStorageOrThrow=Mv;function jv(){return si("localStorage")}ue.getLocalStorage=jv;var $a={};Object.defineProperty($a,"__esModule",{value:!0});var Rl=$a.getWindowMetadata=void 0;const Nl=ue;function qv(){let t,e;try{t=Nl.getDocumentOrThrow(),e=Nl.getLocationOrThrow()}catch{return null}function r(){const l=t.getElementsByTagName("link"),f=[];for(let p=0;p<l.length;p++){const d=l[p],g=d.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const v=d.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let I=e.protocol+"//"+e.host;if(v.indexOf("/")===0)I+=v;else{const A=e.pathname.split("/");A.pop();const b=A.join("/");I+=b+"/"+v}f.push(I)}else if(v.indexOf("//")===0){const I=e.protocol+v;f.push(I)}else f.push(v)}}return f}function i(...l){const f=t.getElementsByTagName("meta");for(let p=0;p<f.length;p++){const d=f[p],g=["itemprop","property","name"].map(v=>d.getAttribute(v)).filter(v=>v?l.includes(v):!1);if(g.length&&g){const v=d.getAttribute("content");if(v)return v}}return""}function n(){let l=i("name","og:site_name","og:title","twitter:title");return l||(l=t.title),l}function s(){return i("description","og:description","twitter:description","keywords")}const o=n(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}Rl=$a.getWindowMetadata=qv;function mn(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Oa(t){return mn(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Ul="2.30.6";let Pa={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${Ul}`};class ai extends Error{constructor(e,r={}){const i=r.cause instanceof ai?r.cause.details:r.cause?.message?r.cause.message:r.details,n=r.cause instanceof ai&&r.cause.docsPath||r.docsPath,s=Pa.getDocsUrl?.({...r,docsPath:n}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...i?[`Details: ${i}`]:[],...Pa.version?[`Version: ${Pa.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=Ul}walk(e){return Fl(this,e)}}function Fl(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Fl(t.cause,e):e?null:t}class Ll extends ai{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function Ti(t,{dir:e,size:r=32}={}){return typeof t=="string"?zv(t,{dir:e,size:r}):Hv(t,{dir:e,size:r})}function zv(t,{dir:e,size:r=32}={}){if(r===null)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Ll({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function Hv(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Ll({size:t.length,targetSize:r,type:"bytes"});const i=new Uint8Array(r);for(let n=0;n<r;n++){const s=e==="right";i[s?n:r-n-1]=t[s?n:t.length-n-1]}return i}class Vv extends ai{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number "${s}" is not in safe ${n?`${n*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class Kv extends ai{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ri(t,{size:e}){if(Oa(t)>e)throw new Kv({givenSize:Oa(t),maxSize:e})}function Ba(t,e={}){const{signed:r}=e;e.size&&Ri(t,{size:e.size});const i=BigInt(t);if(!r)return i;const n=(t.length-2)/2,s=(1n<<BigInt(n)*8n-1n)-1n;return i<=s?i:i-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function Wv(t,e={}){return Number(Ba(t,e))}const Gv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ca(t,e={}){return typeof t=="number"||typeof t=="bigint"?Ta(t,e):typeof t=="string"?Jv(t,e):typeof t=="boolean"?Yv(t,e):kl(t,e)}function Yv(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(Ri(r,{size:e.size}),Ti(r,{size:e.size})):r}function kl(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=Gv[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(Ri(i,{size:e.size}),Ti(i,{dir:"right",size:e.size})):i}function Ta(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const c=typeof t=="bigint"?"n":"";throw new Vv({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:i,value:`${t}${c}`})}const a=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?Ti(a,{size:i}):a}const Zv=new TextEncoder;function Jv(t,e={}){const r=Zv.encode(t);return kl(r,e)}const Xv=new TextEncoder;function Qv(t,e={}){return typeof t=="number"||typeof t=="bigint"?t2(t,e):typeof t=="boolean"?e2(t,e):mn(t)?jl(t,e):ql(t,e)}function e2(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(Ri(r,{size:e.size}),Ti(r,{size:e.size})):r}const sr={zero:48,nine:57,A:65,F:70,a:97,f:102};function Ml(t){if(t>=sr.zero&&t<=sr.nine)return t-sr.zero;if(t>=sr.A&&t<=sr.F)return t-(sr.A-10);if(t>=sr.a&&t<=sr.f)return t-(sr.a-10)}function jl(t,e={}){let r=t;e.size&&(Ri(r,{size:e.size}),r=Ti(r,{dir:"right",size:e.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);const n=i.length/2,s=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const c=Ml(i.charCodeAt(a++)),u=Ml(i.charCodeAt(a++));if(c===void 0||u===void 0)throw new ai(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);s[o]=c*16+u}return s}function t2(t,e){const r=Ta(t,e);return jl(r)}function ql(t,e={}){const r=Xv.encode(t);return typeof e.size=="number"?(Ri(r,{size:e.size}),Ti(r,{dir:"right",size:e.size})):r}const Ms=BigInt(2**32-1),zl=BigInt(32);function r2(t,e=!1){return e?{h:Number(t&Ms),l:Number(t>>zl&Ms)}:{h:Number(t>>zl&Ms)|0,l:Number(t&Ms)|0}}function i2(t,e=!1){const r=t.length;let i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=r2(t[s],e);[i[s],n[s]]=[o,a]}return[i,n]}const n2=(t,e,r)=>t<<r|e>>>32-r,s2=(t,e,r)=>e<<r|t>>>32-r,o2=(t,e,r)=>e<<r-32|t>>>64-r,a2=(t,e,r)=>t<<r-32|e>>>64-r,Ni=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function c2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function bn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ci(t,...e){if(!c2(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function u2(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");bn(t.outputLen),bn(t.blockLen)}function Ui(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Hl(t,e){ci(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function h2(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Fi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ra(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Vt(t,e){return t<<32-e|t>>>e}const l2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function f2(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function d2(t){for(let e=0;e<t.length;e++)t[e]=f2(t[e]);return t}const Vl=l2?t=>t:d2;function p2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function js(t){return typeof t=="string"&&(t=p2(t)),ci(t),t}function g2(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];ci(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}class Na{}function Kl(t){const e=i=>t().update(js(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Wl(t=32){if(Ni&&typeof Ni.getRandomValues=="function")return Ni.getRandomValues(new Uint8Array(t));if(Ni&&typeof Ni.randomBytes=="function")return Uint8Array.from(Ni.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const y2=BigInt(0),vn=BigInt(1),w2=BigInt(2),m2=BigInt(7),b2=BigInt(256),v2=BigInt(113),Gl=[],Yl=[],Zl=[];for(let t=0,e=vn,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Gl.push(2*(5*i+r)),Yl.push((t+1)*(t+2)/2%64);let n=y2;for(let s=0;s<7;s++)e=(e<<vn^(e>>m2)*v2)%b2,e&w2&&(n^=vn<<(vn<<BigInt(s))-vn);Zl.push(n)}const Jl=i2(Zl,!0),E2=Jl[0],x2=Jl[1],Xl=(t,e,r)=>r>32?o2(t,e,r):n2(t,e,r),Ql=(t,e,r)=>r>32?a2(t,e,r):s2(t,e,r);function _2(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],h=r[c+1],l=Xl(u,h,1)^r[a],f=Ql(u,h,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=l,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Yl[o],c=Xl(n,s,a),u=Ql(n,s,a),h=Gl[o];n=t[h],s=t[h+1],t[h]=c,t[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=E2[i],t[1]^=x2[i]}Fi(r)}class Ua extends Na{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,bn(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=h2(this.state)}clone(){return this._cloneInto()}keccak(){Vl(this.state32),_2(this.state32,this.rounds),Vl(this.state32),this.posOut=0,this.pos=0}update(e){Ui(this),e=js(e),ci(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Ui(this,!1),ci(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return bn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Hl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Fi(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Ua(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const I2=(t,e,r)=>Kl(()=>new Ua(e,t,r)),ef=I2(1,136,256/8);function tf(t,e){const r=e||"hex",i=ef(mn(t,{strict:!1})?Qv(t):t);return r==="bytes"?i:Ca(i)}class rf extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Fa=new rf(8192);function S2(t,e){if(Fa.has(`${t}.${e}`))return Fa.get(`${t}.${e}`);const r=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),i=tf(ql(r),"bytes"),n=(e?r.substring(`${e}0x`.length):r).split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(i[o>>1]&15)>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const s=`0x${n.join("")}`;return Fa.set(`${t}.${e}`,s),s}function A2(t){const e=tf(`0x${t.substring(4)}`).substring(26);return S2(`0x${e}`)}async function D2({hash:t,signature:e}){const r=mn(t)?t:Ca(t),{secp256k1:i}=await Promise.resolve().then(function(){return YE});return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:h,v:l,yParity:f}=e,p=Number(f??l),d=nf(p);return new i.Signature(Ba(u),Ba(h)).addRecoveryBit(d)}const o=mn(e)?e:Ca(e);if(Oa(o)!==65)throw new Error("invalid signature length");const a=Wv(`0x${o.slice(130)}`),c=nf(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function nf(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function $2({hash:t,signature:e}){return A2(await D2({hash:t,signature:e}))}function O2(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function P2(t,e,r){return t&e^~t&r}function B2(t,e,r){return t&e^t&r^e&r}class C2 extends Na{constructor(e,r,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Ra(this.buffer)}update(e){Ui(this),e=js(e),ci(e);const{view:r,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Ra(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ui(this),Hl(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,Fi(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let l=o;l<n;l++)r[l]=0;O2(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=Ra(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const xr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),T2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_r=new Uint32Array(64);class R2 extends C2{constructor(e=32){super(64,e,8,!1),this.A=xr[0]|0,this.B=xr[1]|0,this.C=xr[2]|0,this.D=xr[3]|0,this.E=xr[4]|0,this.F=xr[5]|0,this.G=xr[6]|0,this.H=xr[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)_r[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const f=_r[l-15],p=_r[l-2],d=Vt(f,7)^Vt(f,18)^f>>>3,g=Vt(p,17)^Vt(p,19)^p>>>10;_r[l]=g+_r[l-7]+d+_r[l-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:h}=this;for(let l=0;l<64;l++){const f=Vt(a,6)^Vt(a,11)^Vt(a,25),p=h+f+P2(a,c,u)+T2[l]+_r[l]|0,g=(Vt(i,2)^Vt(i,13)^Vt(i,22))+B2(i,n,s)|0;h=u,u=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+g|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(i,n,s,o,a,c,u,h)}roundClean(){Fi(_r)}destroy(){this.set(0,0,0,0,0,0,0,0),Fi(this.buffer)}}const qs=Kl(()=>new R2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const La=BigInt(0),ka=BigInt(1);function En(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ir(t){if(!En(t))throw new Error("Uint8Array expected")}function xn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function zs(t){const e=t.toString(16);return e.length&1?"0"+e:e}function sf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?La:BigInt("0x"+t)}const of=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",N2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function _n(t){if(Ir(t),of)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=N2[t[r]];return e}const or={_0:48,_9:57,A:65,F:70,a:97,f:102};function af(t){if(t>=or._0&&t<=or._9)return t-or._0;if(t>=or.A&&t<=or.F)return t-(or.A-10);if(t>=or.a&&t<=or.f)return t-(or.a-10)}function Hs(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(of)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=af(t.charCodeAt(s)),a=af(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function Kt(t){return sf(_n(t))}function cf(t){return Ir(t),sf(_n(Uint8Array.from(t).reverse()))}function ui(t,e){return Hs(t.toString(16).padStart(e*2,"0"))}function uf(t,e){return ui(t,e).reverse()}function Ce(t,e,r){let i;if(typeof e=="string")try{i=Hs(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(En(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Et(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Ir(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}function Ma(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const ja=t=>typeof t=="bigint"&&La<=t;function In(t,e,r){return ja(t)&&ja(e)&&ja(r)&&e<=t&&t<r}function hi(t,e,r,i){if(!In(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function U2(t){let e;for(e=0;t>La;t>>=ka,e+=1);return e}const Vs=t=>(ka<<BigInt(t))-ka,qa=t=>new Uint8Array(t),hf=t=>Uint8Array.from(t);function F2(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=qa(t),n=qa(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...l)=>r(n,i,...l),c=(l=qa(0))=>{n=a(hf([0]),l),i=a(),l.length!==0&&(n=a(hf([1]),l),i=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const f=[];for(;l<e;){i=a();const p=i.slice();f.push(p),l+=i.length}return Et(...f)};return(l,f)=>{o(),c(l);let p;for(;!(p=f(u()));)c();return o(),p}}const L2={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||En(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Sn(t,e,r={}){const i=(n,s,o)=>{const a=L2[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function lf(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const k2="0.1.1";function M2(){return k2}class Ye extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof Ye){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof Ye&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||n?["",i?`Details: ${i}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${M2()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return ff(this,e)}}function ff(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?ff(t.cause,e):e?null:t}function j2(t,e){if(gf(t)>e)throw new Y2({givenSize:gf(t),maxSize:e})}const ar={zero:48,nine:57,A:65,F:70,a:97,f:102};function df(t){if(t>=ar.zero&&t<=ar.nine)return t-ar.zero;if(t>=ar.A&&t<=ar.F)return t-(ar.A-10);if(t>=ar.a&&t<=ar.f)return t-(ar.a-10)}function q2(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Z2({size:t.length,targetSize:i,type:"Bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=r==="right";n[o?s:i-s-1]=t[o?s:t.length-s-1]}return n}function za(t,e){if(Va(t)>e)throw new iE({givenSize:Va(t),maxSize:e})}function pf(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const n=t.replace("0x","");if(n.length>i*2)throw new nE({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const z2=new TextEncoder;function H2(t){return t instanceof Uint8Array?t:typeof t=="string"?K2(t):V2(t)}function V2(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function K2(t,e={}){const{size:r}=e;let i=t;r&&(za(t,r),i=Ha(t,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=df(n.charCodeAt(c++)),h=df(n.charCodeAt(c++));if(u===void 0||h===void 0)throw new Ye(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=u*16+h}return o}function W2(t,e={}){const{size:r}=e,i=z2.encode(t);return typeof r=="number"?(j2(i,r),G2(i,r)):i}function G2(t,e){return q2(t,{dir:"right",size:e})}function gf(t){return t.length}class Y2 extends Ye{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Z2 extends Ye{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const J2=new TextEncoder,X2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function yf(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Q2(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(za(r,e.size),Ks(r,e.size)):r}function wf(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=X2[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(za(i,e.size),Ha(i,e.size)):i}function eE(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const u=typeof t=="bigint"?"n":"";throw new rE({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:i,value:`${t}${u}`})}const c=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?Ks(c,i):c}function tE(t,e={}){return wf(J2.encode(t),e)}function Ks(t,e){return pf(t,{dir:"left",size:e})}function Ha(t,e){return pf(t,{dir:"right",size:e})}function Va(t){return Math.ceil((t.length-2)/2)}class rE extends Ye{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class iE extends Ye{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class nE extends Ye{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}new rf(128),Ta(0,{size:32});function sE(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=ef(H2(t));return r==="Bytes"?i:wf(i)}class oE extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Ka={checksum:new oE(8192)}.checksum,aE=/^0x[a-fA-F0-9]{40}$/;function mf(t,e={}){const{strict:r=!0}=e;if(!aE.test(t))throw new bf({address:t,cause:new uE});if(r){if(t.toLowerCase()===t)return;if(cE(t)!==t)throw new bf({address:t,cause:new hE})}}function cE(t){if(Ka.has(t))return Ka.get(t);mf(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=sE(W2(e),{as:"Bytes"}),i=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&i[s]&&(i[s]=i[s].toUpperCase()),(r[s>>1]&15)>=8&&i[s+1]&&(i[s+1]=i[s+1].toUpperCase());const n=`0x${i.join("")}`;return Ka.set(t,n),n}class bf extends Ye{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class uE extends Ye{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class hE extends Ye{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const lE=/^(.*)\[([0-9]*)\]$/,fE=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,dE=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Wa(t,e){if(t.length!==e.length)throw new gE({expectedLength:t.length,givenLength:e.length});const r=[];for(let i=0;i<t.length;i++){const n=t[i],s=e[i];r.push(Wa.encode(n,s))}return yf(...r)}(function(t){function e(r,i,n=!1){if(r==="address"){const c=i;return mf(c),Ks(c.toLowerCase(),n?32:0)}if(r==="string")return tE(i);if(r==="bytes")return i;if(r==="bool")return Ks(Q2(i),n?32:1);const s=r.match(dE);if(s){const[c,u,h="256"]=s,l=Number.parseInt(h)/8;return eE(i,{size:n?32:l,signed:u==="int"})}const o=r.match(fE);if(o){const[c,u]=o;if(Number.parseInt(u)!==(i.length-2)/2)throw new pE({expectedSize:Number.parseInt(u),value:i});return Ha(i,n?32:0)}const a=r.match(lE);if(a&&Array.isArray(i)){const[c,u]=a,h=[];for(let l=0;l<i.length;l++)h.push(e(u,i[l],!0));return h.length===0?"0x":yf(...h)}throw new yE(r)}t.encode=e})(Wa||(Wa={}));class pE extends Ye{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${Va(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class gE extends Ye{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class yE extends Ye{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class vf extends Na{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,u2(e);const i=js(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Fi(s)}update(e){return Ui(this),this.iHash.update(e),this}digestInto(e){Ui(this),ci(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ef=(t,e,r)=>new vf(t,e).update(r).digest();Ef.create=(t,e)=>new vf(t,e);const nt=BigInt(0),Ze=BigInt(1),li=BigInt(2),wE=BigInt(3),xf=BigInt(4),_f=BigInt(5),If=BigInt(8);function Ae(t,e){const r=t%e;return r>=nt?r:e+r}function xt(t,e,r){let i=t;for(;e-- >nt;)i*=i,i%=r;return i}function Ga(t,e){if(t===nt)throw new Error("invert: expected non-zero number");if(e<=nt)throw new Error("invert: expected positive modulus, got "+e);let r=Ae(t,e),i=e,n=nt,s=Ze;for(;r!==nt;){const a=i/r,c=i%r,u=n-s*a;i=r,r=c,n=s,s=u}if(i!==Ze)throw new Error("invert: does not exist");return Ae(n,e)}function Sf(t,e){const r=(t.ORDER+Ze)/xf,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function mE(t,e){const r=(t.ORDER-_f)/If,i=t.mul(e,li),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,li),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function bE(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Ze,r=0;for(;e%li===nt;)e/=li,r++;let i=li;const n=Ya(t);for(;Df(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Sf;let s=n.pow(i,e);const o=(e+Ze)/li;return function(c,u){if(c.is0(u))return u;if(Df(c,u)!==1)throw new Error("Cannot find square root");let h=r,l=c.mul(c.ONE,s),f=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===h)throw new Error("Cannot find square root");const v=Ze<<BigInt(h-d-1),I=c.pow(l,v);h=d,l=c.sqr(I),f=c.mul(f,l),p=c.mul(p,I)}return p}}function vE(t){return t%xf===wE?Sf:t%If===_f?mE:bE(t)}const EE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Af(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=EE.reduce((i,n)=>(i[n]="function",i),e);return Sn(t,r)}function xE(t,e,r){if(r<nt)throw new Error("invalid exponent, negatives unsupported");if(r===nt)return t.ONE;if(r===Ze)return e;let i=t.ONE,n=e;for(;r>nt;)r&Ze&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Ze;return i}function Ws(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function Df(t,e){const r=(t.ORDER-Ze)/li,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function $f(t,e){e!==void 0&&bn(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Ya(t,e,r=!1,i={}){if(t<=nt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=$f(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:Vs(n),ZERO:nt,ONE:Ze,create:c=>Ae(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return nt<=c&&c<t},is0:c=>c===nt,isOdd:c=>(c&Ze)===Ze,neg:c=>Ae(-c,t),eql:(c,u)=>c===u,sqr:c=>Ae(c*c,t),add:(c,u)=>Ae(c+u,t),sub:(c,u)=>Ae(c-u,t),mul:(c,u)=>Ae(c*u,t),pow:(c,u)=>xE(a,c,u),div:(c,u)=>Ae(c*Ga(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ga(c,t),sqrt:i.sqrt||(c=>(o||(o=vE(t)),o(a,c))),toBytes:c=>r?uf(c,s):ui(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?cf(c):Kt(c)},invertBatch:c=>Ws(a,c),cmov:(c,u,h)=>h?u:c});return Object.freeze(a)}function Of(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Pf(t){const e=Of(t);return e+Math.ceil(e/2)}function _E(t,e,r=!1){const i=t.length,n=Of(e),s=Pf(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?cf(t):Kt(t),a=Ae(o,e-Ze)+Ze;return r?uf(a,n):ui(a,n)}const Bf=BigInt(0),Za=BigInt(1);function Ja(t,e){const r=e.negate();return t?r:e}function Cf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Xa(t,e){Cf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=Vs(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function Tf(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Za);const u=e*i,h=u+Math.abs(a)-1,l=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:h,isZero:l,isNeg:f,isNegF:p,offsetF:u}}function IE(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function SE(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Qa=new WeakMap,Rf=new WeakMap;function ec(t){return Rf.get(t)||1}function AE(t,e){return{constTimeNegate:Ja,hasPrecomputes(r){return ec(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Bf;)i&Za&&(n=n.add(s)),s=s.double(),i>>=Za;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Xa(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let h=1;h<s;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){let s=t.ZERO,o=t.BASE;const a=Xa(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:h,isZero:l,isNeg:f,isNegF:p,offsetF:d}=Tf(n,c,a);n=u,l?o=o.add(Ja(p,i[d])):s=s.add(Ja(f,i[h]))}return{p:s,f:o}},wNAFUnsafe(r,i,n,s=t.ZERO){const o=Xa(r,e);for(let a=0;a<o.windows&&n!==Bf;a++){const{nextN:c,offset:u,isZero:h,isNeg:l}=Tf(n,a,o);if(n=c,!h){const f=i[u];s=s.add(l?f.negate():f)}}return s},getPrecomputes(r,i,n){let s=Qa.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Qa.set(i,n(s))),s},wNAFCached(r,i,n){const s=ec(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=ec(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Cf(i,e),Rf.set(r,i),Qa.delete(r)}}}function DE(t,e,r,i){IE(r,t),SE(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=U2(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Vs(c),h=new Array(Number(u)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=l;p>=0;p-=c){h.fill(o);for(let g=0;g<s;g++){const v=i[g],I=Number(v>>BigInt(p)&u);h[I]=h[I].add(r[g])}let d=o;for(let g=h.length-1,v=o;g>0;g--)v=v.add(h[g]),d=d.add(v);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Nf(t){return Af(t.Fp),Sn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$f(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Uf(t){t.lowS!==void 0&&xn("lowS",t.lowS),t.prehash!==void 0&&xn("prehash",t.prehash)}function $E(t){const e=Nf(t);Sn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class OE extends Error{constructor(e=""){super(e)}}const cr={Err:OE,_tlv:{encode:(t,e)=>{const{Err:r}=cr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=zs(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?zs(n.length/2|128):"";return zs(t)+s+n+e},decode(t,e){const{Err:r}=cr;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const h of u)o=o<<8|h;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=cr;if(t<Tt)throw new e("integer: negative integers are not allowed");let r=zs(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=cr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Kt(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=cr,n=Ce("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:u,l:h}=i.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=cr,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}};function tc(t,e){return _n(ui(t,e))}const Tt=BigInt(0),oe=BigInt(1),Sr=BigInt(2),An=BigInt(3),rc=BigInt(4);function PE(t){const e=$E(t),{Fp:r}=e,i=Ya(e.n,e.nBitLength),n=e.toBytes||((b,m,x)=>{const $=m.toAffine();return Et(Uint8Array.from([4]),r.toBytes($.x),r.toBytes($.y))}),s=e.fromBytes||(b=>{const m=b.subarray(1),x=r.fromBytes(m.subarray(0,r.BYTES)),$=r.fromBytes(m.subarray(r.BYTES,2*r.BYTES));return{x,y:$}});function o(b){const{a:m,b:x}=e,$=r.sqr(b),D=r.mul($,b);return r.add(r.add(D,r.mul(b,m)),x)}function a(b,m){const x=r.sqr(m),$=o(b);return r.eql(x,$)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,An),rc),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function h(b){return In(b,oe,e.n)}function l(b){const{allowedPrivateKeyLengths:m,nByteLength:x,wrapPrivateKey:$,n:D}=e;if(m&&typeof b!="bigint"){if(En(b)&&(b=_n(b)),typeof b!="string"||!m.includes(b.length))throw new Error("invalid private key");b=b.padStart(x*2,"0")}let B;try{B=typeof b=="bigint"?b:Kt(Ce("private key",b,x))}catch{throw new Error("invalid private key, expected hex or "+x+" bytes, got "+typeof b)}return $&&(B=Ae(B,D)),hi("private key",B,oe,D),B}function f(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const p=lf((b,m)=>{const{px:x,py:$,pz:D}=b;if(r.eql(D,r.ONE))return{x,y:$};const B=b.is0();m==null&&(m=B?r.ONE:r.inv(D));const P=r.mul(x,m),U=r.mul($,m),C=r.mul(D,m);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(C,r.ONE))throw new Error("invZ was invalid");return{x:P,y:U}}),d=lf(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=b.toAffine();if(!r.isValid(m)||!r.isValid(x))throw new Error("bad point: x or y not FE");if(!a(m,x))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(m,x,$){if(m==null||!r.isValid(m))throw new Error("x required");if(x==null||!r.isValid(x)||r.is0(x))throw new Error("y required");if($==null||!r.isValid($))throw new Error("z required");this.px=m,this.py=x,this.pz=$,Object.freeze(this)}static fromAffine(m){const{x,y:$}=m||{};if(!m||!r.isValid(x)||!r.isValid($))throw new Error("invalid affine point");if(m instanceof g)throw new Error("projective point not allowed");const D=B=>r.eql(B,r.ZERO);return D(x)&&D($)?g.ZERO:new g(x,$,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const x=Ws(r,m.map($=>$.pz));return m.map(($,D)=>$.toAffine(x[D])).map(g.fromAffine)}static fromHex(m){const x=g.fromAffine(s(Ce("pointHex",m)));return x.assertValidity(),x}static fromPrivateKey(m){return g.BASE.multiply(l(m))}static msm(m,x){return DE(g,i,m,x)}_setWindowSize(m){A.setWindowSize(this,m)}assertValidity(){d(this)}hasEvenY(){const{y:m}=this.toAffine();if(r.isOdd)return!r.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){f(m);const{px:x,py:$,pz:D}=this,{px:B,py:P,pz:U}=m,C=r.eql(r.mul(x,U),r.mul(B,D)),R=r.eql(r.mul($,U),r.mul(P,D));return C&&R}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:m,b:x}=e,$=r.mul(x,An),{px:D,py:B,pz:P}=this;let U=r.ZERO,C=r.ZERO,R=r.ZERO,T=r.mul(D,D),j=r.mul(B,B),y=r.mul(P,P),w=r.mul(D,B);return w=r.add(w,w),R=r.mul(D,P),R=r.add(R,R),U=r.mul(m,R),C=r.mul($,y),C=r.add(U,C),U=r.sub(j,C),C=r.add(j,C),C=r.mul(U,C),U=r.mul(w,U),R=r.mul($,R),y=r.mul(m,y),w=r.sub(T,y),w=r.mul(m,w),w=r.add(w,R),R=r.add(T,T),T=r.add(R,T),T=r.add(T,y),T=r.mul(T,w),C=r.add(C,T),y=r.mul(B,P),y=r.add(y,y),T=r.mul(y,w),U=r.sub(U,T),R=r.mul(y,j),R=r.add(R,R),R=r.add(R,R),new g(U,C,R)}add(m){f(m);const{px:x,py:$,pz:D}=this,{px:B,py:P,pz:U}=m;let C=r.ZERO,R=r.ZERO,T=r.ZERO;const j=e.a,y=r.mul(e.b,An);let w=r.mul(x,B),E=r.mul($,P),O=r.mul(D,U),_=r.add(x,$),S=r.add(B,P);_=r.mul(_,S),S=r.add(w,E),_=r.sub(_,S),S=r.add(x,D);let N=r.add(B,U);return S=r.mul(S,N),N=r.add(w,O),S=r.sub(S,N),N=r.add($,D),C=r.add(P,U),N=r.mul(N,C),C=r.add(E,O),N=r.sub(N,C),T=r.mul(j,S),C=r.mul(y,O),T=r.add(C,T),C=r.sub(E,T),T=r.add(E,T),R=r.mul(C,T),E=r.add(w,w),E=r.add(E,w),O=r.mul(j,O),S=r.mul(y,S),E=r.add(E,O),O=r.sub(w,O),O=r.mul(j,O),S=r.add(S,O),w=r.mul(E,S),R=r.add(R,w),w=r.mul(N,S),C=r.mul(_,C),C=r.sub(C,w),w=r.mul(_,E),T=r.mul(N,T),T=r.add(T,w),new g(C,R,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(g.ZERO)}wNAF(m){return A.wNAFCached(this,m,g.normalizeZ)}multiplyUnsafe(m){const{endo:x,n:$}=e;hi("scalar",m,Tt,$);const D=g.ZERO;if(m===Tt)return D;if(this.is0()||m===oe)return this;if(!x||A.hasPrecomputes(this))return A.wNAFCachedUnsafe(this,m,g.normalizeZ);let{k1neg:B,k1:P,k2neg:U,k2:C}=x.splitScalar(m),R=D,T=D,j=this;for(;P>Tt||C>Tt;)P&oe&&(R=R.add(j)),C&oe&&(T=T.add(j)),j=j.double(),P>>=oe,C>>=oe;return B&&(R=R.negate()),U&&(T=T.negate()),T=new g(r.mul(T.px,x.beta),T.py,T.pz),R.add(T)}multiply(m){const{endo:x,n:$}=e;hi("scalar",m,oe,$);let D,B;if(x){const{k1neg:P,k1:U,k2neg:C,k2:R}=x.splitScalar(m);let{p:T,f:j}=this.wNAF(U),{p:y,f:w}=this.wNAF(R);T=A.constTimeNegate(P,T),y=A.constTimeNegate(C,y),y=new g(r.mul(y.px,x.beta),y.py,y.pz),D=T.add(y),B=j.add(w)}else{const{p:P,f:U}=this.wNAF(m);D=P,B=U}return g.normalizeZ([D,B])[0]}multiplyAndAddUnsafe(m,x,$){const D=g.BASE,B=(U,C)=>C===Tt||C===oe||!U.equals(D)?U.multiplyUnsafe(C):U.multiply(C),P=B(this,x).add(B(m,$));return P.is0()?void 0:P}toAffine(m){return p(this,m)}isTorsionFree(){const{h:m,isTorsionFree:x}=e;if(m===oe)return!0;if(x)return x(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:x}=e;return m===oe?this:x?x(g,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return xn("isCompressed",m),this.assertValidity(),n(g,this,m)}toHex(m=!0){return xn("isCompressed",m),_n(this.toRawBytes(m))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:v,nBitLength:I}=e,A=AE(g,v?Math.ceil(I/2):I);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:h}}function BE(t){const e=Nf(t);return Sn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function CE(t){const e=BE(t),{Fp:r,n:i,nByteLength:n,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return Ae(y,i)}function u(y){return Ga(y,i)}const{ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:p}=PE({...e,toBytes(y,w,E){const O=w.toAffine(),_=r.toBytes(O.x),S=Et;return xn("isCompressed",E),E?S(Uint8Array.from([w.hasEvenY()?2:3]),_):S(Uint8Array.from([4]),_,r.toBytes(O.y))},fromBytes(y){const w=y.length,E=y[0],O=y.subarray(1);if(w===o&&(E===2||E===3)){const _=Kt(O);if(!In(_,oe,r.ORDER))throw new Error("Point is not on curve");const S=f(_);let N;try{N=r.sqrt(S)}catch(q){const V=q instanceof Error?": "+q.message:"";throw new Error("Point is not on curve"+V)}const k=(N&oe)===oe;return(E&1)===1!==k&&(N=r.neg(N)),{x:_,y:N}}else if(w===a&&E===4){const _=r.fromBytes(O.subarray(0,r.BYTES)),S=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:_,y:S}}else{const _=o,S=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+S+", got "+w)}}});function d(y){const w=i>>oe;return y>w}function g(y){return d(y)?c(-y):y}const v=(y,w,E)=>Kt(y.slice(w,E));class I{constructor(w,E,O){hi("r",w,oe,i),hi("s",E,oe,i),this.r=w,this.s=E,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(w){const E=n;return w=Ce("compactSignature",w,E*2),new I(v(w,0,E),v(w,E,2*E))}static fromDER(w){const{r:E,s:O}=cr.toSig(Ce("DER",w));return new I(E,O)}assertValidity(){}addRecoveryBit(w){return new I(this.r,this.s,w)}recoverPublicKey(w){const{r:E,s:O,recovery:_}=this,S=D(Ce("msgHash",w));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const N=_===2||_===3?E+e.n:E;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const k=(_&1)===0?"02":"03",H=h.fromHex(k+tc(N,r.BYTES)),q=u(N),V=c(-S*q),K=c(O*q),G=h.BASE.multiplyAndAddUnsafe(H,V,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Hs(this.toDERHex())}toDERHex(){return cr.hexFromSig(this)}toCompactRawBytes(){return Hs(this.toCompactHex())}toCompactHex(){const w=n;return tc(this.r,w)+tc(this.s,w)}}const A={isValidPrivateKey(y){try{return l(y),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const y=Pf(e.n);return _E(e.randomBytes(y),e.n)},precompute(y=8,w=h.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}};function b(y,w=!0){return h.fromPrivateKey(y).toRawBytes(w)}function m(y){if(typeof y=="bigint")return!1;if(y instanceof h)return!0;const E=Ce("key",y).length,O=r.BYTES,_=O+1,S=2*O+1;if(!(e.allowedPrivateKeyLengths||n===_))return E===_||E===S}function x(y,w,E=!0){if(m(y)===!0)throw new Error("first arg must be private key");if(m(w)===!1)throw new Error("second arg must be public key");return h.fromHex(w).multiply(l(y)).toRawBytes(E)}const $=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const w=Kt(y),E=y.length*8-s;return E>0?w>>BigInt(E):w},D=e.bits2int_modN||function(y){return c($(y))},B=Vs(s);function P(y){return hi("num < 2^"+s,y,Tt,B),ui(y,n)}function U(y,w,E=C){if(["recovered","canonical"].some(W=>W in E))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:_}=e;let{lowS:S,prehash:N,extraEntropy:k}=E;S==null&&(S=!0),y=Ce("msgHash",y),Uf(E),N&&(y=Ce("prehashed msgHash",O(y)));const H=D(y),q=l(w),V=[P(q),P(H)];if(k!=null&&k!==!1){const W=k===!0?_(r.BYTES):k;V.push(Ce("extraEntropy",W))}const K=Et(...V),G=H;function Q(W){const de=$(W);if(!p(de))return;const we=u(de),xe=h.BASE.multiply(de).toAffine(),_e=c(xe.x);if(_e===Tt)return;const me=c(we*c(G+_e*q));if(me===Tt)return;let Me=(xe.x===_e?0:2)|Number(xe.y&oe),Si=me;return S&&d(me)&&(Si=g(me),Me^=1),new I(_e,Si,Me)}return{seed:K,k2sig:Q}}const C={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function T(y,w,E=C){const{seed:O,k2sig:_}=U(y,w,E),S=e;return F2(S.hash.outputLen,S.nByteLength,S.hmac)(O,_)}h.BASE._setWindowSize(8);function j(y,w,E,O=R){const _=y;w=Ce("msgHash",w),E=Ce("publicKey",E);const{lowS:S,prehash:N,format:k}=O;if(Uf(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&k!=="compact"&&k!=="der")throw new Error("format must be compact or der");const H=typeof _=="string"||En(_),q=!H&&!k&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!H&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let V,K;try{if(q&&(V=new I(_.r,_.s)),H){try{k!=="compact"&&(V=I.fromDER(_))}catch(Me){if(!(Me instanceof cr.Err))throw Me}!V&&k!=="der"&&(V=I.fromCompact(_))}K=h.fromHex(E)}catch{return!1}if(!V||S&&V.hasHighS())return!1;N&&(w=e.hash(w));const{r:G,s:Q}=V,W=D(w),de=u(Q),we=c(W*de),xe=c(G*de),_e=h.BASE.multiplyAndAddUnsafe(K,we,xe)?.toAffine();return _e?c(_e.x)===G:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:T,verify:j,ProjectivePoint:h,Signature:I,utils:A}}function TE(t,e){const r=t.ORDER;let i=Tt;for(let d=r-oe;d%Sr===Tt;d/=Sr)i+=oe;const n=i,s=Sr<<n-oe-oe,o=s*Sr,a=(r-oe)/o,c=(a-oe)/Sr,u=o-oe,h=s,l=t.pow(e,a),f=t.pow(e,(a+oe)/Sr);let p=(d,g)=>{let v=l,I=t.pow(g,u),A=t.sqr(I);A=t.mul(A,g);let b=t.mul(d,A);b=t.pow(b,c),b=t.mul(b,I),I=t.mul(b,g),A=t.mul(b,d);let m=t.mul(A,I);b=t.pow(m,h);let x=t.eql(b,t.ONE);I=t.mul(A,f),b=t.mul(m,v),A=t.cmov(I,A,x),m=t.cmov(b,m,x);for(let $=n;$>oe;$--){let D=$-Sr;D=Sr<<D-oe;let B=t.pow(m,D);const P=t.eql(B,t.ONE);I=t.mul(A,v),v=t.mul(v,v),B=t.mul(m,v),A=t.cmov(I,A,P),m=t.cmov(B,m,P)}return{isValid:x,value:A}};if(t.ORDER%rc===An){const d=(t.ORDER-An)/rc,g=t.sqrt(t.neg(e));p=(v,I)=>{let A=t.sqr(I);const b=t.mul(v,I);A=t.mul(A,b);let m=t.pow(A,d);m=t.mul(m,b);const x=t.mul(m,g),$=t.mul(t.sqr(m),I),D=t.eql($,v);let B=t.cmov(x,m,D);return{isValid:D,value:B}}}return p}function RE(t,e){if(Af(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=TE(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return i=>{let n,s,o,a,c,u,h,l;n=t.sqr(i),n=t.mul(n,e.Z),s=t.sqr(n),s=t.add(s,n),o=t.add(s,t.ONE),o=t.mul(o,e.B),a=t.cmov(e.Z,t.neg(s),!t.eql(s,t.ZERO)),a=t.mul(a,e.A),s=t.sqr(o),u=t.sqr(a),c=t.mul(u,e.A),s=t.add(s,c),s=t.mul(s,o),u=t.mul(u,a),c=t.mul(u,e.B),s=t.add(s,c),h=t.mul(n,o);const{isValid:f,value:p}=r(s,u);l=t.mul(n,i),l=t.mul(l,p),h=t.cmov(h,o,f),l=t.cmov(l,p,f);const d=t.isOdd(i)===t.isOdd(l);l=t.cmov(t.neg(l),l,d);const g=Ws(t,[a],!0)[0];return h=t.mul(h,g),{x:h,y:l}}}function NE(t){return{hash:t,hmac:(e,...r)=>Ef(t,e,g2(...r)),randomBytes:Wl}}function UE(t,e){const r=i=>CE({...t,...NE(i)});return{...r(e),create:r}}const FE=Kt;function Ar(t,e){if(Dn(t),Dn(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);const r=Array.from({length:e}).fill(0);for(let i=e-1;i>=0;i--)r[i]=t&255,t>>>=8;return new Uint8Array(r)}function LE(t,e){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t[i]^e[i];return r}function Dn(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function kE(t,e,r,i){Ir(t),Ir(e),Dn(r),e.length>255&&(e=i(Et(Ma("H2C-OVERSIZE-DST-"),e)));const{outputLen:n,blockLen:s}=i,o=Math.ceil(r/n);if(r>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=Et(e,Ar(e.length,1)),c=Ar(0,s),u=Ar(r,2),h=new Array(o),l=i(Et(c,t,u,Ar(0,1),a));h[0]=i(Et(l,Ar(1,1),a));for(let p=1;p<=o;p++){const d=[LE(l,h[p-1]),Ar(p+1,1),a];h[p]=i(Et(...d))}return Et(...h).slice(0,r)}function ME(t,e,r,i,n){if(Ir(t),Ir(e),Dn(r),e.length>255){const s=Math.ceil(2*i/8);e=n.create({dkLen:s}).update(Ma("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return n.create({dkLen:r}).update(t).update(Ar(r,2)).update(e).update(Ar(e.length,1)).digest()}function Ff(t,e,r){Sn(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:i,k:n,m:s,hash:o,expand:a,DST:c}=r;Ir(t),Dn(e);const u=typeof c=="string"?Ma(c):c,h=i.toString(2).length,l=Math.ceil((h+n)/8),f=e*s*l;let p;if(a==="xmd")p=kE(t,u,f,o);else if(a==="xof")p=ME(t,u,f,n,o);else if(a==="_internal_pass")p=t;else throw new Error('expand must be "xmd" or "xof"');const d=new Array(e);for(let g=0;g<e;g++){const v=new Array(s);for(let I=0;I<s;I++){const A=l*(I+g*s),b=p.subarray(A,A+l);v[I]=Ae(FE(b),i)}d[g]=v}return d}function jE(t,e){const r=e.map(i=>Array.from(i).reverse());return(i,n)=>{const[s,o,a,c]=r.map(l=>l.reduce((f,p)=>t.add(t.mul(f,i),p))),[u,h]=Ws(t,[o,c],!0);return i=t.mul(s,u),n=t.mul(n,t.mul(a,h)),{x:i,y:n}}}function qE(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function i(s){return t.fromAffine(e(s))}function n(s){const o=s.clearCofactor();return o.equals(t.ZERO)?t.ZERO:(o.assertValidity(),o)}return{defaults:r,hashToCurve(s,o){const a=Ff(s,2,{...r,DST:r.DST,...o}),c=i(a[0]),u=i(a[1]);return n(c.add(u))},encodeToCurve(s,o){const a=Ff(s,1,{...r,DST:r.encodeDST,...o});return n(i(a[0]))},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(const o of s)if(typeof o!="bigint")throw new Error("expected array of bigints");return n(i(s))}}}const $n=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Gs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ic=BigInt(0),On=BigInt(1),Ys=BigInt(2),Lf=(t,e)=>(t+e/Ys)/e;function kf(t){const e=$n,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,h=u*u*t%e,l=xt(h,r,e)*h%e,f=xt(l,r,e)*h%e,p=xt(f,Ys,e)*u%e,d=xt(p,n,e)*p%e,g=xt(d,s,e)*d%e,v=xt(g,a,e)*g%e,I=xt(v,c,e)*v%e,A=xt(I,a,e)*g%e,b=xt(A,r,e)*h%e,m=xt(b,o,e)*d%e,x=xt(m,i,e)*u%e,$=xt(x,Ys,e);if(!Dr.eql(Dr.sqr($),t))throw new Error("Cannot find square root");return $}const Dr=Ya($n,void 0,void 0,{sqrt:kf}),Pn=UE({a:ic,b:BigInt(7),Fp:Dr,n:Gs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Gs,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-On*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Lf(s*t,e),c=Lf(-i*t,e);let u=Ae(t-a*r-c*n,e),h=Ae(-a*i-c*s,e);const l=u>o,f=h>o;if(l&&(u=e-u),f&&(h=e-h),u>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:f,k2:h}}}},qs),Mf={};function Zs(t,...e){let r=Mf[t];if(r===void 0){const i=qs(Uint8Array.from(t,n=>n.charCodeAt(0)));r=Et(i,i),Mf[t]=r}return qs(Et(r,...e))}const nc=t=>t.toRawBytes(!0).slice(1),sc=t=>ui(t,32),oc=t=>Ae(t,$n),Bn=t=>Ae(t,Gs),ac=Pn.ProjectivePoint,zE=(t,e,r)=>ac.BASE.multiplyAndAddUnsafe(t,e,r);function cc(t){let e=Pn.utils.normPrivateKeyToScalar(t),r=ac.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:Bn(-e),bytes:nc(r)}}function jf(t){hi("x",t,On,$n);const e=oc(t*t),r=oc(e*t+BigInt(7));let i=kf(r);i%Ys!==ic&&(i=oc(-i));const n=new ac(t,i,On);return n.assertValidity(),n}const Li=Kt;function qf(...t){return Bn(Li(Zs("BIP0340/challenge",...t)))}function HE(t){return cc(t).bytes}function VE(t,e,r=Wl(32)){const i=Ce("message",t),{bytes:n,scalar:s}=cc(e),o=Ce("auxRand",r,32),a=sc(s^Li(Zs("BIP0340/aux",o))),c=Zs("BIP0340/nonce",a,n,i),u=Bn(Li(c));if(u===ic)throw new Error("sign failed: k is zero");const{bytes:h,scalar:l}=cc(u),f=qf(h,n,i),p=new Uint8Array(64);if(p.set(h,0),p.set(sc(Bn(l+f*s)),32),!zf(p,i,n))throw new Error("sign: Invalid signature produced");return p}function zf(t,e,r){const i=Ce("signature",t,64),n=Ce("message",e),s=Ce("publicKey",r,32);try{const o=jf(Li(s)),a=Li(i.subarray(0,32));if(!In(a,On,$n))return!1;const c=Li(i.subarray(32,64));if(!In(c,On,Gs))return!1;const u=qf(sc(a),nc(o),n),h=zE(o,c,Bn(-u));return!(!h||!h.hasEvenY()||h.toAffine().x!==a)}catch{return!1}}const KE={getPublicKey:HE,sign:VE,verify:zf,utils:{randomPrivateKey:Pn.utils.randomPrivateKey,lift_x:jf,pointToBytes:nc,numberToBytesBE:ui,bytesToNumberBE:Kt,taggedHash:Zs,mod:Ae}},WE=jE(Dr,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),GE=RE(Dr,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:Dr.create(BigInt("-11"))}),uc=qE(Pn.ProjectivePoint,t=>{const{x:e,y:r}=GE(Dr.create(t[0]));return WE(e,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:Dr.ORDER,m:1,k:128,expand:"xmd",hash:qs});var YE=Object.freeze({__proto__:null,secp256k1:Pn,schnorr:KE,secp256k1_hasher:uc,hashToCurve:uc.hashToCurve,encodeToCurve:uc.encodeToCurve});function ZE(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const h=t.charAt(u),l=h.charCodeAt(0);if(e[l]!==255)throw new TypeError(h+" is ambiguous");e[l]=u}const r=t.length,i=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let h=0,l=0,f=0;const p=u.length;for(;f!==p&&u[f]===0;)f++,h++;const d=(p-f)*s+1>>>0,g=new Uint8Array(d);for(;f!==p;){let A=u[f],b=0;for(let m=d-1;(A!==0||b<l)&&m!==-1;m--,b++)A+=256*g[m]>>>0,g[m]=A%r>>>0,A=A/r>>>0;if(A!==0)throw new Error("Non-zero carry");l=b,f++}let v=d-l;for(;v!==d&&g[v]===0;)v++;let I=i.repeat(h);for(;v<d;++v)I+=t.charAt(g[v]);return I}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let h=0,l=0,f=0;for(;u[h]===i;)l++,h++;const p=(u.length-h)*n+1>>>0,d=new Uint8Array(p);for(;h<u.length;){const A=u.charCodeAt(h);if(A>255)return;let b=e[A];if(b===255)return;let m=0;for(let x=p-1;(b!==0||m<f)&&x!==-1;x--,m++)b+=r*d[x]>>>0,d[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=m,h++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const v=new Uint8Array(l+(p-g));let I=l;for(;g!==p;)v[I++]=d[g++];return v}function c(u){const h=a(u);if(h)return h;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var JE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Cn=ZE(JE);function XE(t){const e=t.length;let r=0,i=0;for(;i<e;){let n=t.charCodeAt(i++);if((n&4294967168)===0){r++;continue}else if((n&4294965248)===0)r+=2;else{if(n>=55296&&n<=56319&&i<e){const s=t.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)===0?r+=3:r+=4}}return r}function QE(t,e,r){const i=t.length;let n=r,s=0;for(;s<i;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[n++]=o;continue}else if((o&4294965248)===0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}const e3=new TextEncoder,t3=50;function r3(t,e,r){e3.encodeInto(t,e.subarray(r))}function i3(t,e,r){t.length>t3?r3(t,e,r):QE(t,e,r)}const n3=4096;function Hf(t,e,r){let i=e;const n=i+r,s=[];let o="";for(;i<n;){const a=t[i++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,u=t[i++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[i++]&63,u=t[i++]&63,h=t[i++]&63;let l=(a&7)<<18|c<<12|u<<6|h;l>65535&&(l-=65536,s.push(l>>>10&1023|55296),l=56320|l&1023),s.push(l)}else s.push(a);s.length>=n3&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const s3=new TextDecoder,o3=200;function a3(t,e,r){const i=t.subarray(e,e+r);return s3.decode(i)}function c3(t,e,r){return r>o3?a3(t,e,r):Hf(t,e,r)}class Js{constructor(e,r){this.type=e,this.data=r}}class dt extends Error{constructor(e){super(e);const r=Object.create(dt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:dt.name})}}const Tn=4294967295;function u3(t,e,r){const i=r/4294967296,n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function Vf(t,e,r){const i=Math.floor(r/4294967296),n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function Kf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function h3(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const l3=-1,f3=4294967296-1,d3=17179869184-1;function p3({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=d3)if(e===0&&t<=f3){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,i),n}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),Vf(i,4,t),r}}function g3(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,n=Math.floor(i/1e9);return{sec:r+n,nsec:i-n*1e9}}function y3(t){if(t instanceof Date){const e=g3(t);return p3(e)}else return null}function w3(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),n=(r&3)*4294967296+i,s=r>>>2;return{sec:n,nsec:s}}case 12:{const r=Kf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new dt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function m3(t){const e=w3(t);return new Date(e.sec*1e3+e.nsec/1e6)}const b3={type:l3,encode:y3,decode:m3};class Xs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(b3)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const n=this.builtInEncoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=-1-i;return new Js(o,s)}}}for(let i=0;i<this.encoders.length;i++){const n=this.encoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=i;return new Js(o,s)}}}return e instanceof Js?e:null}decode(e,r,i){const n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,i):new Js(r,e)}}Xs.defaultCodec=new Xs;function v3(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function hc(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):v3(t)?new Uint8Array(t):Uint8Array.from(t)}const E3=100,x3=2048;class lc{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Xs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??E3,this.initialBufferSize=e?.initialBufferSize??x3,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new lc({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),n=new DataView(r);i.set(this.bytes),this.view=n,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=XE(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),i3(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=hc(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let i=0;for(const n of r)e[n]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const s of i){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),n=i.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),u3(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Vf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function _3(t,e){return new lc(e).encodeSharedRef(t)}function fc(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const I3=16,S3=16;class A3{constructor(e=I3,r=S3){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const n=this.caches[i-1];e:for(const s of n){const o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const i=this.caches[e.length-1],n={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)}decode(e,r,i){const n=this.find(e,r,i);if(n!=null)return this.hit++,n;this.miss++;const s=Hf(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,s),s}}const dc="array",Rn="map_key",Wf="map_value",D3=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new dt("The type of key must be string or number but "+typeof t)};class $3{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=dc,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Rn,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===dc){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Rn||e.type===Wf){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Nn=-1,pc=new DataView(new ArrayBuffer(0)),O3=new Uint8Array(pc.buffer);try{pc.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Gf=new RangeError("Insufficient data"),P3=new A3;class gc{constructor(e){this.totalPos=0,this.pos=0,this.view=pc,this.bytes=O3,this.headByte=Nn,this.stack=new $3,this.entered=!1,this.extensionCodec=e?.extensionCodec??Xs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Tn,this.maxBinLength=e?.maxBinLength??Tn,this.maxArrayLength=e?.maxArrayLength??Tn,this.maxMapLength=e?.maxMapLength??Tn,this.maxExtLength=e?.maxExtLength??Tn,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:P3,this.mapKeyConverter=e?.mapKeyConverter??D3}clone(){return new gc({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Nn,this.stack.reset()}setBuffer(e){const r=hc(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Nn&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=hc(e),n=new Uint8Array(r.length+i.length);n.set(r),n.set(i,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${fc(n)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,n=-1;for await(const s of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(n=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{const n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){const n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){const n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){const n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();r=this.decodeExtension(n,4)}else throw new dt(`Unrecognized type byte: ${fc(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const n=i.top();if(n.type===dc)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,i.release(n);else continue e;else if(n.type===Rn){if(r==="__proto__")throw new dt("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=Wf;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,i.release(n);else{n.key=null,n.type=Rn;continue e}}return r}}readHeadByte(){return this.headByte===Nn&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Nn}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new dt(`Unrecognized array type byte: ${fc(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new dt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new dt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new dt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Gf;const i=this.pos+r;let n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,i,e):n=c3(this.bytes,i,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Rn:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new dt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Gf;const i=this.pos+r,n=this.bytes.subarray(i,i+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new dt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=h3(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Kf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function B3(t,e){return new gc(e).decode(t)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Qs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function yc(t,...e){if(!Qs(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Yf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Zf(t){if(typeof t!="function")throw new Error("function expected");return!0}function $r(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Un(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function eo(t){if(!Array.isArray(t))throw new Error("array expected")}function to(t,e){if(!Yf(!0,e))throw new Error(`${t}: array of strings expected`)}function wc(t,e){if(!Yf(!1,e))throw new Error(`${t}: array of numbers expected`)}function pt(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),i=t.map(s=>s.encode).reduceRight(r,e),n=t.map(s=>s.decode).reduce(r,e);return{encode:i,decode:n}}function gt(t){const e=typeof t=="string"?t.split(""):t,r=e.length;to("alphabet",e);const i=new Map(e.map((n,s)=>[n,s]));return{encode:n=>(eo(n),n.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:n=>(eo(n),n.map(s=>{$r("alphabet.decode",s);const o=i.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function yt(t=""){return $r("join",t),{encode:e=>(to("join.decode",e),e.join(t)),decode:e=>($r("join.decode",e),e.split(t))}}function ro(t,e="="){return Un(t),$r("padding",e),{encode(r){for(to("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){to("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}function Jf(t){return Zf(t),{encode:e=>e,decode:e=>t(e)}}function Xf(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(eo(t),!t.length)return[];let i=0;const n=[],s=Array.from(t,a=>{if(Un(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=i;u<o;u++){const h=s[u],l=e*a,f=l+h;if(!Number.isSafeInteger(f)||l/e!==a||f-h!==l)throw new Error("convertRadix: carry overflow");const p=f/r;a=f%r;const d=Math.floor(p);if(s[u]=d,!Number.isSafeInteger(d)||d*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:i=u;else continue}if(n.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)n.push(0);return n.reverse()}const Qf=(t,e)=>e===0?t:Qf(e,t%e),io=(t,e)=>t+(e-Qf(t,e)),no=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function mc(t,e,r,i){if(eo(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(io(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${io(e,r)}`);let n=0,s=0;const o=no[e],a=no[r]-1,c=[];for(const u of t){if(Un(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(n=n<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((n>>s-r&a)>>>0);const h=no[s];if(h===void 0)throw new Error("invalid carry");n&=h-1}if(n=n<<r-s&a,!i&&s>=e)throw new Error("Excess padding");if(!i&&n>0)throw new Error(`Non-zero padding: ${n}`);return i&&s>0&&c.push(n>>>0),c}function C3(t){Un(t);const e=2**8;return{encode:r=>{if(!Qs(r))throw new Error("radix.encode input should be Uint8Array");return Xf(Array.from(r),e,t)},decode:r=>(wc("radix.decode",r),Uint8Array.from(Xf(r,t,e)))}}function _t(t,e=!1){if(Un(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(io(8,t)>32||io(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Qs(r))throw new Error("radix2.encode input should be Uint8Array");return mc(Array.from(r),8,t,!e)},decode:r=>(wc("radix2.decode",r),Uint8Array.from(mc(r,t,8,e)))}}function ed(t){return Zf(t),function(...e){try{return t.apply(null,e)}catch{}}}const T3=pt(_t(5),gt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ro(5),yt("")),td=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",rd=(t,e)=>{$r("base64",t);const r=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,i=e?"base64url":"base64";if(t.length>0&&!r.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:i,lastChunkHandling:"strict"})},bc=t=>pt(C3(58),gt(t),yt("")),vc=pt(gt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),yt("")),id=[996825010,642813549,513874426,1027748829,705979059];function Fn(t){const e=t>>25;let r=(t&33554431)<<5;for(let i=0;i<id.length;i++)(e>>i&1)===1&&(r^=id[i]);return r}function nd(t,e,r=1){const i=t.length;let n=1;for(let s=0;s<i;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);n=Fn(n)^o>>5}n=Fn(n);for(let s=0;s<i;s++)n=Fn(n)^t.charCodeAt(s)&31;for(let s of e)n=Fn(n)^s;for(let s=0;s<6;s++)n=Fn(n);return n^=r,vc.encode(mc([n%no[30]],30,5,!1))}function sd(t){const e=t==="bech32"?1:734539939,r=_t(5),i=r.decode,n=r.encode,s=ed(i);function o(l,f,p=90){$r("bech32.encode prefix",l),Qs(f)&&(f=Array.from(f)),wc("bech32.encode",f);const d=l.length;if(d===0)throw new TypeError(`Invalid prefix length ${d}`);const g=d+7+f.length;if(p!==!1&&g>p)throw new TypeError(`Length ${g} exceeds limit ${p}`);const v=l.toLowerCase(),I=nd(v,f,e);return`${v}1${vc.encode(f)}${I}`}function a(l,f=90){$r("bech32.decode input",l);const p=l.length;if(p<8||f!==!1&&p>f)throw new TypeError(`invalid string length: ${p} (${l}). Expected (8..${f})`);const d=l.toLowerCase();if(l!==d&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");const g=d.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');const v=d.slice(0,g),I=d.slice(g+1);if(I.length<6)throw new Error("Data must be at least 6 characters long");const A=vc.decode(I).slice(0,-6),b=nd(v,A,e);if(!I.endsWith(b))throw new Error(`Invalid checksum in ${l}: expected "${b}"`);return{prefix:v,words:A}}const c=ed(a);function u(l){const{prefix:f,words:p}=a(l,!1);return{prefix:f,words:p,bytes:i(p)}}function h(l,f){return o(l,n(f))}return{encode:o,decode:a,encodeFromBytes:h,decodeToBytes:u,decodeUnsafe:c,fromWords:i,fromWordsUnsafe:s,toWords:n}}const R3=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",N3={encode(t){return yc(t),t.toHex()},decode(t){return $r("hex",t),Uint8Array.fromHex(t)}};function Ec(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function od(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ec(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ln(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=od(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return Ec(r)}function U3(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,v=0,I=0,A=d.length;I!==A&&d[I]===0;)I++,g++;for(var b=(A-I)*h+1>>>0,m=new Uint8Array(b);I!==A;){for(var x=d[I],$=0,D=b-1;(x!==0||$<v)&&D!==-1;D--,$++)x+=256*m[D]>>>0,m[D]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");v=$,I++}for(var B=b-v;B!==b&&m[B]===0;)B++;for(var P=c.repeat(g);B<b;++B)P+=t.charAt(m[B]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var v=0,I=0;d[g]===c;)v++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var m=r[d.charCodeAt(g)];if(m===255)return;for(var x=0,$=A-1;(m!==0||x<I)&&$!==-1;$--,x++)m+=a*b[$]>>>0,b[$]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");I=x,g++}if(d[g]!==" "){for(var D=A-I;D!==A&&b[D]===0;)D++;for(var B=new Uint8Array(v+(A-D)),P=v;D!==A;)B[P++]=b[D++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var F3=U3,L3=F3;const ad=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},k3=t=>new TextEncoder().encode(t),M3=t=>new TextDecoder().decode(t);class j3{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class q3{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cd(this,e)}}class z3{constructor(e){this.decoders=e}or(e){return cd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const cd=(t,e)=>new z3({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class H3{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new j3(e,r,i),this.decoder=new q3(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const so=({name:t,prefix:e,encode:r,decode:i})=>new H3(t,e,r,i),kn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=L3(r,e);return so({prefix:t,name:e,encode:i,decode:s=>ad(n(s))})},V3=(t,e,r,i)=>{const n={};for(let h=0;h<e.length;++h)n[e[h]]=h;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let h=0;h<s;++h){const l=n[t[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},K3=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Te=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>so({prefix:e,name:t,encode(n){return K3(n,i,r)},decode(n){return V3(n,i,r,t)}}),W3=so({prefix:"\0",name:"identity",encode:t=>M3(t),decode:t=>k3(t)});var G3=Object.freeze({__proto__:null,identity:W3});const Y3=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Z3=Object.freeze({__proto__:null,base2:Y3});const J3=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var X3=Object.freeze({__proto__:null,base8:J3});const Q3=kn({prefix:"9",name:"base10",alphabet:"0123456789"});var ex=Object.freeze({__proto__:null,base10:Q3});const tx=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rx=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ix=Object.freeze({__proto__:null,base16:tx,base16upper:rx});const nx=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sx=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ox=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ax=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cx=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ux=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hx=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lx=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fx=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dx=Object.freeze({__proto__:null,base32:nx,base32upper:sx,base32pad:ox,base32padupper:ax,base32hex:cx,base32hexupper:ux,base32hexpad:hx,base32hexpadupper:lx,base32z:fx});const px=kn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gx=kn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var yx=Object.freeze({__proto__:null,base36:px,base36upper:gx});const wx=kn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mx=kn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bx=Object.freeze({__proto__:null,base58btc:wx,base58flickr:mx});const vx=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ex=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xx=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),_x=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ix=Object.freeze({__proto__:null,base64:vx,base64pad:Ex,base64url:xx,base64urlpad:_x});const ud=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Sx=ud.reduce((t,e,r)=>(t[r]=e,t),[]),Ax=ud.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Dx(t){return t.reduce((e,r)=>(e+=Sx[r],e),"")}function $x(t){const e=[];for(const r of t){const i=Ax[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Ox=so({prefix:"\u{1F680}",name:"base256emoji",encode:Dx,decode:$x});var Px=Object.freeze({__proto__:null,base256emoji:Ox}),Bx=ld,hd=128,Cx=127,Tx=~Cx,Rx=Math.pow(2,31);function ld(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Rx;)e[r++]=t&255|hd,t/=128;for(;t&Tx;)e[r++]=t&255|hd,t>>>=7;return e[r]=t|0,ld.bytes=r-i+1,e}var Nx=xc,Ux=128,fd=127;function xc(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw xc.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&fd)<<n:(o&fd)*Math.pow(2,n),n+=7}while(o>=Ux);return xc.bytes=s-i,r}var Fx=Math.pow(2,7),Lx=Math.pow(2,14),kx=Math.pow(2,21),Mx=Math.pow(2,28),jx=Math.pow(2,35),qx=Math.pow(2,42),zx=Math.pow(2,49),Hx=Math.pow(2,56),Vx=Math.pow(2,63),Kx=function(t){return t<Fx?1:t<Lx?2:t<kx?3:t<Mx?4:t<jx?5:t<qx?6:t<zx?7:t<Hx?8:t<Vx?9:10},Wx={encode:Bx,decode:Nx,encodingLength:Kx},dd=Wx;const pd=(t,e,r=0)=>(dd.encode(t,e,r),e),gd=t=>dd.encodingLength(t),_c=(t,e)=>{const r=e.byteLength,i=gd(t),n=i+gd(r),s=new Uint8Array(n+r);return pd(t,s,0),pd(r,s,i),s.set(e,n),new Gx(t,r,e,s)};class Gx{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const yd=({name:t,code:e,encode:r})=>new Yx(t,e,r);class Yx{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?_c(this.code,r):r.then(i=>_c(this.code,i))}else throw Error("Unknown type, must be binary type")}}const wd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Zx=yd({name:"sha2-256",code:18,encode:wd("SHA-256")}),Jx=yd({name:"sha2-512",code:19,encode:wd("SHA-512")});var Xx=Object.freeze({__proto__:null,sha256:Zx,sha512:Jx});const md=0,Qx="identity",bd=ad;var e_=Object.freeze({__proto__:null,identity:{code:md,name:Qx,encode:bd,digest:t=>_c(md,bd(t))}});new TextEncoder,new TextDecoder;const vd={...G3,...Z3,...X3,...ex,...ix,...dx,...yx,...bx,...Ix,...Px};({...Xx,...e_});function Ed(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const xd=Ed("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ic=Ed("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=od(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),_d={utf8:xd,"utf-8":xd,hex:vd.base16,latin1:Ic,ascii:Ic,binary:Ic,...vd};function It(t,e="utf8"){const r=_d[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ec(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function st(t,e="utf8"){const r=_d[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const t_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},r_="Input must be an string, Buffer or Uint8Array";function i_(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(r_);return e}function n_(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function oo(t){return(4294967296+t).toString(16).substring(1)}function s_(t,e,r){let i=`
`+t+" = ";for(let n=0;n<e.length;n+=2){if(r===32)i+=oo(e[n]).toUpperCase(),i+=" ",i+=oo(e[n+1]).toUpperCase();else if(r===64)i+=oo(e[n+1]).toUpperCase(),i+=oo(e[n]).toUpperCase();else throw new Error("Invalid size "+r);n%6===4?i+=`
`+new Array(t.length+4).join(" "):n<e.length-2&&(i+=" ")}console.log(i)}function o_(t,e,r){let i=new Date().getTime();const n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=o%256;const s=new Date().getTime();console.log("Generated random input in "+(s-i)+"ms"),i=s;for(let o=0;o<r;o++){const a=t(n),c=new Date().getTime(),u=c-i;i=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var Id={normalizeInput:i_,toHex:n_,debugPrint:s_,testSpeed:o_};const ao=Id;function co(t,e,r){const i=t[e]+t[r];let n=t[e+1]+t[r+1];i>=4294967296&&n++,t[e]=i,t[e+1]=n}function Sd(t,e,r,i){let n=t[e]+r;r<0&&(n+=4294967296);let s=t[e+1]+i;n>=4294967296&&s++,t[e]=n,t[e+1]=s}function Ad(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Or(t,e,r,i,n,s){const o=Mn[n],a=Mn[n+1],c=Mn[s],u=Mn[s+1];co(Y,t,e),Sd(Y,t,o,a);let h=Y[i]^Y[t],l=Y[i+1]^Y[t+1];Y[i]=l,Y[i+1]=h,co(Y,r,i),h=Y[e]^Y[r],l=Y[e+1]^Y[r+1],Y[e]=h>>>24^l<<8,Y[e+1]=l>>>24^h<<8,co(Y,t,e),Sd(Y,t,c,u),h=Y[i]^Y[t],l=Y[i+1]^Y[t+1],Y[i]=h>>>16^l<<16,Y[i+1]=l>>>16^h<<16,co(Y,r,i),h=Y[e]^Y[r],l=Y[e+1]^Y[r+1],Y[e]=l>>>31^h<<1,Y[e+1]=h>>>31^l<<1}const Dd=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),a_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],qe=new Uint8Array(a_.map(function(t){return t*2})),Y=new Uint32Array(32),Mn=new Uint32Array(32);function $d(t,e){let r=0;for(r=0;r<16;r++)Y[r]=t.h[r],Y[r+16]=Dd[r];for(Y[24]=Y[24]^t.t,Y[25]=Y[25]^t.t/4294967296,e&&(Y[28]=~Y[28],Y[29]=~Y[29]),r=0;r<32;r++)Mn[r]=Ad(t.b,4*r);for(r=0;r<12;r++)Or(0,8,16,24,qe[r*16+0],qe[r*16+1]),Or(2,10,18,26,qe[r*16+2],qe[r*16+3]),Or(4,12,20,28,qe[r*16+4],qe[r*16+5]),Or(6,14,22,30,qe[r*16+6],qe[r*16+7]),Or(0,10,20,30,qe[r*16+8],qe[r*16+9]),Or(2,12,22,24,qe[r*16+10],qe[r*16+11]),Or(4,14,16,26,qe[r*16+12],qe[r*16+13]),Or(6,8,18,28,qe[r*16+14],qe[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^Y[r]^Y[r+16]}const Pr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Od(t,e,r,i){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(i&&i.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const n={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};Pr.fill(0),Pr[0]=t,e&&(Pr[1]=e.length),Pr[2]=1,Pr[3]=1,r&&Pr.set(r,32),i&&Pr.set(i,48);for(let s=0;s<16;s++)n.h[s]=Dd[s]^Ad(Pr,s*4);return e&&(Sc(n,e),n.c=128),n}function Sc(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,$d(t,!1),t.c=0),t.b[t.c++]=e[r]}function Pd(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;$d(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function Bd(t,e,r,i,n){r=r||64,t=ao.normalizeInput(t),i&&(i=ao.normalizeInput(i)),n&&(n=ao.normalizeInput(n));const s=Od(r,e,i,n);return Sc(s,t),Pd(s)}function c_(t,e,r,i,n){const s=Bd(t,e,r,i,n);return ao.toHex(s)}var u_={blake2b:Bd,blake2bHex:c_,blake2bInit:Od,blake2bUpdate:Sc,blake2bFinal:Pd};const Cd=Id;function h_(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Br(t,e,r,i,n,s){ee[t]=ee[t]+ee[e]+n,ee[i]=uo(ee[i]^ee[t],16),ee[r]=ee[r]+ee[i],ee[e]=uo(ee[e]^ee[r],12),ee[t]=ee[t]+ee[e]+s,ee[i]=uo(ee[i]^ee[t],8),ee[r]=ee[r]+ee[i],ee[e]=uo(ee[e]^ee[r],7)}function uo(t,e){return t>>>e^t<<32-e}const Td=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ze=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ee=new Uint32Array(16),Re=new Uint32Array(16);function Rd(t,e){let r=0;for(r=0;r<8;r++)ee[r]=t.h[r],ee[r+8]=Td[r];for(ee[12]^=t.t,ee[13]^=t.t/4294967296,e&&(ee[14]=~ee[14]),r=0;r<16;r++)Re[r]=h_(t.b,4*r);for(r=0;r<10;r++)Br(0,4,8,12,Re[ze[r*16+0]],Re[ze[r*16+1]]),Br(1,5,9,13,Re[ze[r*16+2]],Re[ze[r*16+3]]),Br(2,6,10,14,Re[ze[r*16+4]],Re[ze[r*16+5]]),Br(3,7,11,15,Re[ze[r*16+6]],Re[ze[r*16+7]]),Br(0,5,10,15,Re[ze[r*16+8]],Re[ze[r*16+9]]),Br(1,6,11,12,Re[ze[r*16+10]],Re[ze[r*16+11]]),Br(2,7,8,13,Re[ze[r*16+12]],Re[ze[r*16+13]]),Br(3,4,9,14,Re[ze[r*16+14]],Re[ze[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=ee[r]^ee[r+8]}function Nd(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");const i={h:new Uint32Array(Td),b:new Uint8Array(64),c:0,t:0,outlen:t};return i.h[0]^=16842752^r<<8^t,r>0&&(Ac(i,e),i.c=64),i}function Ac(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,Rd(t,!1),t.c=0),t.b[t.c++]=e[r]}function Ud(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;Rd(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function Fd(t,e,r){r=r||32,t=Cd.normalizeInput(t);const i=Nd(r,e);return Ac(i,t),Ud(i)}function l_(t,e,r){const i=Fd(t,e,r);return Cd.toHex(i)}var f_={blake2s:Fd,blake2sHex:l_,blake2sInit:Nd,blake2sUpdate:Ac,blake2sFinal:Ud};const jn=u_,qn=f_;var d_={blake2b:jn.blake2b,blake2bHex:jn.blake2bHex,blake2bInit:jn.blake2bInit,blake2bUpdate:jn.blake2bUpdate,blake2bFinal:jn.blake2bFinal,blake2s:qn.blake2s,blake2sHex:qn.blake2sHex,blake2sInit:qn.blake2sInit,blake2sUpdate:qn.blake2sUpdate,blake2sFinal:qn.blake2sFinal},p_=Object.defineProperty,g_=Object.defineProperties,y_=Object.getOwnPropertyDescriptors,Ld=Object.getOwnPropertySymbols,w_=Object.prototype.hasOwnProperty,m_=Object.prototype.propertyIsEnumerable,kd=(t,e,r)=>e in t?p_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ur=(t,e)=>{for(var r in e||(e={}))w_.call(e,r)&&kd(t,r,e[r]);if(Ld)for(var r of Ld(e))m_.call(e,r)&&kd(t,r,e[r]);return t},Dc=(t,e)=>g_(t,y_(e));const b_=":";function ki(t){const[e,r]=t.split(b_);return{namespace:e,reference:r}}function Md(t,e){return t.includes(":")?[t]:e.chains||[]}var v_=Object.defineProperty,E_=Object.defineProperties,x_=Object.getOwnPropertyDescriptors,jd=Object.getOwnPropertySymbols,__=Object.prototype.hasOwnProperty,I_=Object.prototype.propertyIsEnumerable,qd=(t,e,r)=>e in t?v_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zd=(t,e)=>{for(var r in e||(e={}))__.call(e,r)&&qd(t,r,e[r]);if(jd)for(var r of jd(e))I_.call(e,r)&&qd(t,r,e[r]);return t},S_=(t,e)=>E_(t,x_(e));const A_="ReactNative",wt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},D_="js";function ho(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Cr(){return!oi()&&!!Da()&&navigator.product===A_}function $_(){return Cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function O_(){return Cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Mi(){return!ho()&&!!Da()&&!!oi()}function zn(){return Cr()?wt.reactNative:ho()?wt.node:Mi()?wt.browser:wt.unknown}function Hd(){var t;try{return Cr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function P_(t,e){const r=new URLSearchParams(t);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const n=e[i];n!==void 0&&r.set(i,n)}return r.toString()}function B_(t){var e,r;const i=Vd();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),S_(zd(zd({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(n){return console.warn("Error populating app metadata",n),t||i}}function Vd(){return Rl()||{name:"",description:"",url:"",icons:[""]}}function C_(){if(zn()===wt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Dv();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function T_(){var t;const e=zn();return e===wt.browser?[e,((t=Tl())==null?void 0:t.host)||"unknown"].join(":"):e}function Kd(t,e,r){const i=C_(),n=T_();return[[t,e].join("-"),[D_,r].join("-"),i,n].join("/")}function R_({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),h=Kd(t,e,i),l={auth:n,ua:h,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=P_(u[1]||"",l);return u[0]+"?"+f}function fi(t,e){return t.filter(r=>e.includes(r)).length===t.length}function $c(t){return Object.fromEntries(t.entries())}function Oc(t){return new Map(Object.entries(t))}function di(t=L.FIVE_MINUTES,e){const r=L.toMiliseconds(t||L.FIVE_MINUTES);let i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),i=a,n=c})}}function Tr(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function Wd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function N_(t){return Wd("topic",t)}function U_(t){return Wd("id",t)}function Gd(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function ve(t,e){return L.fromMiliseconds((e||Date.now())+L.toMiliseconds(t))}function Rr(t){return Date.now()>=L.toMiliseconds(t)}function ne(t,e){return`${t}${e?`:${e}`:""}`}function Wt(t=[],e=[]){return[...new Set([...t,...e])]}async function F_({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,s=n?.href;if(typeof s!="string")return;const o=L_(s,t,e),a=zn();if(a===wt.browser){if(!((i=oi())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}k_(o)}else a===wt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function L_(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${z_(i,!0)}`}else n=`${n}/wc?${i}`;return n}function k_(t){let e="_self";q_()?e="_top":(j_()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function M_(t,e){let r="";try{if(Mi()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Yd(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Zd(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Pc(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function j_(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function q_(){try{return window.self!==window.top}catch{return!1}}function z_(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Jd(t){return Buffer.from(t,"base64").toString("utf-8")}function H_(t){return new Promise(e=>setTimeout(e,t))}const lo=BigInt(2**32-1),Xd=BigInt(32);function Qd(t,e=!1){return e?{h:Number(t&lo),l:Number(t>>Xd&lo)}:{h:Number(t>>Xd&lo)|0,l:Number(t&lo)|0}}function ep(t,e=!1){const r=t.length;let i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Qd(t[s],e);[i[s],n[s]]=[o,a]}return[i,n]}const tp=(t,e,r)=>t>>>r,rp=(t,e,r)=>t<<32-r|e>>>r,Nr=(t,e,r)=>t>>>r|e<<32-r,Ur=(t,e,r)=>t<<32-r|e>>>r,Hn=(t,e,r)=>t<<64-r|e>>>r-32,Vn=(t,e,r)=>t>>>r-32|e<<64-r,V_=(t,e)=>e,K_=(t,e)=>t,W_=(t,e,r)=>t<<r|e>>>32-r,G_=(t,e,r)=>e<<r|t>>>32-r,Y_=(t,e,r)=>e<<r-32|t>>>64-r,Z_=(t,e,r)=>t<<r-32|e>>>64-r;function Rt(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Bc=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Cc=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,J_=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),X_=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,Q_=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),e8=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,ji=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function t8(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Fr(t,...e){if(!t8(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tc(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");hr(t.outputLen),hr(t.blockLen)}function Lr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Rc(t,e){Fr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Kn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function St(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Nc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Gt(t,e){return t<<32-e|t>>>e}const ip=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function np(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const lr=ip?t=>t:t=>np(t);function r8(t){for(let e=0;e<t.length;e++)t[e]=np(t[e]);return t}const kr=ip?t=>t:r8;function i8(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Nt(t){return typeof t=="string"&&(t=i8(t)),Fr(t),t}function n8(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Fr(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}class fo{}function Wn(t){const e=i=>t().update(Nt(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function s8(t){const e=(i,n)=>t(n).update(Nt(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function qi(t=32){if(ji&&typeof ji.getRandomValues=="function")return ji.getRandomValues(new Uint8Array(t));if(ji&&typeof ji.randomBytes=="function")return Uint8Array.from(ji.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const o8=BigInt(0),Gn=BigInt(1),a8=BigInt(2),c8=BigInt(7),u8=BigInt(256),h8=BigInt(113),sp=[],op=[],ap=[];for(let t=0,e=Gn,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],sp.push(2*(5*i+r)),op.push((t+1)*(t+2)/2%64);let n=o8;for(let s=0;s<7;s++)e=(e<<Gn^(e>>c8)*h8)%u8,e&a8&&(n^=Gn<<(Gn<<BigInt(s))-Gn);ap.push(n)}const cp=ep(ap,!0),l8=cp[0],f8=cp[1],up=(t,e,r)=>r>32?Y_(t,e,r):W_(t,e,r),hp=(t,e,r)=>r>32?Z_(t,e,r):G_(t,e,r);function d8(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],h=r[c+1],l=up(u,h,1)^r[a],f=hp(u,h,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=l,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=op[o],c=up(n,s,a),u=hp(n,s,a),h=sp[o];n=t[h],s=t[h+1],t[h]=c,t[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=l8[i],t[1]^=f8[i]}St(r)}class Uc extends fo{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,hr(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Kn(this.state)}clone(){return this._cloneInto()}keccak(){kr(this.state32),d8(this.state32,this.rounds),kr(this.state32),this.posOut=0,this.pos=0}update(e){Lr(this),e=Nt(e),Fr(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Lr(this,!1),Fr(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return hr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Rc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,St(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Uc(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const p8=(t,e,r)=>Wn(()=>new Uc(e,t,r)),g8=p8(1,136,256/8);function y8(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function w8(t,e,r){return t&e^~t&r}function m8(t,e,r){return t&e^t&r^e&r}class lp extends fo{constructor(e,r,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Nc(this.buffer)}update(e){Lr(this),e=Nt(e),Fr(e);const{view:r,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Nc(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Lr(this),Rc(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,St(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let l=o;l<n;l++)r[l]=0;y8(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=Nc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const Mr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),He=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ve=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),b8=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jr=new Uint32Array(64);class v8 extends lp{constructor(e=32){super(64,e,8,!1),this.A=Mr[0]|0,this.B=Mr[1]|0,this.C=Mr[2]|0,this.D=Mr[3]|0,this.E=Mr[4]|0,this.F=Mr[5]|0,this.G=Mr[6]|0,this.H=Mr[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)jr[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const f=jr[l-15],p=jr[l-2],d=Gt(f,7)^Gt(f,18)^f>>>3,g=Gt(p,17)^Gt(p,19)^p>>>10;jr[l]=g+jr[l-7]+d+jr[l-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:h}=this;for(let l=0;l<64;l++){const f=Gt(a,6)^Gt(a,11)^Gt(a,25),p=h+f+w8(a,c,u)+b8[l]+jr[l]|0,d=(Gt(i,2)^Gt(i,13)^Gt(i,22))+m8(i,n,s)|0;h=u,u=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+d|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(i,n,s,o,a,c,u,h)}roundClean(){St(jr)}destroy(){this.set(0,0,0,0,0,0,0,0),St(this.buffer)}}const fp=ep(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),E8=fp[0],x8=fp[1],qr=new Uint32Array(80),zr=new Uint32Array(80);class Fc extends lp{constructor(e=64){super(128,e,16,!1),this.Ah=Ve[0]|0,this.Al=Ve[1]|0,this.Bh=Ve[2]|0,this.Bl=Ve[3]|0,this.Ch=Ve[4]|0,this.Cl=Ve[5]|0,this.Dh=Ve[6]|0,this.Dl=Ve[7]|0,this.Eh=Ve[8]|0,this.El=Ve[9]|0,this.Fh=Ve[10]|0,this.Fl=Ve[11]|0,this.Gh=Ve[12]|0,this.Gl=Ve[13]|0,this.Hh=Ve[14]|0,this.Hl=Ve[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:h,Fh:l,Fl:f,Gh:p,Gl:d,Hh:g,Hl:v}=this;return[e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v]}set(e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=v|0}process(e,r){for(let b=0;b<16;b++,r+=4)qr[b]=e.getUint32(r),zr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const m=qr[b-15]|0,x=zr[b-15]|0,$=Nr(m,x,1)^Nr(m,x,8)^tp(m,x,7),D=Ur(m,x,1)^Ur(m,x,8)^rp(m,x,7),B=qr[b-2]|0,P=zr[b-2]|0,U=Nr(B,P,19)^Hn(B,P,61)^tp(B,P,6),C=Ur(B,P,19)^Vn(B,P,61)^rp(B,P,6),R=J_(D,C,zr[b-7],zr[b-16]),T=X_(R,$,U,qr[b-7],qr[b-16]);qr[b]=T|0,zr[b]=R|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:h,Eh:l,El:f,Fh:p,Fl:d,Gh:g,Gl:v,Hh:I,Hl:A}=this;for(let b=0;b<80;b++){const m=Nr(l,f,14)^Nr(l,f,18)^Hn(l,f,41),x=Ur(l,f,14)^Ur(l,f,18)^Vn(l,f,41),$=l&p^~l&g,D=f&d^~f&v,B=Q_(A,x,D,x8[b],zr[b]),P=e8(B,I,m,$,E8[b],qr[b]),U=B|0,C=Nr(i,n,28)^Hn(i,n,34)^Hn(i,n,39),R=Ur(i,n,28)^Vn(i,n,34)^Vn(i,n,39),T=i&s^i&a^s&a,j=n&o^n&c^o&c;I=g|0,A=v|0,g=p|0,v=d|0,p=l|0,d=f|0,{h:l,l:f}=Rt(u|0,h|0,P|0,U|0),u=a|0,h=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const y=Bc(U,R,j);i=Cc(y,P,C,T),n=y|0}({h:i,l:n}=Rt(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Rt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Rt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:h}=Rt(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:f}=Rt(this.Eh|0,this.El|0,l|0,f|0),{h:p,l:d}=Rt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:v}=Rt(this.Gh|0,this.Gl|0,g|0,v|0),{h:I,l:A}=Rt(this.Hh|0,this.Hl|0,I|0,A|0),this.set(i,n,s,o,a,c,u,h,l,f,p,d,g,v,I,A)}roundClean(){St(qr,zr)}destroy(){St(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class _8 extends Fc{constructor(){super(48),this.Ah=He[0]|0,this.Al=He[1]|0,this.Bh=He[2]|0,this.Bl=He[3]|0,this.Ch=He[4]|0,this.Cl=He[5]|0,this.Dh=He[6]|0,this.Dl=He[7]|0,this.Eh=He[8]|0,this.El=He[9]|0,this.Fh=He[10]|0,this.Fl=He[11]|0,this.Gh=He[12]|0,this.Gl=He[13]|0,this.Hh=He[14]|0,this.Hl=He[15]|0}}const Ke=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class I8 extends Fc{constructor(){super(32),this.Ah=Ke[0]|0,this.Al=Ke[1]|0,this.Bh=Ke[2]|0,this.Bl=Ke[3]|0,this.Ch=Ke[4]|0,this.Cl=Ke[5]|0,this.Dh=Ke[6]|0,this.Dl=Ke[7]|0,this.Eh=Ke[8]|0,this.El=Ke[9]|0,this.Fh=Ke[10]|0,this.Fl=Ke[11]|0,this.Gh=Ke[12]|0,this.Gl=Ke[13]|0,this.Hh=Ke[14]|0,this.Hl=Ke[15]|0}}const po=Wn(()=>new v8),S8=Wn(()=>new Fc),A8=Wn(()=>new _8),D8=Wn(()=>new I8),$8=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ee=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Hr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=z[2*t],u=z[2*t+1],h=z[2*e],l=z[2*e+1],f=z[2*r],p=z[2*r+1],d=z[2*i],g=z[2*i+1],v=Bc(c,h,o);u=Cc(v,u,l,a),c=v|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:V_(g,d),Dl:K_(g)},{h:p,l:f}=Rt(p,f,g,d),{Bh:l,Bl:h}={Bh:l^p,Bl:h^f},{Bh:l,Bl:h}={Bh:Nr(l,h,24),Bl:Ur(l,h,24)},z[2*t]=c,z[2*t+1]=u,z[2*e]=h,z[2*e+1]=l,z[2*r]=f,z[2*r+1]=p,z[2*i]=d,z[2*i+1]=g}function Vr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=z[2*t],u=z[2*t+1],h=z[2*e],l=z[2*e+1],f=z[2*r],p=z[2*r+1],d=z[2*i],g=z[2*i+1],v=Bc(c,h,o);u=Cc(v,u,l,a),c=v|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:Nr(g,d,16),Dl:Ur(g,d,16)},{h:p,l:f}=Rt(p,f,g,d),{Bh:l,Bl:h}={Bh:l^p,Bl:h^f},{Bh:l,Bl:h}={Bh:Hn(l,h,63),Bl:Vn(l,h,63)},z[2*t]=c,z[2*t+1]=u,z[2*e]=h,z[2*e+1]=l,z[2*r]=f,z[2*r+1]=p,z[2*i]=d,z[2*i+1]=g}function O8(t,e={},r,i,n){if(hr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}class P8 extends fo{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,hr(e),hr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Kn(this.buffer)}update(e){Lr(this),e=Nt(e),Fr(e);const{blockLen:r,buffer:i,buffer32:n}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(kr(n),this.compress(n,0,!1),kr(n),this.pos=0);const u=Math.min(r-this.pos,s-c),h=o+c;if(u===r&&!(h%4)&&c+u<s){const l=new Uint32Array(a,h,Math.floor((s-c)/4));kr(l);for(let f=0;c+r<s;f+=n.length,c+=r)this.length+=r,this.compress(l,f,!1);kr(l);continue}i.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Lr(this),Rc(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,St(this.buffer.subarray(r)),kr(i),this.compress(i,0,!0),kr(i);const n=Kn(e);this.get().forEach((s,o)=>n[o]=lr(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:n,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=n,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class B8 extends P8{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=Ee[0]|0,this.v0h=Ee[1]|0,this.v1l=Ee[2]|0,this.v1h=Ee[3]|0,this.v2l=Ee[4]|0,this.v2h=Ee[5]|0,this.v3l=Ee[6]|0,this.v3h=Ee[7]|0,this.v4l=Ee[8]|0,this.v4h=Ee[9]|0,this.v5l=Ee[10]|0,this.v5h=Ee[11]|0,this.v6l=Ee[12]|0,this.v6h=Ee[13]|0,this.v7l=Ee[14]|0,this.v7h=Ee[15]|0,O8(r,e,64,16,16);let{key:i,personalization:n,salt:s}=e,o=0;if(i!==void 0&&(i=Nt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Nt(s);const a=Kn(s);this.v4l^=lr(a[0]),this.v4h^=lr(a[1]),this.v5l^=lr(a[2]),this.v5h^=lr(a[3])}if(n!==void 0){n=Nt(n);const a=Kn(n);this.v6l^=lr(a[0]),this.v6h^=lr(a[1]),this.v7l^=lr(a[2]),this.v7h^=lr(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:n,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:h,v5l:l,v5h:f,v6l:p,v6h:d,v7l:g,v7h:v}=this;return[e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v]}set(e,r,i,n,s,o,a,c,u,h,l,f,p,d,g,v){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=n|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=h|0,this.v5l=l|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=v|0}compress(e,r,i){this.get().forEach((c,u)=>z[u]=c),z.set(Ee,16);let{h:n,l:s}=Qd(BigInt(this.length));z[24]=Ee[8]^s,z[25]=Ee[9]^n,i&&(z[28]=~z[28],z[29]=~z[29]);let o=0;const a=$8;for(let c=0;c<12;c++)Hr(0,4,8,12,e,r+2*a[o++]),Vr(0,4,8,12,e,r+2*a[o++]),Hr(1,5,9,13,e,r+2*a[o++]),Vr(1,5,9,13,e,r+2*a[o++]),Hr(2,6,10,14,e,r+2*a[o++]),Vr(2,6,10,14,e,r+2*a[o++]),Hr(3,7,11,15,e,r+2*a[o++]),Vr(3,7,11,15,e,r+2*a[o++]),Hr(0,5,10,15,e,r+2*a[o++]),Vr(0,5,10,15,e,r+2*a[o++]),Hr(1,6,11,12,e,r+2*a[o++]),Vr(1,6,11,12,e,r+2*a[o++]),Hr(2,7,8,13,e,r+2*a[o++]),Vr(2,7,8,13,e,r+2*a[o++]),Hr(3,4,9,14,e,r+2*a[o++]),Vr(3,4,9,14,e,r+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],St(z)}destroy(){this.destroyed=!0,St(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const C8=s8(t=>new B8(t)),T8="https://rpc.walletconnect.org/v1";function dp(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(g8(r)).toString("hex")}async function R8(t,e,r,i,n,s){switch(r.t){case"eip191":return await N8(t,e,r.s);case"eip1271":return await U8(t,e,r.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function N8(t,e,r){return(await $2({hash:dp(e),signature:r})).toLowerCase()===t.toLowerCase()}async function U8(t,e,r,i,n,s){const o=ki(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",h=r.substring(2),l=dp(e).substring(2),f=a+l+c+u+h,p=await fetch(`${s||T8}/?chainId=${i}&projectId=${n}`,{method:"POST",body:JSON.stringify({id:F8(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function F8(){return Date.now()+Math.floor(Math.random()*1e3)}function L8(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const n=1+i*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return Cn.encode(s)}function k8(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const n=C8(i,{dkLen:32});return Cn.encode(n)}function pp(t){const e=new Uint8Array(po(M8(t)));return Cn.encode(e)}function M8(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function gp(t){const e=Buffer.from(t,"base64"),r=B3(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=_3(r),n=Buffer.from("TX"),s=Buffer.concat([n,Buffer.from(i)]),o=D8(s);return T3.encode(o).replace(/=+$/,"")}function Lc(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function j8(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(Lc(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(Lc(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(Lc(i.length)),n.push(i);const s=Buffer.concat(n),o=po(s);return Buffer.from(o).toString("hex").toUpperCase()}var q8=Object.defineProperty,z8=Object.defineProperties,H8=Object.getOwnPropertyDescriptors,yp=Object.getOwnPropertySymbols,V8=Object.prototype.hasOwnProperty,K8=Object.prototype.propertyIsEnumerable,wp=(t,e,r)=>e in t?q8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W8=(t,e)=>{for(var r in e||(e={}))V8.call(e,r)&&wp(t,r,e[r]);if(yp)for(var r of yp(e))K8.call(e,r)&&wp(t,r,e[r]);return t},G8=(t,e)=>z8(t,H8(e));const Y8="did:pkh:",kc=t=>t?.split(":"),Z8=t=>{const e=t&&kc(t);if(e)return t.includes(Y8)?e[3]:e[1]},Mc=t=>{const e=t&&kc(t);if(e)return e[2]+":"+e[3]},go=t=>{const e=t&&kc(t);if(e)return e.pop()};async function mp(t){const{cacao:e,projectId:r}=t,{s:i,p:n}=e,s=bp(n,n.iss),o=go(n.iss);return await R8(o,s,i,Mc(n.iss),r)}const bp=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=go(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Z8(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,l=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=yo(t.resources);if(d){const g=Yn(d);n=sI(n,g)}return[r,i,"",n,"",s,o,a,c,u,h,l,f,p].filter(g=>g!=null).join(`
`)};function J8(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function X8(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function pi(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(n=>{const s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function Q8(t,e,r,i={}){return r?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:eI(e,r,i)}}}function eI(t,e,r={}){e=e?.sort((n,s)=>n.localeCompare(s));const i=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...i)}function vp(t){return pi(t),`urn:recap:${J8(t).replace(/=/g,"")}`}function Yn(t){const e=X8(t.replace("urn:recap:",""));return pi(e),e}function tI(t,e,r){const i=Q8(t,e,r);return vp(i)}function rI(t){return t&&t.includes("urn:recap:")}function iI(t,e){const r=Yn(t),i=Yn(e),n=nI(r,i);return vp(n)}function nI(t,e){pi(t),pi(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return r.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[n]=G8(W8({},i.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),i}function sI(t="",e){pi(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,f)=>l.action.localeCompare(f.action));const u={};c.forEach(l=>{u[l.ability]||(u[l.ability]=[]),u[l.ability].push(l.action)});const h=Object.keys(u).map(l=>(n++,`(${n}) '${l}': '${u[l].join("', '")}' for '${a}'.`));i.push(h.join(", ").replace(".,","."))});const s=i.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function Ep(t){var e;const r=Yn(t);pi(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function xp(t){const e=Yn(t);pi(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function yo(t){if(!t)return;const e=t?.[t.length-1];return rI(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function _p(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function jc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function qc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ot(t,...e){if(!_p(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ip(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function oI(t,e){ot(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Kr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function zi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function aI(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const cI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function uI(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function zc(t){if(typeof t=="string")t=uI(t);else if(_p(t))t=Hc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function hI(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function lI(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const fI=(t,e)=>{function r(i,...n){if(ot(i),!cI)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=n[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?ot(u):ot(u,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&ot(n[1]);const o=e(i,...n),a=(u,h)=>{if(h!==void 0){if(u!==2)throw new Error("cipher output not supported");ot(h)}};let c=!1;return{encrypt(u,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ot(u),a(o.encrypt.length,h),o.encrypt(u,h)},decrypt(u,h){if(ot(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,h),o.decrypt(u,h)}}}return Object.assign(r,t),r};function Sp(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!pI(e))throw new Error("invalid output, must be aligned");return e}function Ap(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function dI(t,e,r){jc(r);const i=new Uint8Array(16),n=aI(i);return Ap(n,0,BigInt(e),r),Ap(n,8,BigInt(t),r),i}function pI(t){return t.byteOffset%4===0}function Hc(t){return Uint8Array.from(t)}const Dp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),gI=Dp("expand 16-byte k"),yI=Dp("expand 32-byte k"),wI=Kr(gI),mI=Kr(yI);function te(t,e){return t<<e|t>>>32-e}function Vc(t){return t.byteOffset%4===0}const wo=64,bI=16,$p=2**32-1,Op=new Uint32Array;function vI(t,e,r,i,n,s,o,a){const c=n.length,u=new Uint8Array(wo),h=Kr(u),l=Vc(n)&&Vc(s),f=l?Kr(n):Op,p=l?Kr(s):Op;for(let d=0;d<c;o++){if(t(e,r,i,h,o,a),o>=$p)throw new Error("arx: counter overflow");const g=Math.min(wo,c-d);if(l&&g===wo){const v=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let I=0,A;I<bI;I++)A=v+I,p[A]=f[A]^h[I];d+=wo;continue}for(let v=0,I;v<g;v++)I=d+v,s[I]=n[I]^u[v];d+=g}}function EI(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=hI({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return qc(n),qc(o),jc(s),jc(r),(a,c,u,h,l=0)=>{ot(a),ot(c),ot(u);const f=u.length;if(h===void 0&&(h=new Uint8Array(f)),ot(h),qc(l),l<0||l>=$p)throw new Error("arx: counter overflow");if(h.length<f)throw new Error(`arx: output (${h.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,v;if(d===32)p.push(g=Hc(a)),v=mI;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),v=wI,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Vc(c)||p.push(c=Hc(c));const I=Kr(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(v,I,Kr(c.subarray(0,16)),I),c=c.subarray(16)}const A=16-n;if(A!==c.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){const m=new Uint8Array(12);m.set(c,s?0:12-c.length),c=m,p.push(c)}const b=Kr(c);return vI(t,v,I,b,u,h,l,o),zi(...p),h}}const Ne=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class xI{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=zc(e),ot(e,32);const r=Ne(e,0),i=Ne(e,2),n=Ne(e,4),s=Ne(e,6),o=Ne(e,8),a=Ne(e,10),c=Ne(e,12),u=Ne(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let h=0;h<8;h++)this.pad[h]=Ne(e,16+2*h)}process(e,r,i=!1){const n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],h=o[3],l=o[4],f=o[5],p=o[6],d=o[7],g=o[8],v=o[9],I=Ne(e,r+0),A=Ne(e,r+2),b=Ne(e,r+4),m=Ne(e,r+6),x=Ne(e,r+8),$=Ne(e,r+10),D=Ne(e,r+12),B=Ne(e,r+14);let P=s[0]+(I&8191),U=s[1]+((I>>>13|A<<3)&8191),C=s[2]+((A>>>10|b<<6)&8191),R=s[3]+((b>>>7|m<<9)&8191),T=s[4]+((m>>>4|x<<12)&8191),j=s[5]+(x>>>1&8191),y=s[6]+((x>>>14|$<<2)&8191),w=s[7]+(($>>>11|D<<5)&8191),E=s[8]+((D>>>8|B<<8)&8191),O=s[9]+(B>>>5|n),_=0,S=_+P*a+U*(5*v)+C*(5*g)+R*(5*d)+T*(5*p);_=S>>>13,S&=8191,S+=j*(5*f)+y*(5*l)+w*(5*h)+E*(5*u)+O*(5*c),_+=S>>>13,S&=8191;let N=_+P*c+U*a+C*(5*v)+R*(5*g)+T*(5*d);_=N>>>13,N&=8191,N+=j*(5*p)+y*(5*f)+w*(5*l)+E*(5*h)+O*(5*u),_+=N>>>13,N&=8191;let k=_+P*u+U*c+C*a+R*(5*v)+T*(5*g);_=k>>>13,k&=8191,k+=j*(5*d)+y*(5*p)+w*(5*f)+E*(5*l)+O*(5*h),_+=k>>>13,k&=8191;let H=_+P*h+U*u+C*c+R*a+T*(5*v);_=H>>>13,H&=8191,H+=j*(5*g)+y*(5*d)+w*(5*p)+E*(5*f)+O*(5*l),_+=H>>>13,H&=8191;let q=_+P*l+U*h+C*u+R*c+T*a;_=q>>>13,q&=8191,q+=j*(5*v)+y*(5*g)+w*(5*d)+E*(5*p)+O*(5*f),_+=q>>>13,q&=8191;let V=_+P*f+U*l+C*h+R*u+T*c;_=V>>>13,V&=8191,V+=j*a+y*(5*v)+w*(5*g)+E*(5*d)+O*(5*p),_+=V>>>13,V&=8191;let K=_+P*p+U*f+C*l+R*h+T*u;_=K>>>13,K&=8191,K+=j*c+y*a+w*(5*v)+E*(5*g)+O*(5*d),_+=K>>>13,K&=8191;let G=_+P*d+U*p+C*f+R*l+T*h;_=G>>>13,G&=8191,G+=j*u+y*c+w*a+E*(5*v)+O*(5*g),_+=G>>>13,G&=8191;let Q=_+P*g+U*d+C*p+R*f+T*l;_=Q>>>13,Q&=8191,Q+=j*h+y*u+w*c+E*a+O*(5*v),_+=Q>>>13,Q&=8191;let W=_+P*v+U*g+C*d+R*p+T*f;_=W>>>13,W&=8191,W+=j*l+y*h+w*u+E*c+O*a,_+=W>>>13,W&=8191,_=(_<<2)+_|0,_=_+S|0,S=_&8191,_=_>>>13,N+=_,s[0]=S,s[1]=N,s[2]=k,s[3]=H,s[4]=q,s[5]=V,s[6]=K,s[7]=G,s[8]=Q,s[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;zi(i)}update(e){Ip(this),e=zc(e),ot(e);const{buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){zi(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ip(this),oI(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function _I(t){const e=(i,n)=>t(n).update(zc(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const II=_I(t=>new xI(t));function SI(t,e,r,i,n,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],h=e[0],l=e[1],f=e[2],p=e[3],d=e[4],g=e[5],v=e[6],I=e[7],A=n,b=r[0],m=r[1],x=r[2],$=o,D=a,B=c,P=u,U=h,C=l,R=f,T=p,j=d,y=g,w=v,E=I,O=A,_=b,S=m,N=x;for(let H=0;H<s;H+=2)$=$+U|0,O=te(O^$,16),j=j+O|0,U=te(U^j,12),$=$+U|0,O=te(O^$,8),j=j+O|0,U=te(U^j,7),D=D+C|0,_=te(_^D,16),y=y+_|0,C=te(C^y,12),D=D+C|0,_=te(_^D,8),y=y+_|0,C=te(C^y,7),B=B+R|0,S=te(S^B,16),w=w+S|0,R=te(R^w,12),B=B+R|0,S=te(S^B,8),w=w+S|0,R=te(R^w,7),P=P+T|0,N=te(N^P,16),E=E+N|0,T=te(T^E,12),P=P+T|0,N=te(N^P,8),E=E+N|0,T=te(T^E,7),$=$+C|0,N=te(N^$,16),w=w+N|0,C=te(C^w,12),$=$+C|0,N=te(N^$,8),w=w+N|0,C=te(C^w,7),D=D+R|0,O=te(O^D,16),E=E+O|0,R=te(R^E,12),D=D+R|0,O=te(O^D,8),E=E+O|0,R=te(R^E,7),B=B+T|0,_=te(_^B,16),j=j+_|0,T=te(T^j,12),B=B+T|0,_=te(_^B,8),j=j+_|0,T=te(T^j,7),P=P+U|0,S=te(S^P,16),y=y+S|0,U=te(U^y,12),P=P+U|0,S=te(S^P,8),y=y+S|0,U=te(U^y,7);let k=0;i[k++]=o+$|0,i[k++]=a+D|0,i[k++]=c+B|0,i[k++]=u+P|0,i[k++]=h+U|0,i[k++]=l+C|0,i[k++]=f+R|0,i[k++]=p+T|0,i[k++]=d+j|0,i[k++]=g+y|0,i[k++]=v+w|0,i[k++]=I+E|0,i[k++]=A+O|0,i[k++]=b+_|0,i[k++]=m+S|0,i[k++]=x+N|0}const AI=EI(SI,{counterRight:!1,counterLength:4,allowShortKeys:!1}),DI=new Uint8Array(16),Pp=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(DI.subarray(r))},$I=new Uint8Array(32);function Bp(t,e,r,i,n){const s=t(e,r,$I),o=II.create(s);n&&Pp(o,n),Pp(o,i);const a=dI(i.length,n?n.length:0,!0);o.update(a);const c=o.digest();return zi(s,a),c}const OI=t=>(e,r,i)=>({encrypt(n,s){const o=n.length;s=Sp(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Bp(t,e,r,a,i);return s.set(c,o),zi(c),s},decrypt(n,s){s=Sp(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=Bp(t,e,r,o,i);if(!lI(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,r,s,s,1),zi(c),s}}),Cp=fI({blockSize:64,nonceLength:12,tagLength:16},OI(AI));class Tp extends fo{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Tc(e);const i=Nt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),St(s)}update(e){return Lr(this),this.iHash.update(e),this}digestInto(e){Lr(this),Fr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const mo=(t,e,r)=>new Tp(t,e).update(r).digest();mo.create=(t,e)=>new Tp(t,e);function PI(t,e,r){return Tc(t),r===void 0&&(r=new Uint8Array(t.outputLen)),mo(t,Nt(r),Nt(e))}const Kc=Uint8Array.from([0]),Rp=Uint8Array.of();function BI(t,e,r,i=32){Tc(t),hr(i);const n=t.outputLen;if(i>255*n)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/n);r===void 0&&(r=Rp);const o=new Uint8Array(s*n),a=mo.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let h=0;h<s;h++)Kc[0]=h+1,c.update(h===0?Rp:u).update(r).update(Kc).digestInto(u),o.set(u,n*h),a._cloneInto(c);return a.destroy(),c.destroy(),St(u,Kc),o.slice(0,i)}const CI=(t,e,r,i,n)=>BI(t,PI(t,e,r),i,n),bo=po;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wc=BigInt(0),Gc=BigInt(1);function Zn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Yc(t){if(!Zn(t))throw new Error("Uint8Array expected")}function Jn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function vo(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Np(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Wc:BigInt("0x"+t)}const Up=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",TI=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xn(t){if(Yc(t),Up)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=TI[t[r]];return e}const fr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Fp(t){if(t>=fr._0&&t<=fr._9)return t-fr._0;if(t>=fr.A&&t<=fr.F)return t-(fr.A-10);if(t>=fr.a&&t<=fr.f)return t-(fr.a-10)}function Eo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Up)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=Fp(t.charCodeAt(s)),a=Fp(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function gi(t){return Np(Xn(t))}function xo(t){return Yc(t),Np(Xn(Uint8Array.from(t).reverse()))}function Qn(t,e){return Eo(t.toString(16).padStart(e*2,"0"))}function Zc(t,e){return Qn(t,e).reverse()}function at(t,e,r){let i;if(typeof e=="string")try{i=Eo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Zn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function _o(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Yc(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const Jc=t=>typeof t=="bigint"&&Wc<=t;function Xc(t,e,r){return Jc(t)&&Jc(e)&&Jc(r)&&e<=t&&t<r}function Wr(t,e,r,i){if(!Xc(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function RI(t){let e;for(e=0;t>Wc;t>>=Gc,e+=1);return e}const Io=t=>(Gc<<BigInt(t))-Gc,Qc=t=>new Uint8Array(t),Lp=t=>Uint8Array.from(t);function NI(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Qc(t),n=Qc(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...h)=>r(n,i,...h),c=(h=Qc(0))=>{n=a(Lp([0]),h),i=a(),h.length!==0&&(n=a(Lp([1]),h),i=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const l=[];for(;h<e;){i=a();const f=i.slice();l.push(f),h+=i.length}return _o(...l)};return(h,l)=>{o(),c(h);let f;for(;!(f=l(u()));)c();return o(),f}}const UI={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Zn(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function es(t,e,r={}){const i=(n,s,o)=>{const a=UI[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function kp(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const ct=BigInt(0),Je=BigInt(1),yi=BigInt(2),FI=BigInt(3),Mp=BigInt(4),jp=BigInt(5),qp=BigInt(8);function ut(t,e){const r=t%e;return r>=ct?r:e+r}function Ut(t,e,r){let i=t;for(;e-- >ct;)i*=i,i%=r;return i}function eu(t,e){if(t===ct)throw new Error("invert: expected non-zero number");if(e<=ct)throw new Error("invert: expected positive modulus, got "+e);let r=ut(t,e),i=e,n=ct,s=Je;for(;r!==ct;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==Je)throw new Error("invert: does not exist");return ut(n,e)}function zp(t,e){const r=(t.ORDER+Je)/Mp,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function LI(t,e){const r=(t.ORDER-jp)/qp,i=t.mul(e,yi),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,yi),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function kI(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Je,r=0;for(;e%yi===ct;)e/=yi,r++;let i=yi;const n=ts(t);for(;Vp(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return zp;let s=n.pow(i,e);const o=(e+Je)/yi;return function(a,c){if(a.is0(c))return c;if(Vp(a,c)!==1)throw new Error("Cannot find square root");let u=r,h=a.mul(a.ONE,s),l=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(l,a.ONE);){if(a.is0(l))return a.ZERO;let p=1,d=a.sqr(l);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===u)throw new Error("Cannot find square root");const g=Je<<BigInt(u-p-1),v=a.pow(h,g);u=p,h=a.sqr(v),l=a.mul(l,h),f=a.mul(f,v)}return f}}function MI(t){return t%Mp===FI?zp:t%qp===jp?LI:kI(t)}const jI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=jI.reduce((i,n)=>(i[n]="function",i),e);return es(t,r)}function zI(t,e,r){if(r<ct)throw new Error("invalid exponent, negatives unsupported");if(r===ct)return t.ONE;if(r===Je)return e;let i=t.ONE,n=e;for(;r>ct;)r&Je&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Je;return i}function Hp(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function Vp(t,e){const r=(t.ORDER-Je)/yi,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function Kp(t,e){e!==void 0&&hr(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ts(t,e,r=!1,i={}){if(t<=ct)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Kp(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:Io(n),ZERO:ct,ONE:Je,create:c=>ut(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ct<=c&&c<t},is0:c=>c===ct,isOdd:c=>(c&Je)===Je,neg:c=>ut(-c,t),eql:(c,u)=>c===u,sqr:c=>ut(c*c,t),add:(c,u)=>ut(c+u,t),sub:(c,u)=>ut(c-u,t),mul:(c,u)=>ut(c*u,t),pow:(c,u)=>zI(a,c,u),div:(c,u)=>ut(c*eu(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>eu(c,t),sqrt:i.sqrt||(c=>(o||(o=MI(t)),o(a,c))),toBytes:c=>r?Zc(c,s):Qn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?xo(c):gi(c)},invertBatch:c=>Hp(a,c),cmov:(c,u,h)=>h?u:c});return Object.freeze(a)}function Wp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Gp(t){const e=Wp(t);return e+Math.ceil(e/2)}function HI(t,e,r=!1){const i=t.length,n=Wp(e),s=Gp(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?xo(t):gi(t),a=ut(o,e-Je)+Je;return r?Zc(a,n):Qn(a,n)}const Yp=BigInt(0),tu=BigInt(1);function ru(t,e){const r=e.negate();return t?r:e}function Zp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function iu(t,e){Zp(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=Io(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function Jp(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=tu);const u=e*i,h=u+Math.abs(a)-1,l=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:h,isZero:l,isNeg:f,isNegF:p,offsetF:u}}function VI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function KI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const nu=new WeakMap,Xp=new WeakMap;function su(t){return Xp.get(t)||1}function WI(t,e){return{constTimeNegate:ru,hasPrecomputes(r){return su(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Yp;)i&tu&&(n=n.add(s)),s=s.double(),i>>=tu;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=iu(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let h=1;h<s;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){let s=t.ZERO,o=t.BASE;const a=iu(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:h,isZero:l,isNeg:f,isNegF:p,offsetF:d}=Jp(n,c,a);n=u,l?o=o.add(ru(p,i[d])):s=s.add(ru(f,i[h]))}return{p:s,f:o}},wNAFUnsafe(r,i,n,s=t.ZERO){const o=iu(r,e);for(let a=0;a<o.windows&&n!==Yp;a++){const{nextN:c,offset:u,isZero:h,isNeg:l}=Jp(n,a,o);if(n=c,!h){const f=i[u];s=s.add(l?f.negate():f)}}return s},getPrecomputes(r,i,n){let s=nu.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&nu.set(i,n(s))),s},wNAFCached(r,i,n){const s=su(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=su(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Zp(i,e),Xp.set(r,i),nu.delete(r)}}}function GI(t,e,r,i){VI(r,t),KI(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=RI(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Io(c),h=new Array(Number(u)+1).fill(o),l=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=l;p>=0;p-=c){h.fill(o);for(let g=0;g<s;g++){const v=i[g],I=Number(v>>BigInt(p)&u);h[I]=h[I].add(r[g])}let d=o;for(let g=h.length-1,v=o;g>0;g--)v=v.add(h[g]),d=d.add(v);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Qp(t){return qI(t.Fp),es(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(Dc(ur(ur({},Kp(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const rs=BigInt(0),Hi=BigInt(1),So=BigInt(2);function YI(t){return es(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(ur({},t))}function ZI(t){const e=YI(t),{P:r,type:i,adjustScalarBytes:n,powPminus2:s}=e,o=i==="x25519";if(!o&&i!=="x448")throw new Error("invalid type");const a=o?255:448,c=o?32:56,u=BigInt(o?9:5),h=BigInt(o?121665:39081),l=o?So**BigInt(254):So**BigInt(447),f=o?BigInt(8)*So**BigInt(251)-Hi:BigInt(4)*So**BigInt(445)-Hi,p=l+f+Hi,d=D=>ut(D,r),g=v(u);function v(D){return Zc(d(D),c)}function I(D){const B=at("u coordinate",D,c);return o&&(B[31]&=127),d(xo(B))}function A(D){return xo(n(at("scalar",D,c)))}function b(D,B){const P=$(I(B),A(D));if(P===rs)throw new Error("invalid private or public key received");return v(P)}function m(D){return b(D,g)}function x(D,B,P){const U=d(D*(B-P));return B=d(B-U),P=d(P+U),{x_2:B,x_3:P}}function $(D,B){Wr("u",D,rs,r),Wr("scalar",B,l,p);const P=B,U=D;let C=Hi,R=rs,T=D,j=Hi,y=rs;for(let E=BigInt(a-1);E>=rs;E--){const O=P>>E&Hi;y^=O,{x_2:C,x_3:T}=x(y,C,T),{x_2:R,x_3:j}=x(y,R,j),y=O;const _=C+R,S=d(_*_),N=C-R,k=d(N*N),H=S-k,q=T+j,V=T-j,K=d(V*_),G=d(q*N),Q=K+G,W=K-G;T=d(Q*Q),j=d(U*d(W*W)),C=d(S*k),R=d(H*(S+d(h*H)))}({x_2:C,x_3:T}=x(y,C,T)),{x_2:R,x_3:j}=x(y,R,j);const w=s(R);return d(C*w)}return{scalarMult:b,scalarMultBase:m,getSharedSecret:(D,B)=>b(D,B),getPublicKey:D=>m(D),utils:{randomPrivateKey:()=>e.randomBytes(c)},GuBytes:g.slice()}}const ou=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const JI=BigInt(1),eg=BigInt(2),XI=BigInt(3),QI=BigInt(5);BigInt(8);function eS(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=ou,o=t*t%s*t%s,a=Ut(o,eg,s)*o%s,c=Ut(a,JI,s)*t%s,u=Ut(c,QI,s)*c%s,h=Ut(u,e,s)*u%s,l=Ut(h,r,s)*h%s,f=Ut(l,i,s)*l%s,p=Ut(f,n,s)*f%s,d=Ut(p,n,s)*f%s,g=Ut(d,e,s)*u%s;return{pow_p_5_8:Ut(g,eg,s)*t%s,b2:o}}function tS(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const au=ZI({P:ou,type:"x25519",powPminus2:t=>{const e=ou,{pow_p_5_8:r,b2:i}=eS(t);return ut(Ut(r,XI,e)*i,e)},adjustScalarBytes:tS,randomBytes:qi});function tg(t){t.lowS!==void 0&&Jn("lowS",t.lowS),t.prehash!==void 0&&Jn("prehash",t.prehash)}function rS(t){const e=Qp(t);es(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze(ur({},e))}class iS extends Error{constructor(e=""){super(e)}}const dr={Err:iS,_tlv:{encode:(t,e)=>{const{Err:r}=dr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=vo(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?vo(n.length/2|128):"";return vo(t)+s+n+e},decode(t,e){const{Err:r}=dr;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const h of u)o=o<<8|h;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=dr;if(t<pr)throw new e("integer: negative integers are not allowed");let r=vo(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=dr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return gi(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=dr,n=at("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:u,l:h}=i.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=dr,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}};function cu(t,e){return Xn(Qn(t,e))}const pr=BigInt(0),De=BigInt(1);BigInt(2);const uu=BigInt(3),nS=BigInt(4);function sS(t){const e=rS(t),{Fp:r}=e,i=ts(e.n,e.nBitLength),n=e.toBytes||((b,m,x)=>{const $=m.toAffine();return _o(Uint8Array.from([4]),r.toBytes($.x),r.toBytes($.y))}),s=e.fromBytes||(b=>{const m=b.subarray(1),x=r.fromBytes(m.subarray(0,r.BYTES)),$=r.fromBytes(m.subarray(r.BYTES,2*r.BYTES));return{x,y:$}});function o(b){const{a:m,b:x}=e,$=r.sqr(b),D=r.mul($,b);return r.add(r.add(D,r.mul(b,m)),x)}function a(b,m){const x=r.sqr(m),$=o(b);return r.eql(x,$)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,uu),nS),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function h(b){return Xc(b,De,e.n)}function l(b){const{allowedPrivateKeyLengths:m,nByteLength:x,wrapPrivateKey:$,n:D}=e;if(m&&typeof b!="bigint"){if(Zn(b)&&(b=Xn(b)),typeof b!="string"||!m.includes(b.length))throw new Error("invalid private key");b=b.padStart(x*2,"0")}let B;try{B=typeof b=="bigint"?b:gi(at("private key",b,x))}catch{throw new Error("invalid private key, expected hex or "+x+" bytes, got "+typeof b)}return $&&(B=ut(B,D)),Wr("private key",B,De,D),B}function f(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const p=kp((b,m)=>{const{px:x,py:$,pz:D}=b;if(r.eql(D,r.ONE))return{x,y:$};const B=b.is0();m==null&&(m=B?r.ONE:r.inv(D));const P=r.mul(x,m),U=r.mul($,m),C=r.mul(D,m);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(C,r.ONE))throw new Error("invZ was invalid");return{x:P,y:U}}),d=kp(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:m,y:x}=b.toAffine();if(!r.isValid(m)||!r.isValid(x))throw new Error("bad point: x or y not FE");if(!a(m,x))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(m,x,$){if(m==null||!r.isValid(m))throw new Error("x required");if(x==null||!r.isValid(x)||r.is0(x))throw new Error("y required");if($==null||!r.isValid($))throw new Error("z required");this.px=m,this.py=x,this.pz=$,Object.freeze(this)}static fromAffine(m){const{x,y:$}=m||{};if(!m||!r.isValid(x)||!r.isValid($))throw new Error("invalid affine point");if(m instanceof g)throw new Error("projective point not allowed");const D=B=>r.eql(B,r.ZERO);return D(x)&&D($)?g.ZERO:new g(x,$,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const x=Hp(r,m.map($=>$.pz));return m.map(($,D)=>$.toAffine(x[D])).map(g.fromAffine)}static fromHex(m){const x=g.fromAffine(s(at("pointHex",m)));return x.assertValidity(),x}static fromPrivateKey(m){return g.BASE.multiply(l(m))}static msm(m,x){return GI(g,i,m,x)}_setWindowSize(m){A.setWindowSize(this,m)}assertValidity(){d(this)}hasEvenY(){const{y:m}=this.toAffine();if(r.isOdd)return!r.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){f(m);const{px:x,py:$,pz:D}=this,{px:B,py:P,pz:U}=m,C=r.eql(r.mul(x,U),r.mul(B,D)),R=r.eql(r.mul($,U),r.mul(P,D));return C&&R}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:m,b:x}=e,$=r.mul(x,uu),{px:D,py:B,pz:P}=this;let U=r.ZERO,C=r.ZERO,R=r.ZERO,T=r.mul(D,D),j=r.mul(B,B),y=r.mul(P,P),w=r.mul(D,B);return w=r.add(w,w),R=r.mul(D,P),R=r.add(R,R),U=r.mul(m,R),C=r.mul($,y),C=r.add(U,C),U=r.sub(j,C),C=r.add(j,C),C=r.mul(U,C),U=r.mul(w,U),R=r.mul($,R),y=r.mul(m,y),w=r.sub(T,y),w=r.mul(m,w),w=r.add(w,R),R=r.add(T,T),T=r.add(R,T),T=r.add(T,y),T=r.mul(T,w),C=r.add(C,T),y=r.mul(B,P),y=r.add(y,y),T=r.mul(y,w),U=r.sub(U,T),R=r.mul(y,j),R=r.add(R,R),R=r.add(R,R),new g(U,C,R)}add(m){f(m);const{px:x,py:$,pz:D}=this,{px:B,py:P,pz:U}=m;let C=r.ZERO,R=r.ZERO,T=r.ZERO;const j=e.a,y=r.mul(e.b,uu);let w=r.mul(x,B),E=r.mul($,P),O=r.mul(D,U),_=r.add(x,$),S=r.add(B,P);_=r.mul(_,S),S=r.add(w,E),_=r.sub(_,S),S=r.add(x,D);let N=r.add(B,U);return S=r.mul(S,N),N=r.add(w,O),S=r.sub(S,N),N=r.add($,D),C=r.add(P,U),N=r.mul(N,C),C=r.add(E,O),N=r.sub(N,C),T=r.mul(j,S),C=r.mul(y,O),T=r.add(C,T),C=r.sub(E,T),T=r.add(E,T),R=r.mul(C,T),E=r.add(w,w),E=r.add(E,w),O=r.mul(j,O),S=r.mul(y,S),E=r.add(E,O),O=r.sub(w,O),O=r.mul(j,O),S=r.add(S,O),w=r.mul(E,S),R=r.add(R,w),w=r.mul(N,S),C=r.mul(_,C),C=r.sub(C,w),w=r.mul(_,E),T=r.mul(N,T),T=r.add(T,w),new g(C,R,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(g.ZERO)}wNAF(m){return A.wNAFCached(this,m,g.normalizeZ)}multiplyUnsafe(m){const{endo:x,n:$}=e;Wr("scalar",m,pr,$);const D=g.ZERO;if(m===pr)return D;if(this.is0()||m===De)return this;if(!x||A.hasPrecomputes(this))return A.wNAFCachedUnsafe(this,m,g.normalizeZ);let{k1neg:B,k1:P,k2neg:U,k2:C}=x.splitScalar(m),R=D,T=D,j=this;for(;P>pr||C>pr;)P&De&&(R=R.add(j)),C&De&&(T=T.add(j)),j=j.double(),P>>=De,C>>=De;return B&&(R=R.negate()),U&&(T=T.negate()),T=new g(r.mul(T.px,x.beta),T.py,T.pz),R.add(T)}multiply(m){const{endo:x,n:$}=e;Wr("scalar",m,De,$);let D,B;if(x){const{k1neg:P,k1:U,k2neg:C,k2:R}=x.splitScalar(m);let{p:T,f:j}=this.wNAF(U),{p:y,f:w}=this.wNAF(R);T=A.constTimeNegate(P,T),y=A.constTimeNegate(C,y),y=new g(r.mul(y.px,x.beta),y.py,y.pz),D=T.add(y),B=j.add(w)}else{const{p:P,f:U}=this.wNAF(m);D=P,B=U}return g.normalizeZ([D,B])[0]}multiplyAndAddUnsafe(m,x,$){const D=g.BASE,B=(U,C)=>C===pr||C===De||!U.equals(D)?U.multiplyUnsafe(C):U.multiply(C),P=B(this,x).add(B(m,$));return P.is0()?void 0:P}toAffine(m){return p(this,m)}isTorsionFree(){const{h:m,isTorsionFree:x}=e;if(m===De)return!0;if(x)return x(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:x}=e;return m===De?this:x?x(g,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return Jn("isCompressed",m),this.assertValidity(),n(g,this,m)}toHex(m=!0){return Jn("isCompressed",m),Xn(this.toRawBytes(m))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:v,nBitLength:I}=e,A=WI(g,v?Math.ceil(I/2):I);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:h}}function oS(t){const e=Qp(t);return es(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(ur({lowS:!0},e))}function aS(t){const e=oS(t),{Fp:r,n:i,nByteLength:n,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return ut(y,i)}function u(y){return eu(y,i)}const{ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:p}=sS(Dc(ur({},e),{toBytes(y,w,E){const O=w.toAffine(),_=r.toBytes(O.x),S=_o;return Jn("isCompressed",E),E?S(Uint8Array.from([w.hasEvenY()?2:3]),_):S(Uint8Array.from([4]),_,r.toBytes(O.y))},fromBytes(y){const w=y.length,E=y[0],O=y.subarray(1);if(w===o&&(E===2||E===3)){const _=gi(O);if(!Xc(_,De,r.ORDER))throw new Error("Point is not on curve");const S=f(_);let N;try{N=r.sqrt(S)}catch(H){const q=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+q)}const k=(N&De)===De;return(E&1)===1!==k&&(N=r.neg(N)),{x:_,y:N}}else if(w===a&&E===4){const _=r.fromBytes(O.subarray(0,r.BYTES)),S=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:_,y:S}}else{const _=o,S=a;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+S+", got "+w)}}}));function d(y){const w=i>>De;return y>w}function g(y){return d(y)?c(-y):y}const v=(y,w,E)=>gi(y.slice(w,E));class I{constructor(w,E,O){Wr("r",w,De,i),Wr("s",E,De,i),this.r=w,this.s=E,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(w){const E=n;return w=at("compactSignature",w,E*2),new I(v(w,0,E),v(w,E,2*E))}static fromDER(w){const{r:E,s:O}=dr.toSig(at("DER",w));return new I(E,O)}assertValidity(){}addRecoveryBit(w){return new I(this.r,this.s,w)}recoverPublicKey(w){const{r:E,s:O,recovery:_}=this,S=D(at("msgHash",w));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const N=_===2||_===3?E+e.n:E;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const k=(_&1)===0?"02":"03",H=h.fromHex(k+cu(N,r.BYTES)),q=u(N),V=c(-S*q),K=c(O*q),G=h.BASE.multiplyAndAddUnsafe(H,V,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Eo(this.toDERHex())}toDERHex(){return dr.hexFromSig(this)}toCompactRawBytes(){return Eo(this.toCompactHex())}toCompactHex(){const w=n;return cu(this.r,w)+cu(this.s,w)}}const A={isValidPrivateKey(y){try{return l(y),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const y=Gp(e.n);return HI(e.randomBytes(y),e.n)},precompute(y=8,w=h.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}};function b(y,w=!0){return h.fromPrivateKey(y).toRawBytes(w)}function m(y){if(typeof y=="bigint")return!1;if(y instanceof h)return!0;const w=at("key",y).length,E=r.BYTES,O=E+1,_=2*E+1;if(!(e.allowedPrivateKeyLengths||n===O))return w===O||w===_}function x(y,w,E=!0){if(m(y)===!0)throw new Error("first arg must be private key");if(m(w)===!1)throw new Error("second arg must be public key");return h.fromHex(w).multiply(l(y)).toRawBytes(E)}const $=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const w=gi(y),E=y.length*8-s;return E>0?w>>BigInt(E):w},D=e.bits2int_modN||function(y){return c($(y))},B=Io(s);function P(y){return Wr("num < 2^"+s,y,pr,B),Qn(y,n)}function U(y,w,E=C){if(["recovered","canonical"].some(W=>W in E))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:_}=e;let{lowS:S,prehash:N,extraEntropy:k}=E;S==null&&(S=!0),y=at("msgHash",y),tg(E),N&&(y=at("prehashed msgHash",O(y)));const H=D(y),q=l(w),V=[P(q),P(H)];if(k!=null&&k!==!1){const W=k===!0?_(r.BYTES):k;V.push(at("extraEntropy",W))}const K=_o(...V),G=H;function Q(W){const de=$(W);if(!p(de))return;const we=u(de),xe=h.BASE.multiply(de).toAffine(),_e=c(xe.x);if(_e===pr)return;const me=c(we*c(G+_e*q));if(me===pr)return;let Me=(xe.x===_e?0:2)|Number(xe.y&De),Si=me;return S&&d(me)&&(Si=g(me),Me^=1),new I(_e,Si,Me)}return{seed:K,k2sig:Q}}const C={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function T(y,w,E=C){const{seed:O,k2sig:_}=U(y,w,E),S=e;return NI(S.hash.outputLen,S.nByteLength,S.hmac)(O,_)}h.BASE._setWindowSize(8);function j(y,w,E,O=R){var _;const S=y;w=at("msgHash",w),E=at("publicKey",E);const{lowS:N,prehash:k,format:H}=O;if(tg(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(H!==void 0&&H!=="compact"&&H!=="der")throw new Error("format must be compact or der");const q=typeof S=="string"||Zn(S),V=!q&&!H&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!q&&!V)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let K,G;try{if(V&&(K=new I(S.r,S.s)),q){try{H!=="compact"&&(K=I.fromDER(S))}catch(Me){if(!(Me instanceof dr.Err))throw Me}!K&&H!=="der"&&(K=I.fromCompact(S))}G=h.fromHex(E)}catch{return!1}if(!K||N&&K.hasHighS())return!1;k&&(w=e.hash(w));const{r:Q,s:W}=K,de=D(w),we=u(W),xe=c(de*we),_e=c(Q*we),me=(_=h.BASE.multiplyAndAddUnsafe(G,xe,_e))==null?void 0:_.toAffine();return me?c(me.x)===Q:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:T,verify:j,ProjectivePoint:h,Signature:I,utils:A}}function cS(t){return{hash:t,hmac:(e,...r)=>mo(t,e,n8(...r)),randomBytes:qi}}function hu(t,e){const r=i=>aS(ur(ur({},t),cS(i)));return Dc(ur({},r(e)),{create:r})}const rg=ts(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),uS=rg.create(BigInt("-3")),hS=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),lS=hu({a:uS,b:hS,Fp:rg,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},po),ig=ts(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),fS=ig.create(BigInt("-3")),dS=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");hu({a:fS,b:dS,Fp:ig,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},A8);const ng=ts(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),pS=ng.create(BigInt("-3")),gS=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");hu({a:pS,b:gS,Fp:ng,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},S8);const yS=lS,sg="base10",Xe="base16",Ft="base64pad",Gr="base64url",is="utf8",og=0,gr=1,ns=2,wS=0,ag=1,ss=12,lu=32;function mS(){const t=au.utils.randomPrivateKey(),e=au.getPublicKey(t);return{privateKey:st(t,Xe),publicKey:st(e,Xe)}}function fu(){const t=qi(lu);return st(t,Xe)}function bS(t,e){const r=au.getSharedSecret(It(t,Xe),It(e,Xe)),i=CI(bo,r,void 0,void 0,lu);return st(i,Xe)}function Ao(t){const e=bo(It(t,Xe));return st(e,Xe)}function Yt(t){const e=bo(It(t,is));return st(e,Xe)}function cg(t){return It(`${t}`,sg)}function wi(t){return Number(st(t,sg))}function ug(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function hg(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function vS(t){const e=cg(typeof t.type<"u"?t.type:og);if(wi(e)===gr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?It(t.senderPublicKey,Xe):void 0,i=typeof t.iv<"u"?It(t.iv,Xe):qi(ss),n=It(t.symKey,Xe),s=Cp(n,i).encrypt(It(t.message,is)),o=lg({type:e,sealed:s,iv:i,senderPublicKey:r});return t.encoding===Gr?ug(o):o}function ES(t){const e=It(t.symKey,Xe),{sealed:r,iv:i}=os({encoded:t.encoded,encoding:t.encoding}),n=Cp(e,i).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return st(n,is)}function xS(t,e){const r=cg(ns),i=qi(ss),n=It(t,is),s=lg({type:r,sealed:n,iv:i});return e===Gr?ug(s):s}function _S(t,e){const{sealed:r}=os({encoded:t,encoding:e});return st(r,is)}function lg(t){if(wi(t.type)===ns)return st(Ln([t.type,t.sealed]),Ft);if(wi(t.type)===gr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return st(Ln([t.type,t.senderPublicKey,t.iv,t.sealed]),Ft)}return st(Ln([t.type,t.iv,t.sealed]),Ft)}function os(t){const e=(t.encoding||Ft)===Gr?hg(t.encoded):t.encoded,r=It(e,Ft),i=r.slice(wS,ag),n=ag;if(wi(i)===gr){const c=n+lu,u=c+ss,h=r.slice(n,c),l=r.slice(c,u),f=r.slice(u);return{type:i,sealed:f,iv:l,senderPublicKey:h}}if(wi(i)===ns){const c=r.slice(n),u=qi(ss);return{type:i,sealed:c,iv:u}}const s=n+ss,o=r.slice(n,s),a=r.slice(s);return{type:i,sealed:a,iv:o}}function IS(t,e){const r=os({encoded:t,encoding:e?.encoding});return fg({type:wi(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?st(r.senderPublicKey,Xe):void 0,receiverPublicKey:e?.receiverPublicKey})}function fg(t){const e=t?.type||og;if(e===gr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function dg(t){return t.type===gr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function pg(t){return t.type===ns}function SS(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Ln([new Uint8Array([4]),e,r])}function AS(t,e){const[r,i,n]=t.split("."),s=Buffer.from(hg(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${i}`,u=bo(c),h=SS(e);if(!yS.verify(Ln([o,a]),u,h))throw new Error("Invalid signature");return Aa(t).payload}const DS="irn";function Do(t){return t?.relay||{protocol:DS}}function as(t){const e=t_[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function $S(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function gg(t){if(!t.includes("wc:")){const u=Jd(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,h)=>{a[h]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:OS(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:$S(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function OS(t){return t.startsWith("//")?t.substring(2):t}function PS(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=n,o=r+e+s;t[s]&&(i[o]=t[s])}),i}function yg(t){const e=new URLSearchParams,r=PS(t.relay);Object.keys(r).sort().forEach(n=>{e.set(n,r[n])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const i=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${i}`}function $o(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var BS=Object.defineProperty,CS=Object.defineProperties,TS=Object.getOwnPropertyDescriptors,wg=Object.getOwnPropertySymbols,RS=Object.prototype.hasOwnProperty,NS=Object.prototype.propertyIsEnumerable,mg=(t,e,r)=>e in t?BS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,US=(t,e)=>{for(var r in e||(e={}))RS.call(e,r)&&mg(t,r,e[r]);if(wg)for(var r of wg(e))NS.call(e,r)&&mg(t,r,e[r]);return t},FS=(t,e)=>CS(t,TS(e));function Vi(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function LS(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Vi(r.accounts))}),e}function kS(t,e){const r=[];return Object.values(t).forEach(i=>{Vi(i.accounts).includes(e)&&r.push(...i.methods)}),r}function MS(t,e){const r=[];return Object.values(t).forEach(i=>{Vi(i.accounts).includes(e)&&r.push(...i.events)}),r}function Oo(t){return t.includes(":")}function Ki(t){return Oo(t)?t.split(":")[0]:t}function bg(t){var e,r,i;const n={};if(!Yr(t))return n;for(const[s,o]of Object.entries(t)){const a=Oo(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],h=Ki(s);n[h]=FS(US({},n[h]),{chains:Wt(a,(e=n[h])==null?void 0:e.chains),methods:Wt(c,(r=n[h])==null?void 0:r.methods),events:Wt(u,(i=n[h])==null?void 0:i.events)})}return n}function jS(t){const e={};return t?.forEach(r=>{var i;const[n,s]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function vg(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=jS(e);for(const[i,n]of Object.entries(r))n.methods?n.methods=Wt(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function qS(t,e){var r,i,n,s,o,a;const c=bg(t),u=bg(e),h={},l=Object.keys(c).concat(Object.keys(u));for(const f of l)h[f]={chains:Wt((r=c[f])==null?void 0:r.chains,(i=u[f])==null?void 0:i.chains),methods:Wt((n=c[f])==null?void 0:n.methods,(s=u[f])==null?void 0:s.methods),events:Wt((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return h}const zS={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},HS={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function M(t,e){const{message:r,code:i}=HS[t];return{message:e?`${r} ${e}`:r,code:i}}function ae(t,e){const{message:r,code:i}=zS[t];return{message:e?`${r} ${e}`:r,code:i}}function yr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Yr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ue(t){return typeof t>"u"}function ge(t,e){return e&&Ue(t)?!0:typeof t=="string"&&!!t.trim().length}function du(t,e){return e&&Ue(t)?!0:typeof t=="number"&&!isNaN(t)}function VS(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return fi(n,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],h=Vi(a),l=r[o];(!fi(Md(o,l),h)||!fi(l.methods,c)||!fi(l.events,u))&&(s=!1)}),s):!1}function Po(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function KS(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Po(r)}}return!1}function WS(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const r=Jd(t);return e(r)}}catch{}return!1}function GS(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function YS(t){return t?.topic}function ZS(t,e){let r=null;return ge(t?.publicKey,!1)||(r=M("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Eg(t){let e=!0;return yr(t)?t.length&&(e=t.every(r=>ge(r,!1))):e=!1,e}function JS(t,e,r){let i=null;return yr(e)&&e.length?e.forEach(n=>{i||Po(n)||(i=ae("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):Po(t)||(i=ae("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function XS(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=JS(n,Md(n,s),`${e} ${r}`);o&&(i=o)}),i}function QS(t,e){let r=null;return yr(t)?t.forEach(i=>{r||KS(i)||(r=ae("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ae("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function eA(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=QS(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function tA(t,e){let r=null;return Eg(t?.methods)?Eg(t?.events)||(r=ae("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ae("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function xg(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=tA(i,`${e}, namespace`);n&&(r=n)}),r}function rA(t,e,r){let i=null;if(t&&Yr(t)){const n=xg(t,e);n&&(i=n);const s=XS(t,e,r);s&&(i=s)}else i=M("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function pu(t,e){let r=null;if(t&&Yr(t)){const i=xg(t,e);i&&(r=i);const n=eA(t,e);n&&(r=n)}else r=M("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function _g(t){return ge(t.protocol,!0)}function iA(t,e){let r=!1;return e&&!t?r=!0:t&&yr(t)&&t.length&&t.forEach(i=>{r=_g(i)}),r}function nA(t){return typeof t=="number"}function ht(t){return typeof t<"u"&&typeof t!==null}function sA(t){return!(!t||typeof t!="object"||!t.code||!du(t.code,!1)||!t.message||!ge(t.message,!1))}function oA(t){return!(Ue(t)||!ge(t.method,!1))}function aA(t){return!(Ue(t)||Ue(t.result)&&Ue(t.error)||!du(t.id,!1)||!ge(t.jsonrpc,!1))}function cA(t){return!(Ue(t)||!ge(t.name,!1))}function Ig(t,e){return!(!Po(e)||!LS(t).includes(e))}function uA(t,e,r){return ge(r,!1)?kS(t,e).includes(r):!1}function hA(t,e,r){return ge(r,!1)?MS(t,e).includes(r):!1}function Sg(t,e,r){let i=null;const n=lA(t),s=fA(e),o=Object.keys(n),a=Object.keys(s),c=Ag(Object.keys(t)),u=Ag(Object.keys(e)),h=c.filter(l=>!u.includes(l));return h.length&&(i=M("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),fi(o,a)||(i=M("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const f=Vi(e[l].accounts);f.includes(l)||(i=M("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${f.toString()}`))}),o.forEach(l=>{i||(fi(n[l].methods,s[l].methods)?fi(n[l].events,s[l].events)||(i=M("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${l}`)):i=M("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function lA(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Ag(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function fA(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Vi(t[r].accounts);i?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function dA(t,e){return du(t,!1)&&t<=e.max&&t>=e.min}function Dg(){const t=zn();return new Promise(e=>{switch(t){case wt.browser:e(pA());break;case wt.reactNative:e(gA());break;case wt.node:e(yA());break;default:e(!0)}})}function pA(){return Mi()&&navigator?.onLine}async function gA(){if(Cr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function yA(){return!0}function wA(t){switch(zn()){case wt.browser:mA(t);break;case wt.reactNative:bA(t);break}}function mA(t){!Cr()&&Mi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function bA(t){Cr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function vA(){var t;return Mi()&&oi()?((t=oi())==null?void 0:t.visibilityState)==="visible":!0}const gu={};class cs{static get(e){return gu[e]}static set(e,r){gu[e]=r}static delete(e){delete gu[e]}}function EA(t){const e=Cn.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function xA({publicKey:t,signature:e,payload:r}){var i;const n=yu(r.method),s=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=SA(r.address),a=r.era==="00"?new Uint8Array([0]):yu(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),h=BigInt(`0x${IA(r.tip)}`),l=DA(h),f=new Uint8Array([0,...t,o,...e,...a,...u,...l,...n]),p=AA(f.length+1);return new Uint8Array([...p,s,...f])}function _A(t){const e=yu(t),r=d_.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function yu(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function IA(t){return t.startsWith("0x")?t.slice(2):t}function SA(t){const e=Cn.decode(t)[0];return e===42?0:e===60?2:1}function AA(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function DA(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function $A(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=EA(t.transaction.address),i=xA({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(i).toString("hex");return _A(n)}const OA="PARSE_ERROR",PA="INVALID_REQUEST",BA="METHOD_NOT_FOUND",CA="INVALID_PARAMS",$g="INTERNAL_ERROR",wu="SERVER_ERROR",TA=[-32700,-32600,-32601,-32602,-32603],us={[OA]:{code:-32700,message:"Parse error"},[PA]:{code:-32600,message:"Invalid Request"},[BA]:{code:-32601,message:"Method not found"},[CA]:{code:-32602,message:"Invalid params"},[$g]:{code:-32603,message:"Internal error"},[wu]:{code:-32e3,message:"Server error"}},Og=wu;function RA(t){return TA.includes(t)}function Pg(t){return Object.keys(us).includes(t)?us[t]:us[Og]}function NA(t){const e=Object.values(us).find(r=>r.code===t);return e||us[Og]}function Bg(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Cg={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var mu=function(t,e){return mu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},mu(t,e)};function UA(t,e){mu(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var bu=function(){return bu=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},bu.apply(this,arguments)};function FA(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function LA(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function kA(t,e){return function(r,i){e(r,i,t)}}function MA(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function jA(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(h){try{u(i.next(h))}catch(l){o(l)}}function c(h){try{u(i.throw(h))}catch(l){o(l)}}function u(h){h.done?s(h.value):n(h.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function qA(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return c([u,h])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(h){u=[6,h],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function zA(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function HA(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function vu(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tg(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function VA(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Tg(arguments[e]));return t}function KA(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function hs(t){return this instanceof hs?(this.v=t,this):new hs(t)}function WA(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){l(s[0][3],d)}}function c(f){f.value instanceof hs?Promise.resolve(f.value.v).then(u,h):l(s[0][2],f)}function u(f){a("next",f)}function h(f){a("throw",f)}function l(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function GA(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:hs(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function YA(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof vu=="function"?vu(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function ZA(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function JA(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function XA(t){return t&&t.__esModule?t:{default:t}}function QA(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function eD(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var tD=Object.freeze({__proto__:null,__extends:UA,get __assign(){return bu},__rest:FA,__decorate:LA,__param:kA,__metadata:MA,__awaiter:jA,__generator:qA,__createBinding:zA,__exportStar:HA,__values:vu,__read:Tg,__spread:VA,__spreadArrays:KA,__await:hs,__asyncGenerator:WA,__asyncDelegator:GA,__asyncValues:YA,__makeTemplateObject:ZA,__importStar:JA,__importDefault:XA,__classPrivateFieldGet:QA,__classPrivateFieldSet:eD}),rD=Xu(tD),wr={},Rg;function iD(){if(Rg)return wr;Rg=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.isBrowserCryptoAvailable=wr.getSubtleCrypto=wr.getBrowerCrypto=void 0;function t(){return et?.crypto||et?.msCrypto||{}}wr.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}wr.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return wr.isBrowserCryptoAvailable=r,wr}var mr={},Ng;function nD(){if(Ng)return mr;Ng=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.isBrowser=mr.isNode=mr.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}mr.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}mr.isNode=e;function r(){return!t()&&!e()}return mr.isBrowser=r,mr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=rD;e.__exportStar(iD(),t),e.__exportStar(nD(),t)})(Cg);function Zt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function mi(t=6){return BigInt(Zt(t))}function Zr(t,e,r){return{id:r||Zt(),jsonrpc:"2.0",method:t,params:e}}function Bo(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Co(t,e,r){return{id:t,jsonrpc:"2.0",error:sD(e,r)}}function sD(t,e){return typeof t>"u"?Pg($g):(typeof t=="string"&&(t=Object.assign(Object.assign({},Pg(wu)),{message:t})),typeof e<"u"&&(t.data=e),RA(t.code)&&(t=NA(t.code)),t)}class oD{}class aD extends oD{constructor(){super()}}class cD extends aD{constructor(e){super()}}const uD="^https?:",hD="^wss?:";function lD(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Ug(t,e){const r=lD(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Fg(t){return Ug(t,uD)}function Lg(t){return Ug(t,hD)}function fD(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function kg(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Eu(t){return kg(t)&&"method"in t}function To(t){return kg(t)&&(Jt(t)||At(t))}function Jt(t){return"result"in t}function At(t){return"error"in t}class Dt extends cD{constructor(e){super(e),this.events=new je.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Zr(e.method,e.params||[],e.id||mi().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{At(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),To(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const dD=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),pD=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Mg=t=>t.split("?")[0],jg=10,gD=dD();class yD{constructor(e){if(this.url=e,this.events=new je.exports.EventEmitter,this.registering=!1,!Lg(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Lg(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Cg.isReactNative()?void 0:{rejectUnauthorized:!fD(e)},s=new gD(e,[],n);pD()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?ii(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Co(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Bg(e,Mg(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>jg&&this.events.setMaxListeners(jg)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Mg(this.url)}`));return this.events.emit("register_error",r),r}}var wD=Object.defineProperty,qg=Object.getOwnPropertySymbols,mD=Object.prototype.hasOwnProperty,bD=Object.prototype.propertyIsEnumerable,zg=(t,e,r)=>e in t?wD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qe=(t,e)=>{for(var r in e||(e={}))mD.call(e,r)&&zg(t,r,e[r]);if(qg)for(var r of qg(e))bD.call(e,r)&&zg(t,r,e[r]);return t};const Hg="wc",Vg=2,Ro="core",Xt=`${Hg}@2:${Ro}:`,vD={name:Ro,logger:"error"},ED={database:":memory:"},xD="crypto",Kg="client_ed25519_seed",_D=L.ONE_DAY,ID="keychain",SD="0.3",AD="messages",DD="0.3",Wg=L.SIX_HOURS,$D="publisher",Gg="irn",OD="error",Yg="wss://relay.walletconnect.org",PD="relayer",$e={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},BD="_subscription",$t={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},CD=.1,xu="2.21.2",le={link_mode:"link_mode",relay:"relay"},No={inbound:"inbound",outbound:"outbound"},TD="0.3",RD="WALLETCONNECT_CLIENT_ID",Zg="WALLETCONNECT_LINK_MODE_APPS",mt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},ND="subscription",UD="0.3",FD="pairing",LD="0.3",ls={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},bi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Lt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},kD="history",MD="0.3",jD="expirer",Ot={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},qD="0.3",zD="verify-api",HD="https://verify.walletconnect.com",Jg="https://verify.walletconnect.org",fs=Jg,VD=`${fs}/v3`,KD=[HD,Jg],WD="echo",GD="https://echo.walletconnect.com",Qt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},br={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},kt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},vi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Ei={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},ds={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},YD=.1,ZD="event-client",JD=86400,XD="https://pulse.walletconnect.org/batch";function QD(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,v=0,I=0,A=d.length;I!==A&&d[I]===0;)I++,g++;for(var b=(A-I)*h+1>>>0,m=new Uint8Array(b);I!==A;){for(var x=d[I],$=0,D=b-1;(x!==0||$<v)&&D!==-1;D--,$++)x+=256*m[D]>>>0,m[D]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");v=$,I++}for(var B=b-v;B!==b&&m[B]===0;)B++;for(var P=c.repeat(g);B<b;++B)P+=t.charAt(m[B]);return P}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var v=0,I=0;d[g]===c;)v++,g++;for(var A=(d.length-g)*u+1>>>0,b=new Uint8Array(A);d[g];){var m=r[d.charCodeAt(g)];if(m===255)return;for(var x=0,$=A-1;(m!==0||x<I)&&$!==-1;$--,x++)m+=a*b[$]>>>0,b[$]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");I=x,g++}if(d[g]!==" "){for(var D=A-I;D!==A&&b[D]===0;)D++;for(var B=new Uint8Array(v+(A-D)),P=v;D!==A;)B[P++]=b[D++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:f,decode:p}}var e6=QD,t6=e6;const Xg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},r6=t=>new TextEncoder().encode(t),i6=t=>new TextDecoder().decode(t);class n6{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class s6{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Qg(this,e)}}class o6{constructor(e){this.decoders=e}or(e){return Qg(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Qg=(t,e)=>new o6(Qe(Qe({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class a6{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new n6(e,r,i),this.decoder=new s6(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Uo=({name:t,prefix:e,encode:r,decode:i})=>new a6(t,e,r,i),ps=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=t6(r,e);return Uo({prefix:t,name:e,encode:i,decode:s=>Xg(n(s))})},c6=(t,e,r,i)=>{const n={};for(let h=0;h<e.length;++h)n[e[h]]=h;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let h=0;h<s;++h){const l=n[t[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},u6=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Fe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Uo({prefix:e,name:t,encode(n){return u6(n,i,r)},decode(n){return c6(n,i,r,t)}}),h6=Uo({prefix:"\0",name:"identity",encode:t=>i6(t),decode:t=>r6(t)});var l6=Object.freeze({__proto__:null,identity:h6});const f6=Fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var d6=Object.freeze({__proto__:null,base2:f6});const p6=Fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var g6=Object.freeze({__proto__:null,base8:p6});const y6=ps({prefix:"9",name:"base10",alphabet:"0123456789"});var w6=Object.freeze({__proto__:null,base10:y6});const m6=Fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),b6=Fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var v6=Object.freeze({__proto__:null,base16:m6,base16upper:b6});const E6=Fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),x6=Fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_6=Fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),I6=Fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),S6=Fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),A6=Fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),D6=Fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$6=Fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),O6=Fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var P6=Object.freeze({__proto__:null,base32:E6,base32upper:x6,base32pad:_6,base32padupper:I6,base32hex:S6,base32hexupper:A6,base32hexpad:D6,base32hexpadupper:$6,base32z:O6});const B6=ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),C6=ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var T6=Object.freeze({__proto__:null,base36:B6,base36upper:C6});const R6=ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),N6=ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var U6=Object.freeze({__proto__:null,base58btc:R6,base58flickr:N6});const F6=Fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),L6=Fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),k6=Fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),M6=Fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var j6=Object.freeze({__proto__:null,base64:F6,base64pad:L6,base64url:k6,base64urlpad:M6});const e0=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),q6=e0.reduce((t,e,r)=>(t[r]=e,t),[]),z6=e0.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function H6(t){return t.reduce((e,r)=>(e+=q6[r],e),"")}function V6(t){const e=[];for(const r of t){const i=z6[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const K6=Uo({prefix:"\u{1F680}",name:"base256emoji",encode:H6,decode:V6});var W6=Object.freeze({__proto__:null,base256emoji:K6}),G6=r0,t0=128,Y6=127,Z6=~Y6,J6=Math.pow(2,31);function r0(t,e,r){e=e||[],r=r||0;for(var i=r;t>=J6;)e[r++]=t&255|t0,t/=128;for(;t&Z6;)e[r++]=t&255|t0,t>>>=7;return e[r]=t|0,r0.bytes=r-i+1,e}var X6=_u,Q6=128,i0=127;function _u(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw _u.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&i0)<<n:(o&i0)*Math.pow(2,n),n+=7}while(o>=Q6);return _u.bytes=s-i,r}var e4=Math.pow(2,7),t4=Math.pow(2,14),r4=Math.pow(2,21),i4=Math.pow(2,28),n4=Math.pow(2,35),s4=Math.pow(2,42),o4=Math.pow(2,49),a4=Math.pow(2,56),c4=Math.pow(2,63),u4=function(t){return t<e4?1:t<t4?2:t<r4?3:t<i4?4:t<n4?5:t<s4?6:t<o4?7:t<a4?8:t<c4?9:10},h4={encode:G6,decode:X6,encodingLength:u4},n0=h4;const s0=(t,e,r=0)=>(n0.encode(t,e,r),e),o0=t=>n0.encodingLength(t),Iu=(t,e)=>{const r=e.byteLength,i=o0(t),n=i+o0(r),s=new Uint8Array(n+r);return s0(t,s,0),s0(r,s,i),s.set(e,n),new l4(t,r,e,s)};class l4{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const a0=({name:t,code:e,encode:r})=>new f4(t,e,r);class f4{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Iu(this.code,r):r.then(i=>Iu(this.code,i))}else throw Error("Unknown type, must be binary type")}}const c0=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),d4=a0({name:"sha2-256",code:18,encode:c0("SHA-256")}),p4=a0({name:"sha2-512",code:19,encode:c0("SHA-512")});var g4=Object.freeze({__proto__:null,sha256:d4,sha512:p4});const u0=0,y4="identity",h0=Xg;var w4=Object.freeze({__proto__:null,identity:{code:u0,name:y4,encode:h0,digest:t=>Iu(u0,h0(t))}});new TextEncoder,new TextDecoder;const l0=Qe(Qe(Qe(Qe(Qe(Qe(Qe(Qe(Qe(Qe({},l6),d6),g6),w6),v6),P6),T6),U6),j6),W6);Qe(Qe({},g4),w4);function f0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function m4(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?f0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function d0(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const p0=d0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Su=d0("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=m4(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),b4=Qe({utf8:p0,"utf-8":p0,hex:l0.base16,latin1:Su,ascii:Su,binary:Su},l0);function v4(t,e="utf8"){const r=b4[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?f0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var E4=Object.defineProperty,x4=(t,e,r)=>e in t?E4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,er=(t,e,r)=>x4(t,typeof e!="symbol"?e+"":e,r);class _4{constructor(e,r){this.core=e,this.logger=r,er(this,"keychain",new Map),er(this,"name",ID),er(this,"version",SD),er(this,"initialized",!1),er(this,"storagePrefix",Xt),er(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),er(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),er(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),er(this,"get",i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),er(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Ge(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,$c(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var I4=Object.defineProperty,S4=(t,e,r)=>e in t?I4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Le=(t,e,r)=>S4(t,typeof e!="symbol"?e+"":e,r);class A4{constructor(e,r,i){this.core=e,this.logger=r,Le(this,"name",xD),Le(this,"keychain"),Le(this,"randomSessionIdentifier",fu()),Le(this,"initialized",!1),Le(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Le(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),Le(this,"getClientId",async()=>{this.isInitialized();const n=await this.getClientSeed(),s=$l(n);return Dl(s.publicKey)}),Le(this,"generateKeyPair",()=>{this.isInitialized();const n=mS();return this.setPrivateKey(n.publicKey,n.privateKey)}),Le(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=$l(s),a=this.randomSessionIdentifier;return await mv(a,n,_D,o)}),Le(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=bS(a,s);return this.setSymKey(c,o)}),Le(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||Ao(n);return await this.keychain.set(o,n),o}),Le(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),Le(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),Le(this,"encode",async(n,s,o)=>{this.isInitialized();const a=fg(o),c=rr(s);if(pg(a))return xS(c,o?.encoding);if(dg(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(f,p)}const u=this.getSymKey(n),{type:h,senderPublicKey:l}=a;return vS({type:h,symKey:u,message:c,senderPublicKey:l,encoding:o?.encoding})}),Le(this,"decode",async(n,s,o)=>{this.isInitialized();const a=IS(s,o);if(pg(a)){const c=_S(s,o?.encoding);return ii(c)}if(dg(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(n),u=ES({symKey:c,encoded:s,encoding:o?.encoding});return ii(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Le(this,"getPayloadType",(n,s=Ft)=>{const o=os({encoded:n,encoding:s});return wi(o.type)}),Le(this,"getPayloadSenderPublicKey",(n,s=Ft)=>{const o=os({encoded:n,encoding:s});return o.senderPublicKey?st(o.senderPublicKey,Xe):void 0}),this.core=e,this.logger=Ge(r,this.name),this.keychain=i||new _4(this.core,this.logger)}get context(){return rt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Kg)}catch{e=fu(),await this.keychain.set(Kg,e)}return v4(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var D4=Object.defineProperty,$4=Object.defineProperties,O4=Object.getOwnPropertyDescriptors,g0=Object.getOwnPropertySymbols,P4=Object.prototype.hasOwnProperty,B4=Object.prototype.propertyIsEnumerable,Au=(t,e,r)=>e in t?D4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,C4=(t,e)=>{for(var r in e||(e={}))P4.call(e,r)&&Au(t,r,e[r]);if(g0)for(var r of g0(e))B4.call(e,r)&&Au(t,r,e[r]);return t},T4=(t,e)=>$4(t,O4(e)),bt=(t,e,r)=>Au(t,typeof e!="symbol"?e+"":e,r);class R4 extends wm{constructor(e,r){super(e,r),this.logger=e,this.core=r,bt(this,"messages",new Map),bt(this,"messagesWithoutClientAck",new Map),bt(this,"name",AD),bt(this,"version",DD),bt(this,"initialized",!1),bt(this,"storagePrefix",Xt),bt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),bt(this,"set",async(i,n,s)=>{this.isInitialized();const o=Yt(n);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===No.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,T4(C4({},c),{[o]:n}))}return await this.persist(),o}),bt(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),bt(this,"getWithoutAck",i=>{this.isInitialized();const n={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),bt(this,"has",(i,n)=>{this.isInitialized();const s=this.get(i),o=Yt(n);return typeof s[o]<"u"}),bt(this,"ack",async(i,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=Yt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),bt(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=Ge(e,this.name),this.core=r}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,$c(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,$c(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oc(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Oc(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var N4=Object.defineProperty,U4=Object.defineProperties,F4=Object.getOwnPropertyDescriptors,y0=Object.getOwnPropertySymbols,L4=Object.prototype.hasOwnProperty,k4=Object.prototype.propertyIsEnumerable,Du=(t,e,r)=>e in t?N4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fo=(t,e)=>{for(var r in e||(e={}))L4.call(e,r)&&Du(t,r,e[r]);if(y0)for(var r of y0(e))k4.call(e,r)&&Du(t,r,e[r]);return t},$u=(t,e)=>U4(t,F4(e)),Mt=(t,e,r)=>Du(t,typeof e!="symbol"?e+"":e,r);class M4 extends mm{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Mt(this,"events",new je.exports.EventEmitter),Mt(this,"name",$D),Mt(this,"queue",new Map),Mt(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),Mt(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),Mt(this,"needsTransportRestart",!1),Mt(this,"publish",async(i,n,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const a=s?.ttl||Wg,c=Do(s),u=s?.prompt||!1,h=s?.tag||0,l=s?.id||mi().toString(),f={topic:i,message:n,opts:{ttl:a,relay:c,prompt:u,tag:h,id:l,attestation:s?.attestation,tvf:s?.tvf}},p=`Failed to publish payload, please try again. id:${l} tag:${h}`;try{const d=new Promise(async g=>{const v=({id:A})=>{f.opts.id===A&&(this.removeRequestFromQueue(A),this.relayer.events.removeListener($e.publish,v),g(f))};this.relayer.events.on($e.publish,v);const I=Tr(new Promise((A,b)=>{this.rpcPublish({topic:i,message:n,ttl:a,prompt:u,tag:h,id:l,attestation:s?.attestation,tvf:s?.tvf}).then(A).catch(m=>{this.logger.warn(m,m?.message),b(m)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${h}`);try{await I,this.events.removeListener($e.publish,v)}catch(A){this.queue.set(l,$u(Fo({},f),{attempt:1})),this.logger.warn(A,A?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:i,message:n,opts:s}}),await Tr(d,this.publishTimeout,p)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw d}finally{this.queue.delete(l)}}),Mt(this,"on",(i,n)=>{this.events.on(i,n)}),Mt(this,"once",(i,n)=>{this.events.once(i,n)}),Mt(this,"off",(i,n)=>{this.events.off(i,n)}),Mt(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=Ge(r,this.name),this.registerEventListeners()}get context(){return rt(this.logger)}async rpcPublish(e){var r,i,n,s;const{topic:o,message:a,ttl:c=Wg,prompt:u,tag:h,id:l,attestation:f,tvf:p}=e,d={method:as(Do().protocol).publish,params:Fo({topic:o,message:a,ttl:c,prompt:u,tag:h,attestation:f},p),id:l};Ue((r=d.params)==null?void 0:r.prompt)&&((i=d.params)==null||delete i.prompt),Ue((n=d.params)==null?void 0:n.tag)&&((s=d.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d});const g=await this.relayer.request(d);return this.relayer.events.emit($e.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const i=e.attempt+1;this.queue.set(r,$u(Fo({},e),{attempt:i}));const{topic:n,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish($u(Fo({},e),{topic:n,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ti.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit($e.connection_stalled);return}this.checkQueue()}),this.relayer.on($e.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var j4=Object.defineProperty,q4=(t,e,r)=>e in t?j4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wi=(t,e,r)=>q4(t,typeof e!="symbol"?e+"":e,r);class z4{constructor(){Wi(this,"map",new Map),Wi(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Wi(this,"get",e=>this.map.get(e)||[]),Wi(this,"exists",(e,r)=>this.get(e).includes(r)),Wi(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),Wi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var H4=Object.defineProperty,V4=Object.defineProperties,K4=Object.getOwnPropertyDescriptors,w0=Object.getOwnPropertySymbols,W4=Object.prototype.hasOwnProperty,G4=Object.prototype.propertyIsEnumerable,Ou=(t,e,r)=>e in t?H4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gs=(t,e)=>{for(var r in e||(e={}))W4.call(e,r)&&Ou(t,r,e[r]);if(w0)for(var r of w0(e))G4.call(e,r)&&Ou(t,r,e[r]);return t},Pu=(t,e)=>V4(t,K4(e)),ce=(t,e,r)=>Ou(t,typeof e!="symbol"?e+"":e,r);class Y4 extends Em{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ce(this,"subscriptions",new Map),ce(this,"topicMap",new z4),ce(this,"events",new je.exports.EventEmitter),ce(this,"name",ND),ce(this,"version",UD),ce(this,"pending",new Map),ce(this,"cached",[]),ce(this,"initialized",!1),ce(this,"storagePrefix",Xt),ce(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),ce(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ce(this,"clientId"),ce(this,"batchSubscribeTopicsLimit",500),ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ce(this,"subscribe",async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=Do(n),o={topic:i,relay:s,transportType:n?.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,s,n);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),ce(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),ce(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),ce(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),ce(this,"on",(i,n)=>{this.events.on(i,n)}),ce(this,"once",(i,n)=>{this.events.once(i,n)}),ce(this,"off",(i,n)=>{this.events.off(i,n)}),ce(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),ce(this,"start",async()=>{await this.onConnect()}),ce(this,"stop",async()=>{await this.onDisconnect()}),ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ti.pulse,async()=>{await this.checkPending()}),this.events.on(mt.created,async i=>{const n=mt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(mt.deleted,async i=>{const n=mt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=Ge(r,this.name),this.clientId=""}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Do(i);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const s=ae("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,i){var n;(!i||i?.transportType===le.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:as(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(n=i?.internal)==null?void 0:n.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(i?.transportType===le.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(h=>this.logger.warn(h))},L.toMiliseconds(L.ONE_SECOND)),a;const c=new Promise(async h=>{const l=f=>{f.topic===e&&(this.events.removeListener(mt.created,l),h(f.id))};this.events.on(mt.created,l);try{const f=await Tr(new Promise((p,d)=>{this.relayer.request(s).catch(g=>{this.logger.warn(g,g?.message),d(g)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(mt.created,l),h(f)}catch{}}),u=await Tr(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit($e.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:as(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Tr(new Promise(n=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit($e.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:as(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Tr(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit($e.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:as(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Pu(gs({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,gs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,gs({},r)),this.topicMap.set(r.topic,e),this.events.emit(mt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(mt.deleted,Pu(gs({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(mt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(mt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Pu(gs({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await H_(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Yt(e+await this.getClientId())}}var Z4=Object.defineProperty,m0=Object.getOwnPropertySymbols,J4=Object.prototype.hasOwnProperty,X4=Object.prototype.propertyIsEnumerable,Bu=(t,e,r)=>e in t?Z4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b0=(t,e)=>{for(var r in e||(e={}))J4.call(e,r)&&Bu(t,r,e[r]);if(m0)for(var r of m0(e))X4.call(e,r)&&Bu(t,r,e[r]);return t},re=(t,e,r)=>Bu(t,typeof e!="symbol"?e+"":e,r);class Q4 extends bm{constructor(e){super(e),re(this,"protocol","wc"),re(this,"version",2),re(this,"core"),re(this,"logger"),re(this,"events",new je.exports.EventEmitter),re(this,"provider"),re(this,"messages"),re(this,"subscriber"),re(this,"publisher"),re(this,"name",PD),re(this,"transportExplicitlyClosed",!1),re(this,"initialized",!1),re(this,"connectionAttemptInProgress",!1),re(this,"relayUrl"),re(this,"projectId"),re(this,"packageName"),re(this,"bundleId"),re(this,"hasExperiencedNetworkDisruption",!1),re(this,"pingTimeout"),re(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),re(this,"reconnectTimeout"),re(this,"connectPromise"),re(this,"reconnectInProgress",!1),re(this,"requestsInFlight",[]),re(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),re(this,"request",async r=>{var i,n;this.logger.debug("Publishing Request Payload");const s=r.id||mi().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${s}:${((n=r.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),re(this,"resetPingTimeout",()=>{ho()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,n,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:n.terminate)==null||s.call(n)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),re(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),re(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit($e.connect)}),re(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),re(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit($e.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),re(this,"registerProviderListeners",()=>{this.provider.on($t.payload,this.onPayloadHandler),this.provider.on($t.connect,this.onConnectHandler),this.provider.on($t.disconnect,this.onDisconnectHandler),this.provider.on($t.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ge(e.logger,this.name):qt(Ps({level:e.logger||OD})),this.messages=new R4(this.logger,e.core),this.subscriber=new Y4(this,this.logger),this.publisher=new M4(this,this.logger),this.relayUrl=e?.relayUrl||Yg,this.projectId=e.projectId,$_()?this.packageName=Hd():O_()&&(this.bundleId=Hd()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return rt(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:le.relay},No.outbound)}async subscribe(e,r){var i,n,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=h=>{h.topic===e&&(this.subscriber.off(mt.created,u),c())};return await Promise.all([new Promise(h=>{c=h,this.subscriber.on(mt.created,u)}),new Promise(async(h,l)=>{a=await this.subscriber.subscribe(e,b0({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&l(f)})||a,h()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Tr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Dg())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const n=ve(L.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit($e.message,e),await this.recordMessageEvent(e,No.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once($t.disconnect,s),await Tr(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off($t.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once($t.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off($t.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,L.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,n,s;if(ho())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Dt(new yD(R_({sdkVersion:xu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:n}=e;await this.messages.set(i,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Eu(e)){if(!e.method.endsWith(BD))return;const r=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=r.data,a={topic:i,message:n,publishedAt:s,transportType:le.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(b0({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else To(e)&&this.events.emit($e.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,No.inbound),this.events.emit($e.message,e))}async acknowledgePayload(e){const r=Bo(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off($t.payload,this.onPayloadHandler),this.provider.off($t.connect,this.onConnectHandler),this.provider.off($t.disconnect,this.onDisconnectHandler),this.provider.off($t.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Dg();wA(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ti.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&vA())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit($e.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(CD)))))}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function e$(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function v0(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function E0(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const t$="[object RegExp]",r$="[object String]",i$="[object Number]",n$="[object Boolean]",x0="[object Arguments]",s$="[object Symbol]",o$="[object Date]",a$="[object Map]",c$="[object Set]",u$="[object Array]",h$="[object Function]",l$="[object ArrayBuffer]",Cu="[object Object]",f$="[object Error]",d$="[object DataView]",p$="[object Uint8Array]",g$="[object Uint8ClampedArray]",y$="[object Uint16Array]",w$="[object Uint32Array]",m$="[object BigUint64Array]",b$="[object Int8Array]",v$="[object Int16Array]",E$="[object Int32Array]",x$="[object BigInt64Array]",_$="[object Float32Array]",I$="[object Float64Array]";function _0(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function S$(t,e,r){return ys(t,e,void 0,void 0,void 0,void 0,r)}function ys(t,e,r,i,n,s,o){const a=o(t,e,r,i,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return ws(t,e,s,o)}return ws(t,e,s,o)}function ws(t,e,r,i){if(Object.is(t,e))return!0;let n=E0(t),s=E0(e);if(n===x0&&(n=Cu),s===x0&&(s=Cu),n!==s)return!1;switch(n){case r$:return t.toString()===e.toString();case i$:{const c=t.valueOf(),u=e.valueOf();return e$(c,u)}case n$:case o$:case s$:return Object.is(t.valueOf(),e.valueOf());case t$:return t.source===e.source&&t.flags===e.flags;case h$:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case a$:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!ys(u,e.get(c),c,t,e,r,i))return!1;return!0}case c$:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let h=0;h<c.length;h++){const l=c[h],f=u.findIndex(p=>ys(l,p,void 0,t,e,r,i));if(f===-1)return!1;u.splice(f,1)}return!0}case u$:case p$:case g$:case y$:case w$:case m$:case b$:case v$:case E$:case x$:case _$:case I$:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ys(t[c],e[c],c,t,e,r,i))return!1;return!0}case l$:return t.byteLength!==e.byteLength?!1:ws(new Uint8Array(t),new Uint8Array(e),r,i);case d$:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:ws(new Uint8Array(t),new Uint8Array(e),r,i);case f$:return t.name===e.name&&t.message===e.message;case Cu:{if(!(ws(t.constructor,e.constructor,r,i)||_0(t)&&_0(e)))return!1;const c=[...Object.keys(t),...v0(t)],u=[...Object.keys(e),...v0(e)];if(c.length!==u.length)return!1;for(let h=0;h<c.length;h++){const l=c[h],f=t[l];if(!Object.hasOwn(e,l))return!1;const p=e[l];if(!ys(f,p,l,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function A$(){}function D$(t,e){return S$(t,e,A$)}var $$=Object.defineProperty,I0=Object.getOwnPropertySymbols,O$=Object.prototype.hasOwnProperty,P$=Object.prototype.propertyIsEnumerable,Tu=(t,e,r)=>e in t?$$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,S0=(t,e)=>{for(var r in e||(e={}))O$.call(e,r)&&Tu(t,r,e[r]);if(I0)for(var r of I0(e))P$.call(e,r)&&Tu(t,r,e[r]);return t},lt=(t,e,r)=>Tu(t,typeof e!="symbol"?e+"":e,r);class xi extends vm{constructor(e,r,i,n=Xt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,lt(this,"map",new Map),lt(this,"version",TD),lt(this,"cached",[]),lt(this,"initialized",!1),lt(this,"getKey"),lt(this,"storagePrefix",Xt),lt(this,"recentlyDeleted",[]),lt(this,"recentlyDeletedLimit",200),lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ue(o)?this.map.set(this.getKey(o),o):GS(o)?this.map.set(o.id,o):YS(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),lt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),lt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),lt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>D$(a[c],o[c]))):this.values)),lt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=S0(S0({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),lt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ge(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=M("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var B$=Object.defineProperty,C$=(t,e,r)=>e in t?B$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J=(t,e,r)=>C$(t,typeof e!="symbol"?e+"":e,r);class T${constructor(e,r){this.core=e,this.logger=r,J(this,"name",FD),J(this,"version",LD),J(this,"events",new je.exports),J(this,"pairings"),J(this,"initialized",!1),J(this,"storagePrefix",Xt),J(this,"ignoredPayloadTypes",[gr]),J(this,"registeredMethods",[]),J(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),J(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),J(this,"create",async i=>{this.isInitialized();const n=fu(),s=await this.core.crypto.setSymKey(n),o=ve(L.FIVE_MINUTES),a={protocol:Gg},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},u=yg({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(bi.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType}),{topic:s,uri:u}}),J(this,"pair",async i=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Qt.pairing_started]}});this.isValidPair(i,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=gg(i.uri);n.props.properties.topic=s,n.addTrace(Qt.pairing_uri_validation_success),n.addTrace(Qt.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(s)){if(h=this.pairings.get(s),n.addTrace(Qt.existing_pairing),h.active)throw n.setError(br.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Qt.pairing_not_expired)}const l=c||ve(L.FIVE_MINUTES),f={topic:s,relay:a,expiry:l,active:!1,methods:u};this.core.expirer.set(s,l),await this.pairings.set(s,f),n.addTrace(Qt.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(bi.create,f),n.addTrace(Qt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Qt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(br.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw n.setError(br.subscribe_pairing_topic_failure),p}return n.addTrace(Qt.subscribe_pairing_topic_success),f}),J(this,"activate",async({topic:i})=>{this.isInitialized();const n=ve(L.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),J(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=di();this.events.once(ne("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),J(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),J(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),J(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),J(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ae("USER_DISCONNECTED")),await this.deletePairing(n))}),J(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return yg({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),J(this,"sendRequest",async(i,n,s)=>{const o=Zr(n,s),a=await this.core.crypto.encode(i,o),c=ls[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),J(this,"sendResult",async(i,n,s)=>{const o=Bo(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=ls[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),J(this,"sendError",async(i,n,s)=>{const o=Co(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=ls[c]?ls[c].res:ls.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),J(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ae("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),J(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(n=>Rr(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),J(this,"onRelayEventRequest",async i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),J(this,"onRelayEventResponse",async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}}),J(this,"onPairingPingRequest",async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(bi.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),J(this,"onPairingPingResponse",(i,n)=>{const{id:s}=n;setTimeout(()=>{Jt(n)?this.events.emit(ne("pairing_ping",s),{}):At(n)&&this.events.emit(ne("pairing_ping",s),{error:n.error})},500)}),J(this,"onPairingDeleteRequest",async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(bi.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),J(this,"onUnknownRpcMethodRequest",async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=ae("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),J(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ae("WC_METHOD_UNSUPPORTED",i))}),J(this,"isValidPair",(i,n)=>{var s;if(!ht(i)){const{message:a}=M("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(br.malformed_pairing_uri),new Error(a)}if(!WS(i.uri)){const{message:a}=M("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(br.malformed_pairing_uri),new Error(a)}const o=gg(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=M("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(br.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=M("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(br.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(br.pairing_expired);const{message:a}=M("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),J(this,"isValidPing",async i=>{if(!ht(i)){const{message:s}=M("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),J(this,"isValidDisconnect",async i=>{if(!ht(i)){const{message:s}=M("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),J(this,"isValidPairingTopic",async i=>{if(!ge(i,!1)){const{message:n}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Rr(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=M("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=Ge(r,this.name),this.pairings=new xi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return rt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on($e.message,async e=>{const{topic:r,message:i,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==le.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(r,i);Eu(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):To(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ot.expired,async e=>{const{topic:r}=Gd(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(bi.expire,{topic:r}))})}}var R$=Object.defineProperty,N$=(t,e,r)=>e in t?R$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ke=(t,e,r)=>N$(t,typeof e!="symbol"?e+"":e,r);class U$ extends ym{constructor(e,r){super(e,r),this.core=e,this.logger=r,ke(this,"records",new Map),ke(this,"events",new je.exports.EventEmitter),ke(this,"name",kD),ke(this,"version",MD),ke(this,"cached",[]),ke(this,"initialized",!1),ke(this,"storagePrefix",Xt),ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ke(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:ve(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Lt.created,o)}),ke(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=At(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(Lt.updated,n))}),ke(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),ke(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(Lt.deleted,s)}}),this.persist()}),ke(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),ke(this,"on",(i,n)=>{this.events.on(i,n)}),ke(this,"once",(i,n)=>{this.events.once(i,n)}),ke(this,"off",(i,n)=>{this.events.off(i,n)}),ke(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=Ge(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Zr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Lt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Lt.created,e=>{const r=Lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Lt.updated,e=>{const r=Lt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Lt.deleted,e=>{const r=Lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(ti.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{L.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Lt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var F$=Object.defineProperty,L$=(t,e,r)=>e in t?F$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,We=(t,e,r)=>L$(t,typeof e!="symbol"?e+"":e,r);class k$ extends xm{constructor(e,r){super(e,r),this.core=e,this.logger=r,We(this,"expirations",new Map),We(this,"events",new je.exports.EventEmitter),We(this,"name",jD),We(this,"version",qD),We(this,"cached",[]),We(this,"initialized",!1),We(this,"storagePrefix",Xt),We(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),We(this,"has",i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),We(this,"set",(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ot.created,{target:s,expiration:o})}),We(this,"get",i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)}),We(this,"del",i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Ot.deleted,{target:n,expiration:s})}}),We(this,"on",(i,n)=>{this.events.on(i,n)}),We(this,"once",(i,n)=>{this.events.once(i,n)}),We(this,"off",(i,n)=>{this.events.off(i,n)}),We(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=Ge(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return N_(e);if(typeof e=="number")return U_(e);const{message:r}=M("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ot.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;L.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Ot.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ti.pulse,()=>this.checkExpirations()),this.events.on(Ot.created,e=>{const r=Ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ot.expired,e=>{const r=Ot.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ot.deleted,e=>{const r=Ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}}var M$=Object.defineProperty,j$=(t,e,r)=>e in t?M$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ye=(t,e,r)=>j$(t,typeof e!="symbol"?e+"":e,r);class q$ extends _m{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,ye(this,"name",zD),ye(this,"abortController"),ye(this,"isDevEnv"),ye(this,"verifyUrlV3",VD),ye(this,"storagePrefix",Xt),ye(this,"version",Vg),ye(this,"publicKey"),ye(this,"fetchPromise"),ye(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ye(this,"register",async n=>{if(!Mi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=oi(),h=this.startAbortTimer(L.ONE_SECOND*5),l=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",v),u.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const v=I=>{if(I.data&&typeof I.data=="string")try{const A=JSON.parse(I.data);if(A.type==="verify_attestation"){if(Aa(A.attestation).payload.id!==o)return;clearInterval(h),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",v),f(A.attestation===null?"":A.attestation)}}catch(A){this.logger.warn(A)}};u.body.appendChild(g),window.addEventListener("message",v,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(u){this.logger.warn(u)}return""}),ye(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Aa(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),ye(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ye(this,"getVerifyUrl",n=>{let s=n||fs;return KD.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${fs}`),s=fs),s}),ye(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(L.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),ye(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),ye(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ye(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ye(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ye(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),ye(this,"validateAttestation",(n,s)=>{const o=AS(n,s.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ge(r,this.name),this.abortController=new AbortController,this.isDevEnv=Pc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return rt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var z$=Object.defineProperty,H$=(t,e,r)=>e in t?z$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,A0=(t,e,r)=>H$(t,typeof e!="symbol"?e+"":e,r);class V$ extends Im{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,A0(this,"context",WD),A0(this,"registerDeviceToken",async i=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${GD}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=Ge(r,this.context)}}var K$=Object.defineProperty,D0=Object.getOwnPropertySymbols,W$=Object.prototype.hasOwnProperty,G$=Object.prototype.propertyIsEnumerable,Ru=(t,e,r)=>e in t?K$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ms=(t,e)=>{for(var r in e||(e={}))W$.call(e,r)&&Ru(t,r,e[r]);if(D0)for(var r of D0(e))G$.call(e,r)&&Ru(t,r,e[r]);return t},Oe=(t,e,r)=>Ru(t,typeof e!="symbol"?e+"":e,r);class Y$ extends Sm{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Oe(this,"context",ZD),Oe(this,"storagePrefix",Xt),Oe(this,"storageVersion",YD),Oe(this,"events",new Map),Oe(this,"shouldPersist",!1),Oe(this,"init",async()=>{if(!Pc())try{const n={eventId:Zd(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Kd(this.core.relayer.protocol,this.core.relayer.version,xu)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Oe(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=Zd(),h=this.core.projectId||"",l=Date.now(),f=ms({eventId:u,timestamp:l,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:h,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),Oe(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ms(ms({},a),this.setMethods(a.eventId))}),Oe(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),Oe(this,"setEventListeners",()=>{this.core.heartbeat.on(ti.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(n.timestamp)>JD&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Oe(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),Oe(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),Oe(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Oe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Oe(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,ms(ms({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),Oe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Oe(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${XD}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${xu}${s}`,{method:"POST",body:JSON.stringify(n)})}),Oe(this,"getAppDomain",()=>Vd().url),this.logger=Ge(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Z$=Object.defineProperty,$0=Object.getOwnPropertySymbols,J$=Object.prototype.hasOwnProperty,X$=Object.prototype.propertyIsEnumerable,Nu=(t,e,r)=>e in t?Z$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,O0=(t,e)=>{for(var r in e||(e={}))J$.call(e,r)&&Nu(t,r,e[r]);if($0)for(var r of $0(e))X$.call(e,r)&&Nu(t,r,e[r]);return t},he=(t,e,r)=>Nu(t,typeof e!="symbol"?e+"":e,r);class Uu extends fm{constructor(e){var r;super(e),he(this,"protocol",Hg),he(this,"version",Vg),he(this,"name",Ro),he(this,"relayUrl"),he(this,"projectId"),he(this,"customStoragePrefix"),he(this,"events",new je.exports.EventEmitter),he(this,"logger"),he(this,"heartbeat"),he(this,"relayer"),he(this,"crypto"),he(this,"storage"),he(this,"history"),he(this,"expirer"),he(this,"pairing"),he(this,"verify"),he(this,"echoClient"),he(this,"linkModeSupportedApps"),he(this,"eventClient"),he(this,"initialized",!1),he(this,"logChunkController"),he(this,"on",(a,c)=>this.events.on(a,c)),he(this,"once",(a,c)=>this.events.once(a,c)),he(this,"off",(a,c)=>this.events.off(a,c)),he(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),he(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const h={topic:a,message:c,publishedAt:Date.now(),transportType:le.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:u})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Yg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=Ps({level:typeof e?.logger=="string"&&e.logger?e.logger:vD.logger,name:Ro}),{logger:s,chunkLoggerController:o}=um({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ge(s,this.name),this.heartbeat=new Qo,this.crypto=new A4(this,this.logger,e?.keychain),this.history=new U$(this,this.logger),this.expirer=new k$(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Nw(O0(O0({},ED),e?.storageOptions)),this.relayer=new Q4({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new T$(this,this.logger),this.verify=new q$(this,this.logger,this.storage),this.echoClient=new V$(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Y$(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new Uu(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(RD,i),r}get context(){return rt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Zg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Zg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const Q$=Uu,P0="wc",B0=2,C0="client",Fu=`${P0}@${B0}:${C0}:`,Lu={name:C0,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},T0="WALLETCONNECT_DEEPLINK_CHOICE",eO="proposal",R0="Proposal expired",tO="session",Gi=L.SEVEN_DAYS,rO="engine",Pe={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},ku={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},tr={idle:"IDLE",active:"ACTIVE"},iO={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},nO="request",sO=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],oO="wc",aO="auth",cO="authKeys",uO="pairingTopics",hO="requests",Lo=`${oO}@${1.5}:${aO}:`,ko=`${Lo}:PUB_KEY`;var lO=Object.defineProperty,fO=Object.defineProperties,dO=Object.getOwnPropertyDescriptors,N0=Object.getOwnPropertySymbols,pO=Object.prototype.hasOwnProperty,gO=Object.prototype.propertyIsEnumerable,Mu=(t,e,r)=>e in t?lO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e)=>{for(var r in e||(e={}))pO.call(e,r)&&Mu(t,r,e[r]);if(N0)for(var r of N0(e))gO.call(e,r)&&Mu(t,r,e[r]);return t},ft=(t,e)=>fO(t,dO(e)),F=(t,e,r)=>Mu(t,typeof e!="symbol"?e+"":e,r);class yO extends Om{constructor(e){super(e),F(this,"name",rO),F(this,"events",new je.exports),F(this,"initialized",!1),F(this,"requestQueue",{state:tr.idle,queue:[]}),F(this,"sessionRequestQueue",{state:tr.idle,queue:[]}),F(this,"requestQueueDelay",L.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Pe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=ft(fe({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=qS(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=i;let h=n,l,f=!1;try{if(h){const $=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),$}if(!h||!f){const{topic:$,uri:D}=await this.client.core.pairing.create();h=$,l=D}if(!h){const{message:$}=M("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error($)}const p=await this.client.core.crypto.generateKeyPair(),d=Pe.wc_sessionPropose.req.ttl||L.FIVE_MINUTES,g=ve(d),v=ft(fe(fe({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:Gg}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:h},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Zt()}),I=ne("session_connect",v.id),{reject:A,resolve:b,done:m}=di(d,R0),x=({id:$})=>{$===v.id&&(this.client.events.off("proposal_expire",x),this.pendingSessions.delete(v.id),this.events.emit(I,{error:{message:R0,code:0}}))};return this.client.events.on("proposal_expire",x),this.events.once(I,({error:$,session:D})=>{this.client.events.off("proposal_expire",x),$?A($):D&&b(D)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:v,throwOnFailedPublish:!0,clientRpcId:v.id}),await this.setProposal(v.id,v),{uri:l,approval:m}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),F(this,"approve",async r=>{var i,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[kt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(P){throw o.setError(vi.no_internet_connection),P}try{await this.isValidProposalId(r?.id)}catch(P){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(vi.proposal_not_found),P}try{await this.isValidApprove(r)}catch(P){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(vi.session_approve_namespace_validation_failure),P}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:f}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:g,requiredNamespaces:v,optionalNamespaces:I}=p;let A=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:d});A||(A=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:kt.session_approve_started,properties:{topic:d,trace:[kt.session_approve_started,kt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),m=g.publicKey,x=await this.client.core.crypto.generateSharedKey(b,m),$=fe(fe(fe({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:b,metadata:this.client.metadata},expiry:ve(Gi)},h&&{sessionProperties:h}),l&&{scopedProperties:l}),f&&{sessionConfig:f}),D=le.relay;A.addTrace(kt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(x,{transportType:D})}catch(P){throw A.setError(vi.subscribe_session_topic_failure),P}A.addTrace(kt.subscribe_session_topic_success);const B=ft(fe({},$),{topic:x,requiredNamespaces:v,optionalNamespaces:I,pairingTopic:d,acknowledged:!1,self:$.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:le.relay});await this.client.session.set(x,B),A.addTrace(kt.store_session);try{A.addTrace(kt.publishing_session_settle),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:$,throwOnFailedPublish:!0}).catch(P=>{throw A?.setError(vi.session_settle_publish_failure),P}),A.addTrace(kt.session_settle_publish_success),A.addTrace(kt.publishing_session_approve),await this.sendResult({id:a,topic:d,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(P=>{throw A?.setError(vi.session_approve_publish_failure),P}),A.addTrace(kt.session_approve_publish_success)}catch(P){throw this.client.logger.error(P),this.client.session.delete(x,ae("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(x),P}return this.client.core.eventClient.deleteEvent({eventId:A.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.client.proposal.delete(a,ae("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(x,ve(Gi)),{topic:x,acknowledged:()=>Promise.resolve(this.client.session.get(x))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&(await this.sendError({id:i,topic:s,error:n,rpcOpts:Pe.wc_sessionPropose.reject}),await this.client.proposal.delete(i,ae("USER_DISCONNECTED")))}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:n}=r,{done:s,resolve:o,reject:a}=di(),c=Zt(),u=mi().toString(),h=this.client.session.get(i).namespaces;return this.events.once(ne("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:h}),a(l)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,n=Zt(),{done:s,resolve:o,reject:a}=di();return this.events.once(ne("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,ve(Gi)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:i,request:n,topic:s,expiry:o=Pe.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);a?.transportType===le.relay&&await this.confirmOnlineStateOrThrow();const c=Zt(),u=mi().toString(),{done:h,resolve:l,reject:f}=di(o,"Request expired. Please try again.");this.events.once(ne("session_request",c),({error:v,result:I})=>{v?f(v):l(I)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:ft(fe({},n),{expiryTimestamp:ve(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(v=>f(v)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await h();const g={request:ft(fe({},n),{expiryTimestamp:ve(o)}),chainId:i};return await Promise.all([new Promise(async v=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(I=>f(I)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),v()}),new Promise(async v=>{var I;if(!((I=a.sessionConfig)!=null&&I.disableDeepLink)){const A=await M_(this.client.core.storage,T0);await F_({id:c,topic:s,wcDeepLink:A})}v()}),h()]).then(v=>v[2])}),F(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n,o=this.client.session.get(i);o.transportType===le.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Jt(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0,appLink:a}):At(n)&&await this.sendError({id:s,topic:i,error:n.error,appLink:a}),this.cleanupAfterResponse(r)}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=Zt(),s=mi().toString(),{done:o,resolve:a,reject:c}=di();this.events.once(ne("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,o=mi().toString(),a=Zt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ae("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=M("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>VS(i,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?le.link_mode:le.relay;o===le.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:h,nonce:l,type:f,exp:p,nbf:d,methods:g=[],expiry:v}=r,I=[...r.resources||[]],{topic:A,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:A,uri:b}});const m=await this.client.core.crypto.generateKeyPair(),x=Ao(m);if(await Promise.all([this.client.auth.authKeys.set(ko,{responseTopic:x,publicKey:m}),this.client.auth.pairingTopics.set(x,{topic:x,pairingTopic:A})]),await this.client.core.relayer.subscribe(x,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${A}`),g.length>0){const{namespace:_}=ki(a[0]);let S=tI(_,"request",g);yo(I)&&(S=iI(S,I.pop())),I.push(S)}const $=v&&v>Pe.wc_sessionAuthenticate.req.ttl?v:Pe.wc_sessionAuthenticate.req.ttl,D={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:h,version:"1",nonce:l,iat:new Date().toISOString(),exp:p,nbf:d,resources:I},requester:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:ve($)},B={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},P={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:A,proposer:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:ve(Pe.wc_sessionPropose.req.ttl),id:Zt()},{done:U,resolve:C,reject:R}=di($,"Request expired"),T=Zt(),j=ne("session_connect",P.id),y=ne("session_request",T),w=async({error:_,session:S})=>{this.events.off(y,E),_?R(_):S&&C({session:S})},E=async _=>{var S,N,k;if(await this.deletePendingAuthRequest(T,{message:"fulfilled",code:0}),_.error){const W=ae("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===W.code?void 0:(this.events.off(j,w),R(_.error.message))}await this.deleteProposal(P.id),this.events.off(j,w);const{cacaos:H,responder:q}=_.result,V=[],K=[];for(const W of H){await mp({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),R(ae("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:de}=W,we=yo(de.resources),xe=[Mc(de.iss)],_e=go(de.iss);if(we){const me=Ep(we),Me=xp(we);V.push(...me),xe.push(...Me)}for(const me of xe)K.push(`${me}:${_e}`)}const G=await this.client.core.crypto.generateSharedKey(m,q.publicKey);let Q;V.length>0&&(Q={topic:G,acknowledged:!0,self:{publicKey:m,metadata:this.client.metadata},peer:q,controller:q.publicKey,expiry:ve(Gi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:A,namespaces:vg([...new Set(V)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Q),A&&await this.client.core.pairing.updateMetadata({topic:A,metadata:q.metadata}),Q=this.client.session.get(G)),(S=this.client.metadata.redirect)!=null&&S.linkMode&&(N=q.metadata.redirect)!=null&&N.linkMode&&(k=q.metadata.redirect)!=null&&k.universal&&i&&(this.client.core.addLinkModeSupportedApp(q.metadata.redirect.universal),this.client.session.update(G,{transportType:le.link_mode})),C({auths:H,session:Q})};this.events.once(j,w),this.events.once(y,E);let O;try{if(s){const _=Zr("wc_sessionAuthenticate",D,T);this.client.core.history.set(A,_);const S=await this.client.core.crypto.encode("",_,{type:ns,encoding:Gr});O=$o(i,A,S)}else await Promise.all([this.sendRequest({topic:A,method:"wc_sessionAuthenticate",params:D,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:T}),this.sendRequest({topic:A,method:"wc_sessionPropose",params:P,expiry:Pe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:P.id})])}catch(_){throw this.events.off(j,w),this.events.off(y,E),_}return await this.setProposal(P.id,P),await this.setAuthRequest(T,{request:ft(fe({},D),{verifyContext:{}}),pairingTopic:A,transportType:o}),{uri:O??b,response:U}}),F(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:n}=r,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Ei.authenticated_session_approve_started]}});try{this.isInitialized()}catch(v){throw s.setError(ds.no_internet_connection),v}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(ds.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||le.relay;a===le.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),h=Ao(c),l={type:gr,receiverPublicKey:c,senderPublicKey:u},f=[],p=[];for(const v of n){if(!await mp({cacao:v,projectId:this.client.core.projectId})){s.setError(ds.invalid_cacao);const x=ae("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:h,error:x,encodeOpts:l}),new Error(x.message)}s.addTrace(Ei.cacaos_verified);const{p:I}=v,A=yo(I.resources),b=[Mc(I.iss)],m=go(I.iss);if(A){const x=Ep(A),$=xp(A);f.push(...x),b.push(...$)}for(const x of b)p.push(`${x}:${m}`)}const d=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Ei.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:ve(Gi),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:vg([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(Ei.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(v){throw s.setError(ds.subscribe_authenticated_session_topic_failure),v}s.addTrace(Ei.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),s.addTrace(Ei.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Ei.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:i,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(v){throw s.setError(ds.authenticated_session_approve_publish_failure),v}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:n}=r,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===le.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ao(o),u={type:gr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:u,rpcOpts:Pe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,ae("USER_DISCONNECTED"))}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:n}=r;return bp(i,n)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),F(this,"deleteSession",async r=>{var i;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,ae("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(T0).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,ae("USER_DISCONNECTED"))}),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=tr.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),F(this,"deleteProposal",async(r,i)=>{if(i)try{const n=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:n.pairingTopic});s?.setError(vi.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ae("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=tr.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),F(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,ve(Pe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),F(this,"setAuthRequest",async(r,i)=>{const{request:n,pairingTopic:s,transportType:o=le.relay}=i;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:i,topic:n,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||ve(Pe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:h,tvf:l}=r,f=Zr(n,s,c);let p;const d=!!h;try{const I=d?Gr:Ft;p=await this.client.core.crypto.encode(i,f,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),I}let g;if(sO.includes(n)){const I=Yt(JSON.stringify(f)),A=Yt(p);g=await this.client.core.verify.register({id:A,decryptedId:I})}const v=Pe[n].req;if(v.attestation=g,o&&(v.ttl=o),a&&(v.id=a),this.client.core.history.set(i,f),d){const I=$o(h,i,p);await global.Linking.openURL(I,this.client.name)}else{const I=Pe[n].req;o&&(I.ttl=o),a&&(I.id=a),I.tvf=ft(fe({},l),{correlationId:f.id}),u?(I.internal=ft(fe({},I.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,p,I)):this.client.core.relayer.publish(i,p,I).catch(A=>this.client.logger.error(A))}return f.id}),F(this,"sendResult",async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=Bo(i,s);let h;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=l?Gr:Ft;h=await this.client.core.crypto.encode(n,u,ft(fe({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),d}let f,p;try{f=await this.client.core.history.get(n,i);const d=f.request;try{p=this.getTVFParams(i,d.params,s)}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),d}if(l){const d=$o(c,n,h);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Pe[d].res;g.tvf=ft(fe({},p),{correlationId:i}),o?(g.internal=ft(fe({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,h,g)):this.client.core.relayer.publish(n,h,g).catch(v=>this.client.logger.error(v))}await this.client.core.history.resolve(u)}),F(this,"sendError",async r=>{const{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=Co(i,s);let h;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=l?Gr:Ft;h=await this.client.core.crypto.encode(n,u,ft(fe({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let f;try{f=await this.client.core.history.get(n,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),p}if(l){const p=$o(c,n,h);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Pe[p].res;this.client.core.relayer.publish(n,h,d)}await this.client.core.history.resolve(u)}),F(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;Rr(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Rr(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===tr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=tr.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=tr.idle}),F(this,"processRequest",async r=>{const{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n,transportType:s}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:n}=M("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:n}=r,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:n,attestation:s,encryptedId:o}=r,{params:a,id:c}=n;try{const u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(br.proposal_listener_not_found)),this.isValidConnect(fe({},n.params));const h=a.expiryTimestamp||ve(Pe.wc_sessionPropose.req.ttl),l=fe({id:c,pairingTopic:i,expiryTimestamp:h},a);await this.setProposal(c,l);const f=await this.getVerifyContext({attestationId:s,hash:Yt(JSON.stringify(n)),encryptedId:o,metadata:l.proposer.metadata});u?.addTrace(Qt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:f})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:Pe.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),F(this,"onSessionProposeResponse",async(r,i,n)=>{const{id:s}=i;if(Jt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const h=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:h,pairingTopic:r,proposalId:s,publicKey:c});const l=await this.client.core.relayer.subscribe(h,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else if(At(i)){await this.client.proposal.delete(s,ae("USER_DISCONNECTED"));const o=ne("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),F(this,"onSessionSettleRequest",async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:f}=i.params,p=[...this.pendingSessions.values()].find(v=>v.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const d=this.client.proposal.get(p.proposalId),g=ft(fe(fe(fe({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),l&&{scopedProperties:l}),f&&{sessionConfig:f}),{transportType:le.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(ne("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,i)=>{const{id:n}=i;Jt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ne("session_approve",n),{})):At(i)&&(await this.client.session.delete(r,ae("USER_DISCONNECTED")),this.events.emit(ne("session_approve",n),{error:i.error}))}),F(this,"onSessionUpdateRequest",async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,a=cs.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:ae("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(fe({topic:r},n));try{cs.set(o,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw cs.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,i)=>{const{id:n}=i,s=ne("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Jt(i)?this.events.emit(ne("session_update",n),{}):At(i)&&this.events.emit(ne("session_update",n),{error:i.error})}),F(this,"onSessionExtendRequest",async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ve(Gi)),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,i)=>{const{id:n}=i,s=ne("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Jt(i)?this.events.emit(ne("session_extend",n),{}):At(i)&&this.events.emit(ne("session_extend",n),{error:i.error})}),F(this,"onSessionPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,i)=>{const{id:n}=i,s=ne("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Jt(i)?this.events.emit(ne("session_ping",n),{}):At(i)&&this.events.emit(ne("session_ping",n),{error:i.error})},500)}),F(this,"onSessionDeleteRequest",async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once($e.publish,async()=>{s(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ae("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var i,n,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:h}=r,{id:l,params:f}=a;try{await this.isValidRequest(fe({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:Yt(JSON.stringify(Zr("wc_sessionRequest",f,l))),encryptedId:u,metadata:p.peer.metadata,transportType:h}),g={id:l,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),h===le.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:l,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,i)=>{const{id:n}=i,s=ne("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Jt(i)?this.events.emit(ne("session_request",n),{result:i.result}):At(i)&&this.events.emit(ne("session_request",n),{error:i.error})}),F(this,"onSessionEventRequest",async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,a=cs.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(fe({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),cs.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Jt(i)?this.events.emit(ne("session_request",n),{result:i.result}):At(i)&&this.events.emit(ne("session_request",n),{error:i.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:h,expiryTimestamp:l}=s.params,f=await this.getVerifyContext({attestationId:o,hash:Yt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:n,id:s.id,authPayload:h,verifyContext:f,expiryTimestamp:l};await this.setAuthRequest(s.id,{request:p,pairingTopic:n,transportType:c}),c===le.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:f})}catch(u){this.client.logger.error(u);const h=s.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:gr,receiverPublicKey:h,senderPublicKey:l};await this.sendError({id:s.id,topic:n,error:u,encodeOpts:p,rpcOpts:Pe.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=tr.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=ne("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ne("session_request",s.request.id),{error:i})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===tr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=tr.active,this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),F(this,"emitSessionRequest",r=>{this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:Zr("wc_sessionPropose",ft(fe({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),F(this,"isValidConnect",async r=>{if(!ht(r)){const{message:u}=M("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ue(i)||await this.isValidPairingTopic(i),!iA(c,!0)){const{message:u}=M("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Ue(n)&&Yr(n)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(n,"requiredNamespaces")}if(!Ue(s)&&Yr(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Ue(o)||this.validateSessionProps(o,"sessionProperties"),!Ue(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(h=>u.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),F(this,"validateNamespaces",(r,i)=>{const n=rA(r,"connect()",i);if(n)throw new Error(n.message)}),F(this,"isValidApprove",async r=>{if(!ht(r))throw new Error(M("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=pu(n,"approve()");if(u)throw new Error(u.message);const h=Sg(c.requiredNamespaces,n,"approve()");if(h)throw new Error(h.message);if(!ge(s,!0)){const{message:l}=M("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(l)}if(Ue(o)||this.validateSessionProps(o,"sessionProperties"),!Ue(a)){this.validateSessionProps(a,"scopedProperties");const l=new Set(Object.keys(n));if(!Object.keys(a).every(f=>l.has(f)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!ht(r)){const{message:s}=M("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!sA(n)){const{message:s}=M("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!ht(r)){const{message:u}=M("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!_g(i)){const{message:u}=M("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=ZS(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=pu(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Rr(o)){const{message:u}=M("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),F(this,"isValidUpdate",async r=>{if(!ht(r)){const{message:c}=M("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=pu(n,"update()");if(o)throw new Error(o.message);const a=Sg(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!ht(r)){const{message:n}=M("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),F(this,"isValidRequest",async r=>{if(!ht(r)){const{message:c}=M("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:n,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Ig(a,s)){const{message:c}=M("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!oA(n)){const{message:c}=M("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!uA(a,s,n.method)){const{message:c}=M("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!dA(o,ku)){const{message:c}=M("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${ku.min} and ${ku.max}`);throw new Error(c)}}),F(this,"isValidRespond",async r=>{var i;if(!ht(r)){const{message:o}=M("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(o){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!aA(s)){const{message:o}=M("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),F(this,"isValidPing",async r=>{if(!ht(r)){const{message:n}=M("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidEmit",async r=>{if(!ht(r)){const{message:a}=M("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Ig(o,s)){const{message:a}=M("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!cA(n)){const{message:a}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!hA(o,s,n.name)){const{message:a}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!ht(r)){const{message:n}=M("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidAuthenticate",r=>{const{chains:i,uri:n,domain:s,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(n,!1))throw new Error("uri is required parameter");if(!ge(s,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>ki(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ki(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||fs,validation:"UNKNOWN",origin:o.url||""}};try{if(a===le.link_mode){const h=this.getAppLinkIfEnabled(o,a);return c.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((n,s)=>{if(n==null){const{message:o}=M("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),F(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=M("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}),F(this,"isLinkModeEnabled",(r,i)=>{var n,s,o,a,c,u,h,l,f;return!r||i!==le.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((h=r?.redirect)==null?void 0:h.universal)!==void 0&&((l=r?.redirect)==null?void 0:l.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,i)=>{var n;return this.isLinkModeEnabled(r,i)?(n=r?.redirect)==null?void 0:n.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Yd(r,"topic")||"",n=decodeURIComponent(Yd(r,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:le.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Pc()||Cr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),F(this,"getTVFParams",(r,i,n)=>{var s,o;const a={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const c=this.extractTxHashesFromResult(i.request,n);a.txHashes=c,a.contractAddresses=this.isValidContractData(i.request.params)?[(o=(s=i.request.params)==null?void 0:s[0])==null?void 0:o.to]:[]}catch(c){this.client.logger.warn("Error getting TVF params",c)}return a}),F(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const n=r?.data||((i=r?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,i)=>{var n;try{if(!i)return[];const s=r.method,o=iO[s];if(s==="sui_signTransaction")return[k8(i.transactionBytes)];if(s==="near_signTransaction")return[pp(i)];if(s==="near_signTransactions")return i.map(c=>pp(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(n=i.tx_json)==null?void 0:n.hash];if(s==="polkadot_signTransaction")return[$A({transaction:r.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return yr(i)?i.map(c=>gp(c)):[gp(i)];if(s==="cosmos_signDirect")return[j8(i)];if(typeof i=="string")return[i];const a=i[o.key];if(yr(a))return s==="solana_signAllTransactions"?a.map(c=>L8(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,n]of Object.entries(r))for(const s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on($e.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(ko)?this.client.auth.authKeys.get(ko):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:s===le.link_mode?Gr:Ft});Eu(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:s,encryptedId:Yt(i)})):To(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Ot.expired,async e=>{const{topic:r,id:i}=Gd(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,M("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,M("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(bi.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(bi.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:r}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Rr(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=M("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:r}=M("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=M("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Rr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=M("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=M("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:r}=M("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=M("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!nA(e)){const{message:r}=M("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=M("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Rr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=M("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class wO extends xi{constructor(e,r){super(e,r,eO,Fu),this.core=e,this.logger=r}}class mO extends xi{constructor(e,r){super(e,r,tO,Fu),this.core=e,this.logger=r}}class bO extends xi{constructor(e,r){super(e,r,nO,Fu,i=>i.id),this.core=e,this.logger=r}}class vO extends xi{constructor(e,r){super(e,r,cO,Lo,()=>ko),this.core=e,this.logger=r}}class EO extends xi{constructor(e,r){super(e,r,uO,Lo),this.core=e,this.logger=r}}class xO extends xi{constructor(e,r){super(e,r,hO,Lo,i=>i.id),this.core=e,this.logger=r}}var _O=Object.defineProperty,IO=(t,e,r)=>e in t?_O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ju=(t,e,r)=>IO(t,typeof e!="symbol"?e+"":e,r);class SO{constructor(e,r){this.core=e,this.logger=r,ju(this,"authKeys"),ju(this,"pairingTopics"),ju(this,"requests"),this.authKeys=new vO(this.core,this.logger),this.pairingTopics=new EO(this.core,this.logger),this.requests=new xO(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var AO=Object.defineProperty,DO=(t,e,r)=>e in t?AO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>DO(t,typeof e!="symbol"?e+"":e,r);class qu extends $m{constructor(e){super(e),X(this,"protocol",P0),X(this,"version",B0),X(this,"name",Lu.name),X(this,"metadata"),X(this,"core"),X(this,"logger"),X(this,"events",new je.exports.EventEmitter),X(this,"engine"),X(this,"session"),X(this,"proposal"),X(this,"pendingRequest"),X(this,"auth"),X(this,"signConfig"),X(this,"on",(i,n)=>this.events.on(i,n)),X(this,"once",(i,n)=>this.events.once(i,n)),X(this,"off",(i,n)=>this.events.off(i,n)),X(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),X(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),X(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),X(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),X(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),X(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||Lu.name,this.metadata=B_(e?.metadata),this.signConfig=e?.signConfig;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:qt(Ps({level:e?.logger||Lu.logger}));this.core=e?.core||new Q$(e),this.logger=Ge(r,this.name),this.session=new mO(this.core,this.logger),this.proposal=new wO(this.core,this.logger),this.pendingRequest=new bO(this.core,this.logger),this.engine=new yO(this),this.auth=new SO(this.core,this.logger)}static async init(e){const r=new qu(e);return await r.initialize(),r}get context(){return rt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},L.toMiliseconds(L.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const U0="error",$O="wss://relay.walletconnect.org",OO="wc",PO="universal_provider",Mo=`${OO}@2:${PO}:`,F0="https://rpc.walletconnect.org/v1/",Yi="generic",BO=`${F0}bundler`,Pt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function L0(t){return typeof t=="object"&&t!==null}function zu(t){return t==null||typeof t!="object"&&typeof t!="function"}function k0(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function M0(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const CO="[object RegExp]",j0="[object String]",q0="[object Number]",z0="[object Boolean]",H0="[object Arguments]",TO="[object Symbol]",RO="[object Date]",NO="[object Map]",UO="[object Set]",FO="[object Array]",LO="[object ArrayBuffer]",kO="[object Object]",MO="[object DataView]",jO="[object Uint8Array]",qO="[object Uint8ClampedArray]",zO="[object Uint16Array]",HO="[object Uint32Array]",VO="[object Int8Array]",KO="[object Int16Array]",WO="[object Int32Array]",GO="[object Float32Array]",YO="[object Float64Array]";function Hu(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ZO(t,e){return Zi(t,void 0,t,new Map,e)}function Zi(t,e,r,i=new Map,n=void 0){const s=n?.(t,e,r,i);if(s!=null)return s;if(zu(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=Zi(t[a],a,r,i,n);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,Zi(c,a,r,i,n));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(Zi(a,void 0,r,i,n));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Hu(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=Zi(t[a],a,r,i,n);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),_i(o,t,r,i,n),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),_i(o,t,r,i,n),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),_i(o,t,r,i,n),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,_i(o,t,r,i,n),o}if(typeof t=="object"&&JO(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),_i(o,t,r,i,n),o}return t}function _i(t,e,r=t,i,n){const s=[...Object.keys(e),...k0(e)];for(let o=0;o<s.length;o++){const a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Zi(e[a],a,r,i,n))}}function JO(t){switch(M0(t)){case H0:case FO:case LO:case MO:case z0:case RO:case GO:case YO:case VO:case KO:case WO:case NO:case q0:case kO:case CO:case UO:case j0:case TO:case jO:case qO:case zO:case HO:return!0;default:return!1}}function XO(t,e){return ZO(t,(r,i,n,s)=>{const o=e?.(r,i,n,s);if(o!=null)return o;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case q0:case j0:case z0:{const a=new t.constructor(t?.valueOf());return _i(a,t),a}case H0:{const a={};return _i(a,t),a.length=t.length,a[Symbol.iterator]=t[Symbol.iterator],a}default:return}})}function V0(t){return XO(t)}function K0(t){return t!==null&&typeof t=="object"&&M0(t)==="[object Arguments]"}function QO(t){return Hu(t)}function eP(){}function tP(t){if(zu(t))return t;if(Array.isArray(t)||Hu(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const i=new r(t.message);return i.stack=t.stack,i.name=t.name,i.cause=t.cause,i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function rP(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function iP(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let n=t;for(let s=0;s<r.length;s++){const o=r[s];n=jo(n,o,i,new Map)}return n}function jo(t,e,r,i){if(zu(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return tP(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}const n=[...Object.keys(e),...k0(e)];for(let s=0;s<n.length;s++){const o=n[s];let a=e[o],c=t[o];if(K0(a)&&(a={...a}),K0(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=V0(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const h=[],l=Reflect.ownKeys(c);for(let f=0;f<l.length;f++){const p=l[f];h[p]=c[p]}c=h}else c=[];const u=r(c,a,o,t,e,i);u!=null?t[o]=u:Array.isArray(a)||L0(c)&&L0(a)?t[o]=jo(c,a,r,i):c==null&&rP(a)?t[o]=jo({},a,r,i):c==null&&QO(a)?t[o]=V0(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function nP(t,...e){return iP(t,...e,eP)}var sP=Object.defineProperty,oP=Object.defineProperties,aP=Object.getOwnPropertyDescriptors,W0=Object.getOwnPropertySymbols,cP=Object.prototype.hasOwnProperty,uP=Object.prototype.propertyIsEnumerable,G0=(t,e,r)=>e in t?sP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qo=(t,e)=>{for(var r in e||(e={}))cP.call(e,r)&&G0(t,r,e[r]);if(W0)for(var r of W0(e))uP.call(e,r)&&G0(t,r,e[r]);return t},hP=(t,e)=>oP(t,aP(e));function vt(t,e,r){var i;const n=ki(t);return((i=e.rpcMap)==null?void 0:i[n.reference])||`${F0}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function Ii(t){return t.includes(":")?t.split(":")[1]:t}function Y0(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function lP(t,e){const r=Object.keys(e.namespaces).filter(n=>n.includes(t));if(!r.length)return[];const i=[];return r.forEach(n=>{const s=e.namespaces[n].accounts;i.push(...s)}),i}function zo(t={},e={}){const r=Z0(t),i=Z0(e);return nP(r,i)}function Z0(t){var e,r,i,n,s;const o={};if(!Yr(t))return o;for(const[a,c]of Object.entries(t)){const u=Oo(a)?[a]:c.chains,h=c.methods||[],l=c.events||[],f=c.rpcMap||{},p=Ki(a);o[p]=hP(qo(qo({},o[p]),c),{chains:Wt(u,(e=o[p])==null?void 0:e.chains),methods:Wt(h,(r=o[p])==null?void 0:r.methods),events:Wt(l,(i=o[p])==null?void 0:i.events)}),(Yr(f)||Yr(((n=o[p])==null?void 0:n.rpcMap)||{}))&&(o[p].rpcMap=qo(qo({},f),(s=o[p])==null?void 0:s.rpcMap))}return o}function J0(t){return t.includes(":")?t.split(":")[2]:t}function X0(t){const e={};for(const[r,i]of Object.entries(t)){const n=i.methods||[],s=i.events||[],o=i.accounts||[],a=Oo(r)?[r]:i.chains?i.chains:Y0(i.accounts);e[r]={chains:a,methods:n,events:s,accounts:o}}return e}function Vu(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const Q0={},ie=t=>Q0[t],Ku=(t,e)=>{Q0[t]=e};var Wu={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof et<"u"&&et,i=function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s}();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof et<"u"&&et||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function u(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(y){return y&&h.indexOf(Object.prototype.toString.call(y))>-1};function f(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function p(y){return typeof y!="string"&&(y=String(y)),y}function d(y){var w={next:function(){var E=y.shift();return{done:E===void 0,value:E}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function g(y){this.map={},y instanceof g?y.forEach(function(w,E){this.append(E,w)},this):Array.isArray(y)?y.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(w){this.append(w,y[w])},this)}g.prototype.append=function(y,w){y=f(y),w=p(w);var E=this.map[y];this.map[y]=E?E+", "+w:w},g.prototype.delete=function(y){delete this.map[f(y)]},g.prototype.get=function(y){return y=f(y),this.has(y)?this.map[y]:null},g.prototype.has=function(y){return this.map.hasOwnProperty(f(y))},g.prototype.set=function(y,w){this.map[f(y)]=p(w)},g.prototype.forEach=function(y,w){for(var E in this.map)this.map.hasOwnProperty(E)&&y.call(w,this.map[E],E,this)},g.prototype.keys=function(){var y=[];return this.forEach(function(w,E){y.push(E)}),d(y)},g.prototype.values=function(){var y=[];return this.forEach(function(w){y.push(w)}),d(y)},g.prototype.entries=function(){var y=[];return this.forEach(function(w,E){y.push([E,w])}),d(y)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function v(y){if(!y._noBody){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}}function I(y){return new Promise(function(w,E){y.onload=function(){w(y.result)},y.onerror=function(){E(y.error)}})}function A(y){var w=new FileReader,E=I(w);return w.readAsArrayBuffer(y),E}function b(y){var w=new FileReader,E=I(w),O=/charset=([A-Za-z0-9_-]+)/.exec(y.type),_=O?O[1]:"utf-8";return w.readAsText(y,_),E}function m(y){for(var w=new Uint8Array(y),E=new Array(w.length),O=0;O<w.length;O++)E[O]=String.fromCharCode(w[O]);return E.join("")}function x(y){if(y.slice)return y.slice(0);var w=new Uint8Array(y.byteLength);return w.set(new Uint8Array(y)),w.buffer}function $(){return this.bodyUsed=!1,this._initBody=function(y){this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&u(y)?(this._bodyArrayBuffer=x(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||l(y))?this._bodyArrayBuffer=x(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=v(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=v(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(A);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var y=v(this);if(y)return y;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(U)}),this.json=function(){return this.text().then(JSON.parse)},this}var D=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function B(y){var w=y.toUpperCase();return D.indexOf(w)>-1?w:y}function P(y,w){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var E=w.body;if(y instanceof P){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,w.headers||(this.headers=new g(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!E&&y._bodyInit!=null&&(E=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new g(w.headers)),this.method=B(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||function(){if("AbortController"in a){var S=new AbortController;return S.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(E),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var O=/([?&])_=[^&]*/;if(O.test(this.url))this.url=this.url.replace(O,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function U(y){var w=new FormData;return y.trim().split("&").forEach(function(E){if(E){var O=E.split("="),_=O.shift().replace(/\+/g," "),S=O.join("=").replace(/\+/g," ");w.append(decodeURIComponent(_),decodeURIComponent(S))}}),w}function C(y){var w=new g,E=y.replace(/\r?\n[\t ]+/g," ");return E.split("\r").map(function(O){return O.indexOf(`
`)===0?O.substr(1,O.length):O}).forEach(function(O){var _=O.split(":"),S=_.shift().trim();if(S){var N=_.join(":").trim();try{w.append(S,N)}catch(k){console.warn("Response "+k.message)}}}),w}$.call(P.prototype);function R(y,w){if(!(this instanceof R))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new g(w.headers),this.url=w.url||"",this._initBody(y)}$.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},R.error=function(){var y=new R(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var T=[301,302,303,307,308];R.redirect=function(y,w){if(T.indexOf(w)===-1)throw new RangeError("Invalid status code");return new R(null,{status:w,headers:{location:y}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,E){this.message=w,this.name=E;var O=Error(w);this.stack=O.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function j(y,w){return new Promise(function(E,O){var _=new P(y,w);if(_.signal&&_.signal.aborted)return O(new o.DOMException("Aborted","AbortError"));var S=new XMLHttpRequest;function N(){S.abort()}S.onload=function(){var q={statusText:S.statusText,headers:C(S.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&(S.status<200||S.status>599)?q.status=200:q.status=S.status,q.url="responseURL"in S?S.responseURL:q.headers.get("X-Request-URL");var V="response"in S?S.response:S.responseText;setTimeout(function(){E(new R(V,q))},0)},S.onerror=function(){setTimeout(function(){O(new TypeError("Network request failed"))},0)},S.ontimeout=function(){setTimeout(function(){O(new TypeError("Network request timed out"))},0)},S.onabort=function(){setTimeout(function(){O(new o.DOMException("Aborted","AbortError"))},0)};function k(q){try{return q===""&&a.location.href?a.location.href:q}catch{return q}}if(S.open(_.method,k(_.url),!0),_.credentials==="include"?S.withCredentials=!0:_.credentials==="omit"&&(S.withCredentials=!1),"responseType"in S&&(c.blob?S.responseType="blob":c.arrayBuffer&&(S.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof g||a.Headers&&w.headers instanceof a.Headers)){var H=[];Object.getOwnPropertyNames(w.headers).forEach(function(q){H.push(f(q)),S.setRequestHeader(q,p(w.headers[q]))}),_.headers.forEach(function(q,V){H.indexOf(V)===-1&&S.setRequestHeader(V,q)})}else _.headers.forEach(function(q,V){S.setRequestHeader(V,q)});_.signal&&(_.signal.addEventListener("abort",N),S.onreadystatechange=function(){S.readyState===4&&_.signal.removeEventListener("abort",N)}),S.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return j.polyfill=!0,a.fetch||(a.fetch=j,a.Headers=g,a.Request=P,a.Response=R),o.Headers=g,o.Request=P,o.Response=R,o.fetch=j,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var n=r.fetch?r:i;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e})(Wu,Wu.exports);var ey=my(Wu.exports),fP=Object.defineProperty,dP=Object.defineProperties,pP=Object.getOwnPropertyDescriptors,ty=Object.getOwnPropertySymbols,gP=Object.prototype.hasOwnProperty,yP=Object.prototype.propertyIsEnumerable,ry=(t,e,r)=>e in t?fP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iy=(t,e)=>{for(var r in e||(e={}))gP.call(e,r)&&ry(t,r,e[r]);if(ty)for(var r of ty(e))yP.call(e,r)&&ry(t,r,e[r]);return t},ny=(t,e)=>dP(t,pP(e));const wP={Accept:"application/json","Content-Type":"application/json"},mP="POST",sy={headers:wP,method:mP},oy=10;class jt{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new je.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!Fg(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=rr(e),i=await(await ey(this.url,ny(iy({},sy),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Fg(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=rr({id:1,jsonrpc:"2.0",method:"test",params:[]});await ey(e,ny(iy({},sy),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?ii(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Co(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Bg(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>oy&&this.events.setMaxListeners(oy)}}var bP=Object.defineProperty,vP=(t,e,r)=>e in t?bP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ji=(t,e,r)=>vP(t,typeof e!="symbol"?e+"":e,r);class EP{constructor(e){Ji(this,"name","polkadot"),Ji(this,"client"),Ji(this,"httpProviders"),Ji(this,"events"),Ji(this,"namespace"),Ji(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=Ii(r);e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var xP=Object.defineProperty,_P=Object.defineProperties,IP=Object.getOwnPropertyDescriptors,ay=Object.getOwnPropertySymbols,SP=Object.prototype.hasOwnProperty,AP=Object.prototype.propertyIsEnumerable,Gu=(t,e,r)=>e in t?xP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cy=(t,e)=>{for(var r in e||(e={}))SP.call(e,r)&&Gu(t,r,e[r]);if(ay)for(var r of ay(e))AP.call(e,r)&&Gu(t,r,e[r]);return t},uy=(t,e)=>_P(t,IP(e)),Xi=(t,e,r)=>Gu(t,typeof e!="symbol"?e+"":e,r);class DP{constructor(e){Xi(this,"name","eip155"),Xi(this,"client"),Xi(this,"chainId"),Xi(this,"namespace"),Xi(this,"httpProviders"),Xi(this,"events"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||vt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=parseInt(Ii(r));e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,i;let n=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const s=parseInt(n,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,n,s,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((s=(n=e.request)==null?void 0:n.params)==null?void 0:s[1])||[],u=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const h=this.client.session.get(e.topic),l=((o=h?.sessionProperties)==null?void 0:o.capabilities)||{};if(l!=null&&l[u])return l?.[u];const f=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:uy(cy({},h.sessionProperties||{}),{capabilities:uy(cy({},l||{}),{[u]:f})})})}catch(p){console.warn("Failed to update session with capabilities",p)}return f}async getCallStatus(e){var r,i;const n=this.client.session.get(e.topic),s=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(s){const a=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const n=new URL(e),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Zr("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,r){return`${BO}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}}var $P=Object.defineProperty,OP=(t,e,r)=>e in t?$P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qi=(t,e,r)=>OP(t,typeof e!="symbol"?e+"":e,r);class PP{constructor(e){Qi(this,"name","solana"),Qi(this,"client"),Qi(this,"httpProviders"),Qi(this,"events"),Qi(this,"namespace"),Qi(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=Ii(r);e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var BP=Object.defineProperty,CP=(t,e,r)=>e in t?BP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,en=(t,e,r)=>CP(t,typeof e!="symbol"?e+"":e,r);class TP{constructor(e){en(this,"name","cosmos"),en(this,"client"),en(this,"httpProviders"),en(this,"events"),en(this,"namespace"),en(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=Ii(r);e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var RP=Object.defineProperty,NP=(t,e,r)=>e in t?RP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tn=(t,e,r)=>NP(t,typeof e!="symbol"?e+"":e,r);class UP{constructor(e){tn(this,"name","algorand"),tn(this,"client"),tn(this,"httpProviders"),tn(this,"events"),tn(this,"namespace"),tn(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(!this.httpProviders[e]){const i=r||vt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Dt(new jt(i,ie("disableProviderPing")))}}var FP=Object.defineProperty,LP=(t,e,r)=>e in t?FP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rn=(t,e,r)=>LP(t,typeof e!="symbol"?e+"":e,r);class kP{constructor(e){rn(this,"name","cip34"),rn(this,"client"),rn(this,"httpProviders"),rn(this,"events"),rn(this,"namespace"),rn(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const i=this.getCardanoRPCUrl(r),n=Ii(r);e[n]=this.createHttpProvider(n,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var MP=Object.defineProperty,jP=(t,e,r)=>e in t?MP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nn=(t,e,r)=>jP(t,typeof e!="symbol"?e+"":e,r);class qP{constructor(e){nn(this,"name","elrond"),nn(this,"client"),nn(this,"httpProviders"),nn(this,"events"),nn(this,"namespace"),nn(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=Ii(r);e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var zP=Object.defineProperty,HP=(t,e,r)=>e in t?zP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sn=(t,e,r)=>HP(t,typeof e!="symbol"?e+"":e,r);class VP{constructor(e){sn(this,"name","multiversx"),sn(this,"client"),sn(this,"httpProviders"),sn(this,"events"),sn(this,"namespace"),sn(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=Ii(r);e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var KP=Object.defineProperty,WP=(t,e,r)=>e in t?KP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,on=(t,e,r)=>WP(t,typeof e!="symbol"?e+"":e,r);class GP{constructor(e){on(this,"name","near"),on(this,"client"),on(this,"httpProviders"),on(this,"events"),on(this,"namespace"),on(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||vt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace);return typeof i>"u"?void 0:new Dt(new jt(i,ie("disableProviderPing")))}}var YP=Object.defineProperty,ZP=(t,e,r)=>e in t?YP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,an=(t,e,r)=>ZP(t,typeof e!="symbol"?e+"":e,r);class JP{constructor(e){an(this,"name","tezos"),an(this,"client"),an(this,"httpProviders"),an(this,"events"),an(this,"namespace"),an(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||vt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace);return typeof i>"u"?void 0:new Dt(new jt(i))}}var XP=Object.defineProperty,QP=(t,e,r)=>e in t?XP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cn=(t,e,r)=>QP(t,typeof e!="symbol"?e+"":e,r);class e5{constructor(e){cn(this,"name",Yi),cn(this,"client"),cn(this,"httpProviders"),cn(this,"events"),cn(this,"namespace"),cn(this,"chainId"),this.namespace=e.namespace,this.events=ie("events"),this.client=ie("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(n=>{const s=ki(n);i[`${s.namespace}:${s.reference}`]=this.createHttpProvider(n)}),i}getHttpProvider(e){const r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Dt(new jt(i,ie("disableProviderPing")))}}var t5=Object.defineProperty,r5=Object.defineProperties,i5=Object.getOwnPropertyDescriptors,hy=Object.getOwnPropertySymbols,n5=Object.prototype.hasOwnProperty,s5=Object.prototype.propertyIsEnumerable,Yu=(t,e,r)=>e in t?t5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ho=(t,e)=>{for(var r in e||(e={}))n5.call(e,r)&&Yu(t,r,e[r]);if(hy)for(var r of hy(e))s5.call(e,r)&&Yu(t,r,e[r]);return t},Zu=(t,e)=>r5(t,i5(e)),Bt=(t,e,r)=>Yu(t,typeof e!="symbol"?e+"":e,r);class Vo{constructor(e){Bt(this,"client"),Bt(this,"namespaces"),Bt(this,"optionalNamespaces"),Bt(this,"sessionProperties"),Bt(this,"scopedProperties"),Bt(this,"events",new je.exports),Bt(this,"rpcProviders",{}),Bt(this,"session"),Bt(this,"providerOpts"),Bt(this,"logger"),Bt(this,"uri"),Bt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:qt(Ps({level:e?.logger||U0})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new Vo(e);return await r.initialize(),r}async request(e,r,i){const[n,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Ho({},e),chainId:`${n}:${s}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,n){const s=new Date().getTime();this.request(e,i,n).then(o=>r(null,Bo(s,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ae("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const s=await n();if(this.session=s.session,this.session){const o=X0(this.session.namespaces);this.namespaces=zo(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const n=await i();this.session=n;const s=X0(n.namespaces);return this.namespaces=zo(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,n]=this.validateChain(e),s=this.getProvider(i);s.name===Yi?s.setDefaultChain(`${i}:${n}`,r):s.setDefaultChain(n,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(yr(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await qu.init({core:this.providerOpts.core,logger:this.providerOpts.logger||U0,relayUrl:this.providerOpts.relayUrl||$O,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>Ki(r)))];Ku("client",this.client),Ku("events",this.events),Ku("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=lP(r,this.session),n=Y0(i),s=zo(this.namespaces,this.optionalNamespaces),o=Zu(Ho({},s[r]),{accounts:i,chains:n});switch(r){case"eip155":this.rpcProviders[r]=new DP({namespace:o});break;case"algorand":this.rpcProviders[r]=new UP({namespace:o});break;case"solana":this.rpcProviders[r]=new PP({namespace:o});break;case"cosmos":this.rpcProviders[r]=new TP({namespace:o});break;case"polkadot":this.rpcProviders[r]=new EP({namespace:o});break;case"cip34":this.rpcProviders[r]=new kP({namespace:o});break;case"elrond":this.rpcProviders[r]=new qP({namespace:o});break;case"multiversx":this.rpcProviders[r]=new VP({namespace:o});break;case"near":this.rpcProviders[r]=new GP({namespace:o});break;case"tezos":this.rpcProviders[r]=new JP({namespace:o});break;default:this.rpcProviders[Yi]?this.rpcProviders[Yi].updateNamespace(o):this.rpcProviders[Yi]=new e5({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:n}=e;if(n!==((r=this.session)==null?void 0:r.topic))return;const{event:s}=i;if(s.name==="accountsChanged"){const o=s.data;o&&yr(o)&&this.events.emit("accountsChanged",o.map(J0))}else if(s.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=Ki(o),u=Vu(o)!==Vu(a)?`${c}:${Vu(a)}`:o;this.onChainChanged(u)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,n;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:s}=r,o=(n=this.client)==null?void 0:n.session.get(e);this.session=Zu(Ho({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Zu(Ho({},ae("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Pt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Yi]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:n,scopedProperties:s}=e;this.optionalNamespaces=zo(r,i),this.sessionProperties=n,this.scopedProperties=s}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>Ki(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const n=Ki(Object.keys(this.namespaces)[0]),s=this.rpcProviders[n].getDefaultChain();return[n,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,r=!1){if(!this.namespaces)return;const[i,n]=this.validateChain(e);if(!n)return;this.updateNamespaceChain(i,n),this.events.emit("chainChanged",n);const s=this.getProvider(i).getDefaultChain();r||this.getProvider(i).setDefaultChain(n),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:s,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:r,newChainId:i}){var n,s;try{if(r===i)return;const o=(s=(n=this.session)==null?void 0:n.namespaces[e])==null?void 0:s.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${i}:`)).map(J0);if(!yr(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,n={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const n=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Mo}/${e}${n}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Mo}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Mo}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(Mo)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const o5=Vo;Jr.UniversalProvider=o5,Jr.default=Vo,Object.defineProperty(Jr,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map

(function(U,ft){typeof exports=="object"&&typeof module<"u"?ft(exports):typeof define=="function"&&define.amd?define(["exports"],ft):(U=typeof globalThis<"u"?globalThis:U||self,ft(U["@walletconnect/core"]={}))})(this,function(U){"use strict";var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function la(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Je={exports:{}},wr=typeof Reflect=="object"?Reflect:null,ha=wr&&typeof wr.apply=="function"?wr.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},Pn;wr&&typeof wr.ownKeys=="function"?Pn=wr.ownKeys:Object.getOwnPropertySymbols?Pn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Pn=function(e){return Object.getOwnPropertyNames(e)};function pd(t){console&&console.warn&&console.warn(t)}var fa=Number.isNaN||function(e){return e!==e};function Q(){Q.init.call(this)}Je.exports=Q,Je.exports.once=md,Q.EventEmitter=Q,Q.prototype._events=void 0,Q.prototype._eventsCount=0,Q.prototype._maxListeners=void 0;var da=10;function $n(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Q,"defaultMaxListeners",{enumerable:!0,get:function(){return da},set:function(t){if(typeof t!="number"||t<0||fa(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");da=t}}),Q.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Q.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||fa(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ga(t){return t._maxListeners===void 0?Q.defaultMaxListeners:t._maxListeners}Q.prototype.getMaxListeners=function(){return ga(this)},Q.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")ha(c,this,r);else for(var u=c.length,l=ma(c,u),n=0;n<u;++n)ha(l[n],this,r);return!0};function pa(t,e,r,n){var i,s,o;if($n(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=ga(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,pd(a)}return t}Q.prototype.addListener=function(e,r){return pa(this,e,r,!1)},Q.prototype.on=Q.prototype.addListener,Q.prototype.prependListener=function(e,r){return pa(this,e,r,!0)};function yd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ya(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=yd.bind(n);return i.listener=r,n.wrapFn=i,i}Q.prototype.once=function(e,r){return $n(r),this.on(e,ya(this,e,r)),this},Q.prototype.prependOnceListener=function(e,r){return $n(r),this.prependListener(e,ya(this,e,r)),this},Q.prototype.removeListener=function(e,r){var n,i,s,o,a;if($n(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():bd(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function ba(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?wd(i):ma(i,i.length)}Q.prototype.listeners=function(e){return ba(this,e,!0)},Q.prototype.rawListeners=function(e){return ba(this,e,!1)},Q.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):wa.call(t,e)},Q.prototype.listenerCount=wa;function wa(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Q.prototype.eventNames=function(){return this._eventsCount>0?Pn(this._events):[]};function ma(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function bd(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function wd(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function md(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}Ea(t,e,s,{once:!0}),e!=="error"&&Ed(t,i,{once:!0})})}function Ed(t,e,r){typeof t.on=="function"&&Ea(t,"error",e,r)}function Ea(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var M={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Li=function(t,e){return Li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Li(t,e)};function vd(t,e){Li(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ui=function(){return Ui=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ui.apply(this,arguments)};function _d(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function xd(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Sd(t,e){return function(r,n){e(r,n,t)}}function Dd(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Id(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function Od(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ad(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Td(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Fi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function va(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Rd(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(va(arguments[e]));return t}function Bd(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function zr(t){return this instanceof zr?(this.v=t,this):new zr(t)}function Cd(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(g){return new Promise(function(d,p){s.push([f,g,d,p])>1||a(f,g)})})}function a(f,g){try{c(n[f](g))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof zr?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,g){f(g),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Nd(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:zr(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function Pd(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Fi=="function"?Fi(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function $d(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Ld(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Ud(t){return t&&t.__esModule?t:{default:t}}function Fd(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function zd(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var jd=Object.freeze({__proto__:null,__extends:vd,get __assign(){return Ui},__rest:_d,__decorate:xd,__param:Sd,__metadata:Dd,__awaiter:Id,__generator:Od,__createBinding:Ad,__exportStar:Td,__values:Fi,__read:va,__spread:Rd,__spreadArrays:Bd,__await:zr,__asyncGenerator:Cd,__asyncDelegator:Nd,__asyncValues:Pd,__makeTemplateObject:$d,__importStar:Ld,__importDefault:Ud,__classPrivateFieldGet:Fd,__classPrivateFieldSet:zd}),Ln=la(jd),zi={},jr={},_a;function kd(){if(_a)return jr;_a=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return jr.delay=t,jr}var er={},ji={},tr={},xa;function Md(){return xa||(xa=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.ONE_THOUSAND=tr.ONE_HUNDRED=void 0,tr.ONE_HUNDRED=100,tr.ONE_THOUSAND=1e3),tr}var ki={},Sa;function Hd(){return Sa||(Sa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ki)),ki}var Da;function Ia(){return Da||(Da=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ln;e.__exportStar(Md(),t),e.__exportStar(Hd(),t)}(ji)),ji}var Oa;function Vd(){if(Oa)return er;Oa=1,Object.defineProperty(er,"__esModule",{value:!0}),er.fromMiliseconds=er.toMiliseconds=void 0;const t=Ia();function e(n){return n*t.ONE_THOUSAND}er.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return er.fromMiliseconds=r,er}var Aa;function Kd(){return Aa||(Aa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ln;e.__exportStar(kd(),t),e.__exportStar(Vd(),t)}(zi)),zi}var mr={},Ta;function qd(){if(Ta)return mr;Ta=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return mr.Watch=t,mr.default=t,mr}var Mi={},kr={},Ra;function Wd(){if(Ra)return kr;Ra=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.IWatch=void 0;class t{}return kr.IWatch=t,kr}var Ba;function Gd(){return Ba||(Ba=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ln.__exportStar(Wd(),t)}(Mi)),Mi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ln;e.__exportStar(Kd(),t),e.__exportStar(qd(),t),e.__exportStar(Gd(),t),e.__exportStar(Ia(),t)})(M);class rr{}class Yd extends rr{constructor(e){super()}}const Ca=M.FIVE_SECONDS,nr={pulse:"heartbeat_pulse"};class Hi extends Yd{constructor(e){super(e),this.events=new Je.exports.EventEmitter,this.interval=Ca,this.interval=e?.interval||Ca}static async init(e){const r=new Hi(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(nr.pulse)}}const Zd=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Xd=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Jd=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Qd(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){eg(t);return}return e}function eg(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Un(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Jd.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Zd.test(t)||Xd.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Qd)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function tg(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ue(t,...e){try{return tg(t(...e))}catch(r){return Promise.reject(r)}}function rg(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function ng(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Fn(t){if(rg(t))return String(t);if(ng(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Fn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Vi="base64:";function ig(t){return typeof t=="string"?t:Vi+ag(t)}function sg(t){return typeof t!="string"||!t.startsWith(Vi)?t:og(t.slice(Vi.length))}function og(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function ag(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ne(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function cg(...t){return Ne(t.join(":"))}function zn(t){return t=Ne(t),t?t+":":""}function ug(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function lg(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function f8(t){return t}const hg="memory",fg=()=>{const t=new Map;return{name:hg,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function dg(t={}){const e={mounts:{"":t.driver||fg()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=Ne(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Na(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,g=d=>{let p=f.get(d.base);return p||(p={driver:d.driver,base:d.base,items:[]},f.set(d.base,p)),p};for(const d of u){const p=typeof d=="string",_=Ne(p?d:d.key),R=p?void 0:d.value,P=p||!d.options?l:{...l,...d.options},m=r(_);g(m).items.push({key:_,value:R,relativeKey:m.relativeKey,options:P})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=Ne(u);const{relativeKey:h,driver:f}=r(u);return ue(f.hasItem,h,l)},getItem(u,l={}){u=Ne(u);const{relativeKey:h,driver:f}=r(u);return ue(f.getItem,h,l).then(g=>Un(g))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?ue(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(g=>({key:cg(h.base,g.key),value:Un(g.value)}))):Promise.all(h.items.map(f=>ue(h.driver.getItem,f.relativeKey,f.options).then(g=>({key:f.key,value:Un(g)})))))},getItemRaw(u,l={}){u=Ne(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?ue(f.getItemRaw,h,l):ue(f.getItem,h,l).then(g=>sg(g))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Ne(u);const{relativeKey:f,driver:g}=r(u);g.setItem&&(await ue(g.setItem,f,Fn(l),h),g.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return ue(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Fn(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>ue(h.driver.setItem,f.relativeKey,Fn(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Ne(u);const{relativeKey:f,driver:g}=r(u);if(g.setItemRaw)await ue(g.setItemRaw,f,l,h);else if(g.setItem)await ue(g.setItem,f,ig(l),h);else return;g.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ne(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await ue(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await ue(f.removeItem,h+"$",l),f.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ne(u);const{relativeKey:h,driver:f}=r(u),g=Object.create(null);if(f.getMeta&&Object.assign(g,await ue(f.getMeta,h,l)),!l.nativeOnly){const d=await ue(f.getItem,h+"$",l).then(p=>Un(p));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(g,d))}return g},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=zn(u);const h=n(u,!0);let f=[];const g=[];let d=!0;for(const _ of h){_.driver.flags?.maxDepth||(d=!1);const R=await ue(_.driver.getKeys,_.relativeBase,l);for(const P of R){const m=_.mountpoint+Ne(P);f.some(b=>m.startsWith(b))||g.push(m)}f=[_.mountpoint,...f.filter(P=>!P.startsWith(_.mountpoint))]}const p=l.maxDepth!==void 0&&!d;return g.filter(_=>(!p||ug(_,l.maxDepth))&&lg(_,u))},async clear(u,l={}){u=zn(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return ue(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(g=>h.driver.removeItem(g,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Pa(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=zn(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Na(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=zn(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await Pa(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=Ne(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ne(u),n(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Na(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Pa(t){typeof t.dispose=="function"&&await ue(t.dispose)}function ir(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function $a(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const n=ir(r);return(i,s)=>n.then(o=>s(o.transaction(e,i).objectStore(e)))}let Ki;function Mr(){return Ki||(Ki=$a("keyval-store","keyval")),Ki}function La(t,e=Mr()){return e("readonly",r=>ir(r.get(t)))}function gg(t,e,r=Mr()){return r("readwrite",n=>(n.put(e,t),ir(n.transaction)))}function pg(t,e=Mr()){return e("readwrite",r=>(r.delete(t),ir(r.transaction)))}function yg(t=Mr()){return t("readwrite",e=>(e.clear(),ir(e.transaction)))}function bg(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ir(t.transaction)}function wg(t=Mr()){return t("readonly",e=>{if(e.getAllKeys)return ir(e.getAllKeys());const r=[];return bg(e,n=>r.push(n.key)).then(()=>r)})}const mg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Eg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Er(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Eg(t)}catch{return t}}function sr(t){return typeof t=="string"?t:mg(t)||""}const vg="idb-keyval";var _g=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=$a(t.dbName,t.storeName)),{name:vg,options:t,async hasItem(i){return!(typeof await La(r(i),n)>"u")},async getItem(i){return await La(r(i),n)??null},setItem(i,s){return gg(r(i),s,n)},removeItem(i){return pg(r(i),n)},getKeys(){return wg(n)},clear(){return yg(n)}}};const xg="WALLET_CONNECT_V2_INDEXED_DB",Sg="keyvaluestorage";class Dg{constructor(){this.indexedDb=dg({driver:_g({dbName:xg,storeName:Sg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,sr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var qi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof qi<"u"&&qi.localStorage?jn.exports=qi.localStorage:typeof window<"u"&&window.localStorage?jn.exports=window.localStorage:jn.exports=new e})();function Ig(t){var e;return[t[0],Er((e=t[1])!=null?e:"")]}class Og{constructor(){this.localStorage=jn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Ig)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Er(r)}async setItem(e,r){this.localStorage.setItem(e,sr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Ag="wc_storage_version",Ua=1,Tg=async(t,e,r)=>{const n=Ag,i=await e.getItem(n);if(i&&i>=Ua){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,Ua),r(e),Rg(t,o)},Rg=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class Bg{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Og;this.storage=e;try{const r=new Dg;Tg(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function Cg(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Ng=Pg;function Pg(t,e,r){var n=r&&r.stringify||Cg,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,f=t&&t.length||0,g=0;g<f;){if(t.charCodeAt(g)===37&&g+1<f){switch(h=h>-1?h:0,t.charCodeAt(g+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<g&&(u+=t.slice(h,g)),u+=Number(e[l]),h=g+2,g++;break;case 105:if(l>=c||e[l]==null)break;h<g&&(u+=t.slice(h,g)),u+=Math.floor(Number(e[l])),h=g+2,g++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<g&&(u+=t.slice(h,g));var d=typeof e[l];if(d==="string"){u+="'"+e[l]+"'",h=g+2,g++;break}if(d==="function"){u+=e[l].name||"<anonymous>",h=g+2,g++;break}u+=n(e[l]),h=g+2,g++;break;case 115:if(l>=c)break;h<g&&(u+=t.slice(h,g)),u+=String(e[l]),h=g+2,g++;break;case 37:h<g&&(u+=t.slice(h,g)),u+="%",h=g+2,g++,l--;break}++l}++g}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}const Fa=Ng;var Pt=dt;const Hr=Vg().console||{},$g={mapHttpRequest:Mn,mapHttpResponse:Mn,wrapRequestSerializer:Gi,wrapResponseSerializer:Gi,wrapErrorSerializer:Gi,req:Mn,res:Mn,err:jg};function Lg(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function dt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Hr;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=Lg(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Vr),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:f});const u={transmit:e,serialize:i,asObject:t.browser.asObject,levels:o,timestamp:kg(t)};c.levels=dt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Vr,c.serializers=n,c._serialize=i,c._stdErrSerialize=s,c.child=g,e&&(c._logEvent=Wi());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function f(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,vr(u,c,"error","log"),vr(u,c,"fatal","error"),vr(u,c,"warn","error"),vr(u,c,"info","log"),vr(u,c,"debug","log"),vr(u,c,"trace","log")}function g(d,p){if(!d)throw new Error("missing bindings for child Pino");p=p||{},i&&d.serializers&&(p.serializers=d.serializers);const _=p.serializers;if(i&&_){var R=Object.assign({},n,_),P=t.browser.serialize===!0?Object.keys(R):i;delete d.serializers,kn([d],P,R,this._stdErrSerialize)}function m(b){this._childLevel=(b._childLevel|0)+1,this.error=_r(b,d,"error"),this.fatal=_r(b,d,"fatal"),this.warn=_r(b,d,"warn"),this.info=_r(b,d,"info"),this.debug=_r(b,d,"debug"),this.trace=_r(b,d,"trace"),R&&(this.serializers=R,this._serialize=P),e&&(this._logEvent=Wi([].concat(b._logEvent.bindings,d)))}return m.prototype=this,new m(this)}return c}dt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},dt.stdSerializers=$g,dt.stdTimeFunctions=Object.assign({},{nullTime:za,epochTime:ja,unixTime:Mg,isoTime:Hg});function vr(t,e,r,n){const i=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Vr:i[r]?i[r]:Hr[r]||Hr[n]||Vr,Ug(t,e,r)}function Ug(t,e,r){!t.transmit&&e[r]===Vr||(e[r]=function(n){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Hr?Hr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&kn(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?n.call(a,Fg(this,r,o,s)):n.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=dt.levels.values[u],h=dt.levels.values[r];if(h<l)return;zg(this,{ts:s,methodLevel:r,methodValue:h,transmitLevel:u,transmitValue:dt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function Fg(t,e,r,n){t._serialize&&kn(r,t._serialize,t.serializers,t._stdErrSerialize);const i=r.slice();let s=i[0];const o={};n&&(o.time=n),o.level=dt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Fa(i.shift(),i):void 0}else typeof s=="string"&&(s=Fa(i.shift(),i));return s!==void 0&&(o.msg=s),o}function kn(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=dt.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i]))for(const s in t[i])e&&e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function _r(t,e,r){return function(){const n=new Array(1+arguments.length);n[0]=e;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return t[r].apply(this,n)}}function zg(t,e,r){const n=e.send,i=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;kn(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,n(s,t._logEvent,a),t._logEvent=Wi(c)}function Wi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function jg(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function kg(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?za:ja}function Mn(){return{}}function Gi(t){return t}function Vr(){}function za(){return!1}function ja(){return Date.now()}function Mg(){return Math.round(Date.now()/1e3)}function Hg(){return new Date(Date.now()).toISOString()}function Vg(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const Kg={level:"info"},Kr="custom_context",Yi=1e3*1024;class qg{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class ka{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new qg(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Ma{constructor(e,r=Yi){this.level=e??"error",this.levelValue=Pt.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new ka(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Pt.levels.values.error?console.error(e):r===Pt.levels.values.warn?console.warn(e):r===Pt.levels.values.debug?console.debug(e):r===Pt.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(sr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new ka(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(sr({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class Wg{constructor(e,r=Yi){this.baseChunkLogger=new Ma(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}class Gg{constructor(e,r=Yi){this.baseChunkLogger=new Ma(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var Yg=Object.defineProperty,Zg=Object.defineProperties,Xg=Object.getOwnPropertyDescriptors,Ha=Object.getOwnPropertySymbols,Jg=Object.prototype.hasOwnProperty,Qg=Object.prototype.propertyIsEnumerable,Va=(t,e,r)=>e in t?Yg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hn=(t,e)=>{for(var r in e||(e={}))Jg.call(e,r)&&Va(t,r,e[r]);if(Ha)for(var r of Ha(e))Qg.call(e,r)&&Va(t,r,e[r]);return t},Vn=(t,e)=>Zg(t,Xg(e));function Ka(t){return Vn(Hn({},t),{level:t?.level||Kg.level})}function ep(t,e=Kr){return t[e]||""}function tp(t,e,r=Kr){return t[r]=e,t}function Ke(t,e=Kr){let r="";return typeof t.bindings>"u"?r=ep(t,e):r=t.bindings().context||"",r}function rp(t,e,r=Kr){const n=Ke(t,r);return n.trim()?`${n}/${e}`:e}function Pe(t,e,r=Kr){const n=rp(t,e,r),i=t.child({context:n});return tp(i,n,r)}function np(t){var e,r;const n=new Wg((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Pt(Vn(Hn({},t.opts),{level:"trace",browser:Vn(Hn({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function ip(t){var e;const r=new Gg((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Pt(Vn(Hn({},t.opts),{level:"trace"})),chunkLoggerController:r}}function sp(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?np(t):ip(t)}var op=Object.defineProperty,ap=(t,e,r)=>e in t?op(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qa=(t,e,r)=>ap(t,typeof e!="symbol"?e+"":e,r);class cp extends rr{constructor(e){super(),this.opts=e,qa(this,"protocol","wc"),qa(this,"version",2)}}var up=Object.defineProperty,lp=(t,e,r)=>e in t?up(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hp=(t,e,r)=>lp(t,typeof e!="symbol"?e+"":e,r);class fp extends rr{constructor(e,r){super(),this.core=e,this.logger=r,hp(this,"records",new Map)}}class dp{constructor(e,r){this.logger=e,this.core=r}}class gp extends rr{constructor(e,r){super(),this.relayer=e,this.logger=r}}class pp extends rr{constructor(e){super()}}class yp{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}}class bp extends rr{constructor(e,r){super(),this.relayer=e,this.logger=r}}class wp extends rr{constructor(e,r){super(),this.core=e,this.logger=r}}class mp{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}}class Ep{constructor(e,r){this.projectId=e,this.logger=r}}class vp{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}const Zi="wc",Xi=2,qr="core",st=`${Zi}@2:${qr}:`,Wa={name:qr,logger:"error"},Ga={database:":memory:"},Ya="crypto",Ji="client_ed25519_seed",Za=M.ONE_DAY,Xa="keychain",Ja="0.3",Qa="messages",ec="0.3",Qi=M.SIX_HOURS,tc="publisher",rc="irn",nc="error",es="wss://relay.walletconnect.org",ic="relayer",ge={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},sc="_subscription",qe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},oc=.1,_p={database:":memory:"},Kn="2.21.2",xp=1e4,or={link_mode:"link_mode",relay:"relay"},Wr={inbound:"inbound",outbound:"outbound"},ac="0.3",cc="WALLETCONNECT_CLIENT_ID",ts="WALLETCONNECT_LINK_MODE_APPS",$e={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Sp=M.THIRTY_DAYS,uc="subscription",lc="0.3",Dp=M.FIVE_SECONDS*1e3,hc="pairing",fc="0.3",Ip=M.THIRTY_DAYS,xr={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Sr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Qe={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},dc="history",gc="0.3",pc="expirer",et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},yc="0.3",Op=M.ONE_DAY,bc="verify-api",Ap="https://verify.walletconnect.com",wc="https://verify.walletconnect.org",Gr=wc,mc=`${Gr}/v3`,Ec=[Ap,wc],vc="echo",_c="https://echo.walletconnect.com",Tp="event-client",gt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},mt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Rp={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Bp={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Cp={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Np={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},xc=.1,Sc="event-client",Dc=86400,Ic="https://pulse.walletconnect.org/batch";function Pp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Oc(t,...e){if(!Pp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ac(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function $p(t,e){Oc(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Dr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rs=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Lp(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Tc(t){return typeof t=="string"&&(t=Lp(t)),Oc(t),t}class Up{clone(){return this._cloneInto()}}function Fp(t){const e=n=>t().update(Tc(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Rc(t=32){if(Dr&&typeof Dr.getRandomValues=="function")return Dr.getRandomValues(new Uint8Array(t));if(Dr&&typeof Dr.randomBytes=="function")return Dr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function zp(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}class jp extends Up{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=rs(this.buffer)}update(e){Ac(this);const{view:r,buffer:n,blockLen:i}=this;e=Tc(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=rs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ac(this),$p(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;zp(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=rs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const qn=BigInt(2**32-1),ns=BigInt(32);function Bc(t,e=!1){return e?{h:Number(t&qn),l:Number(t>>ns&qn)}:{h:Number(t>>ns&qn)|0,l:Number(t&qn)|0}}function kp(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Bc(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const Mp=(t,e)=>BigInt(t>>>0)<<ns|BigInt(e>>>0),Hp=(t,e,r)=>t>>>r,Vp=(t,e,r)=>t<<32-r|e>>>r,Kp=(t,e,r)=>t>>>r|e<<32-r,qp=(t,e,r)=>t<<32-r|e>>>r,Wp=(t,e,r)=>t<<64-r|e>>>r-32,Gp=(t,e,r)=>t>>>r-32|e<<64-r,Yp=(t,e)=>e,Zp=(t,e)=>t,Xp=(t,e,r)=>t<<r|e>>>32-r,Jp=(t,e,r)=>e<<r|t>>>32-r,Qp=(t,e,r)=>e<<r-32|t>>>64-r,e0=(t,e,r)=>t<<r-32|e>>>64-r;function t0(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const r0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),n0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,i0=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),s0=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,o0=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),a0=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,q={fromBig:Bc,split:kp,toBig:Mp,shrSH:Hp,shrSL:Vp,rotrSH:Kp,rotrSL:qp,rotrBH:Wp,rotrBL:Gp,rotr32H:Yp,rotr32L:Zp,rotlSH:Xp,rotlSL:Jp,rotlBH:Qp,rotlBL:e0,add:t0,add3L:r0,add3H:n0,add4L:i0,add4H:s0,add5H:a0,add5L:o0},[c0,u0]=q.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),$t=new Uint32Array(80),Lt=new Uint32Array(80);class l0 extends jp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:g,Gl:d,Hh:p,Hl:_}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_]}set(e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=_|0}process(e,r){for(let m=0;m<16;m++,r+=4)$t[m]=e.getUint32(r),Lt[m]=e.getUint32(r+=4);for(let m=16;m<80;m++){const b=$t[m-15]|0,v=Lt[m-15]|0,O=q.rotrSH(b,v,1)^q.rotrSH(b,v,8)^q.shrSH(b,v,7),S=q.rotrSL(b,v,1)^q.rotrSL(b,v,8)^q.shrSL(b,v,7),A=$t[m-2]|0,C=Lt[m-2]|0,L=q.rotrSH(A,C,19)^q.rotrBH(A,C,61)^q.shrSH(A,C,6),T=q.rotrSL(A,C,19)^q.rotrBL(A,C,61)^q.shrSL(A,C,6),N=q.add4L(S,T,Lt[m-7],Lt[m-16]),B=q.add4H(N,O,L,$t[m-7],$t[m-16]);$t[m]=B|0,Lt[m]=N|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:g,Fl:d,Gh:p,Gl:_,Hh:R,Hl:P}=this;for(let m=0;m<80;m++){const b=q.rotrSH(h,f,14)^q.rotrSH(h,f,18)^q.rotrBH(h,f,41),v=q.rotrSL(h,f,14)^q.rotrSL(h,f,18)^q.rotrBL(h,f,41),O=h&g^~h&p,S=f&d^~f&_,A=q.add5L(P,v,S,u0[m],Lt[m]),C=q.add5H(A,R,b,O,c0[m],$t[m]),L=A|0,T=q.rotrSH(n,i,28)^q.rotrBH(n,i,34)^q.rotrBH(n,i,39),N=q.rotrSL(n,i,28)^q.rotrBL(n,i,34)^q.rotrBL(n,i,39),B=n&s^n&a^s&a,j=i&o^i&c^o&c;R=p|0,P=_|0,p=g|0,_=d|0,g=h|0,d=f|0,{h,l:f}=q.add(u|0,l|0,C|0,L|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const w=q.add3L(L,N,j);n=q.add3H(w,C,T,B),i=w|0}({h:n,l:i}=q.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=q.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=q.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=q.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=q.add(this.Eh|0,this.El|0,h|0,f|0),{h:g,l:d}=q.add(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:_}=q.add(this.Gh|0,this.Gl|0,p|0,_|0),{h:R,l:P}=q.add(this.Hh|0,this.Hl|0,R|0,P|0),this.set(n,i,s,o,a,c,u,l,h,f,g,d,p,_,R,P)}roundClean(){$t.fill(0),Lt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const h0=Fp(()=>new l0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const is=BigInt(0),Cc=BigInt(1),f0=BigInt(2);function ss(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function os(t){if(!ss(t))throw new Error("Uint8Array expected")}function as(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const d0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function cs(t){os(t);let e="";for(let r=0;r<t.length;r++)e+=d0[t[r]];return e}function Nc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?is:BigInt("0x"+t)}const Et={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pc(t){if(t>=Et._0&&t<=Et._9)return t-Et._0;if(t>=Et.A&&t<=Et.F)return t-(Et.A-10);if(t>=Et.a&&t<=Et.f)return t-(Et.a-10)}function $c(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Pc(t.charCodeAt(s)),a=Pc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function g0(t){return Nc(cs(t))}function Wn(t){return os(t),Nc(cs(Uint8Array.from(t).reverse()))}function Lc(t,e){return $c(t.toString(16).padStart(e*2,"0"))}function us(t,e){return Lc(t,e).reverse()}function vt(t,e,r){let n;if(typeof e=="string")try{n=$c(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ss(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Uc(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];os(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const ls=t=>typeof t=="bigint"&&is<=t;function p0(t,e,r){return ls(t)&&ls(e)&&ls(r)&&e<=t&&t<r}function Yr(t,e,r,n){if(!p0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function y0(t){let e;for(e=0;t>is;t>>=Cc,e+=1);return e}const b0=t=>(f0<<BigInt(t-1))-Cc,w0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ss(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function hs(t,e,r={}){const n=(i,s,o)=>{const a=w0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Fc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const le=BigInt(0),ie=BigInt(1),ar=BigInt(2),m0=BigInt(3),fs=BigInt(4),zc=BigInt(5),jc=BigInt(8);function ae(t,e){const r=t%e;return r>=le?r:e+r}function E0(t,e,r){if(e<le)throw new Error("invalid exponent, negatives unsupported");if(r<=le)throw new Error("invalid modulus");if(r===ie)return le;let n=ie;for(;e>le;)e&ie&&(n=n*t%r),t=t*t%r,e>>=ie;return n}function pt(t,e,r){let n=t;for(;e-- >le;)n*=n,n%=r;return n}function kc(t,e){if(t===le)throw new Error("invert: expected non-zero number");if(e<=le)throw new Error("invert: expected positive modulus, got "+e);let r=ae(t,e),n=e,i=le,s=ie;for(;r!==le;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==ie)throw new Error("invert: does not exist");return ae(i,e)}function v0(t){const e=(t-ie)/ar;let r,n,i;for(r=t-ie,n=0;r%ar===le;r/=ar,n++);for(i=ar;i<t&&E0(i,e,t)!==t-ie;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+ie)/fs;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+ie)/ar;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const g=o.pow(u,ie<<BigInt(c-f-1));u=o.sqr(g),l=o.mul(l,g),h=o.mul(h,u),c=f}return l}}function _0(t){if(t%fs===m0){const e=(t+ie)/fs;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%jc===zc){const e=(t-zc)/jc;return function(r,n){const i=r.mul(n,ar),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,ar),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return v0(t)}const x0=(t,e)=>(ae(t,e)&ie)===ie,S0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function D0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=S0.reduce((n,i)=>(n[i]="function",n),e);return hs(t,r)}function I0(t,e,r){if(r<le)throw new Error("invalid exponent, negatives unsupported");if(r===le)return t.ONE;if(r===ie)return e;let n=t.ONE,i=e;for(;r>le;)r&ie&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ie;return n}function O0(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Mc(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Hc(t,e,r=!1,n={}){if(t<=le)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Mc(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:b0(i),ZERO:le,ONE:ie,create:c=>ae(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return le<=c&&c<t},is0:c=>c===le,isOdd:c=>(c&ie)===ie,neg:c=>ae(-c,t),eql:(c,u)=>c===u,sqr:c=>ae(c*c,t),add:(c,u)=>ae(c+u,t),sub:(c,u)=>ae(c-u,t),mul:(c,u)=>ae(c*u,t),pow:(c,u)=>I0(a,c,u),div:(c,u)=>ae(c*kc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>kc(c,t),sqrt:n.sqrt||(c=>(o||(o=_0(t)),o(a,c))),invertBatch:c=>O0(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?us(c,s):Lc(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Wn(c):g0(c)}});return Object.freeze(a)}const Vc=BigInt(0),Gn=BigInt(1);function ds(t,e){const r=e.negate();return t?r:e}function Kc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function gs(t,e){Kc(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function A0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function T0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ps=new WeakMap,qc=new WeakMap;function ys(t){return qc.get(t)||1}function R0(t,e){return{constTimeNegate:ds,hasPrecomputes(r){return ys(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Vc;)n&Gn&&(i=i.add(s)),s=s.double(),n>>=Gn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=gs(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=gs(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const g=f*o;let d=Number(i&u);i>>=h,d>o&&(d-=l,i+=Gn);const p=g,_=g+Math.abs(d)-1,R=f%2!==0,P=d<0;d===0?c=c.add(ds(R,n[p])):a=a.add(ds(P,n[_]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=gs(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Vc)break;let g=Number(i&c);if(i>>=l,g>a&&(g-=u,i+=Gn),g===0)continue;let d=n[f+Math.abs(g)-1];g<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,n,i){let s=ps.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ps.set(n,i(s))),s},wNAFCached(r,n,i){const s=ys(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ys(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Kc(n,e),qc.set(r,n),ps.delete(r)}}}function B0(t,e,r,n){if(A0(r,t),T0(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=y0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let g=0;g<n.length;g++){const d=n[g],p=Number(d>>BigInt(h)&BigInt(a));c[p]=c[p].add(r[g])}let f=i;for(let g=c.length-1,d=i;g>0;g--)d=d.add(c[g]),f=f.add(d);if(l=l.add(f),h!==0)for(let g=0;g<o;g++)l=l.double()}return l}function C0(t){return D0(t.Fp),hs(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Mc(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const ot=BigInt(0),Le=BigInt(1),Yn=BigInt(2),N0=BigInt(8),P0={zip215:!0};function $0(t){const e=C0(t);return hs(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function L0(t){const e=$0(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Yn<<BigInt(a*8)-Le,l=r.create,h=Hc(e.n,e.nBitLength),f=e.uvRatio||((w,y)=>{try{return{isValid:!0,value:r.sqrt(w*r.inv(y))}}catch{return{isValid:!1,value:ot}}}),g=e.adjustScalarBytes||(w=>w),d=e.domain||((w,y,E)=>{if(as("phflag",E),y.length||E)throw new Error("Contexts/pre-hash are not supported");return w});function p(w,y){Yr("coordinate "+w,y,ot,u)}function _(w){if(!(w instanceof m))throw new Error("ExtendedPoint expected")}const R=Fc((w,y)=>{const{ex:E,ey:D,ez:x}=w,I=w.is0();y==null&&(y=I?N0:r.inv(x));const $=l(E*y),F=l(D*y),k=l(x*y);if(I)return{x:ot,y:Le};if(k!==Le)throw new Error("invZ was invalid");return{x:$,y:F}}),P=Fc(w=>{const{a:y,d:E}=e;if(w.is0())throw new Error("bad point: ZERO");const{ex:D,ey:x,ez:I,et:$}=w,F=l(D*D),k=l(x*x),H=l(I*I),V=l(H*H),K=l(F*y),G=l(H*l(K+k)),ee=l(V+l(E*l(F*k)));if(G!==ee)throw new Error("bad point: equation left != right (1)");const W=l(D*x),se=l(I*$);if(W!==se)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(y,E,D,x){this.ex=y,this.ey=E,this.ez=D,this.et=x,p("x",y),p("y",E),p("z",D),p("t",x),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof m)throw new Error("extended point not allowed");const{x:E,y:D}=y||{};return p("x",E),p("y",D),new m(E,D,Le,l(E*D))}static normalizeZ(y){const E=r.invertBatch(y.map(D=>D.ez));return y.map((D,x)=>D.toAffine(E[x])).map(m.fromAffine)}static msm(y,E){return B0(m,h,y,E)}_setWindowSize(y){O.setWindowSize(this,y)}assertValidity(){P(this)}equals(y){_(y);const{ex:E,ey:D,ez:x}=this,{ex:I,ey:$,ez:F}=y,k=l(E*F),H=l(I*x),V=l(D*F),K=l($*x);return k===H&&V===K}is0(){return this.equals(m.ZERO)}negate(){return new m(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:y}=e,{ex:E,ey:D,ez:x}=this,I=l(E*E),$=l(D*D),F=l(Yn*l(x*x)),k=l(y*I),H=E+D,V=l(l(H*H)-I-$),K=k+$,G=K-F,ee=k-$,W=l(V*G),se=l(K*ee),De=l(V*ee),Ie=l(G*K);return new m(W,se,Ie,De)}add(y){_(y);const{a:E,d:D}=e,{ex:x,ey:I,ez:$,et:F}=this,{ex:k,ey:H,ez:V,et:K}=y;if(E===BigInt(-1)){const cd=l((I-x)*(H+k)),ud=l((I+x)*(H-k)),ua=l(ud-cd);if(ua===ot)return this.double();const ld=l($*Yn*K),hd=l(F*Yn*V),fd=hd+ld,dd=ud+cd,gd=hd-ld,c8=l(fd*ua),u8=l(dd*gd),l8=l(fd*gd),h8=l(ua*dd);return new m(c8,u8,h8,l8)}const G=l(x*k),ee=l(I*H),W=l(F*D*K),se=l($*V),De=l((x+I)*(k+H)-G-ee),Ie=se-W,Ee=se+W,Oe=l(ee-E*G),Ce=l(De*Ie),br=l(Ee*Oe),o8=l(De*Oe),a8=l(Ie*Ee);return new m(Ce,br,a8,o8)}subtract(y){return this.add(y.negate())}wNAF(y){return O.wNAFCached(this,y,m.normalizeZ)}multiply(y){const E=y;Yr("scalar",E,Le,n);const{p:D,f:x}=this.wNAF(E);return m.normalizeZ([D,x])[0]}multiplyUnsafe(y,E=m.ZERO){const D=y;return Yr("scalar",D,ot,n),D===ot?v:this.is0()||D===Le?this:O.wNAFCachedUnsafe(this,D,m.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,n).is0()}toAffine(y){return R(this,y)}clearCofactor(){const{h:y}=e;return y===Le?this:this.multiplyUnsafe(y)}static fromHex(y,E=!1){const{d:D,a:x}=e,I=r.BYTES;y=vt("pointHex",y,I),as("zip215",E);const $=y.slice(),F=y[I-1];$[I-1]=F&-129;const k=Wn($),H=E?u:r.ORDER;Yr("pointHex.y",k,ot,H);const V=l(k*k),K=l(V-Le),G=l(D*V-x);let{isValid:ee,value:W}=f(K,G);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const se=(W&Le)===Le,De=(F&128)!==0;if(!E&&W===ot&&De)throw new Error("Point.fromHex: x=0 and x_0=1");return De!==se&&(W=l(-W)),m.fromAffine({x:W,y:k})}static fromPrivateKey(y){return C(y).point}toRawBytes(){const{x:y,y:E}=this.toAffine(),D=us(E,r.BYTES);return D[D.length-1]|=y&Le?128:0,D}toHex(){return cs(this.toRawBytes())}}m.BASE=new m(e.Gx,e.Gy,Le,l(e.Gx*e.Gy)),m.ZERO=new m(ot,Le,Le,ot);const{BASE:b,ZERO:v}=m,O=R0(m,a*8);function S(w){return ae(w,n)}function A(w){return S(Wn(w))}function C(w){const y=r.BYTES;w=vt("private key",w,y);const E=vt("hashed private key",s(w),2*y),D=g(E.slice(0,y)),x=E.slice(y,2*y),I=A(D),$=b.multiply(I),F=$.toRawBytes();return{head:D,prefix:x,scalar:I,point:$,pointBytes:F}}function L(w){return C(w).pointBytes}function T(w=new Uint8Array,...y){const E=Uc(...y);return A(s(d(E,vt("context",w),!!i)))}function N(w,y,E={}){w=vt("message",w),i&&(w=i(w));const{prefix:D,scalar:x,pointBytes:I}=C(y),$=T(E.context,D,w),F=b.multiply($).toRawBytes(),k=T(E.context,F,I,w),H=S($+k*x);Yr("signature.s",H,ot,n);const V=Uc(F,us(H,r.BYTES));return vt("result",V,r.BYTES*2)}const B=P0;function j(w,y,E,D=B){const{context:x,zip215:I}=D,$=r.BYTES;w=vt("signature",w,2*$),y=vt("message",y),E=vt("publicKey",E,$),I!==void 0&&as("zip215",I),i&&(y=i(y));const F=Wn(w.slice($,2*$));let k,H,V;try{k=m.fromHex(E,I),H=m.fromHex(w.slice(0,$),I),V=b.multiplyUnsafe(F)}catch{return!1}if(!I&&k.isSmallOrder())return!1;const K=T(x,H.toRawBytes(),k.toRawBytes(),y);return H.add(k.multiplyUnsafe(K)).subtract(V).clearCofactor().equals(m.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:L,sign:N,verify:j,ExtendedPoint:m,utils:{getExtendedPublicKey:C,randomPrivateKey:()=>o(r.BYTES),precompute(w=8,y=m.BASE){return y._setWindowSize(w),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const bs=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Wc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const U0=BigInt(1),Gc=BigInt(2);BigInt(3);const F0=BigInt(5),z0=BigInt(8);function j0(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=bs,o=t*t%s*t%s,a=pt(o,Gc,s)*o%s,c=pt(a,U0,s)*t%s,u=pt(c,F0,s)*c%s,l=pt(u,e,s)*u%s,h=pt(l,r,s)*l%s,f=pt(h,n,s)*h%s,g=pt(f,i,s)*f%s,d=pt(g,i,s)*f%s,p=pt(d,e,s)*u%s;return{pow_p_5_8:pt(p,Gc,s)*t%s,b2:o}}function k0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function M0(t,e){const r=bs,n=ae(e*e*e,r),i=ae(n*n*e,r),s=j0(t*i).pow_p_5_8;let o=ae(t*n*s,r);const a=ae(e*o*o,r),c=o,u=ae(o*Wc,r),l=a===t,h=a===ae(-t,r),f=a===ae(-t*Wc,r);return l&&(o=c),(h||f)&&(o=u),x0(o,r)&&(o=ae(-o,r)),{isValid:l||h,value:o}}const H0=Hc(bs,void 0,!0),V0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:H0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:z0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:h0,randomBytes:Rc,adjustScalarBytes:k0,uvRatio:M0},Yc=L0(V0),K0="EdDSA",q0="JWT",Zn=".",Xn="base64url",Zc="utf8",Xc="utf8",W0=":",G0="did",Y0="key",Jc="base58btc",Z0="z",X0="K36",J0=32;function ws(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Qc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ws(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function eu(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Qc(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return ws(r)}function Q0(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,_=0,R=0,P=d.length;R!==P&&d[R]===0;)R++,p++;for(var m=(P-R)*l+1>>>0,b=new Uint8Array(m);R!==P;){for(var v=d[R],O=0,S=m-1;(v!==0||O<_)&&S!==-1;S--,O++)v+=256*b[S]>>>0,b[S]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");_=O,R++}for(var A=m-_;A!==m&&b[A]===0;)A++;for(var C=c.repeat(p);A<m;++A)C+=t.charAt(b[A]);return C}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var _=0,R=0;d[p]===c;)_++,p++;for(var P=(d.length-p)*u+1>>>0,m=new Uint8Array(P);d[p];){var b=r[d.charCodeAt(p)];if(b===255)return;for(var v=0,O=P-1;(b!==0||v<R)&&O!==-1;O--,v++)b+=a*m[O]>>>0,m[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");R=v,p++}if(d[p]!==" "){for(var S=P-R;S!==P&&m[S]===0;)S++;for(var A=new Uint8Array(_+(P-S)),C=_;S!==P;)A[C++]=m[S++];return A}}}function g(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:g}}var ey=Q0,ty=ey;const tu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ry=t=>new TextEncoder().encode(t),ny=t=>new TextDecoder().decode(t);class iy{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class sy{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ru(this,e)}}class oy{constructor(e){this.decoders=e}or(e){return ru(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ru=(t,e)=>new oy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class ay{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new iy(e,r,n),this.decoder=new sy(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Jn=({name:t,prefix:e,encode:r,decode:n})=>new ay(t,e,r,n),Zr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=ty(r,e);return Jn({prefix:t,name:e,encode:n,decode:s=>tu(i(s))})},cy=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},uy=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},pe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Jn({prefix:e,name:t,encode(i){return uy(i,n,r)},decode(i){return cy(i,n,r,t)}}),ly=Jn({prefix:"\0",name:"identity",encode:t=>ny(t),decode:t=>ry(t)});var hy=Object.freeze({__proto__:null,identity:ly});const fy=pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var dy=Object.freeze({__proto__:null,base2:fy});const gy=pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var py=Object.freeze({__proto__:null,base8:gy});const yy=Zr({prefix:"9",name:"base10",alphabet:"0123456789"});var by=Object.freeze({__proto__:null,base10:yy});const wy=pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),my=pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ey=Object.freeze({__proto__:null,base16:wy,base16upper:my});const vy=pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_y=pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xy=pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sy=pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dy=pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Iy=pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Oy=pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ay=pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ty=pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ry=Object.freeze({__proto__:null,base32:vy,base32upper:_y,base32pad:xy,base32padupper:Sy,base32hex:Dy,base32hexupper:Iy,base32hexpad:Oy,base32hexpadupper:Ay,base32z:Ty});const By=Zr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Cy=Zr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ny=Object.freeze({__proto__:null,base36:By,base36upper:Cy});const Py=Zr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$y=Zr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ly=Object.freeze({__proto__:null,base58btc:Py,base58flickr:$y});const Uy=pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fy=pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zy=pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),jy=pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ky=Object.freeze({__proto__:null,base64:Uy,base64pad:Fy,base64url:zy,base64urlpad:jy});const nu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),My=nu.reduce((t,e,r)=>(t[r]=e,t),[]),Hy=nu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Vy(t){return t.reduce((e,r)=>(e+=My[r],e),"")}function Ky(t){const e=[];for(const r of t){const n=Hy[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const qy=Jn({prefix:"\u{1F680}",name:"base256emoji",encode:Vy,decode:Ky});var Wy=Object.freeze({__proto__:null,base256emoji:qy}),Gy=su,iu=128,Yy=127,Zy=~Yy,Xy=Math.pow(2,31);function su(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Xy;)e[r++]=t&255|iu,t/=128;for(;t&Zy;)e[r++]=t&255|iu,t>>>=7;return e[r]=t|0,su.bytes=r-n+1,e}var Jy=ms,Qy=128,ou=127;function ms(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw ms.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&ou)<<i:(o&ou)*Math.pow(2,i),i+=7}while(o>=Qy);return ms.bytes=s-n,r}var eb=Math.pow(2,7),tb=Math.pow(2,14),rb=Math.pow(2,21),nb=Math.pow(2,28),ib=Math.pow(2,35),sb=Math.pow(2,42),ob=Math.pow(2,49),ab=Math.pow(2,56),cb=Math.pow(2,63),ub=function(t){return t<eb?1:t<tb?2:t<rb?3:t<nb?4:t<ib?5:t<sb?6:t<ob?7:t<ab?8:t<cb?9:10},lb={encode:Gy,decode:Jy,encodingLength:ub},au=lb;const cu=(t,e,r=0)=>(au.encode(t,e,r),e),uu=t=>au.encodingLength(t),Es=(t,e)=>{const r=e.byteLength,n=uu(t),i=n+uu(r),s=new Uint8Array(i+r);return cu(t,s,0),cu(r,s,n),s.set(e,i),new hb(t,r,e,s)};class hb{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const lu=({name:t,code:e,encode:r})=>new fb(t,e,r);class fb{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Es(this.code,r):r.then(n=>Es(this.code,n))}else throw Error("Unknown type, must be binary type")}}const hu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),db=lu({name:"sha2-256",code:18,encode:hu("SHA-256")}),gb=lu({name:"sha2-512",code:19,encode:hu("SHA-512")});var pb=Object.freeze({__proto__:null,sha256:db,sha512:gb});const fu=0,yb="identity",du=tu;var bb=Object.freeze({__proto__:null,identity:{code:fu,name:yb,encode:du,digest:t=>Es(fu,du(t))}});new TextEncoder,new TextDecoder;const gu={...hy,...dy,...py,...by,...Ey,...Ry,...Ny,...Ly,...ky,...Wy};({...pb,...bb});function pu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const yu=pu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),vs=pu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Qc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),bu={utf8:yu,"utf-8":yu,hex:gu.base16,latin1:vs,ascii:vs,binary:vs,...gu};function Qn(t,e="utf8"){const r=bu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Ir(t,e="utf8"){const r=bu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ws(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function wu(t){return Er(Qn(Ir(t,Xn),Zc))}function ei(t){return Qn(Ir(sr(t),Zc),Xn)}function mu(t){const e=Ir(X0,Jc),r=Z0+Qn(eu([e,t]),Jc);return[G0,Y0,r].join(W0)}function wb(t){return Qn(t,Xn)}function mb(t){return Ir(t,Xn)}function Eb(t){return Ir([ei(t.header),ei(t.payload)].join(Zn),Xc)}function vb(t){return[ei(t.header),ei(t.payload),wb(t.signature)].join(Zn)}function _s(t){const e=t.split(Zn),r=wu(e[0]),n=wu(e[1]),i=mb(e[2]),s=Ir(e.slice(0,2).join(Zn),Xc);return{header:r,payload:n,signature:i,data:s}}function Eu(t=Rc(J0)){const e=Yc.getPublicKey(t);return{secretKey:eu([t,e]),publicKey:e}}async function _b(t,e,r,n,i=M.fromMiliseconds(Date.now())){const s={alg:K0,typ:q0},o=mu(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=Eb({header:s,payload:c}),l=Yc.sign(u,n.secretKey.slice(0,32));return vb({header:s,payload:c,signature:l})}function xb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,_=0,R=0,P=d.length;R!==P&&d[R]===0;)R++,p++;for(var m=(P-R)*l+1>>>0,b=new Uint8Array(m);R!==P;){for(var v=d[R],O=0,S=m-1;(v!==0||O<_)&&S!==-1;S--,O++)v+=256*b[S]>>>0,b[S]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");_=O,R++}for(var A=m-_;A!==m&&b[A]===0;)A++;for(var C=c.repeat(p);A<m;++A)C+=t.charAt(b[A]);return C}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var _=0,R=0;d[p]===c;)_++,p++;for(var P=(d.length-p)*u+1>>>0,m=new Uint8Array(P);d[p];){var b=r[d.charCodeAt(p)];if(b===255)return;for(var v=0,O=P-1;(b!==0||v<R)&&O!==-1;O--,v++)b+=a*m[O]>>>0,m[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");R=v,p++}if(d[p]!==" "){for(var S=P-R;S!==P&&m[S]===0;)S++;for(var A=new Uint8Array(_+(P-S)),C=_;S!==P;)A[C++]=m[S++];return A}}}function g(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:g}}var Sb=xb,Db=Sb;const vu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Ib=t=>new TextEncoder().encode(t),Ob=t=>new TextDecoder().decode(t);class Ab{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Tb{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _u(this,e)}}class Rb{constructor(e){this.decoders=e}or(e){return _u(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _u=(t,e)=>new Rb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Bb{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Ab(e,r,n),this.decoder=new Tb(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:n})=>new Bb(t,e,r,n),Xr=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=Db(r,e);return ti({prefix:t,name:e,encode:n,decode:s=>vu(i(s))})},Cb=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Nb=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ye=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>ti({prefix:e,name:t,encode(i){return Nb(i,n,r)},decode(i){return Cb(i,n,r,t)}}),Pb=ti({prefix:"\0",name:"identity",encode:t=>Ob(t),decode:t=>Ib(t)});var $b=Object.freeze({__proto__:null,identity:Pb});const Lb=ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ub=Object.freeze({__proto__:null,base2:Lb});const Fb=ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var zb=Object.freeze({__proto__:null,base8:Fb});const jb=Xr({prefix:"9",name:"base10",alphabet:"0123456789"});var kb=Object.freeze({__proto__:null,base10:jb});const Mb=ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Hb=ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Vb=Object.freeze({__proto__:null,base16:Mb,base16upper:Hb});const Kb=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qb=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Wb=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Gb=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Yb=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Zb=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Xb=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Jb=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Qb=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ew=Object.freeze({__proto__:null,base32:Kb,base32upper:qb,base32pad:Wb,base32padupper:Gb,base32hex:Yb,base32hexupper:Zb,base32hexpad:Xb,base32hexpadupper:Jb,base32z:Qb});const tw=Xr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rw=Xr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var nw=Object.freeze({__proto__:null,base36:tw,base36upper:rw});const iw=Xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),sw=Xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ow=Object.freeze({__proto__:null,base58btc:iw,base58flickr:sw});const aw=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),cw=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uw=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),lw=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var hw=Object.freeze({__proto__:null,base64:aw,base64pad:cw,base64url:uw,base64urlpad:lw});const xu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),fw=xu.reduce((t,e,r)=>(t[r]=e,t),[]),dw=xu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function gw(t){return t.reduce((e,r)=>(e+=fw[r],e),"")}function pw(t){const e=[];for(const r of t){const n=dw[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const yw=ti({prefix:"\u{1F680}",name:"base256emoji",encode:gw,decode:pw});var bw=Object.freeze({__proto__:null,base256emoji:yw}),ww=Du,Su=128,mw=127,Ew=~mw,vw=Math.pow(2,31);function Du(t,e,r){e=e||[],r=r||0;for(var n=r;t>=vw;)e[r++]=t&255|Su,t/=128;for(;t&Ew;)e[r++]=t&255|Su,t>>>=7;return e[r]=t|0,Du.bytes=r-n+1,e}var _w=xs,xw=128,Iu=127;function xs(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw xs.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Iu)<<i:(o&Iu)*Math.pow(2,i),i+=7}while(o>=xw);return xs.bytes=s-n,r}var Sw=Math.pow(2,7),Dw=Math.pow(2,14),Iw=Math.pow(2,21),Ow=Math.pow(2,28),Aw=Math.pow(2,35),Tw=Math.pow(2,42),Rw=Math.pow(2,49),Bw=Math.pow(2,56),Cw=Math.pow(2,63),Nw=function(t){return t<Sw?1:t<Dw?2:t<Iw?3:t<Ow?4:t<Aw?5:t<Tw?6:t<Rw?7:t<Bw?8:t<Cw?9:10},Pw={encode:ww,decode:_w,encodingLength:Nw},Ou=Pw;const Au=(t,e,r=0)=>(Ou.encode(t,e,r),e),Tu=t=>Ou.encodingLength(t),Ss=(t,e)=>{const r=e.byteLength,n=Tu(t),i=n+Tu(r),s=new Uint8Array(i+r);return Au(t,s,0),Au(r,s,n),s.set(e,i),new $w(t,r,e,s)};class $w{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const Ru=({name:t,code:e,encode:r})=>new Lw(t,e,r);class Lw{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ss(this.code,r):r.then(n=>Ss(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Bu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Uw=Ru({name:"sha2-256",code:18,encode:Bu("SHA-256")}),Fw=Ru({name:"sha2-512",code:19,encode:Bu("SHA-512")});var zw=Object.freeze({__proto__:null,sha256:Uw,sha512:Fw});const Cu=0,jw="identity",Nu=vu;var kw=Object.freeze({__proto__:null,identity:{code:Cu,name:jw,encode:Nu,digest:t=>Ss(Cu,Nu(t))}});new TextEncoder,new TextDecoder;const Pu={...$b,...Ub,...zb,...kb,...Vb,...ew,...nw,...ow,...hw,...bw};({...zw,...kw});function Ds(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function $u(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ds(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Lu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Uu=Lu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Is=Lu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=$u(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Fu={utf8:Uu,"utf-8":Uu,hex:Pu.base16,latin1:Is,ascii:Is,binary:Is,...Pu};function We(t,e="utf8"){const r=Fu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ds(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var zu=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Mw=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),Hw=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Vw=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),Kw=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),qw=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Ww=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Gw=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ju=3,Yw=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Ww]],ku=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Zw(t){return t?Mu(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new qw:typeof navigator<"u"?Mu(navigator.userAgent):Qw()}function Xw(t){return t!==""&&Yw.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function Mu(t){var e=Xw(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new Kw;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<ju&&(i=zu(zu([],i,!0),e1(ju-i.length),!0)):i=[];var s=i.join("."),o=Jw(t),a=Gw.exec(t);return a&&a[1]?new Vw(r,s,o,a[1]):new Mw(r,s,o)}function Jw(t){for(var e=0,r=ku.length;e<r;e++){var n=ku[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function Qw(){var t=typeof process<"u"&&process.version;return t?new Hw(process.version.slice(1)):null}function e1(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var re={};Object.defineProperty(re,"__esModule",{value:!0}),re.getLocalStorage=re.getLocalStorageOrThrow=re.getCrypto=re.getCryptoOrThrow=Hu=re.getLocation=re.getLocationOrThrow=Os=re.getNavigator=re.getNavigatorOrThrow=Ar=re.getDocument=re.getDocumentOrThrow=re.getFromWindowOrThrow=re.getFromWindow=void 0;function cr(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}re.getFromWindow=cr;function Or(t){const e=cr(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}re.getFromWindowOrThrow=Or;function t1(){return Or("document")}re.getDocumentOrThrow=t1;function r1(){return cr("document")}var Ar=re.getDocument=r1;function n1(){return Or("navigator")}re.getNavigatorOrThrow=n1;function i1(){return cr("navigator")}var Os=re.getNavigator=i1;function s1(){return Or("location")}re.getLocationOrThrow=s1;function o1(){return cr("location")}var Hu=re.getLocation=o1;function a1(){return Or("crypto")}re.getCryptoOrThrow=a1;function c1(){return cr("crypto")}re.getCrypto=c1;function u1(){return Or("localStorage")}re.getLocalStorageOrThrow=u1;function l1(){return cr("localStorage")}re.getLocalStorage=l1;var As={};Object.defineProperty(As,"__esModule",{value:!0});var Vu=As.getWindowMetadata=void 0;const Ku=re;function h1(){let t,e;try{t=Ku.getDocumentOrThrow(),e=Ku.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),f=[];for(let g=0;g<h.length;g++){const d=h[g],p=d.getAttribute("rel");if(p&&p.toLowerCase().indexOf("icon")>-1){const _=d.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(_.indexOf("/")===0)R+=_;else{const P=e.pathname.split("/");P.pop();const m=P.join("/");R+=m+"/"+_}f.push(R)}else if(_.indexOf("//")===0){const R=e.protocol+_;f.push(R)}else f.push(_)}}return f}function n(...h){const f=t.getElementsByTagName("meta");for(let g=0;g<f.length;g++){const d=f[g],p=["itemprop","property","name"].map(_=>d.getAttribute(_)).filter(_=>_?h.includes(_):!1);if(p.length&&p){const _=d.getAttribute("content");if(_)return _}}return""}function i(){let h=n("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}Vu=As.getWindowMetadata=h1;const qu="2.30.6";let Ts={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${qu}`};class Jr extends Error{constructor(e,r={}){const n=r.cause instanceof Jr?r.cause.details:r.cause?.message?r.cause.message:r.details,i=r.cause instanceof Jr&&r.cause.docsPath||r.docsPath,s=Ts.getDocsUrl?.({...r,docsPath:i}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...n?[`Details: ${n}`]:[],...Ts.version?[`Version: ${Ts.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=i,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=qu}walk(e){return Wu(this,e)}}function Wu(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Wu(t.cause,e):e?null:t}class Gu extends Jr{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function f1(t,{dir:e,size:r=32}={}){return typeof t=="string"?d1(t,{dir:e,size:r}):g1(t,{dir:e,size:r})}function d1(t,{dir:e,size:r=32}={}){if(r===null)return t;const n=t.replace("0x","");if(n.length>r*2)throw new Gu({size:Math.ceil(n.length/2),targetSize:r,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function g1(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Gu({size:t.length,targetSize:r,type:"bytes"});const n=new Uint8Array(r);for(let i=0;i<r;i++){const s=e==="right";n[s?i:r-i-1]=t[s?i:t.length-i-1]}return n}class p1 extends Jr{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}function y1(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new p1({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:n,value:`${t}${c}`})}const a=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?f1(a,{size:n}):a}const ri=BigInt(2**32-1),Yu=BigInt(32);function b1(t,e=!1){return e?{h:Number(t&ri),l:Number(t>>Yu&ri)}:{h:Number(t>>Yu&ri)|0,l:Number(t&ri)|0}}function w1(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=b1(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const m1=(t,e,r)=>t<<r|e>>>32-r,E1=(t,e,r)=>e<<r|t>>>32-r,v1=(t,e,r)=>e<<r-32|t>>>64-r,_1=(t,e,r)=>t<<r-32|e>>>64-r,Tr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function x1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Qr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ur(t,...e){if(!x1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function S1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Qr(t.outputLen),Qr(t.blockLen)}function Rr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zu(t,e){ur(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function D1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Br(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Rs(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function yt(t,e){return t<<32-e|t>>>e}const I1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function O1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function A1(t){for(let e=0;e<t.length;e++)t[e]=O1(t[e]);return t}const Xu=I1?t=>t:A1;function T1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ni(t){return typeof t=="string"&&(t=T1(t)),ur(t),t}function R1(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];ur(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Bs{}function Ju(t){const e=n=>t().update(ni(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function B1(t=32){if(Tr&&typeof Tr.getRandomValues=="function")return Tr.getRandomValues(new Uint8Array(t));if(Tr&&typeof Tr.randomBytes=="function")return Uint8Array.from(Tr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const C1=BigInt(0),en=BigInt(1),N1=BigInt(2),P1=BigInt(7),$1=BigInt(256),L1=BigInt(113),Qu=[],el=[],tl=[];for(let t=0,e=en,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Qu.push(2*(5*n+r)),el.push((t+1)*(t+2)/2%64);let i=C1;for(let s=0;s<7;s++)e=(e<<en^(e>>P1)*L1)%$1,e&N1&&(i^=en<<(en<<BigInt(s))-en);tl.push(i)}const rl=w1(tl,!0),U1=rl[0],F1=rl[1],nl=(t,e,r)=>r>32?v1(t,e,r):m1(t,e,r),il=(t,e,r)=>r>32?_1(t,e,r):E1(t,e,r);function z1(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=nl(u,l,1)^r[a],f=il(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=h,t[o+g+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=el[o],c=nl(i,s,a),u=il(i,s,a),l=Qu[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=U1[n],t[1]^=F1[n]}Br(r)}class Cs extends Bs{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Qr(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=D1(this.state)}clone(){return this._cloneInto()}keccak(){Xu(this.state32),z1(this.state32,this.rounds),Xu(this.state32),this.posOut=0,this.pos=0}update(e){Rr(this),e=ni(e),ur(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Rr(this,!1),ur(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Qr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Zu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Br(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Cs(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const j1=(t,e,r)=>Ju(()=>new Cs(e,t,r)),k1=j1(1,136,256/8);class M1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}function H1(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function V1(t,e,r){return t&e^~t&r}function K1(t,e,r){return t&e^t&r^e&r}class q1 extends Bs{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Rs(this.buffer)}update(e){Rr(this),e=ni(e),ur(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Rs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rr(this),Zu(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Br(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;H1(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Rs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Ut=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),W1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64);class G1 extends q1{constructor(e=32){super(64,e,8,!1),this.A=Ut[0]|0,this.B=Ut[1]|0,this.C=Ut[2]|0,this.D=Ut[3]|0,this.E=Ut[4]|0,this.F=Ut[5]|0,this.G=Ut[6]|0,this.H=Ut[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Ft[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=Ft[h-15],g=Ft[h-2],d=yt(f,7)^yt(f,18)^f>>>3,p=yt(g,17)^yt(g,19)^g>>>10;Ft[h]=p+Ft[h-7]+d+Ft[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=yt(a,6)^yt(a,11)^yt(a,25),g=l+f+V1(a,c,u)+W1[h]+Ft[h]|0,p=(yt(n,2)^yt(n,13)^yt(n,22))+K1(n,i,s)|0;l=u,u=c,c=a,a=o+g|0,o=s,s=i,i=n,n=g+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Br(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),Br(this.buffer)}}const Y1=Ju(()=>new G1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ns=BigInt(0),Ps=BigInt(1);function tn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function $s(t){if(!tn(t))throw new Error("Uint8Array expected")}function rn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function ii(t){const e=t.toString(16);return e.length&1?"0"+e:e}function sl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ns:BigInt("0x"+t)}const ol=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Z1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nn(t){if($s(t),ol)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Z1[t[r]];return e}const _t={_0:48,_9:57,A:65,F:70,a:97,f:102};function al(t){if(t>=_t._0&&t<=_t._9)return t-_t._0;if(t>=_t.A&&t<=_t.F)return t-(_t.A-10);if(t>=_t.a&&t<=_t.f)return t-(_t.a-10)}function si(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(ol)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=al(t.charCodeAt(s)),a=al(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function lr(t){return sl(nn(t))}function cl(t){return $s(t),sl(nn(Uint8Array.from(t).reverse()))}function sn(t,e){return si(t.toString(16).padStart(e*2,"0"))}function ul(t,e){return sn(t,e).reverse()}function tt(t,e,r){let n;if(typeof e=="string")try{n=si(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(tn(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function oi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];$s(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Ls=t=>typeof t=="bigint"&&Ns<=t;function Us(t,e,r){return Ls(t)&&Ls(e)&&Ls(r)&&e<=t&&t<r}function Cr(t,e,r,n){if(!Us(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function X1(t){let e;for(e=0;t>Ns;t>>=Ps,e+=1);return e}const ai=t=>(Ps<<BigInt(t))-Ps,Fs=t=>new Uint8Array(t),ll=t=>Uint8Array.from(t);function J1(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Fs(t),i=Fs(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>r(i,n,...h),c=(h=Fs(0))=>{i=a(ll([0]),h),n=a(),h.length!==0&&(i=a(ll([1]),h),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const g=n.slice();f.push(g),h+=n.length}return oi(...f)};return(h,f)=>{o(),c(h);let g;for(;!(g=f(u()));)c();return o(),g}}const Q1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||tn(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ci(t,e,r={}){const n=(i,s,o)=>{const a=Q1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function hl(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const em="0.1.1";function tm(){return em}class Ae extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof Ae){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),i=r.cause instanceof Ae&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${tm()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return fl(this,e)}}function fl(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?fl(t.cause,e):e?null:t}function rm(t,e){if(pl(t)>e)throw new lm({givenSize:pl(t),maxSize:e})}const xt={zero:48,nine:57,A:65,F:70,a:97,f:102};function dl(t){if(t>=xt.zero&&t<=xt.nine)return t-xt.zero;if(t>=xt.A&&t<=xt.F)return t-(xt.A-10);if(t>=xt.a&&t<=xt.f)return t-(xt.a-10)}function nm(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new hm({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function zs(t,e){if(ks(t)>e)throw new wm({givenSize:ks(t),maxSize:e})}function gl(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new mm({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const im=new TextEncoder;function sm(t){return t instanceof Uint8Array?t:typeof t=="string"?am(t):om(t)}function om(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function am(t,e={}){const{size:r}=e;let n=t;r&&(zs(t,r),n=js(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=dl(i.charCodeAt(c++)),l=dl(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new Ae(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function cm(t,e={}){const{size:r}=e,n=im.encode(t);return typeof r=="number"?(rm(n,r),um(n,r)):n}function um(t,e){return nm(t,{dir:"right",size:e})}function pl(t){return t.length}class lm extends Ae{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class hm extends Ae{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const fm=new TextEncoder,dm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function yl(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function gm(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(zs(r,e.size),ui(r,e.size)):r}function bl(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=dm[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(zs(n,e.size),js(n,e.size)):n}function pm(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new bm({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?ui(c,n):c}function ym(t,e={}){return bl(fm.encode(t),e)}function ui(t,e){return gl(t,{dir:"left",size:e})}function js(t,e){return gl(t,{dir:"right",size:e})}function ks(t){return Math.ceil((t.length-2)/2)}class bm extends Ae{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class wm extends Ae{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class mm extends Ae{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}new M1(128),y1(0,{size:32});function Em(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=k1(sm(t));return r==="Bytes"?n:bl(n)}class vm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const Ms={checksum:new vm(8192)}.checksum,_m=/^0x[a-fA-F0-9]{40}$/;function wl(t,e={}){const{strict:r=!0}=e;if(!_m.test(t))throw new ml({address:t,cause:new Sm});if(r){if(t.toLowerCase()===t)return;if(xm(t)!==t)throw new ml({address:t,cause:new Dm})}}function xm(t){if(Ms.has(t))return Ms.get(t);wl(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Em(cm(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return Ms.set(t,i),i}class ml extends Ae{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Sm extends Ae{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Dm extends Ae{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Im=/^(.*)\[([0-9]*)\]$/,Om=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,Am=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Hs(t,e){if(t.length!==e.length)throw new Rm({expectedLength:t.length,givenLength:e.length});const r=[];for(let n=0;n<t.length;n++){const i=t[n],s=e[n];r.push(Hs.encode(i,s))}return yl(...r)}(function(t){function e(r,n,i=!1){if(r==="address"){const c=n;return wl(c),ui(c.toLowerCase(),i?32:0)}if(r==="string")return ym(n);if(r==="bytes")return n;if(r==="bool")return ui(gm(n),i?32:1);const s=r.match(Am);if(s){const[c,u,l="256"]=s,h=Number.parseInt(l)/8;return pm(n,{size:i?32:h,signed:u==="int"})}const o=r.match(Om);if(o){const[c,u]=o;if(Number.parseInt(u)!==(n.length-2)/2)throw new Tm({expectedSize:Number.parseInt(u),value:n});return js(n,i?32:0)}const a=r.match(Im);if(a&&Array.isArray(n)){const[c,u]=a,l=[];for(let h=0;h<n.length;h++)l.push(e(u,n[h],!0));return l.length===0?"0x":yl(...l)}throw new Bm(r)}t.encode=e})(Hs||(Hs={}));class Tm extends Ae{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${ks(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class Rm extends Ae{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class Bm extends Ae{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class El extends Bs{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,S1(e);const n=ni(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Br(s)}update(e){return Rr(this),this.iHash.update(e),this}digestInto(e){Rr(this),ur(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const vl=(t,e,r)=>new El(t,e).update(r).digest();vl.create=(t,e)=>new El(t,e);const Ue=BigInt(0),Te=BigInt(1),hr=BigInt(2),Cm=BigInt(3),_l=BigInt(4),xl=BigInt(5),Sl=BigInt(8);function Fe(t,e){const r=t%e;return r>=Ue?r:e+r}function rt(t,e,r){let n=t;for(;e-- >Ue;)n*=n,n%=r;return n}function Vs(t,e){if(t===Ue)throw new Error("invert: expected non-zero number");if(e<=Ue)throw new Error("invert: expected positive modulus, got "+e);let r=Fe(t,e),n=e,i=Ue,s=Te;for(;r!==Ue;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==Te)throw new Error("invert: does not exist");return Fe(i,e)}function Dl(t,e){const r=(t.ORDER+Te)/_l,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function Nm(t,e){const r=(t.ORDER-xl)/Sl,n=t.mul(e,hr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,hr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Pm(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Te,r=0;for(;e%hr===Ue;)e/=hr,r++;let n=hr;const i=Ks(t);for(;Ol(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Dl;let s=i.pow(n,e);const o=(e+Te)/hr;return function(c,u){if(c.is0(u))return u;if(Ol(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,s),f=c.pow(u,e),g=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,p=c.sqr(f);for(;!c.eql(p,c.ONE);)if(d++,p=c.sqr(p),d===l)throw new Error("Cannot find square root");const _=Te<<BigInt(l-d-1),R=c.pow(h,_);l=d,h=c.sqr(R),f=c.mul(f,h),g=c.mul(g,R)}return g}}function $m(t){return t%_l===Cm?Dl:t%Sl===xl?Nm:Pm(t)}const Lm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Um(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Lm.reduce((n,i)=>(n[i]="function",n),e);return ci(t,r)}function Fm(t,e,r){if(r<Ue)throw new Error("invalid exponent, negatives unsupported");if(r===Ue)return t.ONE;if(r===Te)return e;let n=t.ONE,i=e;for(;r>Ue;)r&Te&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Te;return n}function Il(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function Ol(t,e){const r=(t.ORDER-Te)/hr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Al(t,e){e!==void 0&&Qr(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ks(t,e,r=!1,n={}){if(t<=Ue)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Al(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:ai(i),ZERO:Ue,ONE:Te,create:c=>Fe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ue<=c&&c<t},is0:c=>c===Ue,isOdd:c=>(c&Te)===Te,neg:c=>Fe(-c,t),eql:(c,u)=>c===u,sqr:c=>Fe(c*c,t),add:(c,u)=>Fe(c+u,t),sub:(c,u)=>Fe(c-u,t),mul:(c,u)=>Fe(c*u,t),pow:(c,u)=>Fm(a,c,u),div:(c,u)=>Fe(c*Vs(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Vs(c,t),sqrt:n.sqrt||(c=>(o||(o=$m(t)),o(a,c))),toBytes:c=>r?ul(c,s):sn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?cl(c):lr(c)},invertBatch:c=>Il(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Tl(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Rl(t){const e=Tl(t);return e+Math.ceil(e/2)}function zm(t,e,r=!1){const n=t.length,i=Tl(e),s=Rl(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?cl(t):lr(t),a=Fe(o,e-Te)+Te;return r?ul(a,i):sn(a,i)}const Bl=BigInt(0),qs=BigInt(1);function Ws(t,e){const r=e.negate();return t?r:e}function Cl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Gs(t,e){Cl(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=ai(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Nl(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=qs);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:u}}function jm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function km(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Ys=new WeakMap,Pl=new WeakMap;function Zs(t){return Pl.get(t)||1}function Mm(t,e){return{constTimeNegate:Ws,hasPrecomputes(r){return Zs(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Bl;)n&qs&&(i=i.add(s)),s=s.double(),n>>=qs;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Gs(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=Gs(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:d}=Nl(i,c,a);i=u,h?o=o.add(Ws(g,n[d])):s=s.add(Ws(f,n[l]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=Gs(r,e);for(let a=0;a<o.windows&&i!==Bl;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=Nl(i,a,o);if(i=c,!l){const f=n[u];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,n,i){let s=Ys.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Ys.set(n,i(s))),s},wNAFCached(r,n,i){const s=Zs(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Zs(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Cl(n,e),Pl.set(r,n),Ys.delete(r)}}}function Hm(t,e,r,n){jm(r,t),km(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=X1(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=ai(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let g=h;g>=0;g-=c){l.fill(o);for(let p=0;p<s;p++){const _=n[p],R=Number(_>>BigInt(g)&u);l[R]=l[R].add(r[p])}let d=o;for(let p=l.length-1,_=o;p>0;p--)_=_.add(l[p]),d=d.add(_);if(f=f.add(d),g!==0)for(let p=0;p<c;p++)f=f.double()}return f}function $l(t){return Um(t.Fp),ci(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Al(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Ll(t){t.lowS!==void 0&&rn("lowS",t.lowS),t.prehash!==void 0&&rn("prehash",t.prehash)}function Vm(t){const e=$l(t);ci(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Km extends Error{constructor(e=""){super(e)}}const St={Err:Km,_tlv:{encode:(t,e)=>{const{Err:r}=St;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=ii(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?ii(i.length/2|128):"";return ii(t)+s+i+e},decode(t,e){const{Err:r}=St;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=St;if(t<Dt)throw new e("integer: negative integers are not allowed");let r=ii(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=St;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return lr(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=St,i=tt("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=St,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function Xs(t,e){return nn(sn(t,e))}const Dt=BigInt(0),he=BigInt(1);BigInt(2);const Js=BigInt(3),qm=BigInt(4);function Wm(t){const e=Vm(t),{Fp:r}=e,n=Ks(e.n,e.nBitLength),i=e.toBytes||((m,b,v)=>{const O=b.toAffine();return oi(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),s=e.fromBytes||(m=>{const b=m.subarray(1),v=r.fromBytes(b.subarray(0,r.BYTES)),O=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:v,y:O}});function o(m){const{a:b,b:v}=e,O=r.sqr(m),S=r.mul(O,m);return r.add(r.add(S,r.mul(m,b)),v)}function a(m,b){const v=r.sqr(b),O=o(m);return r.eql(v,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Js),qm),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(m){return Us(m,he,e.n)}function h(m){const{allowedPrivateKeyLengths:b,nByteLength:v,wrapPrivateKey:O,n:S}=e;if(b&&typeof m!="bigint"){if(tn(m)&&(m=nn(m)),typeof m!="string"||!b.includes(m.length))throw new Error("invalid private key");m=m.padStart(v*2,"0")}let A;try{A=typeof m=="bigint"?m:lr(tt("private key",m,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof m)}return O&&(A=Fe(A,S)),Cr("private key",A,he,S),A}function f(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}const g=hl((m,b)=>{const{px:v,py:O,pz:S}=m;if(r.eql(S,r.ONE))return{x:v,y:O};const A=m.is0();b==null&&(b=A?r.ONE:r.inv(S));const C=r.mul(v,b),L=r.mul(O,b),T=r.mul(S,b);if(A)return{x:r.ZERO,y:r.ZERO};if(!r.eql(T,r.ONE))throw new Error("invZ was invalid");return{x:C,y:L}}),d=hl(m=>{if(m.is0()){if(e.allowInfinityPoint&&!r.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:b,y:v}=m.toAffine();if(!r.isValid(b)||!r.isValid(v))throw new Error("bad point: x or y not FE");if(!a(b,v))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(b,v,O){if(b==null||!r.isValid(b))throw new Error("x required");if(v==null||!r.isValid(v)||r.is0(v))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=b,this.py=v,this.pz=O,Object.freeze(this)}static fromAffine(b){const{x:v,y:O}=b||{};if(!b||!r.isValid(v)||!r.isValid(O))throw new Error("invalid affine point");if(b instanceof p)throw new Error("projective point not allowed");const S=A=>r.eql(A,r.ZERO);return S(v)&&S(O)?p.ZERO:new p(v,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const v=Il(r,b.map(O=>O.pz));return b.map((O,S)=>O.toAffine(v[S])).map(p.fromAffine)}static fromHex(b){const v=p.fromAffine(s(tt("pointHex",b)));return v.assertValidity(),v}static fromPrivateKey(b){return p.BASE.multiply(h(b))}static msm(b,v){return Hm(p,n,b,v)}_setWindowSize(b){P.setWindowSize(this,b)}assertValidity(){d(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:v,py:O,pz:S}=this,{px:A,py:C,pz:L}=b,T=r.eql(r.mul(v,L),r.mul(A,S)),N=r.eql(r.mul(O,L),r.mul(C,S));return T&&N}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:v}=e,O=r.mul(v,Js),{px:S,py:A,pz:C}=this;let L=r.ZERO,T=r.ZERO,N=r.ZERO,B=r.mul(S,S),j=r.mul(A,A),w=r.mul(C,C),y=r.mul(S,A);return y=r.add(y,y),N=r.mul(S,C),N=r.add(N,N),L=r.mul(b,N),T=r.mul(O,w),T=r.add(L,T),L=r.sub(j,T),T=r.add(j,T),T=r.mul(L,T),L=r.mul(y,L),N=r.mul(O,N),w=r.mul(b,w),y=r.sub(B,w),y=r.mul(b,y),y=r.add(y,N),N=r.add(B,B),B=r.add(N,B),B=r.add(B,w),B=r.mul(B,y),T=r.add(T,B),w=r.mul(A,C),w=r.add(w,w),B=r.mul(w,y),L=r.sub(L,B),N=r.mul(w,j),N=r.add(N,N),N=r.add(N,N),new p(L,T,N)}add(b){f(b);const{px:v,py:O,pz:S}=this,{px:A,py:C,pz:L}=b;let T=r.ZERO,N=r.ZERO,B=r.ZERO;const j=e.a,w=r.mul(e.b,Js);let y=r.mul(v,A),E=r.mul(O,C),D=r.mul(S,L),x=r.add(v,O),I=r.add(A,C);x=r.mul(x,I),I=r.add(y,E),x=r.sub(x,I),I=r.add(v,S);let $=r.add(A,L);return I=r.mul(I,$),$=r.add(y,D),I=r.sub(I,$),$=r.add(O,S),T=r.add(C,L),$=r.mul($,T),T=r.add(E,D),$=r.sub($,T),B=r.mul(j,I),T=r.mul(w,D),B=r.add(T,B),T=r.sub(E,B),B=r.add(E,B),N=r.mul(T,B),E=r.add(y,y),E=r.add(E,y),D=r.mul(j,D),I=r.mul(w,I),E=r.add(E,D),D=r.sub(y,D),D=r.mul(j,D),I=r.add(I,D),y=r.mul(E,I),N=r.add(N,y),y=r.mul($,I),T=r.mul(x,T),T=r.sub(T,y),y=r.mul(x,E),B=r.mul($,B),B=r.add(B,y),new p(T,N,B)}subtract(b){return this.add(b.negate())}is0(){return this.equals(p.ZERO)}wNAF(b){return P.wNAFCached(this,b,p.normalizeZ)}multiplyUnsafe(b){const{endo:v,n:O}=e;Cr("scalar",b,Dt,O);const S=p.ZERO;if(b===Dt)return S;if(this.is0()||b===he)return this;if(!v||P.hasPrecomputes(this))return P.wNAFCachedUnsafe(this,b,p.normalizeZ);let{k1neg:A,k1:C,k2neg:L,k2:T}=v.splitScalar(b),N=S,B=S,j=this;for(;C>Dt||T>Dt;)C&he&&(N=N.add(j)),T&he&&(B=B.add(j)),j=j.double(),C>>=he,T>>=he;return A&&(N=N.negate()),L&&(B=B.negate()),B=new p(r.mul(B.px,v.beta),B.py,B.pz),N.add(B)}multiply(b){const{endo:v,n:O}=e;Cr("scalar",b,he,O);let S,A;if(v){const{k1neg:C,k1:L,k2neg:T,k2:N}=v.splitScalar(b);let{p:B,f:j}=this.wNAF(L),{p:w,f:y}=this.wNAF(N);B=P.constTimeNegate(C,B),w=P.constTimeNegate(T,w),w=new p(r.mul(w.px,v.beta),w.py,w.pz),S=B.add(w),A=j.add(y)}else{const{p:C,f:L}=this.wNAF(b);S=C,A=L}return p.normalizeZ([S,A])[0]}multiplyAndAddUnsafe(b,v,O){const S=p.BASE,A=(L,T)=>T===Dt||T===he||!L.equals(S)?L.multiplyUnsafe(T):L.multiply(T),C=A(this,v).add(A(b,O));return C.is0()?void 0:C}toAffine(b){return g(this,b)}isTorsionFree(){const{h:b,isTorsionFree:v}=e;if(b===he)return!0;if(v)return v(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:v}=e;return b===he?this:v?v(p,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return rn("isCompressed",b),this.assertValidity(),i(p,this,b)}toHex(b=!0){return rn("isCompressed",b),nn(this.toRawBytes(b))}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO);const{endo:_,nBitLength:R}=e,P=Mm(p,_?Math.ceil(R/2):R);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function Gm(t){const e=$l(t);return ci(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Ym(t){const e=Gm(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(w){return Fe(w,n)}function u(w){return Vs(w,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:g}=Wm({...e,toBytes(w,y,E){const D=y.toAffine(),x=r.toBytes(D.x),I=oi;return rn("isCompressed",E),E?I(Uint8Array.from([y.hasEvenY()?2:3]),x):I(Uint8Array.from([4]),x,r.toBytes(D.y))},fromBytes(w){const y=w.length,E=w[0],D=w.subarray(1);if(y===o&&(E===2||E===3)){const x=lr(D);if(!Us(x,he,r.ORDER))throw new Error("Point is not on curve");const I=f(x);let $;try{$=r.sqrt(I)}catch(H){const V=H instanceof Error?": "+H.message:"";throw new Error("Point is not on curve"+V)}const F=($&he)===he;return(E&1)===1!==F&&($=r.neg($)),{x,y:$}}else if(y===a&&E===4){const x=r.fromBytes(D.subarray(0,r.BYTES)),I=r.fromBytes(D.subarray(r.BYTES,2*r.BYTES));return{x,y:I}}else{const x=o,I=a;throw new Error("invalid Point, expected length of "+x+", or uncompressed "+I+", got "+y)}}});function d(w){const y=n>>he;return w>y}function p(w){return d(w)?c(-w):w}const _=(w,y,E)=>lr(w.slice(y,E));class R{constructor(y,E,D){Cr("r",y,he,n),Cr("s",E,he,n),this.r=y,this.s=E,D!=null&&(this.recovery=D),Object.freeze(this)}static fromCompact(y){const E=i;return y=tt("compactSignature",y,E*2),new R(_(y,0,E),_(y,E,2*E))}static fromDER(y){const{r:E,s:D}=St.toSig(tt("DER",y));return new R(E,D)}assertValidity(){}addRecoveryBit(y){return new R(this.r,this.s,y)}recoverPublicKey(y){const{r:E,s:D,recovery:x}=this,I=S(tt("msgHash",y));if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");const $=x===2||x===3?E+e.n:E;if($>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=(x&1)===0?"02":"03",k=l.fromHex(F+Xs($,r.BYTES)),H=u($),V=c(-I*H),K=c(D*H),G=l.BASE.multiplyAndAddUnsafe(k,V,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new R(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return si(this.toDERHex())}toDERHex(){return St.hexFromSig(this)}toCompactRawBytes(){return si(this.toCompactHex())}toCompactHex(){const y=i;return Xs(this.r,y)+Xs(this.s,y)}}const P={isValidPrivateKey(w){try{return h(w),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const w=Rl(e.n);return zm(e.randomBytes(w),e.n)},precompute(w=8,y=l.BASE){return y._setWindowSize(w),y.multiply(BigInt(3)),y}};function m(w,y=!0){return l.fromPrivateKey(w).toRawBytes(y)}function b(w){if(typeof w=="bigint")return!1;if(w instanceof l)return!0;const E=tt("key",w).length,D=r.BYTES,x=D+1,I=2*D+1;if(!(e.allowedPrivateKeyLengths||i===x))return E===x||E===I}function v(w,y,E=!0){if(b(w)===!0)throw new Error("first arg must be private key");if(b(y)===!1)throw new Error("second arg must be public key");return l.fromHex(y).multiply(h(w)).toRawBytes(E)}const O=e.bits2int||function(w){if(w.length>8192)throw new Error("input is too large");const y=lr(w),E=w.length*8-s;return E>0?y>>BigInt(E):y},S=e.bits2int_modN||function(w){return c(O(w))},A=ai(s);function C(w){return Cr("num < 2^"+s,w,Dt,A),sn(w,i)}function L(w,y,E=T){if(["recovered","canonical"].some(W=>W in E))throw new Error("sign() legacy options not supported");const{hash:D,randomBytes:x}=e;let{lowS:I,prehash:$,extraEntropy:F}=E;I==null&&(I=!0),w=tt("msgHash",w),Ll(E),$&&(w=tt("prehashed msgHash",D(w)));const k=S(w),H=h(y),V=[C(H),C(k)];if(F!=null&&F!==!1){const W=F===!0?x(r.BYTES):F;V.push(tt("extraEntropy",W))}const K=oi(...V),G=k;function ee(W){const se=O(W);if(!g(se))return;const De=u(se),Ie=l.BASE.multiply(se).toAffine(),Ee=c(Ie.x);if(Ee===Dt)return;const Oe=c(De*c(G+Ee*H));if(Oe===Dt)return;let Ce=(Ie.x===Ee?0:2)|Number(Ie.y&he),br=Oe;return I&&d(Oe)&&(br=p(Oe),Ce^=1),new R(Ee,br,Ce)}return{seed:K,k2sig:ee}}const T={lowS:e.lowS,prehash:!1},N={lowS:e.lowS,prehash:!1};function B(w,y,E=T){const{seed:D,k2sig:x}=L(w,y,E),I=e;return J1(I.hash.outputLen,I.nByteLength,I.hmac)(D,x)}l.BASE._setWindowSize(8);function j(w,y,E,D=N){const x=w;y=tt("msgHash",y),E=tt("publicKey",E);const{lowS:I,prehash:$,format:F}=D;if(Ll(D),"strict"in D)throw new Error("options.strict was renamed to lowS");if(F!==void 0&&F!=="compact"&&F!=="der")throw new Error("format must be compact or der");const k=typeof x=="string"||tn(x),H=!k&&!F&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!k&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let V,K;try{if(H&&(V=new R(x.r,x.s)),k){try{F!=="compact"&&(V=R.fromDER(x))}catch(Ce){if(!(Ce instanceof St.Err))throw Ce}!V&&F!=="der"&&(V=R.fromCompact(x))}K=l.fromHex(E)}catch{return!1}if(!V||I&&V.hasHighS())return!1;$&&(y=e.hash(y));const{r:G,s:ee}=V,W=S(y),se=u(ee),De=c(W*se),Ie=c(G*se),Ee=l.BASE.multiplyAndAddUnsafe(K,De,Ie)?.toAffine();return Ee?c(Ee.x)===G:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:v,sign:B,verify:j,ProjectivePoint:l,Signature:R,utils:P}}function Zm(t){return{hash:t,hmac:(e,...r)=>vl(t,e,R1(...r)),randomBytes:B1}}function Xm(t,e){const r=n=>Ym({...t,...Zm(n)});return{...r(e),create:r}}const Ul=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Fl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Jm=BigInt(0),Qm=BigInt(1),Qs=BigInt(2),zl=(t,e)=>(t+e/Qs)/e;function eE(t){const e=Ul,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=rt(l,r,e)*l%e,f=rt(h,r,e)*l%e,g=rt(f,Qs,e)*u%e,d=rt(g,i,e)*g%e,p=rt(d,s,e)*d%e,_=rt(p,a,e)*p%e,R=rt(_,c,e)*_%e,P=rt(R,a,e)*p%e,m=rt(P,r,e)*l%e,b=rt(m,o,e)*d%e,v=rt(b,n,e)*u%e,O=rt(v,Qs,e);if(!eo.eql(eo.sqr(O),t))throw new Error("Cannot find square root");return O}const eo=Ks(Ul,void 0,void 0,{sqrt:eE});Xm({a:Jm,b:BigInt(7),Fp:eo,n:Fl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Fl,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Qm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=zl(s*t,e),c=zl(-n*t,e);let u=Fe(t-a*r-c*i,e),l=Fe(-a*n-c*s,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},Y1);function tE(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0;const g=u.length;for(;f!==g&&u[f]===0;)f++,l++;const d=(g-f)*s+1>>>0,p=new Uint8Array(d);for(;f!==g;){let P=u[f],m=0;for(let b=d-1;(P!==0||m<h)&&b!==-1;b--,m++)P+=256*p[b]>>>0,p[b]=P%r>>>0,P=P/r>>>0;if(P!==0)throw new Error("Non-zero carry");h=m,f++}let _=d-h;for(;_!==d&&p[_]===0;)_++;let R=n.repeat(l);for(;_<d;++_)R+=t.charAt(p[_]);return R}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===n;)h++,l++;const g=(u.length-l)*i+1>>>0,d=new Uint8Array(g);for(;l<u.length;){const P=u.charCodeAt(l);if(P>255)return;let m=e[P];if(m===255)return;let b=0;for(let v=g-1;(m!==0||b<f)&&v!==-1;v--,b++)m+=r*d[v]>>>0,d[v]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");f=b,l++}let p=g-f;for(;p!==g&&d[p]===0;)p++;const _=new Uint8Array(h+(g-p));let R=h;for(;p!==g;)_[R++]=d[p++];return _}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var rE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";tE(rE);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function li(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function to(t,...e){if(!li(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function jl(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function kl(t){if(typeof t!="function")throw new Error("function expected");return!0}function zt(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function on(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function hi(t){if(!Array.isArray(t))throw new Error("array expected")}function fi(t,e){if(!jl(!0,e))throw new Error(`${t}: array of strings expected`)}function ro(t,e){if(!jl(!1,e))throw new Error(`${t}: array of numbers expected`)}function Ge(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function Ye(t){const e=typeof t=="string"?t.split(""):t,r=e.length;fi("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(hi(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(hi(i),i.map(s=>{zt("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Ze(t=""){return zt("join",t),{encode:e=>(fi("join.decode",e),e.join(t)),decode:e=>(zt("join.decode",e),e.split(t))}}function di(t,e="="){return on(t),zt("padding",e),{encode(r){for(fi("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){fi("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function Ml(t){return kl(t),{encode:e=>e,decode:e=>t(e)}}function Hl(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(hi(t),!t.length)return[];let n=0;const i=[],s=Array.from(t,a=>{if(on(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=n;u<o;u++){const l=s[u],h=e*a,f=h+l;if(!Number.isSafeInteger(f)||h/e!==a||f-l!==h)throw new Error("convertRadix: carry overflow");const g=f/r;a=f%r;const d=Math.floor(g);if(s[u]=d,!Number.isSafeInteger(d)||d*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:n=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const Vl=(t,e)=>e===0?t:Vl(e,t%e),gi=(t,e)=>t+(e-Vl(t,e)),pi=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function no(t,e,r,n){if(hi(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(gi(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${gi(e,r)}`);let i=0,s=0;const o=pi[e],a=pi[r]-1,c=[];for(const u of t){if(on(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const l=pi[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function nE(t){on(t);const e=2**8;return{encode:r=>{if(!li(r))throw new Error("radix.encode input should be Uint8Array");return Hl(Array.from(r),e,t)},decode:r=>(ro("radix.decode",r),Uint8Array.from(Hl(r,t,e)))}}function nt(t,e=!1){if(on(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(gi(8,t)>32||gi(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!li(r))throw new Error("radix2.encode input should be Uint8Array");return no(Array.from(r),8,t,!e)},decode:r=>(ro("radix2.decode",r),Uint8Array.from(no(r,t,8,e)))}}function Kl(t){return kl(t),function(...e){try{return t.apply(null,e)}catch{}}}const ql=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",Wl=(t,e)=>{zt("base64",t);const r=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,n=e?"base64url":"base64";if(t.length>0&&!r.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:n,lastChunkHandling:"strict"})},io=t=>Ge(nE(58),Ye(t),Ze("")),so=Ge(Ye("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ze("")),Gl=[996825010,642813549,513874426,1027748829,705979059];function an(t){const e=t>>25;let r=(t&33554431)<<5;for(let n=0;n<Gl.length;n++)(e>>n&1)===1&&(r^=Gl[n]);return r}function Yl(t,e,r=1){const n=t.length;let i=1;for(let s=0;s<n;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=an(i)^o>>5}i=an(i);for(let s=0;s<n;s++)i=an(i)^t.charCodeAt(s)&31;for(let s of e)i=an(i)^s;for(let s=0;s<6;s++)i=an(i);return i^=r,so.encode(no([i%pi[30]],30,5,!1))}function Zl(t){const e=t==="bech32"?1:734539939,r=nt(5),n=r.decode,i=r.encode,s=Kl(n);function o(h,f,g=90){zt("bech32.encode prefix",h),li(f)&&(f=Array.from(f)),ro("bech32.encode",f);const d=h.length;if(d===0)throw new TypeError(`Invalid prefix length ${d}`);const p=d+7+f.length;if(g!==!1&&p>g)throw new TypeError(`Length ${p} exceeds limit ${g}`);const _=h.toLowerCase(),R=Yl(_,f,e);return`${_}1${so.encode(f)}${R}`}function a(h,f=90){zt("bech32.decode input",h);const g=h.length;if(g<8||f!==!1&&g>f)throw new TypeError(`invalid string length: ${g} (${h}). Expected (8..${f})`);const d=h.toLowerCase();if(h!==d&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const p=d.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const _=d.slice(0,p),R=d.slice(p+1);if(R.length<6)throw new Error("Data must be at least 6 characters long");const P=so.decode(R).slice(0,-6),m=Yl(_,P,e);if(!R.endsWith(m))throw new Error(`Invalid checksum in ${h}: expected "${m}"`);return{prefix:_,words:P}}const c=Kl(a);function u(h){const{prefix:f,words:g}=a(h,!1);return{prefix:f,words:g,bytes:n(g)}}function l(h,f){return o(h,i(f))}return{encode:o,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:i}}const iE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",sE={encode(t){return to(t),t.toHex()},decode(t){return zt("hex",t),Uint8Array.fromHex(t)}};function cn(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=$u(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Ds(r)}function ze(t,e="utf8"){const r=Fu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const oE={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var aE=Object.defineProperty,cE=Object.defineProperties,uE=Object.getOwnPropertyDescriptors,Xl=Object.getOwnPropertySymbols,lE=Object.prototype.hasOwnProperty,hE=Object.prototype.propertyIsEnumerable,Jl=(t,e,r)=>e in t?aE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,It=(t,e)=>{for(var r in e||(e={}))lE.call(e,r)&&Jl(t,r,e[r]);if(Xl)for(var r of Xl(e))hE.call(e,r)&&Jl(t,r,e[r]);return t},oo=(t,e)=>cE(t,uE(e));const fE="ReactNative",at={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},dE="js";function yi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function fr(){return!Ar()&&!!Os()&&navigator.product===fE}function gE(){return fr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function pE(){return fr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function un(){return!yi()&&!!Os()&&!!Ar()}function bi(){return fr()?at.reactNative:yi()?at.node:un()?at.browser:at.unknown}function Ql(){var t;try{return fr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function yE(t,e){const r=new URLSearchParams(t);for(const n of Object.keys(e).sort())if(e.hasOwnProperty(n)){const i=e[n];i!==void 0&&r.set(n,i)}return r.toString()}function bE(){return Vu()||{name:"",description:"",url:"",icons:[""]}}function wE(){if(bi()===at.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=Zw();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function mE(){var t;const e=bi();return e===at.browser?[e,((t=Hu())==null?void 0:t.host)||"unknown"].join(":"):e}function eh(t,e,r){const n=wE(),i=mE();return[[t,e].join("-"),[dE,r].join("-"),n,i].join("/")}function EE({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=eh(t,e,n),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=yE(u[1]||"",h);return u[0]+"?"+f}function ao(t){return Object.fromEntries(t.entries())}function co(t){return new Map(Object.entries(t))}function vE(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function jt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function th(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function _E(t){return th("topic",t)}function xE(t){return th("id",t)}function SE(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function ln(t,e){return M.fromMiliseconds((e||Date.now())+M.toMiliseconds(t))}function rh(t){return Date.now()>=M.toMiliseconds(t)}function uo(t,e){return`${t}${e?`:${e}`:""}`}function nh(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function ih(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function sh(t){return Buffer.from(t,"base64").toString("utf-8")}function DE(t){return new Promise(e=>setTimeout(e,t))}const wi=BigInt(2**32-1),oh=BigInt(32);function ah(t,e=!1){return e?{h:Number(t&wi),l:Number(t>>oh&wi)}:{h:Number(t>>oh&wi)|0,l:Number(t&wi)|0}}function ch(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=ah(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const uh=(t,e,r)=>t>>>r,lh=(t,e,r)=>t<<32-r|e>>>r,kt=(t,e,r)=>t>>>r|e<<32-r,Mt=(t,e,r)=>t<<32-r|e>>>r,hn=(t,e,r)=>t<<64-r|e>>>r-32,fn=(t,e,r)=>t>>>r-32|e<<64-r,IE=(t,e)=>e,OE=(t,e)=>t,AE=(t,e,r)=>t<<r|e>>>32-r,TE=(t,e,r)=>e<<r|t>>>32-r,RE=(t,e,r)=>e<<r-32|t>>>64-r,BE=(t,e,r)=>t<<r-32|e>>>64-r;function ct(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const lo=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),ho=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,CE=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),NE=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,PE=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),$E=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Nr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function LE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ot(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ht(t,...e){if(!LE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function fo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ot(t.outputLen),Ot(t.blockLen)}function Vt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function go(t,e){Ht(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function dn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function it(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function po(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function bt(t,e){return t<<32-e|t>>>e}const hh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function fh(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const At=hh?t=>t:t=>fh(t);function UE(t){for(let e=0;e<t.length;e++)t[e]=fh(t[e]);return t}const Kt=hh?t=>t:UE;function FE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ut(t){return typeof t=="string"&&(t=FE(t)),Ht(t),t}function zE(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Ht(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class mi{}function gn(t){const e=n=>t().update(ut(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function jE(t){const e=(n,i)=>t(i).update(ut(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Pr(t=32){if(Nr&&typeof Nr.getRandomValues=="function")return Nr.getRandomValues(new Uint8Array(t));if(Nr&&typeof Nr.randomBytes=="function")return Uint8Array.from(Nr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const kE=BigInt(0),pn=BigInt(1),ME=BigInt(2),HE=BigInt(7),VE=BigInt(256),KE=BigInt(113),dh=[],gh=[],ph=[];for(let t=0,e=pn,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],dh.push(2*(5*n+r)),gh.push((t+1)*(t+2)/2%64);let i=kE;for(let s=0;s<7;s++)e=(e<<pn^(e>>HE)*KE)%VE,e&ME&&(i^=pn<<(pn<<BigInt(s))-pn);ph.push(i)}const yh=ch(ph,!0),qE=yh[0],WE=yh[1],bh=(t,e,r)=>r>32?RE(t,e,r):AE(t,e,r),wh=(t,e,r)=>r>32?BE(t,e,r):TE(t,e,r);function GE(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=bh(u,l,1)^r[a],f=wh(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=h,t[o+g+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=gh[o],c=bh(i,s,a),u=wh(i,s,a),l=dh[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=qE[n],t[1]^=WE[n]}it(r)}class yo extends mi{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Ot(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=dn(this.state)}clone(){return this._cloneInto()}keccak(){Kt(this.state32),GE(this.state32,this.rounds),Kt(this.state32),this.posOut=0,this.pos=0}update(e){Vt(this),e=ut(e),Ht(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Vt(this,!1),Ht(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ot(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(go(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,it(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new yo(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}((t,e,r)=>gn(()=>new yo(e,t,r)))(1,136,256/8);function YE(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function ZE(t,e,r){return t&e^~t&r}function XE(t,e,r){return t&e^t&r^e&r}class mh extends mi{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=po(this.buffer)}update(e){Vt(this),e=ut(e),Ht(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=po(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vt(this),go(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,it(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;YE(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=po(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const qt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ve=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),_e=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),JE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wt=new Uint32Array(64);class QE extends mh{constructor(e=32){super(64,e,8,!1),this.A=qt[0]|0,this.B=qt[1]|0,this.C=qt[2]|0,this.D=qt[3]|0,this.E=qt[4]|0,this.F=qt[5]|0,this.G=qt[6]|0,this.H=qt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Wt[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=Wt[h-15],g=Wt[h-2],d=bt(f,7)^bt(f,18)^f>>>3,p=bt(g,17)^bt(g,19)^g>>>10;Wt[h]=p+Wt[h-7]+d+Wt[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=bt(a,6)^bt(a,11)^bt(a,25),g=l+f+ZE(a,c,u)+JE[h]+Wt[h]|0,d=(bt(n,2)^bt(n,13)^bt(n,22))+XE(n,i,s)|0;l=u,u=c,c=a,a=o+g|0,o=s,s=i,i=n,n=g+d|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){it(Wt)}destroy(){this.set(0,0,0,0,0,0,0,0),it(this.buffer)}}const Eh=ch(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ev=Eh[0],tv=Eh[1],Gt=new Uint32Array(80),Yt=new Uint32Array(80);class bo extends mh{constructor(e=64){super(128,e,16,!1),this.Ah=_e[0]|0,this.Al=_e[1]|0,this.Bh=_e[2]|0,this.Bl=_e[3]|0,this.Ch=_e[4]|0,this.Cl=_e[5]|0,this.Dh=_e[6]|0,this.Dl=_e[7]|0,this.Eh=_e[8]|0,this.El=_e[9]|0,this.Fh=_e[10]|0,this.Fl=_e[11]|0,this.Gh=_e[12]|0,this.Gl=_e[13]|0,this.Hh=_e[14]|0,this.Hl=_e[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:g,Gl:d,Hh:p,Hl:_}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_]}set(e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=_|0}process(e,r){for(let m=0;m<16;m++,r+=4)Gt[m]=e.getUint32(r),Yt[m]=e.getUint32(r+=4);for(let m=16;m<80;m++){const b=Gt[m-15]|0,v=Yt[m-15]|0,O=kt(b,v,1)^kt(b,v,8)^uh(b,v,7),S=Mt(b,v,1)^Mt(b,v,8)^lh(b,v,7),A=Gt[m-2]|0,C=Yt[m-2]|0,L=kt(A,C,19)^hn(A,C,61)^uh(A,C,6),T=Mt(A,C,19)^fn(A,C,61)^lh(A,C,6),N=CE(S,T,Yt[m-7],Yt[m-16]),B=NE(N,O,L,Gt[m-7],Gt[m-16]);Gt[m]=B|0,Yt[m]=N|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:g,Fl:d,Gh:p,Gl:_,Hh:R,Hl:P}=this;for(let m=0;m<80;m++){const b=kt(h,f,14)^kt(h,f,18)^hn(h,f,41),v=Mt(h,f,14)^Mt(h,f,18)^fn(h,f,41),O=h&g^~h&p,S=f&d^~f&_,A=PE(P,v,S,tv[m],Yt[m]),C=$E(A,R,b,O,ev[m],Gt[m]),L=A|0,T=kt(n,i,28)^hn(n,i,34)^hn(n,i,39),N=Mt(n,i,28)^fn(n,i,34)^fn(n,i,39),B=n&s^n&a^s&a,j=i&o^i&c^o&c;R=p|0,P=_|0,p=g|0,_=d|0,g=h|0,d=f|0,{h,l:f}=ct(u|0,l|0,C|0,L|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const w=lo(L,N,j);n=ho(w,C,T,B),i=w|0}({h:n,l:i}=ct(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ct(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ct(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ct(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=ct(this.Eh|0,this.El|0,h|0,f|0),{h:g,l:d}=ct(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:_}=ct(this.Gh|0,this.Gl|0,p|0,_|0),{h:R,l:P}=ct(this.Hh|0,this.Hl|0,R|0,P|0),this.set(n,i,s,o,a,c,u,l,h,f,g,d,p,_,R,P)}roundClean(){it(Gt,Yt)}destroy(){it(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class rv extends bo{constructor(){super(48),this.Ah=ve[0]|0,this.Al=ve[1]|0,this.Bh=ve[2]|0,this.Bl=ve[3]|0,this.Ch=ve[4]|0,this.Cl=ve[5]|0,this.Dh=ve[6]|0,this.Dl=ve[7]|0,this.Eh=ve[8]|0,this.El=ve[9]|0,this.Fh=ve[10]|0,this.Fl=ve[11]|0,this.Gh=ve[12]|0,this.Gl=ve[13]|0,this.Hh=ve[14]|0,this.Hl=ve[15]|0}}const xe=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class nv extends bo{constructor(){super(32),this.Ah=xe[0]|0,this.Al=xe[1]|0,this.Bh=xe[2]|0,this.Bl=xe[3]|0,this.Ch=xe[4]|0,this.Cl=xe[5]|0,this.Dh=xe[6]|0,this.Dl=xe[7]|0,this.Eh=xe[8]|0,this.El=xe[9]|0,this.Fh=xe[10]|0,this.Fl=xe[11]|0,this.Gh=xe[12]|0,this.Gl=xe[13]|0,this.Hh=xe[14]|0,this.Hl=xe[15]|0}}const vh=gn(()=>new QE),iv=gn(()=>new bo),sv=gn(()=>new rv);gn(()=>new nv);const ov=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ce=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Zt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=z[2*t],u=z[2*t+1],l=z[2*e],h=z[2*e+1],f=z[2*r],g=z[2*r+1],d=z[2*n],p=z[2*n+1],_=lo(c,l,o);u=ho(_,u,h,a),c=_|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:IE(p,d),Dl:OE(p)},{h:g,l:f}=ct(g,f,p,d),{Bh:h,Bl:l}={Bh:h^g,Bl:l^f},{Bh:h,Bl:l}={Bh:kt(h,l,24),Bl:Mt(h,l,24)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*r]=f,z[2*r+1]=g,z[2*n]=d,z[2*n+1]=p}function Xt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=z[2*t],u=z[2*t+1],l=z[2*e],h=z[2*e+1],f=z[2*r],g=z[2*r+1],d=z[2*n],p=z[2*n+1],_=lo(c,l,o);u=ho(_,u,h,a),c=_|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:kt(p,d,16),Dl:Mt(p,d,16)},{h:g,l:f}=ct(g,f,p,d),{Bh:h,Bl:l}={Bh:h^g,Bl:l^f},{Bh:h,Bl:l}={Bh:hn(h,l,63),Bl:fn(h,l,63)},z[2*t]=c,z[2*t+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*r]=f,z[2*r+1]=g,z[2*n]=d,z[2*n+1]=p}function av(t,e={},r,n,i){if(Ot(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class cv extends mi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Ot(e),Ot(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=dn(this.buffer)}update(e){Vt(this),e=ut(e),Ht(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(Kt(i),this.compress(i,0,!1),Kt(i),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));Kt(h);for(let f=0;c+r<s;f+=i.length,c+=r)this.length+=r,this.compress(h,f,!1);Kt(h);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Vt(this),go(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,it(this.buffer.subarray(r)),Kt(n),this.compress(n,0,!0),Kt(n);const i=dn(e);this.get().forEach((s,o)=>i[o]=At(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class uv extends cv{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ce[0]|0,this.v0h=ce[1]|0,this.v1l=ce[2]|0,this.v1h=ce[3]|0,this.v2l=ce[4]|0,this.v2h=ce[5]|0,this.v3l=ce[6]|0,this.v3h=ce[7]|0,this.v4l=ce[8]|0,this.v4h=ce[9]|0,this.v5l=ce[10]|0,this.v5h=ce[11]|0,this.v6l=ce[12]|0,this.v6h=ce[13]|0,this.v7l=ce[14]|0,this.v7h=ce[15]|0,av(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=ut(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=ut(s);const a=dn(s);this.v4l^=At(a[0]),this.v4h^=At(a[1]),this.v5l^=At(a[2]),this.v5h^=At(a[3])}if(i!==void 0){i=ut(i);const a=dn(i);this.v6l^=At(a[0]),this.v6h^=At(a[1]),this.v7l^=At(a[2]),this.v7h^=At(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:g,v6h:d,v7l:p,v7h:_}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_]}set(e,r,n,i,s,o,a,c,u,l,h,f,g,d,p,_){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=g|0,this.v6h=d|0,this.v7l=p|0,this.v7h=_|0}compress(e,r,n){this.get().forEach((c,u)=>z[u]=c),z.set(ce,16);let{h:i,l:s}=ah(BigInt(this.length));z[24]=ce[8]^s,z[25]=ce[9]^i,n&&(z[28]=~z[28],z[29]=~z[29]);let o=0;const a=ov;for(let c=0;c<12;c++)Zt(0,4,8,12,e,r+2*a[o++]),Xt(0,4,8,12,e,r+2*a[o++]),Zt(1,5,9,13,e,r+2*a[o++]),Xt(1,5,9,13,e,r+2*a[o++]),Zt(2,6,10,14,e,r+2*a[o++]),Xt(2,6,10,14,e,r+2*a[o++]),Zt(3,7,11,15,e,r+2*a[o++]),Xt(3,7,11,15,e,r+2*a[o++]),Zt(0,5,10,15,e,r+2*a[o++]),Xt(0,5,10,15,e,r+2*a[o++]),Zt(1,6,11,12,e,r+2*a[o++]),Xt(1,6,11,12,e,r+2*a[o++]),Zt(2,7,8,13,e,r+2*a[o++]),Xt(2,7,8,13,e,r+2*a[o++]),Zt(3,4,9,14,e,r+2*a[o++]),Xt(3,4,9,14,e,r+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],it(z)}destroy(){this.destroyed=!0,it(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}jE(t=>new uv(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function _h(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function wo(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function mo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function je(t,...e){if(!_h(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function xh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lv(t,e){je(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Jt(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function $r(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function hv(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const fv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function dv(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Eo(t){if(typeof t=="string")t=dv(t);else if(_h(t))t=vo(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function gv(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function pv(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const yv=(t,e)=>{function r(n,...i){if(je(n),!fv)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?je(u):je(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&je(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");je(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,je(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(je(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Sh(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!wv(e))throw new Error("invalid output, must be aligned");return e}function Dh(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function bv(t,e,r){wo(r);const n=new Uint8Array(16),i=hv(n);return Dh(i,0,BigInt(e),r),Dh(i,8,BigInt(t),r),n}function wv(t){return t.byteOffset%4===0}function vo(t){return Uint8Array.from(t)}const Ih=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),mv=Ih("expand 16-byte k"),Ev=Ih("expand 32-byte k"),vv=Jt(mv),_v=Jt(Ev);function Z(t,e){return t<<e|t>>>32-e}function _o(t){return t.byteOffset%4===0}const Ei=64,xv=16,Oh=2**32-1,Ah=new Uint32Array;function Sv(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(Ei),l=Jt(u),h=_o(i)&&_o(s),f=h?Jt(i):Ah,g=h?Jt(s):Ah;for(let d=0;d<c;o++){if(t(e,r,n,l,o,a),o>=Oh)throw new Error("arx: counter overflow");const p=Math.min(Ei,c-d);if(h&&p===Ei){const _=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let R=0,P;R<xv;R++)P=_+R,g[P]=f[P]^l[R];d+=Ei;continue}for(let _=0,R;_<p;_++)R=d+_,s[R]=i[R]^u[_];d+=p}}function Dv(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=gv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return mo(i),mo(o),wo(s),wo(r),(a,c,u,l,h=0)=>{je(a),je(c),je(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),je(l),mo(h),h<0||h>=Oh)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const g=[];let d=a.length,p,_;if(d===32)g.push(p=vo(a)),_=_v;else if(d===16&&r)p=new Uint8Array(32),p.set(a),p.set(a,16),_=vv,g.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);_o(c)||g.push(c=vo(c));const R=Jt(p);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(_,R,Jt(c.subarray(0,16)),R),c=c.subarray(16)}const P=16-i;if(P!==c.length)throw new Error(`arx: nonce must be ${P} or 16 bytes`);if(P!==12){const b=new Uint8Array(12);b.set(c,s?0:12-c.length),c=b,g.push(c)}const m=Jt(c);return Sv(t,_,R,m,u,l,h,o),$r(...g),l}}const be=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Iv{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Eo(e),je(e,32);const r=be(e,0),n=be(e,2),i=be(e,4),s=be(e,6),o=be(e,8),a=be(e,10),c=be(e,12),u=be(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=be(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],g=o[6],d=o[7],p=o[8],_=o[9],R=be(e,r+0),P=be(e,r+2),m=be(e,r+4),b=be(e,r+6),v=be(e,r+8),O=be(e,r+10),S=be(e,r+12),A=be(e,r+14);let C=s[0]+(R&8191),L=s[1]+((R>>>13|P<<3)&8191),T=s[2]+((P>>>10|m<<6)&8191),N=s[3]+((m>>>7|b<<9)&8191),B=s[4]+((b>>>4|v<<12)&8191),j=s[5]+(v>>>1&8191),w=s[6]+((v>>>14|O<<2)&8191),y=s[7]+((O>>>11|S<<5)&8191),E=s[8]+((S>>>8|A<<8)&8191),D=s[9]+(A>>>5|i),x=0,I=x+C*a+L*(5*_)+T*(5*p)+N*(5*d)+B*(5*g);x=I>>>13,I&=8191,I+=j*(5*f)+w*(5*h)+y*(5*l)+E*(5*u)+D*(5*c),x+=I>>>13,I&=8191;let $=x+C*c+L*a+T*(5*_)+N*(5*p)+B*(5*d);x=$>>>13,$&=8191,$+=j*(5*g)+w*(5*f)+y*(5*h)+E*(5*l)+D*(5*u),x+=$>>>13,$&=8191;let F=x+C*u+L*c+T*a+N*(5*_)+B*(5*p);x=F>>>13,F&=8191,F+=j*(5*d)+w*(5*g)+y*(5*f)+E*(5*h)+D*(5*l),x+=F>>>13,F&=8191;let k=x+C*l+L*u+T*c+N*a+B*(5*_);x=k>>>13,k&=8191,k+=j*(5*p)+w*(5*d)+y*(5*g)+E*(5*f)+D*(5*h),x+=k>>>13,k&=8191;let H=x+C*h+L*l+T*u+N*c+B*a;x=H>>>13,H&=8191,H+=j*(5*_)+w*(5*p)+y*(5*d)+E*(5*g)+D*(5*f),x+=H>>>13,H&=8191;let V=x+C*f+L*h+T*l+N*u+B*c;x=V>>>13,V&=8191,V+=j*a+w*(5*_)+y*(5*p)+E*(5*d)+D*(5*g),x+=V>>>13,V&=8191;let K=x+C*g+L*f+T*h+N*l+B*u;x=K>>>13,K&=8191,K+=j*c+w*a+y*(5*_)+E*(5*p)+D*(5*d),x+=K>>>13,K&=8191;let G=x+C*d+L*g+T*f+N*h+B*l;x=G>>>13,G&=8191,G+=j*u+w*c+y*a+E*(5*_)+D*(5*p),x+=G>>>13,G&=8191;let ee=x+C*p+L*d+T*g+N*f+B*h;x=ee>>>13,ee&=8191,ee+=j*l+w*u+y*c+E*a+D*(5*_),x+=ee>>>13,ee&=8191;let W=x+C*_+L*p+T*d+N*g+B*f;x=W>>>13,W&=8191,W+=j*h+w*l+y*u+E*c+D*a,x+=W>>>13,W&=8191,x=(x<<2)+x|0,x=x+I|0,I=x&8191,x=x>>>13,$+=x,s[0]=I,s[1]=$,s[2]=F,s[3]=k,s[4]=H,s[5]=V,s[6]=K,s[7]=G,s[8]=ee,s[9]=W}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;$r(n)}update(e){xh(this),e=Eo(e),je(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){$r(this.h,this.r,this.buffer,this.pad)}digestInto(e){xh(this),lv(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function Ov(t){const e=(n,i)=>t(i).update(Eo(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const Av=Ov(t=>new Iv(t));function Tv(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],g=e[3],d=e[4],p=e[5],_=e[6],R=e[7],P=i,m=r[0],b=r[1],v=r[2],O=o,S=a,A=c,C=u,L=l,T=h,N=f,B=g,j=d,w=p,y=_,E=R,D=P,x=m,I=b,$=v;for(let k=0;k<s;k+=2)O=O+L|0,D=Z(D^O,16),j=j+D|0,L=Z(L^j,12),O=O+L|0,D=Z(D^O,8),j=j+D|0,L=Z(L^j,7),S=S+T|0,x=Z(x^S,16),w=w+x|0,T=Z(T^w,12),S=S+T|0,x=Z(x^S,8),w=w+x|0,T=Z(T^w,7),A=A+N|0,I=Z(I^A,16),y=y+I|0,N=Z(N^y,12),A=A+N|0,I=Z(I^A,8),y=y+I|0,N=Z(N^y,7),C=C+B|0,$=Z($^C,16),E=E+$|0,B=Z(B^E,12),C=C+B|0,$=Z($^C,8),E=E+$|0,B=Z(B^E,7),O=O+T|0,$=Z($^O,16),y=y+$|0,T=Z(T^y,12),O=O+T|0,$=Z($^O,8),y=y+$|0,T=Z(T^y,7),S=S+N|0,D=Z(D^S,16),E=E+D|0,N=Z(N^E,12),S=S+N|0,D=Z(D^S,8),E=E+D|0,N=Z(N^E,7),A=A+B|0,x=Z(x^A,16),j=j+x|0,B=Z(B^j,12),A=A+B|0,x=Z(x^A,8),j=j+x|0,B=Z(B^j,7),C=C+L|0,I=Z(I^C,16),w=w+I|0,L=Z(L^w,12),C=C+L|0,I=Z(I^C,8),w=w+I|0,L=Z(L^w,7);let F=0;n[F++]=o+O|0,n[F++]=a+S|0,n[F++]=c+A|0,n[F++]=u+C|0,n[F++]=l+L|0,n[F++]=h+T|0,n[F++]=f+N|0,n[F++]=g+B|0,n[F++]=d+j|0,n[F++]=p+w|0,n[F++]=_+y|0,n[F++]=R+E|0,n[F++]=P+D|0,n[F++]=m+x|0,n[F++]=b+I|0,n[F++]=v+$|0}const Rv=Dv(Tv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Bv=new Uint8Array(16),Th=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Bv.subarray(r))},Cv=new Uint8Array(32);function Rh(t,e,r,n,i){const s=t(e,r,Cv),o=Av.create(s);i&&Th(o,i),Th(o,n);const a=bv(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return $r(s,a),c}const Nv=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Sh(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Rh(t,e,r,a,n);return s.set(c,o),$r(c),s},decrypt(i,s){s=Sh(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Rh(t,e,r,o,n);if(!pv(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),$r(c),s}}),Bh=yv({blockSize:64,nonceLength:12,tagLength:16},Nv(Rv));class Ch extends mi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,fo(e);const n=ut(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),it(s)}update(e){return Vt(this),this.iHash.update(e),this}digestInto(e){Vt(this),Ht(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const vi=(t,e,r)=>new Ch(t,e).update(r).digest();vi.create=(t,e)=>new Ch(t,e);function Pv(t,e,r){return fo(t),r===void 0&&(r=new Uint8Array(t.outputLen)),vi(t,ut(r),ut(e))}const xo=Uint8Array.from([0]),Nh=Uint8Array.of();function $v(t,e,r,n=32){fo(t),Ot(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=Nh);const o=new Uint8Array(s*i),a=vi.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)xo[0]=l+1,c.update(l===0?Nh:u).update(r).update(xo).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),it(u,xo),o.slice(0,n)}const Lv=(t,e,r,n,i)=>$v(t,Pv(t,e,r),n,i),_i=vh;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const So=BigInt(0),Do=BigInt(1);function yn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Io(t){if(!yn(t))throw new Error("Uint8Array expected")}function bn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function xi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Ph(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?So:BigInt("0x"+t)}const $h=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Uv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function wn(t){if(Io(t),$h)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Uv[t[r]];return e}const Tt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Lh(t){if(t>=Tt._0&&t<=Tt._9)return t-Tt._0;if(t>=Tt.A&&t<=Tt.F)return t-(Tt.A-10);if(t>=Tt.a&&t<=Tt.f)return t-(Tt.a-10)}function Si(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if($h)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Lh(t.charCodeAt(s)),a=Lh(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function dr(t){return Ph(wn(t))}function Di(t){return Io(t),Ph(wn(Uint8Array.from(t).reverse()))}function mn(t,e){return Si(t.toString(16).padStart(e*2,"0"))}function Oo(t,e){return mn(t,e).reverse()}function ke(t,e,r){let n;if(typeof e=="string")try{n=Si(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(yn(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Ii(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Io(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Ao=t=>typeof t=="bigint"&&So<=t;function To(t,e,r){return Ao(t)&&Ao(e)&&Ao(r)&&e<=t&&t<r}function Qt(t,e,r,n){if(!To(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Fv(t){let e;for(e=0;t>So;t>>=Do,e+=1);return e}const Oi=t=>(Do<<BigInt(t))-Do,Ro=t=>new Uint8Array(t),Uh=t=>Uint8Array.from(t);function zv(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Ro(t),i=Ro(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=Ro(0))=>{i=a(Uh([0]),l),n=a(),l.length!==0&&(i=a(Uh([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const f=n.slice();h.push(f),l+=n.length}return Ii(...h)};return(l,h)=>{o(),c(l);let f;for(;!(f=h(u()));)c();return o(),f}}const jv={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||yn(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function En(t,e,r={}){const n=(i,s,o)=>{const a=jv[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Fh(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Me=BigInt(0),Re=BigInt(1),gr=BigInt(2),kv=BigInt(3),zh=BigInt(4),jh=BigInt(5),kh=BigInt(8);function He(t,e){const r=t%e;return r>=Me?r:e+r}function lt(t,e,r){let n=t;for(;e-- >Me;)n*=n,n%=r;return n}function Bo(t,e){if(t===Me)throw new Error("invert: expected non-zero number");if(e<=Me)throw new Error("invert: expected positive modulus, got "+e);let r=He(t,e),n=e,i=Me,s=Re;for(;r!==Me;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Re)throw new Error("invert: does not exist");return He(i,e)}function Mh(t,e){const r=(t.ORDER+Re)/zh,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function Mv(t,e){const r=(t.ORDER-jh)/kh,n=t.mul(e,gr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,gr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Hv(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Re,r=0;for(;e%gr===Me;)e/=gr,r++;let n=gr;const i=vn(t);for(;Vh(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Mh;let s=i.pow(n,e);const o=(e+Re)/gr;return function(a,c){if(a.is0(c))return c;if(Vh(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let g=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(g++,d=a.sqr(d),g===u)throw new Error("Cannot find square root");const p=Re<<BigInt(u-g-1),_=a.pow(l,p);u=g,l=a.sqr(_),h=a.mul(h,l),f=a.mul(f,_)}return f}}function Vv(t){return t%zh===kv?Mh:t%kh===jh?Mv:Hv(t)}const Kv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qv(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Kv.reduce((n,i)=>(n[i]="function",n),e);return En(t,r)}function Wv(t,e,r){if(r<Me)throw new Error("invalid exponent, negatives unsupported");if(r===Me)return t.ONE;if(r===Re)return e;let n=t.ONE,i=e;for(;r>Me;)r&Re&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Re;return n}function Hh(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function Vh(t,e){const r=(t.ORDER-Re)/gr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Kh(t,e){e!==void 0&&Ot(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function vn(t,e,r=!1,n={}){if(t<=Me)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Kh(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Oi(i),ZERO:Me,ONE:Re,create:c=>He(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Me<=c&&c<t},is0:c=>c===Me,isOdd:c=>(c&Re)===Re,neg:c=>He(-c,t),eql:(c,u)=>c===u,sqr:c=>He(c*c,t),add:(c,u)=>He(c+u,t),sub:(c,u)=>He(c-u,t),mul:(c,u)=>He(c*u,t),pow:(c,u)=>Wv(a,c,u),div:(c,u)=>He(c*Bo(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Bo(c,t),sqrt:n.sqrt||(c=>(o||(o=Vv(t)),o(a,c))),toBytes:c=>r?Oo(c,s):mn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Di(c):dr(c)},invertBatch:c=>Hh(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function qh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Wh(t){const e=qh(t);return e+Math.ceil(e/2)}function Gv(t,e,r=!1){const n=t.length,i=qh(e),s=Wh(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Di(t):dr(t),a=He(o,e-Re)+Re;return r?Oo(a,i):mn(a,i)}const Gh=BigInt(0),Co=BigInt(1);function No(t,e){const r=e.negate();return t?r:e}function Yh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Po(t,e){Yh(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Oi(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function Zh(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Co);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:u}}function Yv(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Zv(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const $o=new WeakMap,Xh=new WeakMap;function Lo(t){return Xh.get(t)||1}function Xv(t,e){return{constTimeNegate:No,hasPrecomputes(r){return Lo(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Gh;)n&Co&&(i=i.add(s)),s=s.double(),n>>=Co;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Po(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=Po(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:d}=Zh(i,c,a);i=u,h?o=o.add(No(g,n[d])):s=s.add(No(f,n[l]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=Po(r,e);for(let a=0;a<o.windows&&i!==Gh;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=Zh(i,a,o);if(i=c,!l){const f=n[u];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,n,i){let s=$o.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&$o.set(n,i(s))),s},wNAFCached(r,n,i){const s=Lo(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Lo(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Yh(n,e),Xh.set(r,n),$o.delete(r)}}}function Jv(t,e,r,n){Yv(r,t),Zv(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Fv(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Oi(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let g=h;g>=0;g-=c){l.fill(o);for(let p=0;p<s;p++){const _=n[p],R=Number(_>>BigInt(g)&u);l[R]=l[R].add(r[p])}let d=o;for(let p=l.length-1,_=o;p>0;p--)_=_.add(l[p]),d=d.add(_);if(f=f.add(d),g!==0)for(let p=0;p<c;p++)f=f.double()}return f}function Jh(t){return qv(t.Fp),En(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(oo(It(It({},Kh(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const _n=BigInt(0),Lr=BigInt(1),Ai=BigInt(2);function Qv(t){return En(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(It({},t))}function e2(t){const e=Qv(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s}=e,o=n==="x25519";if(!o&&n!=="x448")throw new Error("invalid type");const a=o?255:448,c=o?32:56,u=BigInt(o?9:5),l=BigInt(o?121665:39081),h=o?Ai**BigInt(254):Ai**BigInt(447),f=o?BigInt(8)*Ai**BigInt(251)-Lr:BigInt(4)*Ai**BigInt(445)-Lr,g=h+f+Lr,d=S=>He(S,r),p=_(u);function _(S){return Oo(d(S),c)}function R(S){const A=ke("u coordinate",S,c);return o&&(A[31]&=127),d(Di(A))}function P(S){return Di(i(ke("scalar",S,c)))}function m(S,A){const C=O(R(A),P(S));if(C===_n)throw new Error("invalid private or public key received");return _(C)}function b(S){return m(S,p)}function v(S,A,C){const L=d(S*(A-C));return A=d(A-L),C=d(C+L),{x_2:A,x_3:C}}function O(S,A){Qt("u",S,_n,r),Qt("scalar",A,h,g);const C=A,L=S;let T=Lr,N=_n,B=S,j=Lr,w=_n;for(let E=BigInt(a-1);E>=_n;E--){const D=C>>E&Lr;w^=D,{x_2:T,x_3:B}=v(w,T,B),{x_2:N,x_3:j}=v(w,N,j),w=D;const x=T+N,I=d(x*x),$=T-N,F=d($*$),k=I-F,H=B+j,V=B-j,K=d(V*x),G=d(H*$),ee=K+G,W=K-G;B=d(ee*ee),j=d(L*d(W*W)),T=d(I*F),N=d(k*(I+d(l*k)))}({x_2:T,x_3:B}=v(w,T,B)),{x_2:N,x_3:j}=v(w,N,j);const y=s(N);return d(T*y)}return{scalarMult:m,scalarMultBase:b,getSharedSecret:(S,A)=>m(S,A),getPublicKey:S=>b(S),utils:{randomPrivateKey:()=>e.randomBytes(c)},GuBytes:p.slice()}}const Uo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const t2=BigInt(1),Qh=BigInt(2),r2=BigInt(3),n2=BigInt(5);BigInt(8);function i2(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Uo,o=t*t%s*t%s,a=lt(o,Qh,s)*o%s,c=lt(a,t2,s)*t%s,u=lt(c,n2,s)*c%s,l=lt(u,e,s)*u%s,h=lt(l,r,s)*l%s,f=lt(h,n,s)*h%s,g=lt(f,i,s)*f%s,d=lt(g,i,s)*f%s,p=lt(d,e,s)*u%s;return{pow_p_5_8:lt(p,Qh,s)*t%s,b2:o}}function s2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Fo=e2({P:Uo,type:"x25519",powPminus2:t=>{const e=Uo,{pow_p_5_8:r,b2:n}=i2(t);return He(lt(r,r2,e)*n,e)},adjustScalarBytes:s2,randomBytes:Pr});function ef(t){t.lowS!==void 0&&bn("lowS",t.lowS),t.prehash!==void 0&&bn("prehash",t.prehash)}function o2(t){const e=Jh(t);En(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze(It({},e))}class a2 extends Error{constructor(e=""){super(e)}}const Rt={Err:a2,_tlv:{encode:(t,e)=>{const{Err:r}=Rt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=xi(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?xi(i.length/2|128):"";return xi(t)+s+i+e},decode(t,e){const{Err:r}=Rt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Rt;if(t<Bt)throw new e("integer: negative integers are not allowed");let r=xi(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Rt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return dr(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Rt,i=ke("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Rt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function zo(t,e){return wn(mn(t,e))}const Bt=BigInt(0),fe=BigInt(1);BigInt(2);const jo=BigInt(3),c2=BigInt(4);function u2(t){const e=o2(t),{Fp:r}=e,n=vn(e.n,e.nBitLength),i=e.toBytes||((m,b,v)=>{const O=b.toAffine();return Ii(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),s=e.fromBytes||(m=>{const b=m.subarray(1),v=r.fromBytes(b.subarray(0,r.BYTES)),O=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:v,y:O}});function o(m){const{a:b,b:v}=e,O=r.sqr(m),S=r.mul(O,m);return r.add(r.add(S,r.mul(m,b)),v)}function a(m,b){const v=r.sqr(b),O=o(m);return r.eql(v,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,jo),c2),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(m){return To(m,fe,e.n)}function h(m){const{allowedPrivateKeyLengths:b,nByteLength:v,wrapPrivateKey:O,n:S}=e;if(b&&typeof m!="bigint"){if(yn(m)&&(m=wn(m)),typeof m!="string"||!b.includes(m.length))throw new Error("invalid private key");m=m.padStart(v*2,"0")}let A;try{A=typeof m=="bigint"?m:dr(ke("private key",m,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof m)}return O&&(A=He(A,S)),Qt("private key",A,fe,S),A}function f(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}const g=Fh((m,b)=>{const{px:v,py:O,pz:S}=m;if(r.eql(S,r.ONE))return{x:v,y:O};const A=m.is0();b==null&&(b=A?r.ONE:r.inv(S));const C=r.mul(v,b),L=r.mul(O,b),T=r.mul(S,b);if(A)return{x:r.ZERO,y:r.ZERO};if(!r.eql(T,r.ONE))throw new Error("invZ was invalid");return{x:C,y:L}}),d=Fh(m=>{if(m.is0()){if(e.allowInfinityPoint&&!r.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:b,y:v}=m.toAffine();if(!r.isValid(b)||!r.isValid(v))throw new Error("bad point: x or y not FE");if(!a(b,v))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(b,v,O){if(b==null||!r.isValid(b))throw new Error("x required");if(v==null||!r.isValid(v)||r.is0(v))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=b,this.py=v,this.pz=O,Object.freeze(this)}static fromAffine(b){const{x:v,y:O}=b||{};if(!b||!r.isValid(v)||!r.isValid(O))throw new Error("invalid affine point");if(b instanceof p)throw new Error("projective point not allowed");const S=A=>r.eql(A,r.ZERO);return S(v)&&S(O)?p.ZERO:new p(v,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const v=Hh(r,b.map(O=>O.pz));return b.map((O,S)=>O.toAffine(v[S])).map(p.fromAffine)}static fromHex(b){const v=p.fromAffine(s(ke("pointHex",b)));return v.assertValidity(),v}static fromPrivateKey(b){return p.BASE.multiply(h(b))}static msm(b,v){return Jv(p,n,b,v)}_setWindowSize(b){P.setWindowSize(this,b)}assertValidity(){d(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:v,py:O,pz:S}=this,{px:A,py:C,pz:L}=b,T=r.eql(r.mul(v,L),r.mul(A,S)),N=r.eql(r.mul(O,L),r.mul(C,S));return T&&N}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:v}=e,O=r.mul(v,jo),{px:S,py:A,pz:C}=this;let L=r.ZERO,T=r.ZERO,N=r.ZERO,B=r.mul(S,S),j=r.mul(A,A),w=r.mul(C,C),y=r.mul(S,A);return y=r.add(y,y),N=r.mul(S,C),N=r.add(N,N),L=r.mul(b,N),T=r.mul(O,w),T=r.add(L,T),L=r.sub(j,T),T=r.add(j,T),T=r.mul(L,T),L=r.mul(y,L),N=r.mul(O,N),w=r.mul(b,w),y=r.sub(B,w),y=r.mul(b,y),y=r.add(y,N),N=r.add(B,B),B=r.add(N,B),B=r.add(B,w),B=r.mul(B,y),T=r.add(T,B),w=r.mul(A,C),w=r.add(w,w),B=r.mul(w,y),L=r.sub(L,B),N=r.mul(w,j),N=r.add(N,N),N=r.add(N,N),new p(L,T,N)}add(b){f(b);const{px:v,py:O,pz:S}=this,{px:A,py:C,pz:L}=b;let T=r.ZERO,N=r.ZERO,B=r.ZERO;const j=e.a,w=r.mul(e.b,jo);let y=r.mul(v,A),E=r.mul(O,C),D=r.mul(S,L),x=r.add(v,O),I=r.add(A,C);x=r.mul(x,I),I=r.add(y,E),x=r.sub(x,I),I=r.add(v,S);let $=r.add(A,L);return I=r.mul(I,$),$=r.add(y,D),I=r.sub(I,$),$=r.add(O,S),T=r.add(C,L),$=r.mul($,T),T=r.add(E,D),$=r.sub($,T),B=r.mul(j,I),T=r.mul(w,D),B=r.add(T,B),T=r.sub(E,B),B=r.add(E,B),N=r.mul(T,B),E=r.add(y,y),E=r.add(E,y),D=r.mul(j,D),I=r.mul(w,I),E=r.add(E,D),D=r.sub(y,D),D=r.mul(j,D),I=r.add(I,D),y=r.mul(E,I),N=r.add(N,y),y=r.mul($,I),T=r.mul(x,T),T=r.sub(T,y),y=r.mul(x,E),B=r.mul($,B),B=r.add(B,y),new p(T,N,B)}subtract(b){return this.add(b.negate())}is0(){return this.equals(p.ZERO)}wNAF(b){return P.wNAFCached(this,b,p.normalizeZ)}multiplyUnsafe(b){const{endo:v,n:O}=e;Qt("scalar",b,Bt,O);const S=p.ZERO;if(b===Bt)return S;if(this.is0()||b===fe)return this;if(!v||P.hasPrecomputes(this))return P.wNAFCachedUnsafe(this,b,p.normalizeZ);let{k1neg:A,k1:C,k2neg:L,k2:T}=v.splitScalar(b),N=S,B=S,j=this;for(;C>Bt||T>Bt;)C&fe&&(N=N.add(j)),T&fe&&(B=B.add(j)),j=j.double(),C>>=fe,T>>=fe;return A&&(N=N.negate()),L&&(B=B.negate()),B=new p(r.mul(B.px,v.beta),B.py,B.pz),N.add(B)}multiply(b){const{endo:v,n:O}=e;Qt("scalar",b,fe,O);let S,A;if(v){const{k1neg:C,k1:L,k2neg:T,k2:N}=v.splitScalar(b);let{p:B,f:j}=this.wNAF(L),{p:w,f:y}=this.wNAF(N);B=P.constTimeNegate(C,B),w=P.constTimeNegate(T,w),w=new p(r.mul(w.px,v.beta),w.py,w.pz),S=B.add(w),A=j.add(y)}else{const{p:C,f:L}=this.wNAF(b);S=C,A=L}return p.normalizeZ([S,A])[0]}multiplyAndAddUnsafe(b,v,O){const S=p.BASE,A=(L,T)=>T===Bt||T===fe||!L.equals(S)?L.multiplyUnsafe(T):L.multiply(T),C=A(this,v).add(A(b,O));return C.is0()?void 0:C}toAffine(b){return g(this,b)}isTorsionFree(){const{h:b,isTorsionFree:v}=e;if(b===fe)return!0;if(v)return v(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:v}=e;return b===fe?this:v?v(p,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return bn("isCompressed",b),this.assertValidity(),i(p,this,b)}toHex(b=!0){return bn("isCompressed",b),wn(this.toRawBytes(b))}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO);const{endo:_,nBitLength:R}=e,P=Xv(p,_?Math.ceil(R/2):R);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function l2(t){const e=Jh(t);return En(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(It({lowS:!0},e))}function h2(t){const e=l2(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(w){return He(w,n)}function u(w){return Bo(w,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:g}=u2(oo(It({},e),{toBytes(w,y,E){const D=y.toAffine(),x=r.toBytes(D.x),I=Ii;return bn("isCompressed",E),E?I(Uint8Array.from([y.hasEvenY()?2:3]),x):I(Uint8Array.from([4]),x,r.toBytes(D.y))},fromBytes(w){const y=w.length,E=w[0],D=w.subarray(1);if(y===o&&(E===2||E===3)){const x=dr(D);if(!To(x,fe,r.ORDER))throw new Error("Point is not on curve");const I=f(x);let $;try{$=r.sqrt(I)}catch(k){const H=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+H)}const F=($&fe)===fe;return(E&1)===1!==F&&($=r.neg($)),{x,y:$}}else if(y===a&&E===4){const x=r.fromBytes(D.subarray(0,r.BYTES)),I=r.fromBytes(D.subarray(r.BYTES,2*r.BYTES));return{x,y:I}}else{const x=o,I=a;throw new Error("invalid Point, expected length of "+x+", or uncompressed "+I+", got "+y)}}}));function d(w){const y=n>>fe;return w>y}function p(w){return d(w)?c(-w):w}const _=(w,y,E)=>dr(w.slice(y,E));class R{constructor(y,E,D){Qt("r",y,fe,n),Qt("s",E,fe,n),this.r=y,this.s=E,D!=null&&(this.recovery=D),Object.freeze(this)}static fromCompact(y){const E=i;return y=ke("compactSignature",y,E*2),new R(_(y,0,E),_(y,E,2*E))}static fromDER(y){const{r:E,s:D}=Rt.toSig(ke("DER",y));return new R(E,D)}assertValidity(){}addRecoveryBit(y){return new R(this.r,this.s,y)}recoverPublicKey(y){const{r:E,s:D,recovery:x}=this,I=S(ke("msgHash",y));if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");const $=x===2||x===3?E+e.n:E;if($>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=(x&1)===0?"02":"03",k=l.fromHex(F+zo($,r.BYTES)),H=u($),V=c(-I*H),K=c(D*H),G=l.BASE.multiplyAndAddUnsafe(k,V,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new R(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Si(this.toDERHex())}toDERHex(){return Rt.hexFromSig(this)}toCompactRawBytes(){return Si(this.toCompactHex())}toCompactHex(){const y=i;return zo(this.r,y)+zo(this.s,y)}}const P={isValidPrivateKey(w){try{return h(w),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const w=Wh(e.n);return Gv(e.randomBytes(w),e.n)},precompute(w=8,y=l.BASE){return y._setWindowSize(w),y.multiply(BigInt(3)),y}};function m(w,y=!0){return l.fromPrivateKey(w).toRawBytes(y)}function b(w){if(typeof w=="bigint")return!1;if(w instanceof l)return!0;const y=ke("key",w).length,E=r.BYTES,D=E+1,x=2*E+1;if(!(e.allowedPrivateKeyLengths||i===D))return y===D||y===x}function v(w,y,E=!0){if(b(w)===!0)throw new Error("first arg must be private key");if(b(y)===!1)throw new Error("second arg must be public key");return l.fromHex(y).multiply(h(w)).toRawBytes(E)}const O=e.bits2int||function(w){if(w.length>8192)throw new Error("input is too large");const y=dr(w),E=w.length*8-s;return E>0?y>>BigInt(E):y},S=e.bits2int_modN||function(w){return c(O(w))},A=Oi(s);function C(w){return Qt("num < 2^"+s,w,Bt,A),mn(w,i)}function L(w,y,E=T){if(["recovered","canonical"].some(W=>W in E))throw new Error("sign() legacy options not supported");const{hash:D,randomBytes:x}=e;let{lowS:I,prehash:$,extraEntropy:F}=E;I==null&&(I=!0),w=ke("msgHash",w),ef(E),$&&(w=ke("prehashed msgHash",D(w)));const k=S(w),H=h(y),V=[C(H),C(k)];if(F!=null&&F!==!1){const W=F===!0?x(r.BYTES):F;V.push(ke("extraEntropy",W))}const K=Ii(...V),G=k;function ee(W){const se=O(W);if(!g(se))return;const De=u(se),Ie=l.BASE.multiply(se).toAffine(),Ee=c(Ie.x);if(Ee===Bt)return;const Oe=c(De*c(G+Ee*H));if(Oe===Bt)return;let Ce=(Ie.x===Ee?0:2)|Number(Ie.y&fe),br=Oe;return I&&d(Oe)&&(br=p(Oe),Ce^=1),new R(Ee,br,Ce)}return{seed:K,k2sig:ee}}const T={lowS:e.lowS,prehash:!1},N={lowS:e.lowS,prehash:!1};function B(w,y,E=T){const{seed:D,k2sig:x}=L(w,y,E),I=e;return zv(I.hash.outputLen,I.nByteLength,I.hmac)(D,x)}l.BASE._setWindowSize(8);function j(w,y,E,D=N){var x;const I=w;y=ke("msgHash",y),E=ke("publicKey",E);const{lowS:$,prehash:F,format:k}=D;if(ef(D),"strict"in D)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&k!=="compact"&&k!=="der")throw new Error("format must be compact or der");const H=typeof I=="string"||yn(I),V=!H&&!k&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!H&&!V)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let K,G;try{if(V&&(K=new R(I.r,I.s)),H){try{k!=="compact"&&(K=R.fromDER(I))}catch(Ce){if(!(Ce instanceof Rt.Err))throw Ce}!K&&k!=="der"&&(K=R.fromCompact(I))}G=l.fromHex(E)}catch{return!1}if(!K||$&&K.hasHighS())return!1;F&&(y=e.hash(y));const{r:ee,s:W}=K,se=S(y),De=u(W),Ie=c(se*De),Ee=c(ee*De),Oe=(x=l.BASE.multiplyAndAddUnsafe(G,Ie,Ee))==null?void 0:x.toAffine();return Oe?c(Oe.x)===ee:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:v,sign:B,verify:j,ProjectivePoint:l,Signature:R,utils:P}}function f2(t){return{hash:t,hmac:(e,...r)=>vi(t,e,zE(...r)),randomBytes:Pr}}function ko(t,e){const r=n=>h2(It(It({},t),f2(n)));return oo(It({},r(e)),{create:r})}const tf=vn(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),d2=tf.create(BigInt("-3")),g2=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p2=ko({a:d2,b:g2,Fp:tf,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},vh),rf=vn(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),y2=rf.create(BigInt("-3")),b2=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");ko({a:y2,b:b2,Fp:rf,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},sv);const nf=vn(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),w2=nf.create(BigInt("-3")),m2=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");ko({a:w2,b:m2,Fp:nf,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},iv);const E2=p2,sf="base10",Be="base16",pr="base64pad",Mo="base64url",xn="utf8",of=0,Ur=1,Ti=2,v2=0,af=1,Sn=12,Ho=32;function _2(){const t=Fo.utils.randomPrivateKey(),e=Fo.getPublicKey(t);return{privateKey:ze(t,Be),publicKey:ze(e,Be)}}function Vo(){const t=Pr(Ho);return ze(t,Be)}function x2(t,e){const r=Fo.getSharedSecret(We(t,Be),We(e,Be)),n=Lv(_i,r,void 0,void 0,Ho);return ze(n,Be)}function S2(t){const e=_i(We(t,Be));return ze(e,Be)}function Ri(t){const e=_i(We(t,xn));return ze(e,Be)}function cf(t){return We(`${t}`,sf)}function yr(t){return Number(ze(t,sf))}function uf(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function lf(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function D2(t){const e=cf(typeof t.type<"u"?t.type:of);if(yr(e)===Ur&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?We(t.senderPublicKey,Be):void 0,n=typeof t.iv<"u"?We(t.iv,Be):Pr(Sn),i=We(t.symKey,Be),s=Bh(i,n).encrypt(We(t.message,xn)),o=hf({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===Mo?uf(o):o}function I2(t){const e=We(t.symKey,Be),{sealed:r,iv:n}=Dn({encoded:t.encoded,encoding:t.encoding}),i=Bh(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return ze(i,xn)}function O2(t,e){const r=cf(Ti),n=Pr(Sn),i=We(t,xn),s=hf({type:r,sealed:i,iv:n});return e===Mo?uf(s):s}function A2(t,e){const{sealed:r}=Dn({encoded:t,encoding:e});return ze(r,xn)}function hf(t){if(yr(t.type)===Ti)return ze(cn([t.type,t.sealed]),pr);if(yr(t.type)===Ur){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ze(cn([t.type,t.senderPublicKey,t.iv,t.sealed]),pr)}return ze(cn([t.type,t.iv,t.sealed]),pr)}function Dn(t){const e=(t.encoding||pr)===Mo?lf(t.encoded):t.encoded,r=We(e,pr),n=r.slice(v2,af),i=af;if(yr(n)===Ur){const c=i+Ho,u=c+Sn,l=r.slice(i,c),h=r.slice(c,u),f=r.slice(u);return{type:n,sealed:f,iv:h,senderPublicKey:l}}if(yr(n)===Ti){const c=r.slice(i),u=Pr(Sn);return{type:n,sealed:c,iv:u}}const s=i+Sn,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function T2(t,e){const r=Dn({encoded:t,encoding:e?.encoding});return ff({type:yr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ze(r.senderPublicKey,Be):void 0,receiverPublicKey:e?.receiverPublicKey})}function ff(t){const e=t?.type||of;if(e===Ur){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function df(t){return t.type===Ur&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function gf(t){return t.type===Ti}function R2(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return cn([new Uint8Array([4]),e,r])}function B2(t,e){const[r,n,i]=t.split("."),s=Buffer.from(lf(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=_i(c),l=R2(e);if(!E2.verify(cn([o,a]),u,l))throw new Error("Invalid signature");return _s(t).payload}const C2="irn";function Bi(t){return t?.relay||{protocol:C2}}function In(t){const e=oE[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function N2(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function pf(t){if(!t.includes("wc:")){const u=sh(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:P2(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:N2(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function P2(t){return t.startsWith("//")?t.substring(2):t}function $2(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function yf(t){const e=new URLSearchParams,r=$2(t.relay);Object.keys(r).sort().forEach(i=>{e.set(i,r[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const n=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${n}`}const L2={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},U2={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(t,e){const{message:r,code:n}=U2[t];return{message:e?`${r} ${e}`:r,code:n}}function On(t,e){const{message:r,code:n}=L2[t];return{message:e?`${r} ${e}`:r,code:n}}function Ci(t){return typeof t>"u"}function bf(t,e){return e&&Ci(t)?!0:typeof t=="string"&&!!t.trim().length}function F2(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(bf(t,!1)){if(e(t))return!0;const r=sh(t);return e(r)}}catch{}return!1}function z2(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function j2(t){return t?.topic}function Ko(t){return typeof t<"u"&&typeof t!==null}function wf(){const t=bi();return new Promise(e=>{switch(t){case at.browser:e(k2());break;case at.reactNative:e(M2());break;case at.node:e(H2());break;default:e(!0)}})}function k2(){return un()&&navigator?.onLine}async function M2(){if(fr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function H2(){return!0}function V2(t){switch(bi()){case at.browser:K2(t);break;case at.reactNative:q2(t);break}}function K2(t){!fr()&&un()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function q2(t){fr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function W2(){var t;return un()&&Ar()?((t=Ar())==null?void 0:t.visibilityState)==="visible":!0}var G2=Object.defineProperty,Y2=(t,e,r)=>e in t?G2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wt=(t,e,r)=>Y2(t,typeof e!="symbol"?e+"":e,r);class mf{constructor(e,r){this.core=e,this.logger=r,wt(this,"keychain",new Map),wt(this,"name",Xa),wt(this,"version",Ja),wt(this,"initialized",!1),wt(this,"storagePrefix",st),wt(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),wt(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),wt(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),wt(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=J("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),wt(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Pe(r,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ao(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?co(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Z2=Object.defineProperty,X2=(t,e,r)=>e in t?Z2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,we=(t,e,r)=>X2(t,typeof e!="symbol"?e+"":e,r);class Ef{constructor(e,r,n){this.core=e,this.logger=r,we(this,"name",Ya),we(this,"keychain"),we(this,"randomSessionIdentifier",Vo()),we(this,"initialized",!1),we(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),we(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),we(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=Eu(i);return mu(s.publicKey)}),we(this,"generateKeyPair",()=>{this.isInitialized();const i=_2();return this.setPrivateKey(i.publicKey,i.privateKey)}),we(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Eu(s),a=this.randomSessionIdentifier;return await _b(a,i,Za,o)}),we(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=x2(a,s);return this.setSymKey(c,o)}),we(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||S2(i);return await this.keychain.set(o,i),o}),we(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),we(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),we(this,"encode",async(i,s,o)=>{this.isInitialized();const a=ff(o),c=sr(s);if(gf(a))return O2(c,o?.encoding);if(df(a)){const f=a.senderPublicKey,g=a.receiverPublicKey;i=await this.generateSharedKey(f,g)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return D2({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),we(this,"decode",async(i,s,o)=>{this.isInitialized();const a=T2(s,o);if(gf(a)){const c=A2(s,o?.encoding);return Er(c)}if(df(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=I2({symKey:c,encoded:s,encoding:o?.encoding});return Er(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),we(this,"getPayloadType",(i,s=pr)=>{const o=Dn({encoded:i,encoding:s});return yr(o.type)}),we(this,"getPayloadSenderPublicKey",(i,s=pr)=>{const o=Dn({encoded:i,encoding:s});return o.senderPublicKey?ze(o.senderPublicKey,Be):void 0}),this.core=e,this.logger=Pe(r,this.name),this.keychain=n||new mf(this.core,this.logger)}get context(){return Ke(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ji)}catch{e=Vo(),await this.keychain.set(Ji,e)}return We(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var J2=Object.defineProperty,Q2=Object.defineProperties,e_=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,qo=(t,e,r)=>e in t?J2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,n_=(t,e)=>{for(var r in e||(e={}))t_.call(e,r)&&qo(t,r,e[r]);if(vf)for(var r of vf(e))r_.call(e,r)&&qo(t,r,e[r]);return t},i_=(t,e)=>Q2(t,e_(e)),Xe=(t,e,r)=>qo(t,typeof e!="symbol"?e+"":e,r);class _f extends dp{constructor(e,r){super(e,r),this.logger=e,this.core=r,Xe(this,"messages",new Map),Xe(this,"messagesWithoutClientAck",new Map),Xe(this,"name",Qa),Xe(this,"version",ec),Xe(this,"initialized",!1),Xe(this,"storagePrefix",st),Xe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Xe(this,"set",async(n,i,s)=>{this.isInitialized();const o=Ri(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===Wr.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,i_(n_({},c),{[o]:i}))}return await this.persist(),o}),Xe(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),Xe(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),Xe(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=Ri(i);return typeof s[o]<"u"}),Xe(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=Ri(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),Xe(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Pe(e,this.name),this.core=r}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ao(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ao(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?co(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?co(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}const s_="PARSE_ERROR",o_="INVALID_REQUEST",a_="METHOD_NOT_FOUND",c_="INVALID_PARAMS",xf="INTERNAL_ERROR",Wo="SERVER_ERROR",u_=[-32700,-32600,-32601,-32602,-32603],An={[s_]:{code:-32700,message:"Parse error"},[o_]:{code:-32600,message:"Invalid Request"},[a_]:{code:-32601,message:"Method not found"},[c_]:{code:-32602,message:"Invalid params"},[xf]:{code:-32603,message:"Internal error"},[Wo]:{code:-32e3,message:"Server error"}},Sf=Wo;function l_(t){return u_.includes(t)}function Df(t){return Object.keys(An).includes(t)?An[t]:An[Sf]}function h_(t){const e=Object.values(An).find(r=>r.code===t);return e||An[Sf]}function f_(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var If={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Go=function(t,e){return Go=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Go(t,e)};function d_(t,e){Go(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Yo=function(){return Yo=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Yo.apply(this,arguments)};function g_(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function p_(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function y_(t,e){return function(r,n){e(r,n,t)}}function b_(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function w_(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function m_(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function E_(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function v_(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Zo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Of(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function __(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Of(arguments[e]));return t}function x_(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Tn(t){return this instanceof Tn?(this.v=t,this):new Tn(t)}function S_(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(g){return new Promise(function(d,p){s.push([f,g,d,p])>1||a(f,g)})})}function a(f,g){try{c(n[f](g))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Tn?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,g){f(g),s.shift(),s.length&&a(s[0][0],s[0][1])}}function D_(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Tn(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function I_(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Zo=="function"?Zo(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function O_(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function A_(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function T_(t){return t&&t.__esModule?t:{default:t}}function R_(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function B_(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var C_=Object.freeze({__proto__:null,__extends:d_,get __assign(){return Yo},__rest:g_,__decorate:p_,__param:y_,__metadata:b_,__awaiter:w_,__generator:m_,__createBinding:E_,__exportStar:v_,__values:Zo,__read:Of,__spread:__,__spreadArrays:x_,__await:Tn,__asyncGenerator:S_,__asyncDelegator:D_,__asyncValues:I_,__makeTemplateObject:O_,__importStar:A_,__importDefault:T_,__classPrivateFieldGet:R_,__classPrivateFieldSet:B_}),N_=la(C_),Ct={},Af;function P_(){if(Af)return Ct;Af=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isBrowserCryptoAvailable=Ct.getSubtleCrypto=Ct.getBrowerCrypto=void 0;function t(){return ft?.crypto||ft?.msCrypto||{}}Ct.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Ct.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ct.isBrowserCryptoAvailable=r,Ct}var Nt={},Tf;function $_(){if(Tf)return Nt;Tf=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.isBrowser=Nt.isNode=Nt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Nt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Nt.isNode=e;function r(){return!t()&&!e()}return Nt.isBrowser=r,Nt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=N_;e.__exportStar(P_(),t),e.__exportStar($_(),t)})(If);function Rf(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Xo(t=6){return BigInt(Rf(t))}function Jo(t,e,r){return{id:r||Rf(),jsonrpc:"2.0",method:t,params:e}}function Bf(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Cf(t,e,r){return{id:t,jsonrpc:"2.0",error:L_(e,r)}}function L_(t,e){return typeof t>"u"?Df(xf):(typeof t=="string"&&(t=Object.assign(Object.assign({},Df(Wo)),{message:t})),typeof e<"u"&&(t.data=e),l_(t.code)&&(t=h_(t.code)),t)}class U_{}class F_ extends U_{constructor(){super()}}class z_ extends F_{constructor(e){super()}}const j_="^wss?:";function k_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function M_(t,e){const r=k_(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Nf(t){return M_(t,j_)}function H_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Pf(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function $f(t){return Pf(t)&&"method"in t}function Qo(t){return Pf(t)&&(Lf(t)||Ni(t))}function Lf(t){return"result"in t}function Ni(t){return"error"in t}class V_ extends z_{constructor(e){super(e),this.events=new Je.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Jo(e.method,e.params||[],e.id||Xo().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{Ni(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Qo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const K_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),q_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Uf=t=>t.split("?")[0],Ff=10,W_=K_();class G_{constructor(e){if(this.url=e,this.events=new Je.exports.EventEmitter,this.registering=!1,!Nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(sr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Nf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=If.isReactNative()?void 0:{rejectUnauthorized:!H_(e)},s=new W_(e,[],i);q_()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Er(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Cf(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return f_(e,Uf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ff&&this.events.setMaxListeners(Ff)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Uf(this.url)}`));return this.events.emit("register_error",r),r}}var Y_=Object.defineProperty,Z_=Object.defineProperties,X_=Object.getOwnPropertyDescriptors,zf=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,Q_=Object.prototype.propertyIsEnumerable,ea=(t,e,r)=>e in t?Y_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pi=(t,e)=>{for(var r in e||(e={}))J_.call(e,r)&&ea(t,r,e[r]);if(zf)for(var r of zf(e))Q_.call(e,r)&&ea(t,r,e[r]);return t},ta=(t,e)=>Z_(t,X_(e)),ht=(t,e,r)=>ea(t,typeof e!="symbol"?e+"":e,r);class e3 extends gp{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ht(this,"events",new Je.exports.EventEmitter),ht(this,"name",tc),ht(this,"queue",new Map),ht(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),ht(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ht(this,"needsTransportRestart",!1),ht(this,"publish",async(n,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const a=s?.ttl||Qi,c=Bi(s),u=s?.prompt||!1,l=s?.tag||0,h=s?.id||Xo().toString(),f={topic:n,message:i,opts:{ttl:a,relay:c,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}},g=`Failed to publish payload, please try again. id:${h} tag:${l}`;try{const d=new Promise(async p=>{const _=({id:P})=>{f.opts.id===P&&(this.removeRequestFromQueue(P),this.relayer.events.removeListener(ge.publish,_),p(f))};this.relayer.events.on(ge.publish,_);const R=jt(new Promise((P,m)=>{this.rpcPublish({topic:n,message:i,ttl:a,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}).then(P).catch(b=>{this.logger.warn(b,b?.message),m(b)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${l}`);try{await R,this.events.removeListener(ge.publish,_)}catch(P){this.queue.set(h,ta(Pi({},f),{attempt:1})),this.logger.warn(P,P?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:n,message:i,opts:s}}),await jt(d,this.publishTimeout,g)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw d}finally{this.queue.delete(h)}}),ht(this,"on",(n,i)=>{this.events.on(n,i)}),ht(this,"once",(n,i)=>{this.events.once(n,i)}),ht(this,"off",(n,i)=>{this.events.off(n,i)}),ht(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Pe(r,this.name),this.registerEventListeners()}get context(){return Ke(this.logger)}async rpcPublish(e){var r,n,i,s;const{topic:o,message:a,ttl:c=Qi,prompt:u,tag:l,id:h,attestation:f,tvf:g}=e,d={method:In(Bi().protocol).publish,params:Pi({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:f},g),id:h};Ci((r=d.params)==null?void 0:r.prompt)&&((n=d.params)==null||delete n.prompt),Ci((i=d.params)==null?void 0:i.tag)&&((s=d.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d});const p=await this.relayer.request(d);return this.relayer.events.emit(ge.publish,e),this.logger.debug("Successfully Published Payload"),p}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const n=e.attempt+1;this.queue.set(r,ta(Pi({},e),{attempt:n}));const{topic:i,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(ta(Pi({},e),{topic:i,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(nr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ge.connection_stalled);return}this.checkQueue()}),this.relayer.on(ge.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var t3=Object.defineProperty,r3=(t,e,r)=>e in t?t3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fr=(t,e,r)=>r3(t,typeof e!="symbol"?e+"":e,r);class n3{constructor(){Fr(this,"map",new Map),Fr(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Fr(this,"get",e=>this.map.get(e)||[]),Fr(this,"exists",(e,r)=>this.get(e).includes(r)),Fr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Fr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var i3=Object.defineProperty,s3=Object.defineProperties,o3=Object.getOwnPropertyDescriptors,jf=Object.getOwnPropertySymbols,a3=Object.prototype.hasOwnProperty,c3=Object.prototype.propertyIsEnumerable,ra=(t,e,r)=>e in t?i3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rn=(t,e)=>{for(var r in e||(e={}))a3.call(e,r)&&ra(t,r,e[r]);if(jf)for(var r of jf(e))c3.call(e,r)&&ra(t,r,e[r]);return t},na=(t,e)=>s3(t,o3(e)),te=(t,e,r)=>ra(t,typeof e!="symbol"?e+"":e,r);class kf extends bp{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,te(this,"subscriptions",new Map),te(this,"topicMap",new n3),te(this,"events",new Je.exports.EventEmitter),te(this,"name",uc),te(this,"version",lc),te(this,"pending",new Map),te(this,"cached",[]),te(this,"initialized",!1),te(this,"storagePrefix",st),te(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),te(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),te(this,"clientId"),te(this,"batchSubscribeTopicsLimit",500),te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),te(this,"subscribe",async(n,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=Bi(i),o={topic:n,relay:s,transportType:i?.transportType};this.pending.set(n,o);const a=await this.rpcSubscribe(n,s,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),te(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),te(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),te(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),te(this,"on",(n,i)=>{this.events.on(n,i)}),te(this,"once",(n,i)=>{this.events.once(n,i)}),te(this,"off",(n,i)=>{this.events.off(n,i)}),te(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),te(this,"start",async()=>{await this.onConnect()}),te(this,"stop",async()=>{await this.onDisconnect()}),te(this,"restart",async()=>{await this.restore(),await this.onRestart()}),te(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),te(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(nr.pulse,async()=>{await this.checkPending()}),this.events.on($e.created,async n=>{const i=$e.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on($e.deleted,async n=>{const i=$e.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Pe(r,this.name),this.clientId=""}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Bi(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=On("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i;(!n||n?.transportType===or.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:In(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(i=n?.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(n?.transportType===or.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},M.toMiliseconds(M.ONE_SECOND)),a;const c=new Promise(async l=>{const h=f=>{f.topic===e&&(this.events.removeListener($e.created,h),l(f.id))};this.events.on($e.created,h);try{const f=await jt(new Promise((g,d)=>{this.relayer.request(s).catch(p=>{this.logger.warn(p,p?.message),d(p)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener($e.created,h),l(f)}catch{}}),u=await jt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ge.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:In(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await jt(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ge.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:In(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await jt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ge.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:In(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,na(Rn({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Rn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Rn({},r)),this.topicMap.set(r.topic,e),this.events.emit($e.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit($e.deleted,na(Rn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit($e.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit($e.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>na(Rn({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await DE(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ri(e+await this.getClientId())}}var u3=Object.defineProperty,Mf=Object.getOwnPropertySymbols,l3=Object.prototype.hasOwnProperty,h3=Object.prototype.propertyIsEnumerable,ia=(t,e,r)=>e in t?u3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hf=(t,e)=>{for(var r in e||(e={}))l3.call(e,r)&&ia(t,r,e[r]);if(Mf)for(var r of Mf(e))h3.call(e,r)&&ia(t,r,e[r]);return t},X=(t,e,r)=>ia(t,typeof e!="symbol"?e+"":e,r);class Vf extends pp{constructor(e){super(e),X(this,"protocol","wc"),X(this,"version",2),X(this,"core"),X(this,"logger"),X(this,"events",new Je.exports.EventEmitter),X(this,"provider"),X(this,"messages"),X(this,"subscriber"),X(this,"publisher"),X(this,"name",ic),X(this,"transportExplicitlyClosed",!1),X(this,"initialized",!1),X(this,"connectionAttemptInProgress",!1),X(this,"relayUrl"),X(this,"projectId"),X(this,"packageName"),X(this,"bundleId"),X(this,"hasExperiencedNetworkDisruption",!1),X(this,"pingTimeout"),X(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),X(this,"reconnectTimeout"),X(this,"connectPromise"),X(this,"reconnectInProgress",!1),X(this,"requestsInFlight",[]),X(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),X(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||Xo().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),X(this,"resetPingTimeout",()=>{yi()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),X(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),X(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(ge.connect)}),X(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),X(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(ge.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),X(this,"registerProviderListeners",()=>{this.provider.on(qe.payload,this.onPayloadHandler),this.provider.on(qe.connect,this.onConnectHandler),this.provider.on(qe.disconnect,this.onDisconnectHandler),this.provider.on(qe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Pe(e.logger,this.name):Pt(Ka({level:e.logger||nc})),this.messages=new _f(this.logger,e.core),this.subscriber=new kf(this,this.logger),this.publisher=new e3(this,this.logger),this.relayUrl=e?.relayUrl||es,this.projectId=e.projectId,gE()?this.packageName=Ql():pE()&&(this.bundleId=Ql()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return Ke(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:or.relay},Wr.outbound)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off($e.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on($e.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,Hf({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await jt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await wf())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=ln(M.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(ge.message,e),await this.recordMessageEvent(e,Wr.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(qe.disconnect,s),await jt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(qe.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(qe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(qe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(yi())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new V_(new G_(EE({sdkVersion:Kn,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),$f(e)){if(!e.method.endsWith(sc))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:or.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Hf({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Qo(e)&&this.events.emit(ge.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Wr.inbound),this.events.emit(ge.message,e))}async acknowledgePayload(e){const r=Bf(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(qe.payload,this.onPayloadHandler),this.provider.off(qe.connect,this.onConnectHandler),this.provider.off(qe.disconnect,this.onDisconnectHandler),this.provider.off(qe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await wf();V2(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(nr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&W2())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ge.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(oc)))))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function f3(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Kf(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function qf(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const d3="[object RegExp]",g3="[object String]",p3="[object Number]",y3="[object Boolean]",Wf="[object Arguments]",b3="[object Symbol]",w3="[object Date]",m3="[object Map]",E3="[object Set]",v3="[object Array]",_3="[object Function]",x3="[object ArrayBuffer]",sa="[object Object]",S3="[object Error]",D3="[object DataView]",I3="[object Uint8Array]",O3="[object Uint8ClampedArray]",A3="[object Uint16Array]",T3="[object Uint32Array]",R3="[object BigUint64Array]",B3="[object Int8Array]",C3="[object Int16Array]",N3="[object Int32Array]",P3="[object BigInt64Array]",$3="[object Float32Array]",L3="[object Float64Array]";function Gf(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function U3(t,e,r){return Bn(t,e,void 0,void 0,void 0,void 0,r)}function Bn(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Cn(t,e,s,o)}return Cn(t,e,s,o)}function Cn(t,e,r,n){if(Object.is(t,e))return!0;let i=qf(t),s=qf(e);if(i===Wf&&(i=sa),s===Wf&&(s=sa),i!==s)return!1;switch(i){case g3:return t.toString()===e.toString();case p3:{const c=t.valueOf(),u=e.valueOf();return f3(c,u)}case y3:case w3:case b3:return Object.is(t.valueOf(),e.valueOf());case d3:return t.source===e.source&&t.flags===e.flags;case _3:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case m3:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Bn(u,e.get(c),c,t,e,r,n))return!1;return!0}case E3:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(g=>Bn(h,g,void 0,t,e,r,n));if(f===-1)return!1;u.splice(f,1)}return!0}case v3:case I3:case O3:case A3:case T3:case R3:case B3:case C3:case N3:case P3:case $3:case L3:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Bn(t[c],e[c],c,t,e,r,n))return!1;return!0}case x3:return t.byteLength!==e.byteLength?!1:Cn(new Uint8Array(t),new Uint8Array(e),r,n);case D3:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Cn(new Uint8Array(t),new Uint8Array(e),r,n);case S3:return t.name===e.name&&t.message===e.message;case sa:{if(!(Cn(t.constructor,e.constructor,r,n)||Gf(t)&&Gf(e)))return!1;const u=[...Object.keys(t),...Kf(t)],l=[...Object.keys(e),...Kf(e)];if(u.length!==l.length)return!1;for(let h=0;h<u.length;h++){const f=u[h],g=t[f];if(!Object.hasOwn(e,f))return!1;const d=e[f];if(!Bn(g,d,f,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function F3(){}function z3(t,e){return U3(t,e,F3)}var j3=Object.defineProperty,Yf=Object.getOwnPropertySymbols,k3=Object.prototype.hasOwnProperty,M3=Object.prototype.propertyIsEnumerable,oa=(t,e,r)=>e in t?j3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zf=(t,e)=>{for(var r in e||(e={}))k3.call(e,r)&&oa(t,r,e[r]);if(Yf)for(var r of Yf(e))M3.call(e,r)&&oa(t,r,e[r]);return t},Ve=(t,e,r)=>oa(t,typeof e!="symbol"?e+"":e,r);class Xf extends yp{constructor(e,r,n,i=st,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Ve(this,"map",new Map),Ve(this,"version",ac),Ve(this,"cached",[]),Ve(this,"initialized",!1),Ve(this,"getKey"),Ve(this,"storagePrefix",st),Ve(this,"recentlyDeleted",[]),Ve(this,"recentlyDeletedLimit",200),Ve(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ci(o)?this.map.set(this.getKey(o),o):z2(o)?this.map.set(o.id,o):j2(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ve(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ve(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ve(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>z3(a[c],o[c]))):this.values)),Ve(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Zf(Zf({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ve(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Pe(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=J("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var H3=Object.defineProperty,V3=(t,e,r)=>e in t?H3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Y=(t,e,r)=>V3(t,typeof e!="symbol"?e+"":e,r);class Jf{constructor(e,r){this.core=e,this.logger=r,Y(this,"name",hc),Y(this,"version",fc),Y(this,"events",new Je.exports),Y(this,"pairings"),Y(this,"initialized",!1),Y(this,"storagePrefix",st),Y(this,"ignoredPayloadTypes",[Ur]),Y(this,"registeredMethods",[]),Y(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Y(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),Y(this,"create",async n=>{this.isInitialized();const i=Vo(),s=await this.core.crypto.setSymKey(i),o=ln(M.FIVE_MINUTES),a={protocol:rc},c={topic:s,expiry:o,relay:a,active:!1,methods:n?.methods},u=yf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(Sr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n?.transportType}),{topic:s,uri:u}}),Y(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[gt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=pf(n.uri);i.props.properties.topic=s,i.addTrace(gt.pairing_uri_validation_success),i.addTrace(gt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(gt.existing_pairing),l.active)throw i.setError(mt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(gt.pairing_not_expired)}const h=c||ln(M.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(gt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Sr.create,f),i.addTrace(gt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(gt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(mt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(g){throw i.setError(mt.subscribe_pairing_topic_failure),g}return i.addTrace(gt.subscribe_pairing_topic_success),f}),Y(this,"activate",async({topic:n})=>{this.isInitialized();const i=ln(M.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),Y(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=vE();this.events.once(uo("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),Y(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),Y(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),Y(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Y(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",On("USER_DISCONNECTED")),await this.deletePairing(i))}),Y(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return yf({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),Y(this,"sendRequest",async(n,i,s)=>{const o=Jo(i,s),a=await this.core.crypto.encode(n,o),c=xr[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),Y(this,"sendResult",async(n,i,s)=>{const o=Bf(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=xr[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Y(this,"sendError",async(n,i,s)=>{const o=Cf(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=xr[c]?xr[c].res:xr.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Y(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,On("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),Y(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>rh(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),Y(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),Y(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),Y(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Sr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Y(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{Lf(i)?this.events.emit(uo("pairing_ping",s),{}):Ni(i)&&this.events.emit(uo("pairing_ping",s),{error:i.error})},500)}),Y(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Sr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Y(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=On("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),Y(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(On("WC_METHOD_UNSUPPORTED",n))}),Y(this,"isValidPair",(n,i)=>{var s;if(!Ko(n)){const{message:a}=J("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(mt.malformed_pairing_uri),new Error(a)}if(!F2(n.uri)){const{message:a}=J("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(mt.malformed_pairing_uri),new Error(a)}const o=pf(n?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=J("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(mt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=J("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(mt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(mt.pairing_expired);const{message:a}=J("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Y(this,"isValidPing",async n=>{if(!Ko(n)){const{message:s}=J("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Y(this,"isValidDisconnect",async n=>{if(!Ko(n)){const{message:s}=J("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Y(this,"isValidPairingTopic",async n=>{if(!bf(n,!1)){const{message:i}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(rh(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=J("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Pe(r,this.name),this.pairings=new Xf(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ke(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ge.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==or.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);$f(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Qo(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(et.expired,async e=>{const{topic:r}=SE(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Sr.expire,{topic:r}))})}}var K3=Object.defineProperty,q3=(t,e,r)=>e in t?K3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,me=(t,e,r)=>q3(t,typeof e!="symbol"?e+"":e,r);class Qf extends fp{constructor(e,r){super(e,r),this.core=e,this.logger=r,me(this,"records",new Map),me(this,"events",new Je.exports.EventEmitter),me(this,"name",dc),me(this,"version",gc),me(this,"cached",[]),me(this,"initialized",!1),me(this,"storagePrefix",st),me(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),me(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:ln(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Qe.created,o)}),me(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=Ni(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(Qe.updated,i))}),me(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),me(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Qe.deleted,s)}}),this.persist()}),me(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),me(this,"on",(n,i)=>{this.events.on(n,i)}),me(this,"once",(n,i)=>{this.events.once(n,i)}),me(this,"off",(n,i)=>{this.events.off(n,i)}),me(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Pe(r,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Jo(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Qe.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Qe.created,e=>{const r=Qe.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Qe.updated,e=>{const r=Qe.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(Qe.deleted,e=>{const r=Qe.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(nr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(Qe.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var W3=Object.defineProperty,G3=(t,e,r)=>e in t?W3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Se=(t,e,r)=>G3(t,typeof e!="symbol"?e+"":e,r);class ed extends wp{constructor(e,r){super(e,r),this.core=e,this.logger=r,Se(this,"expirations",new Map),Se(this,"events",new Je.exports.EventEmitter),Se(this,"name",pc),Se(this,"version",yc),Se(this,"cached",[]),Se(this,"initialized",!1),Se(this,"storagePrefix",st),Se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Se(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Se(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(et.created,{target:s,expiration:o})}),Se(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),Se(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(et.deleted,{target:i,expiration:s})}}),Se(this,"on",(n,i)=>{this.events.on(n,i)}),Se(this,"once",(n,i)=>{this.events.once(n,i)}),Se(this,"off",(n,i)=>{this.events.off(n,i)}),Se(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Pe(r,this.name)}get context(){return Ke(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _E(e);if(typeof e=="number")return xE(e);const{message:r}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;M.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(et.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(nr.pulse,()=>this.checkExpirations()),this.events.on(et.created,e=>{const r=et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(et.expired,e=>{const r=et.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(et.deleted,e=>{const r=et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Y3=Object.defineProperty,Z3=(t,e,r)=>e in t?Y3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e,r)=>Z3(t,typeof e!="symbol"?e+"":e,r);class td extends mp{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,oe(this,"name",bc),oe(this,"abortController"),oe(this,"isDevEnv"),oe(this,"verifyUrlV3",mc),oe(this,"storagePrefix",st),oe(this,"version",Xi),oe(this,"publicKey"),oe(this,"fetchPromise"),oe(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),oe(this,"register",async i=>{if(!un()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Ar(),l=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((f,g)=>{const d=()=>{window.removeEventListener("message",_),u.body.removeChild(p),g("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const p=u.createElement("iframe");p.src=c,p.style.display="none",p.addEventListener("error",d,{signal:this.abortController.signal});const _=R=>{if(R.data&&typeof R.data=="string")try{const P=JSON.parse(R.data);if(P.type==="verify_attestation"){if(_s(P.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(p),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",_),f(P.attestation===null?"":P.attestation)}}catch(P){this.logger.warn(P)}};u.body.appendChild(p),window.addEventListener("message",_,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),oe(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(_s(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),oe(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),oe(this,"getVerifyUrl",i=>{let s=i||Gr;return Ec.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Gr}`),s=Gr),s}),oe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(M.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),oe(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),oe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),oe(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),oe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),oe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),oe(this,"validateAttestation",(i,s)=>{const o=B2(i,s.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Pe(r,this.name),this.abortController=new AbortController,this.isDevEnv=ih(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ke(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var X3=Object.defineProperty,J3=(t,e,r)=>e in t?X3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rd=(t,e,r)=>J3(t,typeof e!="symbol"?e+"":e,r);class nd extends Ep{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,rd(this,"context",vc),rd(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${_c}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Pe(r,this.context)}}var Q3=Object.defineProperty,id=Object.getOwnPropertySymbols,e8=Object.prototype.hasOwnProperty,t8=Object.prototype.propertyIsEnumerable,aa=(t,e,r)=>e in t?Q3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nn=(t,e)=>{for(var r in e||(e={}))e8.call(e,r)&&aa(t,r,e[r]);if(id)for(var r of id(e))t8.call(e,r)&&aa(t,r,e[r]);return t},de=(t,e,r)=>aa(t,typeof e!="symbol"?e+"":e,r);class sd extends vp{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,de(this,"context",Sc),de(this,"storagePrefix",st),de(this,"storageVersion",xc),de(this,"events",new Map),de(this,"shouldPersist",!1),de(this,"init",async()=>{if(!ih())try{const i={eventId:nh(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:eh(this.core.relayer.protocol,this.core.relayer.version,Kn)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),de(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=nh(),l=this.core.projectId||"",h=Date.now(),f=Nn({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),de(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Nn(Nn({},a),this.setMethods(a.eventId))}),de(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),de(this,"setEventListeners",()=>{this.core.heartbeat.on(nr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(i.timestamp)>Dc&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),de(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),de(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),de(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),de(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),de(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Nn(Nn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),de(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),de(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Ic}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Kn}${s}`,{method:"POST",body:JSON.stringify(i)})}),de(this,"getAppDomain",()=>bE().url),this.logger=Pe(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var r8=Object.defineProperty,od=Object.getOwnPropertySymbols,n8=Object.prototype.hasOwnProperty,i8=Object.prototype.propertyIsEnumerable,ca=(t,e,r)=>e in t?r8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ad=(t,e)=>{for(var r in e||(e={}))n8.call(e,r)&&ca(t,r,e[r]);if(od)for(var r of od(e))i8.call(e,r)&&ca(t,r,e[r]);return t},ne=(t,e,r)=>ca(t,typeof e!="symbol"?e+"":e,r);class $i extends cp{constructor(e){var r;super(e),ne(this,"protocol",Zi),ne(this,"version",Xi),ne(this,"name",qr),ne(this,"relayUrl"),ne(this,"projectId"),ne(this,"customStoragePrefix"),ne(this,"events",new Je.exports.EventEmitter),ne(this,"logger"),ne(this,"heartbeat"),ne(this,"relayer"),ne(this,"crypto"),ne(this,"storage"),ne(this,"history"),ne(this,"expirer"),ne(this,"pairing"),ne(this,"verify"),ne(this,"echoClient"),ne(this,"linkModeSupportedApps"),ne(this,"eventClient"),ne(this,"initialized",!1),ne(this,"logChunkController"),ne(this,"on",(a,c)=>this.events.on(a,c)),ne(this,"once",(a,c)=>this.events.once(a,c)),ne(this,"off",(a,c)=>this.events.off(a,c)),ne(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ne(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:or.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||es,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Ka({level:typeof e?.logger=="string"&&e.logger?e.logger:Wa.logger,name:qr}),{logger:s,chunkLoggerController:o}=sp({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Pe(s,this.name),this.heartbeat=new Hi,this.crypto=new Ef(this,this.logger,e?.keychain),this.history=new Qf(this,this.logger),this.expirer=new ed(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Bg(ad(ad({},Ga),e?.storageOptions)),this.relayer=new Vf({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Jf(this,this.logger),this.verify=new td(this,this.logger,this.storage),this.echoClient=new nd(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new sd(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new $i(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(cc,n),r}get context(){return Ke(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(ts,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ts)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const s8=$i;U.CORE_CONTEXT=qr,U.CORE_DEFAULT=Wa,U.CORE_PROTOCOL=Zi,U.CORE_STORAGE_OPTIONS=Ga,U.CORE_STORAGE_PREFIX=st,U.CORE_VERSION=Xi,U.CRYPTO_CLIENT_SEED=Ji,U.CRYPTO_CONTEXT=Ya,U.CRYPTO_JWT_TTL=Za,U.Core=s8,U.Crypto=Ef,U.ECHO_CONTEXT=vc,U.ECHO_URL=_c,U.EVENTS_CLIENT_API_URL=Ic,U.EVENTS_STORAGE_CLEANUP_INTERVAL=Dc,U.EVENTS_STORAGE_CONTEXT=Sc,U.EVENTS_STORAGE_VERSION=xc,U.EVENT_CLIENT_AUTHENTICATE_ERRORS=Np,U.EVENT_CLIENT_AUTHENTICATE_TRACES=Cp,U.EVENT_CLIENT_CONTEXT=Tp,U.EVENT_CLIENT_PAIRING_ERRORS=mt,U.EVENT_CLIENT_PAIRING_TRACES=gt,U.EVENT_CLIENT_SESSION_ERRORS=Bp,U.EVENT_CLIENT_SESSION_TRACES=Rp,U.EXPIRER_CONTEXT=pc,U.EXPIRER_DEFAULT_TTL=Op,U.EXPIRER_EVENTS=et,U.EXPIRER_STORAGE_VERSION=yc,U.EchoClient=nd,U.EventClient=sd,U.Expirer=ed,U.HISTORY_CONTEXT=dc,U.HISTORY_EVENTS=Qe,U.HISTORY_STORAGE_VERSION=gc,U.JsonRpcHistory=Qf,U.KEYCHAIN_CONTEXT=Xa,U.KEYCHAIN_STORAGE_VERSION=Ja,U.KeyChain=mf,U.MESSAGES_CONTEXT=Qa,U.MESSAGES_STORAGE_VERSION=ec,U.MESSAGE_DIRECTION=Wr,U.MessageTracker=_f,U.PAIRING_CONTEXT=hc,U.PAIRING_DEFAULT_TTL=Ip,U.PAIRING_EVENTS=Sr,U.PAIRING_RPC_OPTS=xr,U.PAIRING_STORAGE_VERSION=fc,U.PENDING_SUB_RESOLUTION_TIMEOUT=Dp,U.PUBLISHER_CONTEXT=tc,U.PUBLISHER_DEFAULT_TTL=Qi,U.Pairing=Jf,U.RELAYER_CONTEXT=ic,U.RELAYER_DEFAULT_LOGGER=nc,U.RELAYER_DEFAULT_PROTOCOL=rc,U.RELAYER_DEFAULT_RELAY_URL=es,U.RELAYER_EVENTS=ge,U.RELAYER_PROVIDER_EVENTS=qe,U.RELAYER_RECONNECT_TIMEOUT=oc,U.RELAYER_SDK_VERSION=Kn,U.RELAYER_STORAGE_OPTIONS=_p,U.RELAYER_SUBSCRIBER_SUFFIX=sc,U.RELAYER_TRANSPORT_CUTOFF=xp,U.Relayer=Vf,U.STORE_STORAGE_VERSION=ac,U.SUBSCRIBER_CONTEXT=uc,U.SUBSCRIBER_DEFAULT_TTL=Sp,U.SUBSCRIBER_EVENTS=$e,U.SUBSCRIBER_STORAGE_VERSION=lc,U.Store=Xf,U.Subscriber=kf,U.TRANSPORT_TYPES=or,U.TRUSTED_VERIFY_URLS=Ec,U.VERIFY_CONTEXT=bc,U.VERIFY_SERVER=Gr,U.VERIFY_SERVER_V3=mc,U.Verify=td,U.WALLETCONNECT_CLIENT_ID=cc,U.WALLETCONNECT_LINK_MODE_APPS=ts,U.default=$i,Object.defineProperty(U,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
